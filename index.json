{"L2Jsb2MvMjAxNS8xMi9jb250ZW5pZG9ycw==":{"date":1449014400000,"title":"Docker: crea, desplega i executa aplicacions en contenidors","description":"Docker és una tecnologia que ha revolucionat el desplegament d’aplicacions i de programari degut a la seva senzillesa, facilitat d'ús i velocitat de  desplegament.","sections":["Bloc","home"],"bloc_tags":["desplegament","contenidors","docker"],"imatge":"/images/bloc/docker/large_h-dark-trans.png","path":"/bloc/2015/12/contenidors","content":"Des de la Unitat d'Arquitectura de CTTI estem avaluant **Docker** com a tecnologia de desplegament d'aplicacions, de cara a utilitzar-la en el futur als clouds de la Generalitat.\r\n\r\nDocker és una tecnologia que ha revolucionat el desplegament d’aplicacions i de programari degut a la seva senzillesa, facilitat d'ús i velocitat de  desplegament.\r\n\r\nEl seu fonament és l’ús de plantilles, anomedades \"imatges\", que inclouen tant el sistema operatiu com les dependències necessàries per a executar les aplicacions. Aquestes imatges són: \r\n\r\n* **Extensibles**, podent partir d'imatges ja creades, i poder-hi afegir les característiques requerides a nivell de programari. \r\n\r\n* **Exportables**: la definició de la imatge consisteix en un fitxer de text (Dockerfile) que pot ser utilitzat per a crear la imatge a qualsevol ordinador/servidor i sistema operatiu.\r\n\r\n* **Lleugeres** en comparació amb les màquines virtuals tradicionals\r\n\r\nA partir de les imatges Docker s'arrenquen els contenidors. Els contenidors són instàncies executades d'una imatge concreta, arrencada amb una sèrie de característiques. Per exemple, una contenidor es pot arrencar amb aïllament de CPU i RAM, i amb volums de dades compartits entre el host i el contenidor per a realitzar certes operacions. \r\n\r\nDegut a que els contenidors no arrenquen un sistema operatiu complet, a diferència de les màquines virtuals, el seu _footprint_ és molt petit i són capaços d'arrencar en pocs segons, aspecte que permet l'escalat automàtic d'aplicacions de manera molt senzilla i sota demanda.\r\n\r\n## Comparativa entre VM i Docker\r\n\r\n![comparativa vm i docker](/images/bloc/docker/vm-vs-container2.png)\r\n\r\nUn altre aspecte a destacar és que els contenidors, i concretament Docker, és una tecnologia adoptada a la majoria de cloud públics (Amazon, Google, Azure, Bluemix, ...), fent dels contenidors una tecnologia portable i àmpliament suportada, junt amb un, cada cop més gran, ecosistema d'eines per a governar el cicle de vida dels contenidors i les imatges.\r\n\r\nA més, els fabricants de software també proporcionen imatges Docker oficials, donant certes garanties sobre la tecnologia i la manera de fer servir els seus productes.\r\n\r\nDes de la Unitat d'Arquitectura, una de les imatges que hem creat és la de **\"Apache GICAR\"**. Aquesta imatge ens permet aixecar instàncies d'Apache amb l'agent de Siteminder instal·lat i configurat en un segon (literalment), amb polítiques i configuracions diverses que es passen al contenidor en el moment de l'arrencada.\r\n\r\n","objectID":"L2Jsb2MvMjAxNS8xMi9jb250ZW5pZG9ycw=="},"L2Jsb2MvMjAxNS8xMi9sbGVuZ3VhdGdlcw==":{"date":1449100800000,"title":"Nous llenguatges i entorns d'execució: Node.js i Golang","description":"Tecnologies de desenvolupament i altres opcions davant noves necessitats dels projectes","sections":["Bloc","home"],"bloc_tags":["desenvolupament"],"imatge":"/images/bloc/nodejs_golang.png","path":"/bloc/2015/12/llenguatges","content":"Des de la Unitat d'Arquitectura fem un seguiment de noves tecnologies de desenvolupament, per a avaluar el seu encaix dins la Generalitat de Catalunya i tenir altres opcions davant noves necessitats dels projectes. \r\n\r\nUs presentem dues que tenim al nostre radar i amb les que ja hem fet alguns projectes:\r\n\r\n## Node.js\r\n\r\n* basat en la màquina de Google Chrome V8\r\n* javascript\r\n* model asíncron\r\n* un únic thread\r\n* la comunitat que més ha crescut als últims anys\r\n* grans empreses l'han adoptat per als seus serveis migrant-los de piles tecnològiques antigues\r\n* Node.js Foundation (https://nodejs.org/en/foundation/members/): fabricants i proveïdors de serveis formen part de la fundació\r\n\r\n\r\n### Experiències a la Generalitat\r\n\r\n* Serveis oberts (http://serveisoberts.gencat.cat ): \r\n\t* és una API d'accés a dades obertes de la Generalitat construïda sobre Node.js i MongoDB.  \r\n\t* exposa una API privada per a la sincronització de dades des dels backends i una API pública de consulta\r\n\t* inclou un \"explorador de dades\" per a cada col·lecció, per a poder visualitzar les dades en un format més amigable (http://serveisoberts.gencat.cat/equipaments/explorer)\r\n\r\n* Microservei per a les aplicacions de mobilitat per a comprovar versions i compatibilitat \r\n\r\n* Diccionari clínic de l'ICS\r\n\r\nResultat: alta productivitat de l'equip de desenvolupament, corba d'aprenentatge relativament petita i gran rendiment de la plataforma.\r\n\r\n\r\n## Golang\r\n\r\n* llenguatge que va sortir dels laboratoris de Google\r\n* intenta millorar aspectes de baix nivell que amb C són més difícils de realitzar\r\n* molt bona gestió de threads i concurrència\r\n* \"garbage collected\"\r\n* compilat\r\n* cross-compiling: des d'un mateix entorn es pot compilar per a diverses arquitectures\r\n\r\n### Experiències a la Generalitat\r\n\r\nHem desenvolupat una eina orientada a avaluar la qualitat de les infraestructures lliurades. \r\n\r\nEn aquest cas, ens permet avaluar si totes les connectivitats necessàries s'han obert, mitjançant el lliurament d'un fitxer de configuració en format YAML adaptat al projecte concret. L'eina genera un informe de resultats que inclou si les diferents connectivitats han estat satisfactòries o no, la data, hora i host en el que s'ha executat, així com un hash per a validar la integritat de l'informe generat.\r\n\r\nL'eina s'afegeix a totes les plantilles d'imatges virtuals de tots els CPDs, de manera que només s'ha d'afegir el fitxer de configuració i executar l'eina. \r\n\r\nCom que l'eina ha de córrer en diferents sistemes operatius i havia de ser compilada - per a evitar dependències externes - i el més lleugera possible, vàrem pensar que Golang podria ser una bona oportunitat. \r\n\r\nResultat: alta productivitat i posada en funcionament realment ràpida.\r\n","objectID":"L2Jsb2MvMjAxNS8xMi9sbGVuZ3VhdGdlcw=="},"L2Jsb2MvMjAxNS8xMi9wcmluY2lwaXM=":{"date":1448928000000,"title":"Principis d'Arquitectura de Sistemes d'Informació","description":"Recomanacions a seguir en la construcció de sistemes d'informació a la Generalitat de Catalunya","bloc_tags":["bones pràctiques"],"sections":["Bloc","home"],"aliases":["/principis","/bloc/principis","/bloc/2015/11/principis","/arquitectura/principis","/arquitectura/2015/11/principis"],"imatge":"/images/bloc/principis.png","teletext_id":"principis","langs":["ca","es"],"path":"/bloc/2015/12/principis","content":"<!--\r\n\r\n## Principis sobre el  disseny d'aplicacions\r\n\r\n\r\n1. Segregació de funcions/responsabilitats. Les aplicacions han d’estar estructuralment dividides en blocs independents per funcionalitats, processos de negoci o serveis, per tal d’evitar els monòlits.\r\n\r\nAquest principi és d’aplicació a totes les capes. Una aplicació tipus pot dividir-se fàcilment, per exemple, en els següents mòduls:\r\n\r\n\t* Públic general (internet)\r\n\t* Col·laboradors externs (extranet)\r\n\t* Backoffice (intranet)\r\n\t* Processos batch\r\n\t* Extraccions (ETL)\r\n\t* La presentació (client/frontend) i el backend/negoci estaran desacoblats.\r\n\r\n1. Orientació a serveis. Cada cop més, les aplicacions poden ser consumides externament o bé han d’integrar-se amb 3rs. Els backend han d’exposar la seva funcionalitat de negoci via serveis per facilitar-ho. \r\n\r\n1. Emmagatzema a la memòria cau tot allò que sigui possible. Per fer-ho, utilitza la tecnologia que millor s’adapti tant a client (html5 cache, localstorage , etc.) com a servidor (Redis, Varnish, Memcache, caché personalitzada, etc.)\r\n\r\n1. Tingues present sempre la compatibilitat cap a enrere dels teus serveis: si exposes una API REST i actualitzes el teu servei, que sigui compatible amb versions anteriors per a evitar actualitzacions innecessàries als teus consumidors i d’aquesta manera poder evolucionar el servei lliurement.\r\n\r\n1. Dissenya l'aplicació o servei tenint present els conceptes d'elasticitat (enlloc de per a suportar els pics de càrrega), d’alta disponibilitat, d’alta concurrència i zero downtime.\r\n\r\n1. Pensa en la portabilitat de les aplicacions, això és, que es puguin moure amb facilitat d’un cloud privat a un cloud públic, per exemple.\r\n\r\n1. A l’hora de dissenyar el teu sistema cal incorporar aspectes qualitatius al cicle de vida:\r\n\r\n\t* Proves per a verificar la qualitat o requisits no funcionals del sistema.\r\n\t* Documentació detallada del projecte (descripció d’arquitectura, document funcional, manual de desplegament, manual d’explotació, …).\r\n\t* Control de versions. El sistema en el seu conjunt ha de ser tractat com un producte amb les seves versions majors, menors, etc\r\n\t* Desplegament automatitzat, execució de proves automàtiques que verifiquin la instal·lació i integració contínua.\r\n\r\n1. Són d'aplicació en aquest apartat els principis que estableix la Guia Web Gencat\r\n\r\n\r\n## Principis sobre la tecnologia\r\n\r\n\r\n1. Utilitza la tecnologia que millor encaixi al cas d’ús, si cal combinant tecnologies, ja que en un mateix sistema en poden conviure diverses.\r\n\r\n1. Els serveis (backend) exposaran el seu negoci mitjançant REST i en format JSON.\r\n\r\n1. En el cas d’aplicacions web, la presentació estarà construïda amb tecnologies estàtiques (html5/javascript/css) i consumirà els serveis que li proporcioni el backend. \r\n\r\n1. Davant solucions estàndards utilitzarem preferentment les tecnologies del Full de Ruta. Aquest fet no exclou que per a noves solucions es puguin utilitzar altres tecnologies, que eventualment passaran a formar-ne part.\r\n\r\n1. Des de les unitats d'Arquitectura s'ha de fer un seguiment de noves tecnologies, per a avaluar el seu encaix i tenir altres opcions davant noves necessitats dels projectes (per exemple, nous llenguatges i frameworks o provisió d'infraestructura).\r\n\r\n## Principis sobre el cost i manteniment de les solucions\r\n\r\n\r\n1. Cal tenir presents els costos d’infraestructura i el model de llicenciament requerits per a posar en marxa una solució ja que representen un cost recurrent.\r\n\r\n1. Pensa en els costos i en la seva optimització:\r\n\r\n\t* Monitoritza els teus serveis per a identificar necessitats d'ampliació o reducció de recursos i poder ajustar els costos en conseqüència\r\n\t* Arquitectura/dissenya les càrregues de treball amb els costos en ment\r\n\r\n1. \"Opensource vs Comercial vs Construcció a mida\": a l'hora de concebre una nova solució, s'ha de regir pel següent arbre de decisió:\r\n\r\n\t* Per a problemes comuns, utilitza \"Opensource\". \r\n\t* Per a problemes poc comuns, compra. \r\n\t* Per a problemes únics, construeix.\r\n\r\nA l’hora de triar entre utilitzar un producte (opensource o comercial) o fer un desenvolupament a mida cal fer una avaluació del cost vs. benefici de l’opció triada respecte a les altres.\r\n\r\n1. Pensa en l’impacte d’actualització que pugui tenir un canvi de sistema operatiu, middleware o producte allà on corre l’aplicació: quant menys acoblament amb el sistema de base i utilitzant estàndards, més senzilla serà l’actualització o l’ampliació de funcionalitats de l’aplicació.\r\n\r\n-->","objectID":"L2Jsb2MvMjAxNS8xMi9wcmluY2lwaXM="},"L2Jsb2MvMjAxNi8wMS9hcGk=":{"date":1452556800000,"title":"APIs RESTful: millors pràctiques","description":"Millors pràctiques per a la construcció d'APIs REST","toc":true,"sections":["Bloc","home"],"bloc_tags":["bones pràctiques","api","desenvolupament"],"imatge":"/images/bloc/json-api.png","path":"/bloc/2016/01/api","content":"Aquest document pretèn unificar la manera d'interaccionar amb les APIs que ofereixin els diferents sistemes de la Generalitat, ja siguin públics o d'ús intern.\r\n\r\n## Acords generals\r\n\r\n- Utilitzarem estàndards HTTP: verbs, http codes, headers, ...\r\n- Els recursos exposats a través de la API seran en plural (\"aplicacions\" enlloc d' \"aplicacio\")\r\n- El format per defecte serà JSON. No es contemplaran altres formats, en general.\r\n- Si exposem dades d'accés públic, inclourem un paràmetre \"callback\" per a poder fer peticions JSONP\r\n- Paràmetres del querystring reservats explicats més endavant:\r\n\t\r\n\t- fields\r\n\t- sort\r\n\t- q\r\n\t- limit\r\n\t- offset\r\n\t- v\r\n\r\n- La nostra API es publicarà en el path /api del nostre domini:\r\n\t\r\n\t\thttp://subdomini.gencat.cat/api\r\n\r\n## Verbs HTTP\r\n \r\n- GET = select\r\n- POST = insert\r\n- PATCH = update\r\n- DELETE\r\n\r\n###\t Exemple\r\n\r\nL'esquema general de la nostra uri serà el següent:\r\n\r\n\t\thttp://subdomini.gencat.cat/api/{recurs}/{id}\r\n\r\nImaginem que la nostra API gestiona el recurs \"Aplicació\". La notra API exposarà aquests recursos amb el verbs http de la manera següent:\r\n\r\n- GET **/aplicacions** - obté el llistat de totes les aplicacions\r\n- GET **/aplicacions/{id}** - obté la informació de l'aplicació amb l'id corresponent passat a l'URI\r\n- POST **/aplicacions** - crea una nova aplicació\r\n- PATCH **/aplicacions/{id}** - actualitza l'aplicació amb l'id corresponent passat a l'URI\r\n- DELETE **/aplicacions/{id}** - elimina l'aplicació amb l'id corresponent passat a l'URI\t\r\n\r\n## Esquemes JSON\r\n\r\n- GET\r\n\r\n\t\t\t{\r\n\t\t\t\tdata : {\r\n\r\n\t\t\t\t\ttotal : 976,  //nombre total dels resultats de la petició\r\n\t\t\t\t\tlimit : 100,  //màxim nombre de resultats a retornar per a cada petició\r\n\t\t\t\t\toffset : 200, //en quin resultat del total comença aquesta petició \r\n\t\t\t\t\t\r\n\t\t\t\t\tincluded : [  //array de resultats\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid : 1,\r\n\t\t\t\t\t\t\tattributes : {\r\n\t\t\t\t\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\t\t\t\t\tcamp2 : \"B\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid : 2,\r\n\t\t\t\t\t\t\tattributes : {\r\n\t\t\t\t\t\t\t\tcamp1 : \"C\",\r\n\t\t\t\t\t\t\t\tcamp2 : \"D\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t...\r\n\t\t\t\t\t]\r\n\t\t\t\t} \r\n\t\t\t}\r\n\r\n- GET/POST/PATCH/DELETE\r\n\r\n\t\t\t{\r\n\t\t\t\terrors : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcode : 401,\r\n\t\t\t\t\t\tdesc : \"l'usuari proporcionat no té permisos d'accés\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\r\n- GET/POST/PATCH - Elements individuals\r\n\r\n\r\n\t\t\t{\r\n\t\t\t\tid : 1, // en el cas del POST no enviarem el id, normalment\r\n\t\t\t\tattributes : {\r\n\t\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\t\tcamp2 : \"B\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n## GET - Filtrat de resultats\r\n\r\n- Els recursos es filtraran mitjançant paràmetres al querystring.\r\n\r\n- S'utilitzarà un sol cop cada paràmetre que permeti filtratge:\r\n\r\n\t- si s'han de realitzar operacions més complexes, s'hauria d'establir el mecanisme amb un sol paràmetre\r\n\r\n- Exemple\r\n\r\n\t\tGET /aplicacions?estat=evolutiu&lang=nodejs\r\n\r\n\tRetornarà totes les aplicacions que en aquell moment estiguin en evolució i el llenguatge de desenvolupament sigui Node.js.\r\n\r\n## GET - Paginació\r\n\r\n- En una petició sense cap filtre, mai no es retornaran tots els elements del recurs consultat.\r\n\r\n- La nostra API implementarà paginació, indicant els resultats de la següent manera:\r\n\r\n\r\n\t\t\tdata : {\r\n\t\t\t\ttotal : 976,\r\n\t\t\t\tlimit : 100, \r\n\t\t\t\toffset : 200,\r\n\t\t\t\tincluded : [\r\n\t\t\t\t\t...\r\n\t\t\t\t]\r\n\t\t\t} \r\n\r\n\r\n\t- el camp \"**total**\" indicarà el número de resultats d'una request\r\n\t- el camp \"**limit**\" indicarà el número de resultats per pàgina. S'inclourà al querystring. Si no s'informa, per defecte serà 10 i el màxim dependrà dels objectius de rendiment, però no hauríem de passar de 500 resultats.\r\n\t- el camp \"**offset**\" indicarà en quin resultat hauria de començar el subset de resultats demanat en una request. S'inclourà al querystring. Si no s'informa, per defecte serà 0 i retornarà el primers resultats en funció del paràmetre \"limit\".\r\n\r\n\t\t\tGET /aplicacions?limit=100&offset=200 \r\n\r\n\t\tRetornarà a partir del resultat 300 i amb 100 resultats en aquella petició.\r\n\r\n\r\n\t- Amb l'exemple anterior, el número de pàgines seria:\r\n\r\n\t\t- total / límit = 976 / 100 = 9,76, que arrodonit a l'enter superior ens donaria 10 planes\r\n\r\n\t- I la pàgina activa seria:\r\n\r\n\t\t- (offset / limit) + 1 = 200/100+1 = pàgina 3\r\n\r\n\t- [Exemple a jsfiddle](https://goo.gl/WKlXnV)\r\n\r\n## GET - Selecció de camps\r\n\r\n- Es permetrà seleccionar els camps que es volen consultar implementant el paràmetre \"**fields**\", on el seu valor seran els noms dels camps a incloure en els resultats separats per coma:\r\n\r\n\t\tGET /aplicacions?fields=codi,data_creacio,proveidor,lang \r\n\r\n\tRetornarà totes les aplicacions però els documents només retornaran els camps enumerats al camp fields.\r\n\t\t\r\n\r\n## GET - Ordre dels resultats\r\n\r\n- Si es requereix, es podrà habilitar un paràmetre \"**sort**\" que acceptarà valors dels camps separats per comes i on es podrà indicar amb el signe \"-\" precedint el nom del camp, l'ordre descendent per a aquell camp. Per defecte l'ordre serà ascendent\r\n\r\n- Exemple:\r\n\r\n\t\tGET /aplicacions?sort=data_creacio,-loc \r\n\r\n\tRetornarà totes les aplicacions ordenades per data de creació ascendent i línies de codi (loc) descendent.\r\n\r\n## GET - Cerca lliure\r\n\r\n- Per a les cerques lliures a qualsevol camp dels elements del recurs, el paràmetre per defecte serà \"**q**\"\r\n\r\n- Exemple:\r\n\r\n\t\tGET /aplicacions?q=mysql\r\n\r\n\tRetornarà totes les aplicacions que en algun dels camps continguin \"mysql\"\t\r\n\r\n## GET - Memòria cau\r\n\r\nLes peticions de tipus GET són succeptibles de ser guardades en memòria cau si l'API està exposada al públic i té un consum elevat. Depèn de què es vulgui guardar, establirem una o altra \"clau de caché\". \r\n\r\nUtilitzarem dues aproximacions:\r\n\r\n- Per a consultes sobre tot el recurs establirem una clau de caché que podria ser tota la url + el querystring o bé alguns paràmetres del querystring.\r\n\r\n\tPer a realitzar aquesta funcionalitat es podria incorporar dins la lògica de la pròpia API però la millor pràctica seria utilitzar serveis de caché externs (Varnish, caché a balancejadors, ...)\r\n\r\n- En qualsevol cas, siguin consultes múltiples o d'un ítem concret, hauríem de proporcionar les capçareleres http relacionades amb la caducitat dels resultats:\r\n\r\n\t- Etag\r\n\t- Date\r\n\t- Last-modified\r\n\t- Expires\r\n\r\n## GET - JSONP Callback\r\n\r\nPer a peticions GET, permetrem incloure un paràmetre \"callback\" amb el nom de la funció amb la que envolcallarem la nostra resposta (JSONP)\r\n\r\n\t\tRequest\r\n\r\n\t\t\tGET /aplicacions?callback=f\r\n\r\n\t\tResponse\r\n\r\n\t\t\tf({\r\n\t\t\t\tdata : {\r\n\r\n\t\t\t\t\ttotal : 976,  \r\n\t\t\t\t\tlimit : 100,  \r\n\t\t\t\t\toffset : 200, \r\n\t\t\t\t\t\r\n\t\t\t\t\tincluded : [  \r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid : 1,\r\n\t\t\t\t\t\t\tattributes : {\r\n\t\t\t\t\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\t\t\t\t\tcamp2 : \"B\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tid : 2,\r\n\t\t\t\t\t\t\tattributes : {\r\n\t\t\t\t\t\t\t\tcamp1 : \"C\",\r\n\t\t\t\t\t\t\t\tcamp2 : \"D\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t...\r\n\t\t\t\t\t]\r\n\t\t\t\t} \r\n\t\t\t})\r\n\r\n\r\n\t\r\nRetornarà la resposta JSON amb una funció de nom \"f\" que l'envolcallarà\r\n\r\n\r\n## POST - Creació d'un recurs\r\n\r\nAmb el verb POST crearem nous elements al nostre recurs:\r\n\r\n\t\tPOST /aplicacions/\r\n\t\tContent-type: application/json\r\n\r\n\t\t{\r\n\t\t\tdata : {\r\n\t\t\t\tattributes : {\r\n\t\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\t\tcamp2 : \"B\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\nSi tot ha anat correctament el HTTP response code serà 201. La resposta pot incloure un header location amb la uri del recurs creat.\r\n\r\n\r\n\t\tLocation: /api/aplicacions/5220-4848-864539594927\r\n\r\n\t\t{\r\n\t\t\tdata : {\r\n\t\t\t\tid : \"5220-4848-864539594927\", // en el cas del POST no enviarem el id, normalment\r\n\t\t\t\tattributes : {\r\n\t\t\t\t\tcamp1 : \"A\",\r\n\t\t\t\t\tcamp2 : \"B\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n## PATCH - Actualització d'un recurs\r\n\r\nAmb el verb PATCH actualitzarem un recurs concret.\r\n\r\n\t\tPATCH /aplicacions/5220-4848-864539594927\r\n\t\tContent-type: application/json\r\n\r\n\t\t{\r\n\t\t\tdata : {\r\n\t\t\t\tid : 5220-4848-864539594927\r\n\t\t\t\tattributes : {\r\n\t\t\t\t\tcamp1 : \"X\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\nSi tot ha anat correctament el HTTP response code serà 20x, depenent de si s'ha realitzat o s'ha encuat per a processar\r\n\r\n## DELETE - Eliminació d'un recurs\r\n\r\nAmb el verb DELETE eliminarem un recurs concret.\r\n\r\n\t\tDELETE /aplicacions/5220-4848-864539594927\r\n\t\tContent-type: application/json\r\n\r\n\r\nSi tot ha anat correctament el HTTP response code serà 20x, depenent de si s'ha realitzat o s'ha encuat per a processar\r\n\r\n## Operacions múltiples (BATCH)\r\n\r\n- La nostra API podrà incorporar un mecanisme per a poder realitzar operacions múltiples (crear, actualitzar o eliminar) a la url:\r\n\r\n\t\thttp://subdomini.gencat.cat/api/_batch\r\n\r\n- L'acció serà de crear, actualitzar o eliminar, no es podran barrejar accions.\r\n\r\n- Es realitzarà mitjançant un POST amb el següent format de document:\r\n\r\n\r\n\t\tPATCH /_batch/\r\n\t\tContent-type: application/json\r\n\r\n\t\t{\r\n\t\t\taction : \"POST\" //o \"PATH\", \"DELETE\"\r\n\t\t\tdata : [\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594927\r\n\t\t\t\t\tattributes : {\r\n\t\t\t\t\t\tcamp1 : \"X\"\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594928\r\n\t\t\t\t\tattributes : {\r\n\t\t\t\t\t\tcamp1 : \"Z\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\r\n\r\n- En el cas de crear múltiples elements, és obligatori enviar un \"id\" que permeti retornar en la resposta si l'id enviat s'ha processat correctament o no.\r\n\r\n- Qualsevol acció múltiple estarà limitada a un màxim de **100 elements**.\r\n\r\n- La resposta http consistirà en el mateix atribut data enviat, que retornarà un status per a cada document enviat a crear, actualitzar o eliminar. En el cas d'errors, s'inclourà un atribut \"errors\" que serà un array d'errors a processar, amb el codi intern que li correspongui i la descripció.\r\n\r\n\t\t{\r\n\t\t\tdata : [\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594927,\r\n\t\t\t\t\tstatus: 200\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tid : 5220-4848-864539594928,\r\n\t\t\t\t\tstatus: 400,\r\n\t\t\t\t\terrors : [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tcode : 999,\r\n\t\t\t\t\t\t\tdesc : \"Falten camps obligatoris per informar\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\r\n\r\n\r\n\r\n## Multi idioma\r\n\r\nSi l'API pot retornar atributs en múltiples idiomes, tindrem dos mecanismes per a poder negociar-lo:\r\n\r\n- Paràmetre \"lang\" al querystring per a peticions GET\r\n\r\n\t\tGET /aplicacions?lang=ca\r\n\r\n- Header \"Accept-Language\" a tots els verbs\r\n\r\nUtilitzarem els codis de l'estàndard ISO-639-1: https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes\r\n\r\nLa API tindrà un idioma per defecte i informarà en quins llenguatges es pot consultar a la seva pàgina d'ajuda.\r\n\r\n## Versionat\r\n\r\n- El mètode preferit per a seleccionar la versió que volem consultar de l'API, serà incloent el paràmetre \"**v**\" a la querystring\r\n\r\n- Exemple:\r\n\r\n\t\tGET /aplicacions?q=mysql&v=2 \r\n\r\n\tRetornarà totes les aplicacions que en algun dels camps continguin \"mysql\" en la versió 2 de l'API\r\n\r\n- Només farem versions per a canvis majors, de manera que els canvis menors s'incorporaran a la versió major actual en un moment donat, garantint la compatibilitat cap a enrera dels recursos servits mentre es mantingui una versió major.\r\n\r\n## Missatges i errors\r\n\r\nTota interacció amb els recursos de a nostra API retornarà un codi HTTP en funció del tipus d'acció i èxit o error de la mateixa. HTTP codes més comuns:\r\n\r\n- 200 – _OK_ – Tot correcte\r\n- 201 – _OK_ – Nou recurs creat (POST)\r\n- 204 – _OK_ – El recurs s'ha eliminat correctament (DELETE)\r\n\r\n- 304 – _Not Modified_. Es pot utilitzar la caché.\r\n\r\n- 400 – _Bad Request_ – La petició és incorrecta. L'error s'haurà de descriure en el _payload_ de la resposta http.\r\n- 401 – _Unauthorized_ – La petició requereix d'autorització.\r\n- 403 – _Forbidden_ – El servidor entèn la petició però la rebutja o l'accés no està permès.\r\n- 404 – _Not found_ – No s'ha trobat el recurs.\r\n\r\nEn cas d'errors, inclourem un _payload_ en format JSON que informarà dels problemes trobats, ampliant la informació si cal a la descripció (\"desc\"):\r\n\r\n\t\t\t{\r\n\t\t\t\terrors : [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcode : 404,\r\n\t\t\t\t\t\tdesc : \"El recurs sol·licitat no s'ha trobat\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\r\n\t\t\t}\r\n\r\n## Autenticació\r\n\r\nEls mecanismes preferits per a donar accés a la nostra API seran els següents, per ordre de preferència:\r\n\r\n1. Oauth2\r\n1. Autenticació Bàsica sobre GICAR\r\n1. HMAC\r\n\r\nEn cas d'existir un API Gateway en el moment d'implementar l'API, la millor opció serà gestionar la seguretat a través d'aquesta peça, millor que implementar-la a la nostra API.\r\n\r\n## Documentació\r\n\r\nEntre els formats de descripció d'APIs tenim Swagger i WADL. La nostra opció preferida serà utilitzar [Swagger](http://swagger.io/). Podeu veure un exemple de funcionament a [http://petstore.swagger.io/](http://petstore.swagger.io/)\r\n\r\n\r\n## Referències\r\n\r\n- http://jsonapi.org/\r\n- http://www.restapitutorial.com/resources.html\r\n- http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api\r\n- http://restful-api-design.readthedocs.org/en/latest/methods.html\r\n- http://blog.mwaysolutions.com/2014/06/05/10-best-practices-for-better-restful-api/\r\n- http://blog.octo.com/en/design-a-rest-api\r\n\r\n### Aspectes pendents de definir\r\n\r\n- Filtrat per rangs: establir un QL\r\n\r\n- Relacions entre elements \r\n\r\n","objectID":"L2Jsb2MvMjAxNi8wMS9hcGk="},"L2Jsb2MvMjAxNi8wNC9hcHBsZXRzLXRvLWpubHA=":{"date":1459987200000,"title":"Dels Applets a Java Web Start amb JNLP","description":"Us expliquem breument les estratègies de migració dels Applets Java i en concret, la migració a tecnologia Java Web Start amb JNLP","sections":["Bloc","home"],"bloc_tags":["legacy"],"key":"ABRIL2016","path":"/bloc/2016/04/applets-to-jnlp","content":"Tal i com us explicàvem fa unes setmanes, la tecnologia applet tal i com la coneixem deixarà de poder utilitzar-se als navegadors d'internet en breu i, a més, la versió Java 9 deixarà de donar suport als plugins de navegador que permeten l'execució d'aquests applets.\r\n\r\nPer tant, davant d'aquesta problemàtica se'ns presenten dues solucions:\r\n\r\n- Continuar utilitzant els applets amb l'alternativa recomanada per Oracle: Java Web Start\r\n- Canviar la funcionalitat que utilitza els applets per tecnologia nativa web\r\n\r\n### Java Web Start (JWS)\r\n\r\n[Java Web Start](https://www.java.com/en/download/faq/java_webstart.xml) permet executar aplicacions des de la web, però enlloc d'executar-se dins del navegador, incrustats a l'html (tags object, applet, ...) l'usuari es descarrega un fitxer JNLP (Java Network Launching Protocol) i, en clicar-lo, s'executa l'aplicació JWS fora del navegador.\r\n\r\nEn el cas dels applets, JWS dóna suport a la seva execució, de manera que un applet incrustat en una pàgina web d'aquesta manera:\r\n\r\n\t\t<applet code=\"java2d.Java2DemoApplet\"          \r\n        \tjnlp_href=\"dynamictree_applet.jnlp\"         \r\n        \twidth=\"710\" \r\n        \theight=\"540\" >        \r\n\t\t    <param name=\"param1\" value=\"value1\"/>\r\n\t\t</applet> \r\n\r\nPassaria a cridar-se mitjançant un fitxer amb extensió jnlp que contindria el següent codi:\r\n\r\n\t\t<jnlp spec='1.0+' codebase='http://sc-pre.aoc.cat/appletCentralitzat/resources/jars/' href=''>\r\n\t\t\t<information>\r\n\t\t\t\t<title>Applet Centralitzat</title>\r\n\t\t\t</information>\r\n\t\t\t<resources>\r\n\t\t\t\t<jar href=\"SwingSet2.jar\"/>\r\n\t\t\t</resources>\r\n\t\t\t<applet-desc main-class=\"SwingSet2Applet\" name=\"SwingSet\" width=\"625\" height=\"595\">\r\n\t\t\t\t<param name=\"param1\" value=\"value1\"/>\r\n\t\t\t  \t<param name=\"param2\" value=\"value2\"/>\r\n\t\t\t</applet-desc>\r\n\t\t</jnlp>\r\n\r\nL'usuari es descarregaria aquest fitxer des de la web i aixecaria l'aplicació Java fora del navegador. \r\n\r\n**En el cas que l'applet intercanviés informació amb l'aplicació web que el fa servir (o a la inversa) mitjançant javascript, aquesta comunicació deixarà de funcionar, i, per tant, s'haurà de canviar la manera de comunicar l'aplicació applet/java i l'aplicació web. La solució passa per crear un servei del costat de servidor que s'encarregui de comunicar l'applet i l'aplicació web.** \r\n\r\nNota d'Oracle sobre la migració d'applets a JWS: http://docs.oracle.com/javase/8/docs/technotes/guides/deploy/applet_dev_guide.html#JSDPG1032\r\n\r\n### Codi\r\n\r\n- Applet de Signatura de l'AOC: https://github.com/ConsorciAOC/signador \r\n\r\n","objectID":"L2Jsb2MvMjAxNi8wNC9hcHBsZXRzLXRvLWpubHA="},"L2Jsb2MvMjAxNi8wMi9hcHBsZXRz":{"date":1455494400000,"title":"Desenvolupament web. Discontinuació dels Applets Java","description":"","sections":["Bloc","home"],"bloc_tags":["legacy"],"imatge":"/images/bloc/applet.png","path":"/bloc/2016/02/applets","content":"Com bé sabeu la tecnologia dels applets està entrant en obsolescència i se n’està discontinuant el suport per part dels diferents actors del mercat:\r\n\r\n* **Navegadors**: no es poden executar sobre Google Chrome des de setembre de 2015 en què es va deixar de donar suport a l’especificació NPAPI. La resta de navegadors també seguiran aquesta via (https://java.com/en/download/faq/chrome.xml)\r\n\r\n* **Màquina virtual Java**: a partir de la versió 9 de Java, Oracle deixarà de donar suport als applets. Està previst que aquesta versió es publiqui l’abril de 2017. Cal fer esment que encara que es disposés d’un navegador que suportés l’execució d’applets no els podria executar quan la jvm del PC sigui la versió 9 (https://blogs.oracle.com/java-platform-group/entry/moving_to_a_plugin_free)\r\n\r\nDes de la Unitat d’Arquitectura estem avaluant les diferents alternatives tecnològiques que hi ha a l’ús dels applets en funció del seu cas d’ús a les aplicacions de la Generalitat de Catalunya. \r\n\r\nActualment, tenim identificats els casos d’ús següents:\r\n\r\n* Accés a maquinari (perifèrics del PC):\r\n\r\n\t* **Accés a lectors de targes per la signatura digital des del navegador**. L’exemple més rellevant és el que es coneix com a “applet de CatCert”. L'AOC està en procés de construcció d’una alternativa a aquesta funcionalitat.  Estem fent seguiment amb ells per avaluar els impactes del canvi sobre els sistemes d’informació de la Generalitat. Al llarg de la propera setmana ja disposaran d’una primera versió sobre un entorn de proves i començaran les proves internes dins AOC.\r\n\r\n\t* **Accés a impressores**. Com per exemple, l’applet d S@rcat que permet accedir a la impressora de registre de documents.\r\n\r\n\t* **Accés a escàner**\r\n\r\n* Accés a programari:\r\n\r\n\t* **JClic**: aquest applet s'utilitza per a fer córrer aplicacions educatives que es dissenyen amb el Generador de JClic\r\n\r\n\t* **Edició de documents**. Applet que s’utilitza per a poder editar documents amb un openOffice instal·lat al PC, convertir-los a pdf, etc.\r\n\r\n\t* **Comparador de documents de MS Word**\r\n\r\n\t* **Gestió de dades a client**: per temes de performance en aplicacions antigues s'utilitzaven applets per a emmagatzemar dades poc volàtils per a evitar anar a buscar-les al servidor\r\n\r\n\t* **Generació de pantalles a client**\r\n\r\nDurant les properes setmanes publicarem les alternatives per substituir aquesta tecnologia a les aplicacions.\r\n\t","objectID":"L2Jsb2MvMjAxNi8wMi9hcHBsZXRz"},"L2Jsb2MvMjAxNi8wOC9taWNyb3NlcnZlaXM=":{"date":1470268800000,"title":"(micro)serveis","description":"Introducció al patró de disseny basat en microserveis i les implicacions que té a l'hora de pensar les aplicacions","sections":["Bloc","home"],"bloc_tags":["patrons de disseny","api","microserveis"],"imatge":"/images/bloc/microserveis.png","key":"SETEMBRE2016","path":"/bloc/2016/08/microserveis","content":"**(micro)serveis és un patró de disseny** de sistemes orientat a descompondre una aplicació en les seves **unitats funcionals mínimes**, tractar-les com a aplicacions independents, on **cada servei és responsable d'un domini de negoci** i la resta de serveis es comuniquen amb ell mitjançant **interfícies i contractes estàndard** (per exemple, HTTP/REST amb una API coneguda).\n\nPosem (micro) entre parèntesis perquè la granularitat dels serveis dependrà de diversos factors, però el que sí que és important és que les comunicacions entre els diferents serveis/mòduls/funcionalitats es realitzi mitjançant les interfícies que s'exposin. El que no es farà en cap cas és anar a buscar les dades al repositori del servei que volem consumir. És a dir, cada servei serà [**\"l'única font de la veritat\"**](https://en.wikipedia.org/wiki/Single_source_of_truth) de les dades que gestiona.\n\nÉs un pas més a la componentització i modularització dels sistemes en totes les seves capes, on tant el **software** (la meva aplicació) com els **middlewares** (el programari sobre el que corre l'aplicació: servidor web, base de dades, ...) i els **entorns de desplegament** (contenidors o runtimes) es poden dedicar en exclusiva a cada (micro)servei.\n\n### Millors pràctiques\n\n- un servei, un repositori independent: els serveis no comparteixen repositori (lògic)\n- cada servei té un procés de construcció (build) independent\n- es recomana desplegar en contenidors o runtimes estàndards\n- s'han de respectar els contractes/interfícies interns (diferents equips de desenvolupament?) i externs (clients o aplicacions terceres)\n\t\n\n### Beneficis\n\n- cada servei és relativament petit i pot ser desplegat independentment de la resta (això sí, s'han de vigilar els canvis de contracte i per a això és important el versionat dels serveis).\n\n- en ser serveis independents i desplegats de manera independent, poden ser escalats per separat: els monòlits, per contra, s'han d'escalar en bloc.\n\n- permet fer conviure diverses tecnologies en un sistema, de manera que l'únic que ens hem de preocupar d'estandarditzar és la interfície de comunicació (API)\n\n- si un servei té problemes, no té per què veure's afectat tot el sistema, això sí, s'ha de gestionar en els diferents serveis la tolerància a errors de serveis tercers.\n\n\n### Aspectes a tenir presents\n\n- s'ha d'automatitzar TOT des del principi del projecte, ja que la coordinació és la clau de l'èxit.\n\n- en sistemes grans i amb molts serveis, apareixen patrons relacionats que cal gestionar, per a coreografiar els fluxes, gestionar la configuració, ...\n\n\t- service registration: els microserveis s'han d'enregistrar (ells mateixos o via un servei dedicat) al servei de registre\n\n\t- service discovery: han de poder ser \"descoberts\" pels clients abans de ser cridats o a la banda de servidor, que seria la millor pràctica, (en aquest cas, per un API Gateway), de manera que el sistema sabrà les diferents instàncies que corren i a les que ha de dirigir les peticions\n\n\t- seria recomanable disposar d'un API Gateway per a governar els serveis (seguretat, discovery, caché, ...)\n\n- estem acostumats a tenir les dades centralitzades mentre que en aquest patró estan descentralitzades. Per exemple estem acostumats a tenir eines de reporting o BI que accedeixen a un repositori centralitzat. En aquest cas, on els repositoris poden ser diferents i estar ubicats en diferents llocs, es pot optar per disposar d'una BD que agregui la informació per al reporting.\n\n### Canigó + (micro)serveis \n\nCom que estem parlant d'un patró, la seva implementació es pot realitzar de diverses maneres. I com ja hem comentat, aquest patró permet la coexistència de diverses tecnologies. \n\nEn el cas de Canigó, basat en Spring, tot dependrà del disseny que es faci de l'aplicació. Això sí, implica respectar els [principis d'arquitectura](http://canigo.ctti.gencat.cat/bloc/2015/12/principis/) i les [millors pràctiques en la construcció d'apis i serveis](http://canigo.ctti.gencat.cat/bloc/2016/01/api/). A més, algunes de les característiques d'aquest patró ja estan resoltes dins Spring Cloud (routing, load balancing, registry, discovery, ...) i per això recomanem el seu ús als projectes Canigó.\n\n\n<br />\n\n**Referències**:\n\n- http://samnewman.io/books/building_microservices/\n- https://www.nginx.com/blog/introduction-to-microservices/\n- http://microservices.io/patterns/microservices.html\n- https://www.nginx.com/blog/microservices-at-netflix-architectural-best-practices/\n- https://netflix.github.io/ (Common Runtime Services & Libraries: Eureka, Zuul, ...)\n- https://spring.io/blog/2015/07/14/microservices-with-spring\n- http://projects.spring.io/spring-cloud/","objectID":"L2Jsb2MvMjAxNi8wOC9taWNyb3NlcnZlaXM="},"L2Jsb2MvMjAxNi8wNS9yZXN0LXZzLWpzZg==":{"date":1463097600000,"title":"Aplicacions webs modernes: JSF vs REST","description":"Us donem una breu explicació d'aquest canvi de paradigma en la capa de presentació","sections":["Bloc","home"],"bloc_tags":["patrons de disseny","bones pràctiques","legacy","desenvolupament"],"imatge":"/images/bloc/rest.png","key":"JUNY2016","path":"/bloc/2016/05/rest-vs-jsf","content":"Des de fa més de 3 anys, des de la Unitat d'Arquitectura Corporativa i el Centre de Suport Canigó, promovem la creació d'aplicacions orientades a serveis/API (dins els moviments de API Economy, API First, API Strategy) on la capa de presentació és un client més d'aquesta API. A més, proposem que aquest client html sigui totalment estàtic, on no hi hagi renderització des del costat de servidor: d'aquesta manera, el manteniment i evolució de l'aplicació és més senzill i no depenem de frameworks pesats de servidor (com és JSF o Struts).\r\n\r\nPer aquest motiu, us comuniquem que a partir d'aquest moment, **l'ús de JSF ha de ser exclusiu a efectes de manteniment d'aplicacions**. Qualsevol nova aplicació o funcionalitat dins d'una aplicació, s'hauria de desenvolupar seguint el patró REST, on el servidor exposa la lògica de negoci mitjançant serveis en format JSON (i seguint les millor pràctiques en desenvolupament d'APIs que trobareu al nostre bloc) i el client, normalment desenvolupat amb tecnologia estàtica (html/javascript/css), consumeix aquest servei.\r\n\r\nAixò no vol dir que no es puguin utilitzar elements de servidor (jsp) per a facilitar la renderització de plantilles, però s'hauria de reduir a la mínima expressió.\r\n\r\n#### JSF vs HTML5/JS\r\n\r\nA continuació s'exposen una sèrie de referències d'interès que reflecteixen l'impuls dels nous frameworks de client basats en HTML5 i Javascript vers el frameworks JSF més estès del moment, Primefaces:\r\n\r\n*Primefaces (JSF)*\r\n\r\n- https://www.thoughtworks.com/radar/languages-and-frameworks/jsf (Només manteniment)\r\n- https://github.com/primefaces/primefaces (No arriba a 400 starts a Github)\r\n\r\n*AngularJS (HTML5/JS)*\r\n\r\n- https://www.thoughtworks.com/radar/languages-and-frameworks/angularjs (Avaluar)\r\n- https://github.com/angular/angular.js (Aprop de 50.000 starts a Github)\r\n\r\n*ReactJS (HTML5/JS)*\r\n\r\n- https://www.thoughtworks.com/radar/languages-and-frameworks/react-js (Adoptar)\r\n- https://github.com/facebook/react (Més de 40.000 starts a Github)\r\n\r\n*EmberJS (HTML5/JS)*\r\n\r\n- https://www.thoughtworks.com/radar/languages-and-frameworks/ember-js (Provar)\r\n- https://github.com/emberjs/ember.js (Més de 16.000 starts a Github)\r\n\r\nLa tendència de les cerques realitzades a Google també indica un canvi clar des de fa uns anys:\r\n\r\n![Google Trends](/images/bloc/comparativa-frameworks.png  \"Google Trends\")\r\n\r\n*Termes comparats: Primefaces, Richfaces, JavaServer Faces (JSF), Representational state transfer (REST) i AngularJS (JavaScript MVW Framework)*\r\n\r\n### Notícies i comunicats\r\n\r\nDes del CS Canigó s'han anat publicant notícies i enviant comunicats durant aquests darrers anys promocionant aquest tipus d'arquitectura moderna REST+HTML5/JS:\r\n\r\n* [Notícia - Plantilla d'aplicació REST](http://canigo.ctti.gencat.cat/noticies/2015-09-01-Canigo-Plantilla-aplicacio-rest/)\r\n\r\n* [Notícia - Arquitectura d'aplicacions recomanada](http://canigo.ctti.gencat.cat/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada/)\r\n\r\n* [Notícia - Integració de serveis REST amb GICAR](http://canigo.ctti.gencat.cat/noticies/2015-02-05-Canigo-integracio-serveis-rest-gicar/)\r\n\r\n* [Notícia - Cas d'èxit d'aplicació Canigó 3 amb arquitectura HTML5 + REST](http://canigo.ctti.gencat.cat/noticies/2015-01-08-canig%C3%B3-REST/)\r\n\r\n* [Comunicat Gener 2015](http://canigo.ctti.gencat.cat/related/cs/2015/01/comunicat.html)\r\n\r\n* [Comunicat Novembre 2013](http://canigo.ctti.gencat.cat/comunicats_antics/2013/11/)\r\n\r\n* [Comunicat Maig 2013](http://canigo.ctti.gencat.cat/comunicats_antics/2013/05/)\r\n\r\n### Canigó\r\n\r\nProperes publicacions del framework Canigó 3 deixaran de donar suport a JSF. També el plugin d'Eclipse inclòs l'[Entorn de desenvolupament Canigó](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/) per a generació de noves aplicacions no permetrà la generació d'aplicacions basades en aquesta tecnologia. L'única opció serà la creació d'aplicacions amb arquitectura REST+HTML5/JS.\r\n","objectID":"L2Jsb2MvMjAxNi8wNS9yZXN0LXZzLWpzZg=="},"L2Nhbmlnby9kb3dubG9hZA==":{"date":1422115902000,"title":"Descàrrega dels binaris de Canigó i de les API’s de suport","description":"Descàrrega de les diferents versions de Canigó, entorn de treball, plugin d'eclipse...","sections":"Canigó","weight":4,"path":"/canigo/download","content":"## Repositoris Maven\r\n\r\n+ Repositori Maven 1: http://repos.canigo.ctti.gencat.cat/repository/maven1\r\n+ Repositori Maven 2: http://repos.canigo.ctti.gencat.cat/repository/maven2\r\n\r\n<p>&nbsp;</p>\r\n\r\n## Canigó 3.1\r\n\r\n- [Mòduls de Canigó 3.1](http://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/)\r\n- [Release notes Canigó 3.1](/canigo-download-related/release-notes-canigo-31)\r\n- [Matriu de Compatibilitat Canigo 3](/canigo-download-related/matrius-compatibilitats)\r\n\r\n### Creació de l'entorn local\r\n\r\n<!--\r\n- Descàrrega de l'[entorn base de treball](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/entorn-treball/canigo3.html) *És necessari realitzar l'upgrade del plugin de Canigó per Eclipse a la versió 1.2.0.\r\n- Guia d'inici per a la configuració d'un entorn de desenvolupament. Veure aquest [link](/canigo-download-related/guia-inici)\r\n-->\r\n\r\nVeure [Entorn desenvolupament Canigó](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/)\r\n\r\nAltra informació d'interés:\r\n\r\n* Instal·lació plugin Canigó 3.1 per a Eclipse i creació d'aplicació: [HowTo generacio aplicació Canigo 3.1 amb plugin Eclipse](/related/canigo/howto/Canigo%20-%20HowTo%20-%20Generacio%20aplicacio%20Canigo%203.1%20amb%20plugin%20Eclipse.pdf)\r\n* Actualització plugin Canigó 3.0 a 3.1 per a Eclipse i actualització de l'aplicació: [HowTo d'actualització de Canigó 3.0 a 3.1](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Actualitzacio+Canig%C3%B3+3.0+a+Canigo+3.1.pdf)\r\n\r\n<p>&nbsp;</p>\r\n\r\n## Canigó 2.3.20\r\n\r\n- [Serveis de Canigó 2.3.20](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/)\r\n- [Connectors de Canigó 2.3.20](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/connectors/)\r\n- [Release notes Canigó 2.3.20](/canigo-download-related/release-notes-canigo-2)\r\n- [Plantilla Canigó 2.3.20 (Amb exemples) (format .zip)](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/plantilla-canigo-inicial/2.3.20/demo-canigo-2.3.20.zip)\r\n- [Plantilla Canigó 2.3.20 (Sense exemples) (format .zip)](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/plantilla-canigo-inicial/2.3.20/plantilla-canigo-2.3.20.zip)\r\n- [Contingut estàtic versió 2.3.20 (Comprimit) (format .zip)](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/plantilla-canigo-inicial/2.3.20/demo-canigo-static-compress-2.3.20.zip)\r\n\r\n### Creació de l'entorn local\r\n\r\n- Descàrrega de l'[entorn base de treball](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/entorn-treball/canigo.zip)\r\n- Guia d'inici per a la configuració d'un entorn de desenvolupament. Veure aquest [link](/canigo-download-related/guia-inici-canigo2)\r\n\r\n<p>&nbsp;</p>\r\n\r\n## Versions anteriors 2.x\r\n\r\nPer a versions antigues del Framework Canigó, contacteu amb el Centre de Suport.\r\n<p>&nbsp;</p>\r\n","objectID":"L2Nhbmlnby9kb3dubG9hZA=="},"L2Nhbmlnby9lbnRvcm4tZGVzZW52b2x1cGFtZW50":{"date":1447804800000,"title":"Entorn de desenvolupament","description":"Màquina virtual amb l'ecosistema d'eines Canigó per a començar a desenvolupar","sections":"Canigó","weight":99,"path":"/canigo/entorn-desenvolupament","content":"### Objectius\r\n\r\n* Facilitar la posada en marxa de l'entorn de desenvolupament, aprovisionant una màquina virtual amb tot el necessari per a començar el desenvolupament d'una aplicació Canigó.\r\n* Simular els entorns de desplegament als CPD Generalitat, facilitant contenidors amb les mateixes versions i configuracions dels PaaS que ens trobarem als clouds.\r\n\r\n### Pre requisits\r\n\r\n* [Virtualbox](https://www.virtualbox.org/wiki/Downloads)\r\n* [Vagrant](http://www.vagrantup.com/downloads.html)\r\n* [Vagranfile](https://github.com/cs-canigo/dev-environment/releases/tag/1.0.1) amb la configuració de l'entorn Canigó\r\n\r\nLa creació de la VM ha estat certificada amb Vagrant 1.8. Es recomana l'ús d'aquesta versió o superior.\r\n\r\n### Com començar?\r\n\r\n* Descarregar i descomprimir el [zip](https://github.com/cs-canigo/dev-environment/archive/1.0.1.zip) a la carpeta que desitgem (p.e. c:/vms o /home/user/vms)\r\n\r\n* Anar per línia de comanda a la carpeta on estigui el Vagrantfile i executem:\r\n\r\n\t\tvagrant up\r\n\r\n\tAmb aquesta instrucció, vagrant aixecarà una màquina virtual a Virtualbox i executarà les comandes que inclogui el Vagrantfile. El temps d'instal·lació serà llarg degut a que instal·la tot el software necessari per a desenvolupar i desplegar en els entorns de proves (es pot veure què instal·la reseguint el shell script).\r\n\r\n* En el moment que a la màquina virtual aixecada es vegi l'escriptori, el procés ja haurà finalitzat. Podem tancar la màquina i engegar-la i aturar-la a través de VirtualBox.\r\n\r\n\r\n### Setup inicial\r\n\r\n* Usuari i password: canigo/canigo\r\n\r\n* Configurar el teclat amb la configuració correcta: Menú inici > Preferències > Keyboard Input Methods > Input method > Add\r\n* Anara a IBUS Preferences -> Input Method -> Sel·leccionar l'idioma desitjat\r\n\r\n### Programari instal·lat\r\n\r\n* IDE: [Spring Tool Suite] (https://spring.io/tools) (basat en Eclipse Mars) amb JDK 7 (Oracle) i els següents plugins:\r\n\r\n\t- M2Eclipse per integració amb [Apache Maven](https://maven.apache.org/)\r\n\t- CTTI Canigó per creació aplicacions Canigó 3.1 basades en arquitectura REST+HTML5/JS o JSF\r\n\t- Spring Tool Suite per facilitar el desenvolupament d'aplicacions basades en [Spring](http://spring.io/projects)\r\n\t- Subclipse per integració amb [Subversion] (https://subversion.apache.org/)\r\n\t- SonarQube per integració amb [SonarQube] (http://www.sonarqube.org/) (antic Sonar)\r\n\r\n* Altres\r\n\r\n\t- Engine Docker i Docker Compose Tool per l'execució de contenidors Docker\r\n\t- Navegador Google Chrome\r\n\t- Client VPNC per accés a XCAT\r\n\r\n### Demo Equipaments\r\n\r\nDes del CS Canigó es proporciona un exemple d'aplicació Canigó 3 per ser desplegada en contenidors Docker. El stack és el següent:\r\n\r\n* MySQL 5.6: [mysql:5.6](https://hub.docker.com/_/mysql/)\r\n\r\n* Tomcat 7 + Oracle JDK 7: [cscanigo/tomcat7-java7](https://hub.docker.com/r/cscanigo/tomcat7-java7/)\r\n\r\n* Apache 2.4: [cscanigo/httpd:2.4] (https://hub.docker.com/r/cscanigo/httpd/)\r\n\r\nA continuació es descriuen les passes a seguir per la instal·lació i execució de l'aplicació demo Equipaments:\r\n\r\n* Configurar al fitxer /etc/hosts la següent entrada:\r\n\r\n\t\t127.0.0.1\tdemos.canigo.ctti.gencat.cat\r\n\r\n\tAquesta modificació es pot realitzar executant el editor de text \"leafpad\":\r\n\r\n\t\t$ sudo leafpad /etc/hosts\r\n\r\n* Des de l'Eclipse descarregar el projecte demo \"equipaments\":\r\n\r\n\tFile -> Import -> Projects from Git -> Clone URI https://github.com/cs-canigo/equipaments.git (introduïr unes credencials vàlides de Github) -> Sel·lecccionar branch \"master\" -> Sel·leccionar directori \"/home/canigo/Documents/workspace-sts-3.7.1.RELEASE\" com a Destinations -> Sel·leccionar l'opció \"Import Existing Eclipse projects\" -> Finish\r\n\r\n* Construïr l'aplicació:\r\n\r\n\tRun as... -> Maven build -> Configurar Base Directory \"${workspace_loc:/equipaments}\", Goals \"clean package\"-> Executar\r\n\r\n* Adaptar els paths \"home/canigo/...\" del fitxer \"``<workspace_eclipse>``/``<demo_equipaments>/``src/main/docker/stacks/dev/apache-tomcat-mysql/docker-compose.yml\" als paths locals en cas de no haver fer servit els noms per defecte:\r\n\r\n\t- ``<workspace_eclipse>``=/home/canigo/Documents/workspace-sts-3.7.1.RELEASE\r\n\t- ``<demo_equipaments>``=equipaments\r\n\r\n* Executar la demo des de linia de comandes:\r\n\r\n\t\t$ cd <workspace_eclipse>/<demo_equipaments>/src/main/docker/stacks/dev/apache-tomcat-mysql/\r\n\t\t$ docker-compose up\r\n\r\n\tO bé des d'Eclipse:\r\n\r\n\tRun -> External tools -> External Tools Configurations... -> Program - New launch configuration -> Name \"equipaments\" -> Location: \"/usr/local/bin/docker-compose\", Working Directory: \"${workspace_loc:/``<demo_equipaments>``/src/main/docker/stacks/dev/apache-tomcat-mysql}\", Arguments: \"up\" -> Executar\r\n\r\n* Accedir amb el Chrome a la URL http://demos.canigo.ctti.gencat.cat/demo-equipaments\r\n\r\n* La forma més fàcil d'eliminar els contenidors en execució, i per tant aturar l'aplicació, és executar la següent comanda:\r\n\r\n\t\t$ docker rm -f $(docker ps -qa)\r\n\r\n\r\n### Oracle VirtualBox\r\n\r\nSi es volen afegir carpetes compartides entre la màquina host i la guest s'han de seguir les següents passes:\r\n\r\n* Afegir el grup vboxsf a l'usuari canigo (cal ser root o fer sudo):\r\n\r\n\t\t$ sudo usermod -a -G vboxsf canigo\r\n\r\n* Reiniciar la màquina o tornar logar-se.\r\n* Afegir les carpetes desitjades a través de Dispositius -> Carpetes compartides -> Preferències de carpetes compartides... Es pot fer en \"calent\" i apareixen al directori \"/media\" dins la màquina virtual.\r\n\r\n### Versions\r\n\r\n#### 1.0.0 - Ubuntu 15.04 (16/11/2015)\r\n\r\nRELEASE NOTES\r\n\r\n* Versió inicial\r\n\r\n#### 1.0.1 - Ubuntu 15.10 (16/3/2016)\r\n\r\nRELEASE NOTES\r\n\r\n* Actualització a Ubuntu 15.10\r\n\r\nUPGRADE\r\n\r\nEn cas de voler actualitzar a la v1.0.1 des de la v1.0.0 de l'entorn de desenvolupament cal...\r\n\r\n* Fer l'upgrade a la versió 15.10 d'Ubuntu\r\n* Executar les següents comandes per a que segueixi apareixent el fons de pantalla corporatiu CTTI:\r\n\r\n\t\t$ sudo cp /usr/share/lubuntu/wallpapers/1510-lubuntu-default-wallpaper.png /usr/share/lubuntu/wallpapers/1510-lubuntu-default-wallpaper_bck.png\r\n\t\t$ sudo wget http://canigo.ctti.gencat.cat/devenv/fonspantalla_1280.png -O /usr/share/lubuntu/wallpapers/1510-lubuntu-default-wallpaper.png\r\n\r\n* Revisar la configuració de teclat a Preferències -> IBus Preferences -> Input method (en cas de no estar activat l'IBus cal activar-lo a Preferències -> Language Support -> Keyboard input method system)\r\n","objectID":"L2Nhbmlnby9lbnRvcm4tZGVzZW52b2x1cGFtZW50"},"L2Nhbmlnby1kb2N1bWVudGFjaW8vaG93LXRvcw==":{"date":1422115902000,"title":"How to","description":"Normes aplicables al desenvolupament d'aplicacions","sections":"How to","taxonomies":[],"weight":4,"path":"/canigo-documentacio/how-tos","content":"Un how-to és un document informal, generalment breu, que descriu com desenvolupar una certa tasca.\r\n\r\nEn aquest apartat s'aniran afegint un seguit de how-to, per tal de facilitar la configuració de certs components del framework, evitar possibles problemes, etc. Aquests documents estan disponibles en format pdf.\r\n\r\nHow-to disponibles actualment:\r\n\r\n- [Canigó - Contenidor GICAR en entorns de desenvolupament](/related/canigo/howto/Canigo - Howto - Contenidor GICAR en entorns de desenvolupament.pdf)\r\n- [Canigó - Incorporació mòdul Administració de logs a aplicació Canigó](/related/canigo/howto/Canigo - Incorporacio modul Administracio de logs a aplicacio Canigo 3.pdf)\r\n- [Canigó - Anàlisi aplicació Canigó amb Sonar](/related/canigo/howto/Canigo - Analisi aplicacio Canigo amb Sonar.pdf)\r\n- [Canigó - Websockets a Canigó 3.1](/related/canigo/howto/Canigo - Websockets a Canigo 3.1.pdf)\r\n- [Canigó - Streaming de fitxers en clients REST](/related/canigo/howto/Canigo - Streaming de fitxers en clients REST.pdf)\r\n- [Canigó - Actualització connectors amb la PICA](/related/canigo/howto/Canigo - Actualitzacio Connectors PICA.pdf)\r\n- [Canigó - Execució demo Equipaments al nou Entorn de Treball](/related/canigo/howto/Canigo - HowTo - Execucio demo Equipaments al nou Entorn de Treball.pdf)\r\n- [Canigó - Certificació desplegaments d'aplicacions Canigó a Websphere 8.5](/related/canigo/howto/Canigo - HowTo - Certificació desplegaments d'aplicacions Canigó a Websphere 8.5.pdf)\r\n- [SIC - Custodia i control de vesions del codi de les aplicacions](/related/canigo/howto/SIC-Custodia_i_control_de_versions_del_codi_de_les_aplicacions.pdf)\r\n- [Canigó - Generació aplicació Canigó 3.1 amb plugin Eclipse](/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf)\r\n- [Canigó - Aplicació Canigó 3.1 sense frontend](/related/canigo/howto/Canigo - HowTo - Aplicacio Canigo 3.1 sense frontend.pdf)\r\n- [Canigó - Ús de relacions Lazy en aplicacions REST](/related/canigo/howto/Canigo - Us de relacions Lazy en aplicacions REST.pdf)\r\n- [Configuració GICAR i CORS amb proxy invers Apache en aplicacions REST+HTML5/JS](/related/canigo/howto/Canigó - Configuració GICAR-CORS amb Apache en aplicacions REST_HTML5_JS.pdf)\r\n- [Configuració autenticació bàsica a Canigó 3.1](/related/canigo/howto/Canigó - Configuració autenticació bàsica a Canigó 3.1.pdf)\r\n- [Integració Recaptcha](/related/canigo/howto/Canigó - Howto - Integració Recaptcha.pdf)\r\n- [Configuració de Canigo LOPD](/related/canigo/howto/Canigó - Howto - Configuració de Canigo LOPD.pdf)\r\n- [Us checkstyle pmd i findbugs en entorns de desenvolupament](/related/canigo/howto/Canigó - Howto - Us checkstyle pmd i findbugs en entorns de desenvolupament.pdf)\r\n- [Actualització Canigó 3.0 a Canigó 3.1](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Actualitzacio+Canig%C3%B3+3.0+a+Canigo+3.1.pdf)\r\n- [Configuració plantilla canigó amb Primefaces](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Plantilla+Canigo+amb+Primefaces.pdf)\r\n- [Configuració scope view JSF a Spring 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Configuraci%C3%B3+scope+view+JSF+a+Spring+3.pdf)\r\n- [AOP i AspectJ a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+AOP+i+AspectJ+amb+Canig%C3%B3+3.pdf)\r\n- [Configuració fil d'Ariadna a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Configuraci%C3%B3+fil+d%27ariadna+a+Canig%C3%B33.pdf)\r\n- [Menú Lateral amb estat a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Men%C3%BA+Lateral+amb+Recordatori+d%27estat.pdf)\r\n- [Validacions amb Java Bean Validation (JSR-303)](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Validacions+amb+Java+Bean+Validation+%28JSR-303%29.pdf)\r\n- [Llistats paginables a servidor amb Canigó 3 ](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Llistats+paginables+a+servidor+amb+Canig%C3%B3+3.pdf)\r\n- [Joc de caràcters en aplicacions Canigó 3 ](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Joc+de+car%C3%A0cters+en+aplicacions+Canig%C3%B3+3.pdf)\r\n- [Upload de fitxers a Canigó 3 ](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Upload+de+fitxers+a+Canig%C3%B3+3.pdf)\r\n- [Generació de CRUDs amb JSF 2 ](/related/canigo/howto/howto_crud_jsf2.zip)\r\n- [Gestió d'excepcions amb JSF 2](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Gesti%C3%B3+d%27excepcions+amb+JSF+2.pdf)\r\n- [Exemple d'arquitectura servidor i clients desacoblats](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Exemple+d%27arquitectura+servidor+i+clients+desacoblats.pdf)\r\n- [Generació d'informes amb JasperReports](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Generaci%C3%B3+d%27informes+amb+JasperReports.pdf\")\r\n- [Generació de codis de barres](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Generaci%C3%B3+de+codis+de+barres.pdf\")\r\n- [Configuració slave Windows a Jenkins](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Configuraci%C3%B3+slave+Windows+a+Jenkins.pdf\")\r\n- [Implementació CRUD amb serveis REST i JQuery](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Implementaci%C3%B3+CRUD+amb+servei+REST+i+JQuery.pdf\")\r\n- [Mavenització d'aplicacions Android](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Mavenitzaci%C3%B3+d%27aplicacions+Android.pdf\")\r\n- [Custodia i control de versions del codi de les aplicacions](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Custodia+i+control+de+versions+del+codi+de+les+aplicacions.pdf\")\r\n- [Generació de gràfiques amb Primefaces a Canigó 3](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Generaci%C3%B3+de+gr%C3%A0fiques+amb+Primefaces+a+Canig%C3%B3+3.pdf\")\r\n- [Canigó - HowTo + YUI Compressor al SIC](/related/canigo/howto/HowTo.+YUI+Compressor+al+SIC.pdf\")\r\n- [Creació d'un client CXF per l'STD](/related/canigo/howto/HowTo++Creaci%C3%B3+d%27un+client+CXF+STD.pdf\")\r\n- [Creació EAR's en un sol pas](/related/canigo/howto/HowTo.+Creaci%C3%B3+EAR+en+un+sol+pas.pdf)\r\n- [Desplegament Scripts de BBDD en INT](/related/canigo/howto/HowTo.Desplegament+Scripts+de+BBDD+en+INT.pdf)\r\n- [Instrumentació de Canigó 3 custom](/related/canigo/howto/HowTo.+Personalitzaci%C3%B3+de+la+Instrumentaci%C3%B3+Canig%C3%B33.pdf)\r\n- [Eina de Generació de Projectes Canigó 3](/related/canigo/howto/HowTo++Operativa+Eina+de+creaci%C3%B3+de+projectes+Canig%C3%B3.pdf)\r\n- [WURFL](/related/canigo/howto/Howto+Canigo3+-+WURFL_v1+3.pdf)\r\n- [Mavenització d'aplicacions basades en scripts d'ANT.pdf](/related/canigo/howto/HowTo+-+Mavenitzaci%C3%B3+aplicacions+basades+en+scripts+ANT.pdf\")\r\n- [Configuració de Webservices per MTOM.pdf](/related/canigo/howto/Howto+-+Configuraci%C3%B3+de+Webservices+MTOM.pdf)\r\n- [Upgrade Weblogic 10g.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Upgrade+Weblogic+10g.pdf)\r\n- [Crides webservices segurs SSL.pdf](/related/canigo/howto/Howto - Crides webservices segurs SSL.pdf)\r\n- [Millora entorn desenvolupament.pdf](/related/canigo/howto/Howto+-+Millora+entorn+desenvolupament.pdf)\r\n- [Ús d'eines d'increment de la productivitat per l'entorn de treball de Canigó.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-++%C3%9As+d%3Feines+d%3Fincrement+de+la+productivitat+per+l%3Fentorn+de+treball+de+Canig%C3%B3.pdf)\r\n- [Tomcat 6.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Tomcat+6.pdf)\r\n- [Directrius J2EE.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Directrius+J2EE.pdf)\r\n- [Canigo - HowTo - Upgrade Hibernate 3.2.6.ga a Canigó 1.4.x.pdf](/related/canigo/howto/HowTo.Pujar+la+versi%C3%B3+de+Hibernate+a+3.2.6.ga.pdf)\r\n- [Canigo - HowTo - Empaquetat en format EAR.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Empaquetat+en+format+EAR.pdf)\r\n- [Canigo - HowTo - Construcció de projectes amb Maven.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Construcci%C3%B3+de+projectes+amb+Maven.pdf)\r\n- [Accés a WebServices externs des de la Xarxa XCAT.pdf](/related/canigo/howto/Howto+-+Utilitzaci%C3%B3+Proxy+Servei+Framework.pdf)\r\n- [Canigo - HowTo - Com fer upgrade a Servlet 2.4 i JSP 2.0 (J2EE 1.4)](/related/canigo/howto/Canigo+-+HowTo+-+Com+fer+upgrade+a+Servlet+2.4+i+JSP+2.0+%28J2EE+1.4%29.pdf)\r\n- [Com pujar la versió de Hibernate a 3.2.6.ga.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Com+pujar+la+versi%C3%B3+de+Hibernate+a+3.2.6.ga.pdf)\r\n- [Integració amb Gicar](/related/canigo/howto/Canig%C3%B3+-+HowTo+GICAR+v2.pdf)\r\n- [Què fer si els missatges d'excepció d'Hibernate no arriben correctament](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+que+fer+si+els+missatges+d%27excepci%C3%B3+de+Hibernate+no+arriben+correctament.pdf)\r\n- [mostrar excepcions produides en fase de renderitzat .pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+mostrar+excepcions+produides+en+fase+de+renderitzat+.pdf)\r\n- [Publicació i invocació de WebServices](/related/canigo/howto/Canigo+-+HowTo+WebServices-v1.1.pdf)\r\n- [Canigo - HowTo - Generació i visualització de Traces.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Generaci%C3%B3+i+visualitzaci%C3%B3+de+Traces.pdf)\r\n- [Canigo - HowTo - Com securitzar els mètodes de negoci.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Com+securitzar+els+m%C3%A8todes+de+negoci.pdf)&nbsp;\r\n- [Com definir tests en context Spring.pdf](/related/canigo/howto/Canigo+-+HowTo+-+Com+definir+tests+en+context+Spring.pdf)\r\n- [Canigo - HowTo - com fer paginacio amb grans volums de dades.pdf](/related/canigo/howto/Canigo+-+HowTo+-+com+fer+paginacio+amb+grans+volums+de+dades.pdf)\r\n- [Joc de Caràcters en aplicacions Canigó.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Joc+de+Car%C3%A0cters+en+aplicacions+Canig%C3%B3.pdf)\r\n- [Anàlisi d'Utilització de Memòria.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+An%C3%A0lisi+d%27Utilitzaci%C3%B3+de+Mem%C3%B2ria.pdf)\r\n- [Integracio Continua.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Integracio+Continua.pdf)\r\n- [Eines d'anàlisi de rendiment web.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+d%27an%C3%A0lisi+de+rendiment+web.pdf)\r\n- [Eines de compressió JavaScript.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+de+compressi%C3%B3+JavaScript.pdf)\r\n- [Antivirus.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Antivirus.docx)\r\n- [Transformació ppk a openSSH.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Transformaci%C3%B3+ppk+a+openssh.docx)\r\n- [Eines de visualització del GC.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+de+visualitzaci%C3%B3+del+GC.pdf)\r\n- [Eines Intercepció de peticions http.pdf](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Eines+Intercepci%C3%B3+de+peticions.pdf)\r\n- [Entorn Treball](/related/canigo/howto/Canig%C3%B3+-+HowTo+-+Entorn+Treball.pdf)\r\n- [Generació de CRUD Canigó 3](/related/canigo/howto/Howto+-+Generaci%C3%B3+Crud+Canig%C3%B33.zip?version=2) [Descarregar ScreenCast](http://dl.dropbox.com/u/6456567/Videos%20Generaci%C3%B3%20CRUD.zip)\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8vaG93LXRvcw=="},"L2Jsb2MvMjAxNi8wOS9jbG91ZC1yZWFkeQ==":{"date":1473897600000,"title":"Cloud-Ready","description":"Aspectes a tenir en compte en la definició de l'arquitectura d'una aplicació per estar preparada per anar al Cloud","sections":["Bloc","home"],"bloc_tags":["patrons de disseny","microserveis","api"],"imatge":"/images/bloc/cloud-ready.png","key":"OCTUBRE2016","path":"/bloc/2016/09/cloud-ready","content":"Per tal que una aplicació pugui ser desplegada al **Cloud** i s'aprofiti dels beneficis que aquest aporta, cal que hagi estat dissenyada amb aquesta finalitat. Aquest disseny, normalment, és més complex que el disseny que es pugui realitzar per una aplicació destinada a ser desplegada en servidors \"on-premise\". Són molts els avantatges d'un entorn Cloud (flexibilitat, agilitat en aprovisionament, facilitat per desplegament continu,...) que fan que l'esforç en la **definició de l'arquitectura** valgui la pena.\n\nA continuació s'enumeren diferents conceptes a tenir en compte en el disseny d'una aplicació que vulgui estar preparada per anar al Cloud:\n\n## Conceptes\n\n### Micro-serveis <img src=\"/images/bloc/cloud-ready-microservices.png\" alt=\"Microserveis\" style=\"width: 80px;\"/>\n\nL'aplicació ha de ser concebuda com una **col·lecció de serveis**, no com a una única peça (monòlit). Més informació en aquesta [entrada](/bloc/2016/08/microserveis/) d'aquest mateix bloc.\n\n### Escalabilitat <img src=\"/images/bloc/cloud-ready-scalability.png\" alt=\"Escalabilitat\" style=\"width: 80px;\"/>\n\nUna arquitectura orientada a micro-serveis permetrà l'**escalabilitat de cada servei per separat**. Els entorns Cloud estan dissenyats per aprovisionar molts entorns d'execució petits (contenidors, paas, ...). Per tant, les arquitectures orientades a micro-serveis són de forma natural fàcilment integrables en entorns Cloud.\n\nL'escalabilitat permetrà canviar el nombre d'instàncies de l'aplicació segons les necessitats. És important que l'aplicació sigui el més \"stateless\" possible ja que d'aquesta manera serà molt més fàcil d'escalar.\n\nL'aplicació ha d'estar preparada per aturar-se i reiniciar-se sempre que calgui, aturant nodes quan la càrrega sigui petita o incrementant-ne quan hi hagi un pic de consum.\n\n### Agnòstic de la infraestructura <img src=\"/images/bloc/cloud-ready-infraestructure-agnostic.png\" alt=\"Agnòstic de la infraestructura\" style=\"width: 70px;\"/>\n\nL'aplicació **no ha d'estar lligada a cap element de la infraestructura** on hagi de ser desplegada. D'aquesta manera, si l'aplicació ha de traslladar-se d'una infraestructura a una altra de diferent, no es veurà afectada. Per exemple, no ha d'utilitzar IPs, o tenir en compte el número de instàncies de l'aplicació. Tampoc hauria de tenir funcionalitats dependents d'un sistema operatiu concret.\n\n### Robustesa <img src=\"/images/bloc/cloud-ready-fault-tolerance.png\" alt=\"Robustesa\" style=\"width: 50px;\"/>\n\nCada component ha de ser **el més autònom possible**, podent funcionar encara que la resta no estiguin disponibles. Aquesta tolerància a fallides és clau per a l'èxit d'una aplicació amb una arquitectura distribuïda. S'han d'evitar punts crítics que suposin la caiguda (downtime) de tota l'aplicació.\n\n### Desacoblament de les dades <img src=\"/images/bloc/cloud-ready-decoupled.png\" alt=\"Desacoblament\" style=\"width: 60px;\"/>\n\nEl **processament de les dades, i les mateixes dades, han d'estar en components separats**. Un cop desacoblats, és possible tenir les dades en un CPD privat i fer-ne el processament en un cloud públic o privat. Aquesta és una pràctica habitual en empreses i organitzacions que volen tenir les dades en els seus servidors però aprofitar els avantatges que proporciona el cloud.\n\n### Emmagatzemament local <img src=\"/images/bloc/cloud-ready-storage.jpg\" alt=\"Emmagatzemament\" style=\"width: 80px;\"/>\n\nEn un entorn Cloud **els fitxers que escriu l'aplicació al sistema de fitxers local són volàtils**. Per exemple, suposant que l'aplicació utilitza el sistema de fitxers local com a caché, en aturar-se un node i aixecar-se posteriorment en una altra ubicació (màquina física, VM, ...), aquesta caché desapareixerà, el que suposarà que el temps de resposta serà diferent dels altres nodes on si existeix aquesta caché. El que es recomana és utilitzar un repositori extern com pugui ser una base de dades SQL o NoSQL.\n\nUn altre aspecte a tenir en compte és la lectura de fitxers de configuració de l'aplicació. Aquests han de ser idèntics en tots els nodes, ja que en cas contrari el resultat pot ser inesperat.\n\n### Seguretat <img src=\"/images/bloc/cloud-ready-security.png\" alt=\"Seguretat\" style=\"width: 80px;\"/>\n\n#### Stateless\n\nPer tal que una aplicació no es vegi afectada per un escalat dinàmic (canvi del nombre d'instàncies en calent) cal que sigui \"stateless\", és a dir, **no mantingui l'estat en la mateixa aplicació**. Una possibilitat és emmagatzemar part de l'estat en el navegador en aplicacions web modernes utilitzant funcionalitats d'HTML5, encara que el més habitual és utilitzar un repositori centralitzat en el servidor (Redis, per exemple). No ha d'utilitzar-se l'HTTPSession en Java, o session[] hash a Ruby on Rails, donat que llavors estem emmagatzemant l'estat dins la pròpia aplicació, fet que volem evitar. La solució implica utilitzar un repositori amb alta disponibilitat extern a l'aplicació com pugui ser Redis o Memcached. \n\n### Interoperabilitat  <img src=\"/images/bloc/cloud-ready-interoperability.png\" alt=\"Interoperability\" style=\"width: 60px;\"/>\n\n#### Protocols moderns i estàndards\n\nL'aplicació ha d'utilitzar protocols moderns, preferiblement **REST sobre HTTP(s)**, o inclús SOAP i WS-* estàndards. Per tant, cal evitar l'ús de protocols com per exemple RMI-IIOP ja en desús des de fa força temps.\n\n#### Optimització de la comunicació entre components\n\nPer tal que una aplicació tingui un bon rendiment, cal pensar molt bé quina és la manera més òptima per a comunicar els diferents components que en formen part. Per exemple, agrupant missatges en lloc d'estar contínuament fent intercanvi d'informació.\n\n### DevOps <img src=\"/images/bloc/cloud-ready-devops.jpg\" alt=\"DevOps\" style=\"width: 60px;\"/>\n\n#### Configuració/Automatització\n\nÉs molt important que els equips de desenvolupament i operacions es posin d'acord en com ha de ser la configuració de l'aplicació per a poder ser desplegada en els diferents entorns i aquest procés de desplegament pugui automatitzar-se (DevOps). Per assolir aquest objectiu cal definir **convencions** i documentar com han de ser aquestes configuracions per tal que no hi hagi divergències que puguin dificultar la tasca.\n\n#### Monitorització\n\nL'aplicació ha de poder ser monitoritzada. No ha de ser necessari tenir coneixements (interpretar logs) de l'aplicació per a poder determinar si aquesta està funcionant correctament o no. Per tant, han d'existir **mètriques i sondes (health check URL) tècniques**, no funcionals, que permetin saber si l'estat de l'aplicació és correcte. Per exemple, una URL que retorni el codi HTTP 200 en cas satisfactori o un codi diferent altrament.\n\n#### Traçabilitat\n\nL'aplicació no ha d'escriure els logs a un fitxer local. Cal recordar que els nodes han de poder aturar-se i reiniciar-se sense que l'aplicació es vegi afectada. En cas que els logs s'escriguin en el sistema de fitxers local aquesta informació es perdrà.\n\nEn entorns cloud s'acostuma a utilitzar un servei extern que funciona com a **agregador de logs**. D'aquesta manera els logs persistiran encara que els nodes de l'aplicació s'eliminin. Donat que la transmissió de logs es fa per la xarxa, cal anar amb compte amb el nivell de log (error, warn, info, debug, trace) configurat en entorns productius, ja que pot produïr un problema de saturació en cas que estigui configurat a un nivell de detall molt alt. El volum de logs ha de ser manegable.\n\n## Canigó\n\nEs preveu una evolució del framework Canigó durant finals d'aquest any i 2017 en aquesta línia, per tal de facilitar el màxim possible el seu desplegament en entorns Cloud.\n\n<br />\n\n**Referències**:\n\n- http://blog.octo.com/en/cloud-ready-applications/\n- http://www.ibm.com/developerworks/websphere/techjournal/1404_brown/1404_brown.html\n- http://techbeacon.com/5-steps-building-cloud-ready-application-architecture\n","objectID":"L2Jsb2MvMjAxNi8wOS9jbG91ZC1yZWFkeQ=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8vbmF2ZWdhZG9ycw==":{"date":1423152702000,"title":"Navegadors","description":"Estadístiques de navegadors webs gencat (%)","sections":"Documentació Canigó","taxonomies":[],"weight":5,"path":"/canigo-documentacio/navegadors","content":"Principals navegadors que accedeixen a gencat.cat en els últims 3 mesos.\r\n\r\n<script src=\"https://www.google.com/jsapi\"></script>\r\n<script src=\"/js/browsers.js\"></script>\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8vbmF2ZWdhZG9ycw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8vbm9ybWF0aXVz":{"date":1422115902000,"title":"Normatius","description":"Normes aplicables al desenvolupament d'aplicacions","sections":"Documentació Canigó","taxonomies":[],"weight":3,"path":"/canigo-documentacio/normatius","content":"### Principals normes\r\n\r\n- [Norma de desenvolupament J2EE](/related/canigo/normes/NOR_0009_Desenvolupament_J2EE-V03.pdf)\r\n- [Norma de desenvolupament web](https://qualitat.solucions.gencat.cat/normatius/normatiu-desenvolupament-web/)\r\n- [Norma de desenvolupament de BBDD](/related/canigo/normes/SC-NOR11-01 Norma nomenclatura i esquema de bases de dades_v2.2.pdf)\r\n\r\n### Regles d'estil\r\n\r\n- Per als entorns de desenvolupament es recomana l'ús de Checkstyle, PMD i Findbugs\r\n- L'eina corporativa d'auditoria de codi és CAST. Més informació al web del [Model de Qualitat de Solucions](https://qualitat.solucions.gencat.cat/). Enllaç directe a [CAST](https://qualitat.solucions.gencat.cat/MQS/tools/cast_9A47CE30.html?nodeId=33196b46)\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8vbm9ybWF0aXVz"},"L2Nhbmlnby9mcmFtZXdvcms=":{"date":1463011200000,"title":"Framework Canigó","description":"Descripció del Framework de desenvolupament corporatiu JEE de la Generalitat de Catalunya","sections":"Canigó","taxonomies":[],"toc":true,"weight":1,"path":"/canigo/framework","content":"## Descripció del framework\r\n\r\nCanigó es defineix com un \"Espai de treball tecnològic comú per al desenvolupament i execució d'aplicacions en l'àmbit dels sistemes corporatius i departamentals de la Generalitat de Catalunya\", i es els seus objectius són: \r\n\r\n- Oferir una arquitectura comuna de construcció d'aplicacions JEE.\r\n- Proporcionar un entorn de treball, documentacó, suport i manteniment dels seus components.\r\n- Simplificar la complexitat inherent a JEE, oferint un marc de referència de treball.\r\n- Oferir una solució aliniada amb els estàndars i solucions més utilitzades per la comunitat OpenSource.\r\n- Oferir una solució oberta que permeti afegir i intercanviar qualsevol peça amb un cost reduït.\r\n- Oferir una solució d'interconnectivitat amb els serveis corporatius.\r\n- Oferir patrons de desenvolupament àmpliament acceptats.\r\n\r\nL'arquitectura de Canigó es basa en l'arquitectura MVC (Model-Vista-Controlador), on existeix un procés d'abstracció que permet dividir una aplicació en components lògics amb responsabilitats diferenciades i que poden ser desenvolupats fins i tot per diferents rols de l'equip.\r\n\r\nTanmateix, a més de l'estructura lògica dels components segons el patró MVC, Canigó defineix la seva ubicació segons una arquitectura en 3 capes i 4 mòduls transversals:\r\n\r\n**Capes**\r\n\r\n- **Capa de Presentació**: els patrons de desenvolupament actuals fomenten la separació de la capa de presentació en dues parts diferenciades:\r\n\t- **Servidor**: la \"vista\" serà una resposta format JSON, mitjançant serveis (microserveis) HTTP/REST\r\n\t- **Client**: client lleuger estàtic que consumirà el serveis del punt anterior.\r\n\r\n- **Capa de Lògica de Negoci**\r\n- **Capa de Dades/Integració**\r\n\r\n\r\n**Mòduls**\r\n\r\n- **Nucli del Framework**\r\n- **Mòdul de Seguretat**\r\n- **Mòdul de Suport**\r\n- **Mòdul d'Operació**\r\n\r\n\r\n![Arquitectura Canigó](/related/canigo/arquitectura.png)\r\n\r\nCom es mostra en el gràfic anterior, Canigó esta estructurat modularment donant així la opció de només utlitzar el mòdul del framework que es requereixi. Tots aquests mòduls es troben definits mitjançant interfícies, aïllant-los així de la implementació concreta escollida.\r\n\r\nCanigó es basa en la utilització de interfícies i en la integració existent entre diferents APIs (JPA,...) i paquets oberts (Spring, Hibernate, ...). També ofereix extensions als paquets oberts, afegint un ampli ventall de components reutilitzables.\r\n\r\nEl framework base es pot classificar en els següents blocs:\r\n\r\n## Components Base\r\n\r\nCanigó3 és un framework de codi obert per a la plataforma Java. Està basat en Spring, la primera versió del qual va ser creada per Rod Johnson a l'octubre de 2002. Està pensat per donar suport a:\r\n\r\n- la configuració d'aplicacións \r\n- facilitar el muntatge d'un sistema per parts fàcilment intercanviables i visibles entre elles\r\n- la integració de serveis\r\n- serveis de seguretat\r\n- connexió a base de dades, transaccionalitat, ... \r\n- la realització de proves, a través de Spring, que permet realitzar tests unitaris desacoblant els objectes del seu context fent més senzill realitzar proves dels components per separat\r\n- l'accés a dades externes, mitjantçant Spring, gestionant els recursos, proporcionant APIs d'ajuda i suportant la majoria de les tecnologies d'accés a dades com: JDBC, Hibernate, JPA, JDO o iBatis. \r\n\r\nEs pot considerar que la base principal de l'arquitectura de Canigó és un conjunt totalment integrat, i a la vegada modular, de les millors pràctiques tecnològiques existent actualment en aquest entorn, formada pels següents components:\r\nhttps://es.yahoo.com/\r\n- **Spring 4 Framework** com a contenidor centralitzat d'objectes i serveis, totalment configurable mitjançant fitxers XML. La injecció de dependències permet la configuració d'objectes fora del codi de l'aplicació (i de manera no intrusiva). Redueix el codi d'aplicació dedicat a configurar i localitzar recursos. Facilita millors pràctiques com programar contra interfícies enlloc de contra classes, permetent el desacoblament de serveis i el canvi ràpid d'una implementació concreta per una altra. Permet també la gestió de transaccions sense la utilització de APIs específiques mitjançant l'ús de Aspect Oriented Programming (AOP)\r\n- **JPA** proporciona un mòdel de persistència basat en POJO's (Plain Old Java Objects) per mapejar bases de dades relacionals en Java.\r\n- **AOP (Aspect Oriented Programming)** per intercepció d'events a l'aplicació sense necessitat de modificar el codi\r\n\r\n## Nucli del Framework\r\n\r\nAquest mòdul és el <i>core</i> del framework on es troben les principals caracteristiquest:\r\n\r\n- **Configuració Multientorn**: basat en el PropertyPlaceHolder ofert per Spring. Amb la diferència que aquest mòdul permet disposar de propietats depenents de l'entorn sense necessitat de cap configuració extra a nivell de beans o propietats.\r\n- **Internacionalització (i18n)**: té com a objectiu facilitar el desenvolupament a l'hora d'oferir una aplicació en múltiples llenguatges.\r\n- **Servei de Traces**: basat en Log4j. Permet definir el nivell de traces, sortides, nivell mínim de traces, format de sortida, informació de context, ...\r\n- **Servei d'Excepcions**: permet informar que s'ha produït un error al realitzar una petició. Canigó ofereix una sèrie d'excepcions per defecte (BaseException, CoreException, ...). També proporciona un mecanisme d'intercepció d'Excepcions per a evitar \"try-catch\".\r\n\r\n## Mòdul de Seguretat\r\n\r\nTé com a propòsit gestionar l'autenticació i autorització dels usuaris que accedeixen a les aplicacions.\r\n\r\n- **Mòdul de Seguretat**: basat en Spring Security 3.0. Permet gestionar l'autenticació i l'autorització dels usuaris de les aplicacions.\r\n- **Backends Seguretat**: El servei de seguretat s'integra amb GICAR, SACE, LDAP, Base de dades i Inmemory.\r\n\r\n## Mòdul d'Integració\r\n\r\nLa finalitat d'aquests mòduls és facilitar l'accés a diferents serveis que ofereix la Generalitat.\r\n\r\n- **PICA**: proporciona una interfície Java per accedir a la Plataforma d'Integració i Col·laboració Administrativa. Aquest mòdul permet realitzar comunicacions síncrones i asíncrones.\r\n- **GECAT**: proporciona funcionalitat d'alta de factures, consultes i reserves online que ofereix el servei SAP de GECAT.\r\n- **PSIS**: permet la validació de signatures i certificats mitjançant el servei de PSIS ofert per Catcert.\r\n- **SARCAT**: permet consumir els diferents serveis que ofereix Sarcat, via Webservices o FTP/SFTP per a peticions planificades.\r\n- **Documentum**: permet consumir funcionalitats de Documentum com l'emmagatzematge i recuperació de documents, a més de crear carpetes i associar propietats.\r\n- **Notificacions Telemàtiques**: és un connector funcional cap a la PICA que simplifica l'utilització de Notificacions Telemàtiques de la Generalitat.\r\n- **Antivirus**: permet l'escaneig d'arxius mitjançant la Plataforma d'Antivirus Corporatiu de la Generalitat.\r\n- **SAP**: proporciona una interfície simplificada per a accedir a backends SAP de la Generalitat.\r\n- **Webservices**: Canigó 3 no disposa d'un mòdul de Webservices. S'ha realitzat una guia on s'explica com realitzar l'exportació de serveis Java mitjançant Webservices, l'importació de webservices externs i generació de les classes Java d'invocació. Proposa l'utilització d'Spring WS, Jaxb i OXM\r\n- **Cues**: Canigó 3 no disposa d'un mòdul de Gestió de Cues. S'ha realitzat una guia on s'explica com produir i consumir missatges d'una cua. Proposa l'utilització d'Spring JMS (Java Message Service).\r\n\r\n## Mòdul de Persistència\r\n\r\nAquest mòdul permet persistir i recuperar dades entre l'aplicació i el motor de base de dades.\r\n\r\n- **JPA**: Java Persistence API busca la manera d'unificar les utilitats que proporcionen un mapeig objecte-relacional. La implementació de JPA per defecte a Canigó 3 és Hibernate.\r\n\r\n## Mòdul de Suport\r\n\r\nAquest mòdul facilita l'ús d'un conjunt addicional de funcionalitats mitjançant el framework.\r\n\r\n- **Transferència Fitxers**: permet al servidor obtenir fitxers adjunts provinents d'una petició d'un formulari HTML. A més, aquest mòdul s'integra amb d'altres com el d'Antivirus.\r\n- **Enviament de correu**: permet l'enviament de correus electrònics a una o diverses adreces. També permet enviar en format de text pla o html i en tots dos casos ofereix la possibilitat d'adjuntar un o més fitxers en mode adjunt o inline.\r\n- **Planificador Tasques**: basat en Spring i Quartz. Ofereix la possibilitat d'executar tasques de forma diferida. En qualsevol moment del dia, algun dia de la setmana, ...\r\n- **OLE**: permet la manipulació d'objectes OLE (Excel i Word: crear, llegir, modificar documents de Microsoft en format OLE). Basat en POI.\r\n- **Merging**: permet realitzar la fusió de documents en format WordML, partint d'un document amb uns marcadors que seran substituïts per un conjunt de valors indicats en un diccionari.\r\n- **SFTP**: Permet enviar i rebre arxius entre el servidor on s'executa l'aplicació i altres servidors de forma segura mitjançant un intercanvi de claus. Basat en llibreries JSCH i Commons-VFS.\r\n\r\n## Mòdul d'Operació\r\n\r\n- **Instrumentació**: permet a l'aplicació generar dades d'instrumentació (nombre de peticions, nombre d'errors, ...) de la seva execució i posteriorment ser explotades amb eines de monitorització.\r\n- **Monitorització**: permet a l'aplicació mostrar una pantalla on es mostren dades guardades pel mòdul d'instrumentació.\r\n- **Logging**: permet a l'aplicació mostrar una pantalla on canviar el nivell dels logs, monitoritzar el diferents fitxers de logs i descarregar-los.\r\n\r\nLa informació detallada sobre els diferents components del Framework Canigó, la seva arquitectura i components, es pot trobar a l'apartat de <a href=\"/canigo-documentacio\">documentació del portal web</a>.\r\n\r\n","objectID":"L2Nhbmlnby9mcmFtZXdvcms="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXBsYW5pZmljYWRvcg==":{"date":1427971783000,"title":"Planificador de tasques","description":"Planificador de tasques","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-altres/modul-planificador","content":"## Propòsit\r\n\r\nEl propòsit d'aquest apartat es introduir al desenvolupador a la planificació de tasques mitjançant Quartz.\r\n\r\nQuartz permet l'execució de tasques de forma diferida:\r\n\r\n* en qualsevol moment del dia (precisió de milisegons)\r\n* en alguns dies de la setmana\r\n* en alguns dies del mes\r\n* en alguns dies de l'any\r\n* un número específic de repeticions\r\n* repetidament fins a una data/instant determinat\r\n* repetida e indefinidament\r\n* repetidament en un determinat interval de temps\r\n\r\nDocuments i Fonts de Referència\r\n\r\nReferència                       | URL\r\n-------------------------------- | ----\r\nQuartz                           | http://www.quartz-scheduler.org/\r\nSpring 4 + Quartz                | http://static.springsource.org/spring/docs/4.1.0.RELEASE/spring-framework-reference/html/scheduling.html#scheduling-quartz\r\nGuia migració Quartz 1.8.x a 2.0 | http://www.quartz-scheduler.org/documentation/quartz-2.x/migration-guide\r\n\r\n## Glossari\r\n\r\n**Job**\r\n\r\nUn Job o tasca és simplement la referència a la classe que conté el mètode que volem executar de forma diferida.\r\n\r\n**Trigger**\r\n\r\nUn objecte de tipus Trigger s'utilitza per llençar l'execució dels Jobs o tasques. Quan es vol programar una tasca, s'intancia un Trigger i configures les seves propietats per tal de proporcionar la programació d'execució (interval d'execució, número de repeticions, timeout, etc..).\r\n\r\n**SchedulerFactory**\r\n\r\nObjecte que s'encarrega d'instanciar el programador o scheduler que s'encarregarà de gestionar l'execució de les tasques.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar Quartz es necessari afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<org.opensymphony.quartz.version>2.2.1</org.opensymphony.quartz.version>\r\n<commons.collections.version>4.0</commons.collections.version>\r\n<org.springframework.versionn>4.1.0.RELEASE</org.springframework.version>\r\n\r\n<dependency>\r\n    <groupId>org.quartz-scheduler</groupId>\r\n    <artifactId>quartz</artifactId>\r\n    <version>${org.opensymphony.quartz.version}</version>\r\n</dependency>\r\n<dependency>\r\n    <groupId>org.springframework</groupId>\r\n    <artifactId>spring-context-support</artifactId>\r\n    <version>${org.springframework.version}</version>\r\n</dependency><!-- Només per clustering Oracle -->\r\n<dependency>\r\n    <groupId>org.quartz-scheduler</groupId>\r\n    <artifactId>quartz-oracle</artifactId>\r\n    <version>${org.opensymphony.quartz.version}</version>\r\n</dependency>\r\n<!-- Només per a Weblogic -->\r\n<dependency>\r\n    <groupId>org.quartz-scheduler</groupId>\r\n    <artifactId>quartz-weblogic</artifactId>\r\n    <version>${org.opensymphony.quartz.version}</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>org.apache.commons</groupId>\r\n\t<artifactId>commons-collections4</artifactId>\r\n\t<version>${commons.collections.version}</version>\r\n</dependency>\r\n<dependency>\r\n      <groupId>org.springframework</groupId>\r\n      <artifactId>spring-tx</artifactId>\r\n      <version>${org.springframework.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del servei de planificació de tasques es pot dividir en dos punts:\r\n\r\n* Definició dels xmls (o anotacions) de Spring que s'encarregen de la inicialització dels beans de Quartz.\r\n* Externalització de les propietats d'aquest beans.\r\n    \t\r\n<div class=\"message information\">\r\nIMPORTANT: <br>\r\nPer a entorns clusteritzats revisar l'apartat de Preguntes freqüents.\r\n</div>\r\n\r\n#### Definició dels xmls de Spring\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/quartz-config.xml\r\n\r\nLa configuració del planificador de tasques Quartz implica 3 pasos:\r\n\r\n* Definir les tasques que volem executar de forma diferida\r\n* Definir els triggers que defineixen en quin moment s'executaran les tasques\r\n* Definir la factoria per executar les tasques amb els triggers\r\n\r\n#### Configuració dels arxius de propietats\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/planificador.properties\r\n\r\nDins d'aquest arxiu romandrien les propietats dels Jobs, Triggers, Scheduler, etc.\r\n\r\nExemple d'arxiu de propietats:\r\n\r\n```\r\n*.quartz.repeatInterval=2000\r\n*.quartz.autoStartup=false\r\n*.quartz.concurrent=true\r\n```\r\n\r\n## Utilització del Mòdul\r\n\r\n\r\nEn aquest exemple es configura una tasca que es repeteix cada dos segons amb el work manager per defecte de Quartz.\r\n\r\n**quartz-config.xml**\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\r\n\t<bean id=\"salutacio\" class=\"springapp.web.vo.Salutacio\"/>\r\n\r\n        <bean id=\"unaTasca\"\r\n             class=\"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean\">\r\n\t\t<property name=\"targetObject\" \tref=\"salutacio\" />\r\n\t\t<property name=\"targetMethod\" \tvalue=\"saludar\" />\r\n\t\t<property name=\"concurrent\" \tvalue=\"${quartz.concurrent}\" />\r\n\t</bean>\r\n\r\n\t<bean id=\"simpleTrigger\" class=\"org.springframework.scheduling.quartz.SimpleTriggerBean\">\r\n\t\t<property name=\"jobDetail\" ref=\"unaTasca\" />\r\n\t\t<property name=\"repeatInterval\" value=\"${quartz.repeatInterval}\" />\r\n\t</bean>\r\n\r\n\t<bean id=\"schedulerFactoryBean\"\r\n             class=\"org.springframework.scheduling.quartz.SchedulerFactoryBean\">\r\n\t\t<property name=\"autoStartup\" value=\"${quartz.autoStartup}\" />\r\n\t\t<property name=\"triggers\">\r\n\t\t\t<list>\r\n\t\t\t\t<ref bean=\"simpleTrigger\" />\r\n\t\t\t</list>\r\n\t\t</property>\r\n\t</bean>\r\n\r\n</beans>\r\n```\r\n\r\n<div class=\"message warning\">\r\nWorkmanager per defecte\r\n\r\nPer defecte de Quartz gestiona l'execució de les tasques amb el seu pròpi workmanager. Aquest motor per defecte s'encarrega de gestionar els diferents \"threads\" o fils d'execució de les tasques planificades de manera autònoma sense que el servidor d'aplicacions tingui constància d'aquests \"threads\" oberts.\r\nEn entorns productius s'ha pogut observar com en algunes situacions el motor no allibera correctament aquests \"threads\" de la VM, lo que pot provocar la degradació del sistema o en el pitjor dels casos, la seva indisponibilitat.\r\n\r\nPer evitar aquest tipus de situacions es recomenable que llegiu l'apartat de Recomanacions.\r\n</div>\r\n\r\n## Recomanacions\r\n\r\nCom a alternativa al workmanager per defecte de \"Quartz\", i amb la idea de que sigui el servidor d'aplicacions qui gestioni els threads de Quartz, a continuació es descriu un exemple de configuració per a utilitzar la implementació de \"Commonj\".\r\n\r\n### Configuració per a servidors d'aplicacions Weblogic\r\n\r\nPer canviar el WorkManager per defecte per el de \"Commonj\" a servidors d'aplicacions Weblogic, es necessari realitzar les següents accions:\r\n\r\n* Modificar el taskexecutor del SchedulerFactoryBean.\r\n* Modificar web.xml per afegir una referència local al \"WorkManager\".\r\n* Modificar weblogic.xml per crear un \"WorkManager\".\r\n\r\n### Modificar el taskexecutor del SchedulerFactoryBean\r\n\r\nPer sobrescriure el \"taskexecutor\" per defecte de \"Quartz\", s'ha de modificar el SchedulerFactoryBean per instanciar el nou \"TaskExecutor\", aquest informarà les següents propietats:\r\n\r\n* workManagerName: Nom JNDI del WorkManager JCA.\r\n* resourceRef: Indica si la cerca del nom JNDI es realitza en un contenidor J2EE.\r\n\r\n```\r\n<!-- Planificador amb l'engine de commonj -->\r\n<bean id=\"schedulerFactoryBeanCommonj\"\r\n      class=\"org.springframework.scheduling.quartz.SchedulerFactoryBean\">\r\n    <property name=\"autoStartup\" value=\"false\" />\r\n    <property name=\"triggers\">\r\n        <list>\r\n            <ref bean=\"simpleTrigger\" />\r\n        </list>\r\n    </property>\r\n    <property name=\"taskExecutor\" ref=\"taskExecutor\"/>\r\n</bean>\r\n<bean id=\"taskExecutor\"\r\n      class=\"org.springframework.scheduling.commonj.WorkManagerTaskExecutor\">\r\n    <property name=\"workManagerName\" value=\"appWorkManager\" />\r\n    <property name=\"resourceRef\" value=\"true\" />\r\n</bean>\r\n```\r\n\r\n### Modificar web.xml per afegir una referència local al \"WorkManager\"\r\n\r\nModificar l'arxiu \"web.xml\" per afegir una referència local al \"WorkManager\" que posteriorment es definirà al \"weblogic.xml\":\r\n\r\n```\r\n...\r\n<resource-ref>\r\n\t<res-ref-name>appWorkManager</res-ref-name>\r\n\t<res-type>commonj.work.WorkManager</res-type>\r\n\t<res-auth>Container</res-auth>\r\n\t<res-sharing-scope>Shareable</res-sharing-scope>\r\n</resource-ref>\r\n...\r\n```\r\n\r\n### Modificar weblogic.xml per crear un \"WorkManager\"\r\n\r\nFinalment cal registrar un \"WorkManager\" aplicatiu al servidor d'aplicacions mitjançant l'arxiu \"weblogic.xml\". En l'exemple es registra un \"WorkManager\" que com a màxim pot executar 3 \"threads\" concurrents.\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<weblogic-web-app xmlns=\"http://www.bea.com/ns/weblogic/90\"\r\n\txmlns:j2ee=\"http://java.sun.com/xml/ns/j2ee\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://www.bea.com/ns/weblogic/90\r\n                           http://www.bea.com/ns/weblogic/90/weblogic-web-app.xsd\">\r\n\r\n\t<work-manager>\r\n\t\t<name>appWorkManager</name>\r\n\t\t<max-threads-constraint>\r\n\t\t\t<name>appWorkManager</name>\r\n\t\t\t<count>3</count>\r\n\t\t</max-threads-constraint>\r\n\t</work-manager>\r\n</weblogic-web-app>\r\n```\r\n\r\n### Configuració per a servidors d'aplicacions Tomcat\r\n\r\nPer canviar el WorkManager per defecte per el de \"Commonj\" per a servidors d'aplicacions Tomcat es necessari realitzar les següents accions:\r\n\r\n* Afegir les llibreries de Commonj.\r\n* Modificar el taskexecutor del SchedulerFactoryBean.\r\n* Modificar web.xml per afegir una referència local al \"WorkManager\".\r\n* Crear el \"WorkManager\" al context.xml de Tomcat.\r\n\r\n### Afegir les llibreries de Commonj\r\n\r\nCal verificar que les llibreries de Commonj estiguin incloses dins la carpeta de llibreries compartides de Tomcat o bé dins l'aplicació que les farà servir:\r\n\r\n* Si es volen afegir directament com a llibreries compartides de Tomcat, cal afegir a $TOMCAT_HOME/lib les llibreries commonj-twm.jar i foo-commonj-1.1.0.jar . Aquestes es poden trobar dins la carpeta \\foo-commonj-1.1.0\\lib del zip que es pot descarregar de la web oficial\r\n* Si es volen afegir al projecte Canigó3, cal afegir les següents dependències Maven al pom.xml:\r\n\r\n```\r\n<dependency>\r\n    <groupId>com.bea.wlplatform</groupId>\r\n    <artifactId>commonj-twm</artifactId>\r\n    <version>1.1</version>\r\n</dependency>\r\n<dependency>\r\n    <groupId>com.bea.wlplatform</groupId>\r\n    <artifactId>foo-commonj</artifactId>\r\n    <version>1.1.0</version>\r\n</dependency>\r\n```\r\n\r\n### Modificar el taskexecutor del SchedulerFactoryBean\r\n\r\nPer sobrescriure el \"taskexecutor\" per defecte de \"Quartz\", s'ha de modificar el SchedulerFactoryBean per instanciar el nou \"TaskExecutor\", aquest informarà les següents propietats:\r\n\r\n* workManagerName: Nom JNDI del WorkManager JCA.\r\n* resourceRef: Indica si la cerca del nom JNDI es realitza en un contenidor J2EE.\r\n\r\n```\r\n<!-- Planificador amb l'engine de commonj -->\r\n<bean id=\"schedulerFactoryBeanCommonj\"\r\n      class=\"org.springframework.scheduling.quartz.SchedulerFactoryBean\">\r\n    <property name=\"autoStartup\" value=\"false\" />\r\n    <property name=\"triggers\">\r\n        <list>\r\n            <ref bean=\"simpleTrigger\" />\r\n        </list>\r\n    </property>\r\n    <property name=\"taskExecutor\" ref=\"taskExecutor\"/>\r\n</bean>\r\n<bean id=\"taskExecutor\"\r\n      class=\"org.springframework.scheduling.commonj.WorkManagerTaskExecutor\">\r\n    <property name=\"workManagerName\" value=\"wm/appWorkManager\" />\r\n    <property name=\"resourceRef\" value=\"true\" />\r\n</bean>\r\n```\r\n\r\n### Modificar web.xml per afegir una referència local al \"WorkManager\"\r\n\r\nModificar l'arxiu \"web.xml\" per afegir una referència local al \"WorkManager\" que posteriorment es definirà al \"weblogic.xml\":\r\n\r\n```\r\n...\r\n<resource-ref>\r\n\t<res-ref-name>wm/appWorkManager</res-ref-name>\r\n\t<res-type>commonj.work.WorkManager</res-type>\r\n\t<res-auth>Container</res-auth>\r\n\t<res-sharing-scope>Shareable</res-sharing-scope>\r\n</resource-ref>\r\n...\r\n```\r\n\r\n### Crear el \"WorkManager\" al context.xml de Tomcat\r\n\r\nFinalment cal registrar un \"WorkManager\" aplicatiu al servidor d'aplicacions. En aquest cas caldría afegir-ho al fitxer $TOMCAT_HOME/conf/context.xml. En l'exemple es registra un \"WorkManager\" que com a màxim pot executar 3 \"threads\" concurrents.\r\n\r\n```\r\n...\r\n<Resource name=\"wm/appWorkManager\"\r\n\tauth=\"Container\"\r\n\tfactory=\"de.myfoo.commonj.work.FooWorkManagerFactory\" \r\n\ttype=\"commonj.work.WorkManager\"\r\n\tmaxThreads=\"3\"/>\r\n...\r\n```\r\n\r\nAlguns dels paràmetres de configuració i tunning del \"WorkManager\" es poden trobar a la següent adreça:\r\nhttp://download.oracle.com/docs/cd/E11035_01/wls100/config_wls/self_tuned.html\r\n\r\n## Preguntes freqüents\r\n\r\n### Utilització de Quartz en un cluster\r\n\r\nLa principal problemàtica del planificador de tasques en un cluster és l'execució del planificador en cadascuna de les màquines de forma independent. Si l'aplicació es troba en un cluster i no es gestiona aquesta problemàtica, la tasca s'executarà tants cops com nodes al cluster tinguessim.\r\n\r\nPer solventar aquest problema, Quartz proporciona una solució basada en una base de dades centralitzada que funciona com a semàfor d'execució dels diferents Jobs.\r\n\r\n### Configuració\r\n\r\nLa configuració consta de dos passos:\r\n\r\n1. Crear les taules a partir dels scripts proporcionats per Quartz. Els pots trobar al directori: quartz\\docs\\dbTables directory.\r\n2. Crear el arxiu de propietats quartz.properties a l'arrel de l'aplicació. src/main/resources/quartz.properties\r\n\r\n```\r\n#============================================================================\r\n# Configure Main Scheduler Properties\r\n#============================================================================\r\norg.quartz.scheduler.instanceName = MyClusteredScheduler\r\norg.quartz.scheduler.instanceId = AUTO\r\n#============================================================================\r\n# Configure ThreadPool\r\n#============================================================================\r\norg.quartz.threadPool.class = org.quartz.simpl.SimpleThreadPool\r\norg.quartz.threadPool.threadCount = 25\r\norg.quartz.threadPool.threadPriority = 5\r\n#============================================================================\r\n# Configure JobStore\r\n#============================================================================\r\norg.quartz.jobStore.misfireThreshold = 60000\r\norg.quartz.jobStore.class = org.quartz.impl.jdbcjobstore.JobStoreTX\r\norg.quartz.jobStore.driverDelegateClass = org.quartz.impl.jdbcjobstore.oracle.OracleDelegate\r\norg.quartz.jobStore.useProperties = false\r\norg.quartz.jobStore.dataSource = myDS\r\norg.quartz.jobStore.tablePrefix = QRTZ_\r\n\r\norg.quartz.jobStore.isClustered = true\r\norg.quartz.jobStore.clusterCheckinInterval = 20000\r\n#============================================================================\r\n# Configure Datasources\r\n#============================================================================\r\n#org.quartz.dataSource.myDS.driver = oracle.jdbc.driver.OracleDriver\r\n#org.quartz.dataSource.myDS.URL = jdbc:oracle:thin:@localhost:1521:orcl\r\n#org.quartz.dataSource.myDS.user = scott\r\n#org.quartz.dataSource.myDS.password = tiger\r\n#org.quartz.dataSource.myDS.maxConnections = 5\r\n#org.quartz.dataSource.myDS.validationQuery=select 0 from dual\r\n#============================================================================\r\n# Configure Datasources JNDI\r\n#============================================================================\r\norg.quartz.dataSource.myDS.jndiURL=jdbc/myDataSource\r\norg.quartz.dataSource.myDS.java.naming.factory.initial=com.evermind.server.rmi.RMIInitialContextFactory\r\norg.quartz.dataSource.myDS.java.naming.provider.url=ormi://localhost\r\norg.quartz.dataSource.myDS.java.naming.security.principal=admin\r\norg.quartz.dataSource.myDS.java.naming.security.credentials=123\r\n```\r\n\r\nMés informació a:\r\n\r\nhttp://www.quartz-scheduler.org/documentation/quartz-2.x/configuration/ConfigJDBCJobStoreClustering\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXBsYW5pZmljYWRvcg=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXByb3Zlcw==":{"date":1427978212000,"title":"Proves","description":"Proves unitàries","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-altres/modul-proves","content":"## Propòsit\r\n\r\nLes proves son una part fonamental en el desenvolupament d'aplicacions, en aquest apartat es focalitza en com realitzar proves unitàries dels diferents mòduls de l'aplicació mitjançant Spring Test.\r\n\r\nA l'utilitzar injecció de dependència, això fa que el codi sigui menys dependent del que ho seria en un desenvolupament java tradicional i per tant realitzar proves unitàries de diferents parts de mòduls sense tenir el conjunt complert hauria de ser més senzill.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nReferència | URL\r\n---------- | ---\r\nSpring Test | http://docs.spring.io/spring/docs/4.1.x/spring-framework-reference/html/testing.html\r\n\r\n## Glossari\r\n\r\n**@RunWith** - Anotació a nivell de classe per indicar amb que s'executarà la classe de test.\r\n**@ContextConfiguration** - Anotació a nivell de classe per a carregar el context d'Spring.\r\n**@Before** - Anotació a nivell de mètode per indicar quin és el mètode d'inicialització de la classe de test.\r\n**@Test** - Anotació a nivell de mètode per indicar que el mètode és de test.\r\n**@Autowired** - Anotació a nivell de propietat o mètode per a indicar que la propietat de la classe es carregui automàticament amb el bean del context d'spring.\r\n**@Qualifier** - Anotació a nivell de propietat o mètode que s'utilitza quan s'ha indicat un @Autowired i al context d'spring existeixen més d'un bean del mateix tipus del que s'ha de realitzar l'autowired, aleshores d'indica el @Qualifier per indicar a Spring el nom del bean que ha de setejar.\r\n\r\n## Instal.lació\r\n\r\nUtilitzant Canigó3 on cal realitzar cap pas addicional per a tenir instal- lat el mòdul de testing d'Spring. Ja que el framework ja incorpora la dependència.\r\n\r\n**Dependència pom.xml**\r\n\r\nPer defecte canigó3 incorpora la dependència d'Spring Test en scope test, aquesta dependència la incorpora canigo-core de la següent manera:\r\n\r\n```\r\n<dependency>\r\n\t<groupId>org.springframework</groupId>\r\n\t<artifactId>spring-test</artifactId>\r\n\t<version>${org.springframework.version}</version>\r\n\t<scope>test</scope>\r\n</dependency>\r\n```\r\n\r\n## Utilització\r\n\r\n### Definició classe de test\r\n\r\nPer a crear una classe de test simplement s'ha de crear una classe de Java tradicional i afegir la següent anotació @RunWith (org.junit.runner.RunWith) per a que spring detecti que és una classe de test.\r\n\r\n```\r\nimport org.springframework.test.context.junit4.SpringJUnit4ClassRunner;\r\n\r\n...\r\n\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n```\r\n\r\n### Càrrega del context de l'aplicació\r\n\r\nPer a carregar el context de l'aplicació s'utilitzarà l'anotació @ContextConfiguration (org.springframework.test.context.ContextConfiguration) a nivell de classe.\r\n\r\nEs pot carregar el context de canigo-core que carregarà tot el framework:\r\n\r\n```\r\n@ContextConfiguration(locations = {\"../../../core/config/canigo-core.xml\"})\r\n```\r\n\r\n\r\nal carregar el context de canigó serà necessari indicar els fitxers xml app-custom-***.xml dintre del directori spring i els fitxers de propietats d'aquest fitxer xml dintre del directori config, tal i com es te a l'aplicació.\r\n\r\no be només carregar els beans que es troben en certs fitxers xml:\r\n\r\n```\r\n@ContextConfiguration(locations = {\"config/canigo-support-mailing.xml\", \"config/app-support-mailing.xml\"})\r\n```\r\n\r\n### Mètodes de setUp\r\n\r\nPer indicar el mètode de setUp del test cal fer-ho mitjançant l'anotació @Before (org.junit.Before) a nivell de mètode.\r\n\r\nEn aquest mètode es realitzaran les inicialitzacions necessàries per a poder executar els mètodes de test de la classe.\r\n\r\n```java\r\n@Autowired\r\n@Qualifier(\"accountDAO\")\r\nAccountDAO<Account, Integer> dao = null;\r\n\r\n...\r\n\r\n@Before\r\npublic void settingUp(){\r\n\tAssert.assertNotNull(dao);\r\n\tAssert.assertEquals(Account.class, dao.getPersistentClass());\r\n}\r\n```\r\n\r\n### Mètodes de test\r\n\r\nPer indicar que un mètode és de test cal fer-ho mitjançant l'anotació @Test (org.junit.Test) a nivell de mètode.\r\n\r\n```java\r\n@Test\r\npublic void testFinder(){\t\t\r\n\tAssert.assertNull(dao.get(1));\r\n\tAccount account = new Account();\r\n\taccount.setName(\"test1\");\r\n\tdao.save(account);\r\n\t\r\n\tAssert.assertNotNull(dao.get(account.getId()));\r\n\t\r\n\tAccount account2 = new Account();\r\n\taccount2.setName(\"test2\");\r\n\tdao.save(account2);\r\n\t\r\n\tList<Account> accounts = dao.findAll();\r\n\tAssert.assertEquals(5, accounts.size());\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXByb3Zlcw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1jb25maWd1cmFjaW8=":{"date":1425571902000,"title":"Mòdul de configuració","description":"Configuracio de les propietats dels components de l'aplicació.","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-core/modul-configuracio","content":"## Propòsit\r\n\r\nEl mòdul de configuració té com a propòsit la configuració de les\r\npropietats de qualsevol component de l'aplicació. Aquestes propietats\r\npoden ser tant referències a altres objectes com propietats internes\r\n(atributs) que necessiten per al seu correcte funcionament.\r\n\r\nUna de les principals avantatges del mòdul respecte la classe\r\n[PropertyPlaceholderConfigurer](http://static.springsource.org/spring/docs/3.0.3.RELEASE/javadoc-api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html \"Documentacio de Spring\")\r\naportada per Spring, és la possibilitat de disposar de propietats\r\ndependents d'entorn sense necessitat de cap configuració extra a nivell\r\nde beans - propietats.\r\n\r\n## Instal.lació i configuració\r\n\r\n### Instal.lació\r\n\r\nEl mòdul de configuració s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació (Struts o JSF), l'eina de\r\nsuport al desenvolupament inclourà la referència dins del pom.xml. En\r\ncas d'una instal- lació manual afegir les següents línies al pom.xml de\r\nl'aplicació:\r\n\r\n```xml\r\n<canigo.core.version>[3.1.0,3.2.0)</canigo.core.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.core</artifactId>\r\n          <version>${canigo.core.version}</version>\r\n</dependency>\r\n```\r\n\r\n\\\r\n\r\n### Configuració\r\n\r\nNo requereix configuració per part del desenvolupador. Els xmls de\r\nconfiguració del servei es troben internalitzats dins del jar del core,\r\ni s'inicialitzarà de manera automàtica un cop arrenqui l'aplicació.\r\n\r\nEls arxius de configuració de propietats de l'aplicació han d'estar en\r\nla següent ubicació:\r\n\r\n    <PROJECT_ROOT>/src/main/resources/config/props/*.properties\r\n\r\n<div class=\"message warning\">\r\nTots els arxius d'aquest directori han de complir el format de multi-entorn. Totes les propietats que no disposin d'aquest format seran ignorades.\r\n</div>  \r\n\r\n\r\n#### Configuració segons l'entorn\r\n\r\nA partir de la versió 3.0 de Canigó i per tal de reduir el número\r\nd'arxius de configuració per entorn, s'introdueixen els arxius de\r\npropietats multientorn. Cadascuna de les claus d'aquests arxius de\r\nconfiguració disposa de dues parts:\r\n\r\n-   **Entorn:** identifica l'entorn en el que aquesta propietat serà\r\n    vàlida. El entorn amb asterisc indica valor per defecte. En el cas\r\n    de que existeixi una propietat específica per a l'entorn, aquesta es\r\n    seleccionarà per defecte.\r\n-   **Clau:** propietat de identifica un determinat valor de\r\n    configuració.\r\n\r\nUn exemple d'un arxiu de propietats de configuració *exemple.properties*\r\npodria ser el següent:\r\n\r\n```java\r\n# Arxiu de configuració per al mòdul d'antivirus\r\n*.antivirus.serverIp=127.0.0.1\r\npro.antivirus.serverIp=11.11.11.02\r\nint.antivirus.serverIp=21.21.11.02\r\n*.antivirus.serverPort=1344\r\nint.antivirus.serverPort=1567\r\n```\r\n\r\n\r\n\r\nAixí, en l'exemple anterior tindríem la següent configuració per entorn:\r\n\r\nClau|Entorn|Valor|Comentari\r\n----|------|-----|---------\r\nantivirus.serverIp|loc|127.0.0.1|Configuració per defecte. No hi ha propietat específica per al entorn local.\r\nantivirus.serverIp|dev|127.0.0.1|Configuració per defecte. No hi ha propietat específica per al entorn de desenvolupament.\r\nantivirus.serverIp|int|21.21.11.02|Configuració específica per a l'entorn d'integració.\r\nantivirus.serverIp|pre|127.0.0.1|Configuració per defecte. No hi ha propietat específica per al entorn de preproducció\r\nantivirus.serverIp|pro|11.11.11.02|Configuració específica per a l'entorn de producció.\r\nantivirus.serverPort|loc|1344|Configuració per defecte. No hi ha propietat específica per al entorn local.\r\nantivirus.serverPort|dev|1344|Configuració per defecte. No hi ha propietat específica per al entorn de desenvolupament.\r\nantivirus.serverPort|int|1567|Configuració específica per a l'entorn d'integració.\r\nantivirus.serverPort|pre|1344|Configuració per defecte. No hi ha propietat específica per al entorn de preproducció.\r\nantivirus.serverPort|pro|1344|Configuració per defecte. No hi ha propietat específica per al entorn de producció.\r\n\r\n##### Definició de l'entorn\r\n\r\nEl concepte d'Entorn es defineix mitjançant la propietat entorn, a la\r\nque s'assigna el valor corresponent a l'arrancar la màquina virtual\r\nJava\r\n\r\n```java\r\njava ... -Dentorn=pro\r\n```\r\n\r\n\r\n\r\nAmb aquesta configuració en funció de l'entorn, el servei de\r\nconfiguració de Canigó cerca la configuració adient en els diferents\r\narxius de configuració de la carpeta\r\n<PROJECT_ROOT>/src/main/resources/config/props/\r\n\r\n## Utilització del mòdul\r\n\r\nDegut a la pròpia naturalesa del mòdul, l'obtenció de les propietats des\r\nde classes \"clients\" no requereix cap injecció de dependències o\r\nconfiguració addiccional. La resolució de les propietats per entorn es\r\nrealitzarà de manera automàtica i transparent per al desenvolupador.\r\n\r\n-   Exemple d'inserció de propietats en configuració de Beans de Spring\r\n    basada en XML:\r\n\r\n    ```java\r\n    <bean id=\"antivirus\"  class=\"cat.gencat.ctti.canigo.arch.integration.antivirus.impl.AntivirusImpl\">\r\n        <property name=\"remote\" value=\"${antivirus.remote:false}\" />\r\n            <property name=\"serverIP\" value=\"${antivirus.serverIp}\" />\r\n        <property name=\"serverPort\" value=\"${antivirus.serverPort}\" />\r\n    </bean>\r\n    ```\r\n\r\n    \r\n\r\n-   Exemple d'inserció de propietats en configuració de Beans de Spring bassat en anotacions:\r\n\r\n    ```java\r\n    @Repository\r\n    public class AntivirusImpl implements Antivirus{\r\n        @Value(\"${antivirus.serverIp}\")\r\n        private String serverIP;\r\n    }\r\n    ```\r\n\r\n## Configuració a servidors JEE corporatius\r\n\r\n### Concepte de configuració amb propietats globals\r\n\r\nA partir de la versió 3.0.3 del mòdul canigo.core s'inclou la\r\npossibilitat de poder fer servir propietats definides fora de\r\nl'aplicació. Aquestes propietats es configuren a nivell del servidor JEE\r\nmitjançant un fitxer de propietats la ruta del qual és especificada\r\ndurant l'arrencada de la JVM. Les propietats d'aquest fitxer afecten a\r\ntotes les aplicacions desplegades al servidor que incorporin aquesta\r\nversió (o posterior) del mòdul canigo.core. També es dona flexibilitat\r\nper poder definir excepcions per a certes aplicacions mitjançant un\r\nfitxer de propietats específic. \r\n Per aconseguir aquest funcionament cal que el proveïdor de l'aplicació\r\ni l'administrador del servidor JEE al CPD facin una sèrie de\r\nconfiguracions: \r\n \r\n\r\n#### Proveïdor de l'aplicació Canigó\r\n\r\nCal definir a l'aplicació la següent propietat al fitxer:\r\n**src/main/resources/config/props/application.properties**\r\n\r\nPropietat|Requerit|Descripció\r\n---------|--------|----------\r\ncodi_aplicacio|NO|Típicament serà el codi de diàleg de l'aplicació. Cal informar-ho nomes si es vol emprar un fitxer de propietats específiques per a l'aplicació en comptes del global de servidor.\r\n\r\n#### Administrador del servidor JEE al CPD\r\n\r\n<div class=\"message warning\">\r\nDeixar clar que aquest punt és responsabilitat de CPD i que l'únic que necessita conèixer de l'aplicació per poder-ne fer una configuració específica és el <b>codi_aplicacio</b>.\r\n</div>\r\n\r\n\r\n##### Indicar path de la carpeta del fitxer de propietats globals\r\n\r\nAl arrencar la màquina virtual de Java cal indicar la següent propietat:\r\n\r\n```java\r\njava ... -Dconf_dir=[ pathToConfDir ]\r\n```\r\n\r\nOn [ pathToConfDir ] és el path de la carpeta al servidor on hi figura\r\nl'arxiu de propietats global server.properties.\r\n \r\n\r\n##### Informar el fitxer de propietats globals\r\n\r\nAl servidor cal crear el següent fitxer de propietats: **[ pathToConfDir\r\n]/server.properties**\r\n I definir les següents propietats:\r\n\r\nPropietat|Requerit|Descripció\r\n---------|--------|----------\r\nentorn|SI|Nom de l'entorn\r\ncodi_servei|NO|Cal informar-ho només si es vol habilitar l'ús de fitxers de propietats específics per a aplicacions al servidor.\r\n\r\n    \r\nA aquest fitxer caldria afegir-hi la resta de propietats globals que es\r\nvulguin definir per a totes les aplicacions que es despleguin en aquest\r\nservidor. \r\n\r\n\r\n##### Informar el fitxer de propietats específic d'aplicació\r\n\r\nEn cas de voler habilitar fitxers de propietats específics per a una\r\naplicació, caldria crear la següent estructura de carpetes i fitxers: \r\n **[ pathToConfDir ]/[ entorn ]/[ codi_servei ]/[ codi_aplicacio\r\n]/app.properties** \r\n \r\n\r\n#### Exemples d'ús de propietats globals a servidor\r\n\r\n##### Exemple 1: Ús de propietats globals definides al servidor\r\n\r\nEs vol que totes les aplicacions desplegades al servidor facin servir la\r\nmateixa configuració per al servei d'enviament de correus, tret del\r\nusername i password del compte d'enviament que les definiran les pròpies\r\naplicacions. Per a aquest propòsit:\r\n\r\n-   Els proveïdors de les aplicacions que despleguin en aquest servidor\r\n    hauran d'indicar les propietats referents al username/password al\r\n    fitxer de propietats de configuració de correu de l'aplicació:\r\n    **/src/main/resources/config/props/mail.properties**.\r\n\r\n    ```java\r\n    *.mail.username=demo@gencat.cat\r\n    *.mail.password=*****\r\n    ```\r\n\r\n-   Els administradors del servidor hauran de :\r\n    -   Indicar el path de la carpeta del fitxer de propietats globals\r\n        durant l'arrencada de la JVM:\r\n\r\n        ```java\r\n        java ... -Dconf_dir=/serveis/conf\r\n        ```\r\n\r\n    -   Crear el fitxer de propietats globals i informar les seves\r\n        propietats: **/serveis/conf/server.properties**\r\n\r\n        ```java\r\n        entorn=loc\r\n        #Propietats globals d'enviament de correu per a totes les aplicacions desplegades\r\n        *.mail.host=smtp-intranet.gencat.intranet\r\n        *.mail.port=25\r\n        *.mail.protocol=smtp\r\n        *.mail.maxAttachmentSize=1024\r\n        ```\r\n\r\n        \r\n\r\n##### Exemple 2: Ús de propietats específiques d'aplicació definides al servidor\r\n\r\nEs vol definir el nom dels dataSources de les conexions per JNDI de les\r\naplicacions mitjançant els fitxers de propietats específics d'aplicació\r\ndins servidor. Per a aquest propòsit:\r\n\r\n-   Els proveïdors de l'aplicació hauran d'informar la propietat\r\n    **codi_aplicacio** al fitxer de propietats de la seva aplicació:\r\n    **src/main/resources/config/props/application.properties**\r\n\r\n    ```java\r\n    codi_aplicacio=001\r\n    ```\r\n\r\n-   Els administradors del servidor hauran de :\r\n    -   Indicar el path de la carpeta del fitxer de propietats globals\r\n        durant l'arrencada de la JVM:\r\n\r\n        ```java\r\n        java ... -Dconf_dir=/serveis/conf\r\n        ```\r\n\r\n    -   Crear el fitxer de propietats globals i informar les seves\r\n        propietats: **/serveis/conf/server.properties**\r\n\r\n        ```java\r\n        entorn=pre\r\n        codi_servei=demo\r\n        ```\r\n\r\n        \r\n\r\n    -   Crear l'estructura de carpetes i el fitxer de propietats\r\n        específic per a l'aplicació al servidor (+ creació estructura\r\n        directoris): **/serveis/conf/pre/demo/001/app.properties**\r\n\r\n        ```java\r\n        #Configuració de l'orígen de dades per JNDI per a l'aplicació 001\r\n        *.jndi.name=java:comp/env/dataSource001\r\n        ```\r\n\r\n        Prèviament cal que l'administrador del servidor hagi consultat\r\n        aquest **codi_aplicacio** al proveïdor de l'aplicació. \r\n         \r\n\r\nPreguntes freqüents\r\n-------------------\r\n\r\n### Accés manual al servei de configuració\r\n\r\nEncara que no és recomanable accedir a les propietats del mòdul de\r\nmanera directa, el desenvolupador pot realitzar una crida de forma\r\nexterna mitjançant el patró ['Dependency\r\nInjection'](http://martinfowler.com/articles/injection.html \"Dependency Injection\")\r\nal mòdul i les seves propietats d'entorn.\r\n\r\n-   Injecció de dependències mitjançant xml. Per exemple:\r\n     Ruta proposada:\r\n    <PROJECT_ROOT>/src/main/resources/spring/exemple-beans-config.xml\r\n\r\n```java\r\n<bean id=\"myBean\"  class=\"cat.gencat.app.exemples.Injection\">\r\n    <property name=\"configuration\" ref=\"propertiesConfiguration\" />\r\n</bean>\r\n```\r\n\r\n\r\n\r\nLa clase Injection tindria la següent estructura:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.core.config.PropertiesConfiguration;\r\n\r\npublic class Injection {\r\n     PropertiesConfiguration configuration;\r\n\r\n     public void setConfiguration(PropertiesConfiguration  configuration){\r\n         this.configuration = configuration;\r\n     }\r\n\r\n}\r\n```\r\n\r\n\r\n\r\nInjecció del mòdul de configuració dins del bean \"myBean\". Spring\r\ns'encarregarà d'injectar la configuració del mòdul de propietats\r\nexecutant el mètode setConfiguration.\r\n\r\n-   Injecció de dependències mitjançant annotacions:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.core.config.PropertiesConfiguration;\r\n\r\n@Component(\"myBean\")\r\npublic class Injection {\r\n     @Autowired\r\n     PropertiesConfiguration configuration;\r\n\r\n     public void execute(){\r\n\r\n         String ip = configuration.getProperty(\"antivirus.serverIp\");\r\n     }\r\n\r\n}\r\n```\r\n\r\n\r\n\r\nL'anotació @Autowired injecta en aquest cas, un bean de tipus\r\ncat.gencat.ctti.canigo.arch.core.config.PropertiesConfiguration\r\nque Spring trobarà en el context de l'aplicació.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1jb25maWd1cmFjaW8="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1leGNlcGNpb25z":{"date":1426175425000,"title":"Mòdul d'excepcions","description":"Mòdul per a la gestió d'Errors","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-core/modul-excepcions","content":"## Propòsit\r\n\r\nLa gestió d'excepcions permet informar que s'ha produït un error al realitzar una petició. Aquest error podrà ser tractat adequadament i en cas necessari informar a l'usuari, llençar una traça, enviar un correu, etc.\r\n\r\nLa gestió correcta de les excepcions és molt important i crítica, però generalment la forma en la que es generen i gestionen les excepcions en les aplicacions és un dels aspectes més ignorats en el disseny de les mateixes. L'ús apropiat de les excepcions fa que els nostres aplicatius siguin més robusts, més fàcils de desenvolupar i mantenir, més lliures d'errors i més fàcils d'utilitzar. Per aquest motiu és important que donem el màxim de detall en les excepcions.\r\n\r\nPer evitar l'ús innecessari de blocs 'try-catch' dins el codi dels nostres aplicatius Canigó proporciona un mecanisme d'intercepció, pel qual indicarem quines excepcions volem tractar i quins gestors les tractaran sense haver d'incorporar cap referència a cap classe de l'aplicació.\r\n\r\n## Glossari\r\n\r\n## Instal.lació i configuració\r\n\r\n### Instal.lació\r\n\r\nEl mòdul de configuració s'inclou per defecte dins del core de Canigó 3. Durant el procés de creació de l'aplicació (Struts o JSF), l'eina de suport al desenvolupament inclourà la referència dins del pom.xml. En cas d'una instal- lació manual afegir les següents línies al pom.xml de l'aplicació:\r\n\r\n```\r\n<canigo.core.version>[3.1.0,3.2.0)</canigo.core.version>\r\n<canigo.web.jsf.version>[1.2.0,1.3.0)</canigo.web.jsf.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.core</artifactId>\r\n          <version>${canigo.core.version}</version>\r\n</dependency>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.web.jsf</artifactId>\r\n\t<version>${canigo.web.jsf.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del servei d'exepcions es configura mitjançant el fitxer de configuració web.xml:\r\n\r\nCaldrà configurar el filtre que interceptarà les peticions:\r\n\r\n```\r\n<filter>\r\n\t<filter-name>ErrorHandler Filter</filter-name>\r\n\t<filter-class>cat.gencat.ctti.canigo.arch.web.jsf.filter.ErrorHandlerFilter</filter-class>\r\n</filter>\r\n<filter-mapping>\r\n\t<filter-name>ErrorHandler Filter</filter-name>\r\n\t<url-pattern>*.jsf</url-pattern>\r\n</filter-mapping>\r\n\r\nTambé es definirà la pantalla d'error genèrica:\r\n\r\n<context-param>\r\n\t<param-name>errorPage</param-name>\r\n\t<param-value>/AppJava/views/error.jsf</param-value>\r\n</context-param>\r\n```\r\n\r\n## Utilització del mòdul\r\n\r\nEl filtre, intercepta totes les peticions a les pàgines JSF. Per defecte el filtre ErrorHandlerFilter que ofereix el framework, el que fa es interceptar qualsevol petició que doni un error del tipus Exception i mostrar la pàgina d'error genèrica definida al web.xml amb la informació de la excepció.\r\n\r\nEl framework defineix una interfície IBaseException, la qual han d'implementar totes les excepcions que es creï la pròpia aplicació. Aquesta interfície simplement defineix que aquesta hagi de tenir un detall de l'error amb informació de l'excepció base, codis d'error i altres propietats.\r\n\r\nEl core de Canigó3 ja incorpora una sèrie d'excepcions definides:    \r\n<br>\r\n\r\n![Imatge de les Excepcions Definides](/related/canigo/documentacio/modul-excepcions/cat.gencat.ctti.canigo.arch.core.exceptions.jpg \"Excepcions definides al mòdul\")","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1leGNlcGNpb25z"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnN0cnVtZW50YWNpbw==":{"date":1427449467000,"title":"Instrumentació","description":"Mòdul per generar dades d’instrumentació (nombre de peticions, nombre d’errors, …) de la seva execució.","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-core/modul-instrumentacio","content":"## Propòsit\r\n\r\nAquest mòdul permet a l'aplicació generar dades d'instrumentació de la seva execució, per tal de poder ser explotades posteriorment amb eines de monitorització.\r\n\r\nDins d'aquest mòdul podem trobar les següents funcionalitats:\r\n\r\n* Instrumentació de les peticions web: nombre de peticions, nombre d'errors i temps mig per petició.\r\n* Interfície web que permet visualitzar/explotar les dades d'instrumentació en forma de gràfiques.\r\n* Eines de revisió de l'estat de l'aplicació definits pel desenvolupador.\r\n* Interfície web per visualitzar l'estat dels punts crítics de l'aplicació definits pel desenvolupador.\r\n* Instrumentació manual en format log de mètodes de classes aplicatives.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'instrumentació es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.operation.instrumentation.version>[1.1.0,1.2.0)</canigo.operation.instrumentation.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.operation.instrumentation</artifactId>\r\n    <version>${canigo.operation.instrumentation.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\n#### JSF\r\n\r\nEn el cas d'utilitzar la opció de JSF, l'eina gestionar la inserció del següent filtre al web.xml:\r\n\r\n```\r\n<filter>\r\n     <filter-name>Instrumentation Filter</filter-name>\r\n     <filter-class>cat.gencat.ctti.canigo.arch.operation.instrumentation.filter.InstrumentationFilter</filter-class>\r\n</filter>\r\n<filter-mapping>\r\n     <filter-name>Instrumentation Filter</filter-name>\r\n     <url-pattern>*.jsf</url-pattern>\r\n</filter-mapping>\r\n```\r\n\r\nL'eina de desenvolupament també genera automàticament el fitxer de propietats necessari per a la configuració del servei.  \r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/instrumentation.properties\r\n\r\n<table>\r\n    <tbody>\r\n        <tr>\r\n            <th><b>Propietat</b></th>\r\n            <th><b>Requerit</b></th>\r\n            <th><b>Descripció</b></th>\r\n        </tr>\r\n        <tr>\r\n            <td> *.instrumentation.interval </td>\r\n            <td> No </td>\r\n            <td> Interval de refresc de les dades instrumentades en l'aplicació de monitorització. Per defecte: 60000 </td>\r\n        </tr>\r\n        <tr>\r\n            <td> *.instrumentation.implementation </td>\r\n            <td> No </td>\r\n            <td> Implementació del servei per als diferents servidors d'aplicacions, amb i sense cluster <br clear=\"all\">\r\n            Opcions:\r\n            <ul>\r\n                <li>Weblogic + cluster: cat.gencat.ctti.canigo.arch.operation.monitoring.cluster.WeblogicMonitoringServiceImpl</li>\r\n                <li>Tomcat + cluster: cat.gencat.ctti.canigo.arch.operation.monitoring.cluster.TomcatMonitoringServiceImpl</li>\r\n                <li>Tomcat/Weblogic sense cluster: cat.gencat.ctti.canigo.arch.operation.monitoring.single.MonitoringImpl <br clear=\"all\">\r\n            <b>Per defecte: cat.gencat.ctti.canigo.arch.operation.monitoring.single.MonitoringImpl</b> </li>\r\n            </ul>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td> *.instrumentation.username </td>\r\n            <td> No </td>\r\n            <td> Usuari per logarse al admin server del Cluster. Per defecte: weblogic </td>\r\n        </tr>\r\n        <tr>\r\n            <td> *.instrumentation.password </td>\r\n            <td> No </td>\r\n            <td> Password per logarse al admin server del Cluster. Per defecte: weblogic </td>\r\n        </tr>\r\n        <tr>\r\n            <td> *.instrumentation.protocol </td>\r\n            <td> No </td>\r\n            <td> Protocol per la connexió al Mbean Server. Per defecte: t3 </td>\r\n        </tr>\r\n        <tr>\r\n            <td> *.instrumentation.jndiRoot </td>\r\n            <td> No </td>\r\n            <td>&nbsp;</td>\r\n        </tr>\r\n        <tr>\r\n            <td> *.instrumentation.port </td>\r\n            <td> No </td>\r\n            <td> Port del admin server. Per defecte: 7001 </td>\r\n        </tr>\r\n        <tr>\r\n            <td> *.instrumentation.hostname </td>\r\n            <td> No </td>\r\n            <td> IP del admin server. Per defecte: localhost </td>\r\n        </tr>\r\n        <tr>\r\n            <td> *.instrumentation.mbean </td>\r\n            <td> No </td>\r\n            <td> mbean de monitorització. Per defecte: cat.gencat.ctti.canigo.\"application.Id\" </td>\r\n        </tr>\r\n    </tbody>\r\n</table>\r\n\r\n### Utilització del Mòdul\r\n\r\nPer a utilitzar aquest mòdul, cal instal- lar-lo amb l'eina de desenvolupament.\r\n\r\nA continuació es descriu el mode d'ús per cadascuna de les funcionalitats oferides pel mòdul:\r\n\r\n#### Interfície web amb les gràfiques de monitorització de l'aplicació\r\n\r\nPer accedir a aquesta interfície l'usuari ha d'introduir la següent url al navegador:\r\n\r\n    http:\\\\url_aplicacio\\views\\monitoring.jsf\r\n\r\nEn aquesta pantalla es mostra el nombre de peticions, errors i temps mig per unitat de temps.\r\n\r\n<div class=\"message information\">\r\nControl d'accés\r\n\r\nPer defecte, i només si el desenvolupador ha instal- lat el mòdul de seguretat de l'aplicació, aquesta pantalla només serà accessible per a usuaris logats amb rol administrador.\r\n</div>\r\n\r\n\r\n#### Eines de revisió de l'estat de l'aplicació\r\n\r\nMitjançant anotacions Java, el desenvolupador pot crear els seus propis punts de control de l'aplicació, per certificar d'una manera ràpida el seu correcte funcionament.\r\n\r\nClasse de servei que serà invocada des del Managed Bean de JSF:\r\n\r\n```java\r\n/**\r\n * Check status for several backend\r\n *\r\n * @author\r\n *\r\n */\r\n@Repository(\"statusService\")\r\npublic class StatusService {\r\n\r\n\t@Autowired\r\n        private GenericDAO<User, Integer> dao;\r\n\r\n\r\n\t/**\r\n        * Check PSIS\r\n        * @throws IOException\r\n        */\r\n        @CheckStatus\r\n        public void checkPSIS() throws IOException{\r\n\t        URL myUrl = new URL(\"http://psis.catcert.net/psis/catcert/dss\");\r\n         \tURLConnection myConn = (HttpURLConnection)myUrl.openConnection();\r\n        \tmyConn.setRequestProperty(\"User-agent\",\"Mozilla/4.0\");\r\n        \tInputStreamReader is = null;\r\n        \tBufferedReader br = null;\r\n        \ttry{\r\n\t        \tis = new InputStreamReader(myConn.getInputStream());\r\n\t\t        br = new BufferedReader(is);\r\n            \t\tbr.readLine();\r\n          \t}finally{\r\n\t         \tif(is!=null){\r\n\t\t        \tis.close();\r\n          \t\t}\r\n\t          \tif(br!=null){\r\n\t\t        \tbr.close();\r\n           \t\t}\r\n\t         }\r\n         }\r\n\r\n\t/**\r\n\t * Database check\r\n\t */\r\n\t@CheckStatus\r\n\tpublic void checkDataBaseConnection(){\r\n\t\tdao.get(1);\r\n\t}\r\n\r\n\t/**\r\n\t * Always IOException\r\n\t * @throws IOException\r\n\t */\r\n\t@CheckStatus\r\n\tpublic void checkLDAP() throws IOException{\r\n\t  .....\r\n          .....\r\n\t}\r\n\r\n}\r\n```\r\n\r\n<div class=\"message information\">\r\nControl d'excepcions\r\n\r\nLes excepcions dels diferents mètodes de validació han de propagar-se per tal de que Canigó detecti si ha finalitzat en execució correcta o errònia.\r\n</div>\r\n\r\nLes crides a aquest servei es realitzaran des de la classe CheckStatusBean proporcionada per l'eina de desenvolupament, dins del mètode check:\r\n\r\n```java\r\n@Component(\"statusBean\")\r\n@Scope(\"singleton\")\r\n@Lazy\r\npublic class CheckStatusBean {\r\n\r\n        @Autowired\r\n\tprivate StatusService service;\r\n\r\n\tpublic void check() throws IOException{\r\n\t\tservice.checkPSIS();\r\n\t\tservice.checkDataBaseConnection();\r\n\t\tservice.checkLDAP();\r\n\t}\r\n}\r\n```\r\n\r\nPer executar aquestes comprovacions, dins de la pantalla de monitorització, pestanya \"Estat\", es pot visualitzar/llançar les validacions definides pel desenvolupador.\r\n\r\n#### Instrumentació en format log de l'execució de mètodes de l'aplicació\r\n\r\nAmb l'anotació @Trace, el desenvolupador pot marcar un mètode d'una classe gestionada per Spring, i de automàticament aquest generarà traces d'instrumentació de la seva execució:\r\n\r\n```java\r\n@Repository(\"myService\")\r\npublic class ServiceImpl implements Service {\r\n\r\n\r\n\t@Trace\r\n\tpublic void doSomething(){\r\n\t\t.....\r\n                .....\r\n\t}\r\n\r\n\r\n}\r\n```\r\n\r\nOn el resultat de l'execució del mètode ens deixarà la següent traça:\r\n\r\n```\r\ncanigo Message: XX XXX 2010 16:45:40,774 INFO  [main] cat.gencat.ctti.canigo.arch.operation.instrumentation.trace.AspectTrace - ea84cbe0-60ff-4ba5-a4e8-d90465101ac3;loc;weblogic1;0;Service.doSomething();KO;\r\n```\r\n\r\nOn cadascun dels camps separats per coma son:\r\n\r\n* Identificador únic de petició\r\n* Entorn\r\n* Nom instància Weblogic\r\n* Temps d'execució\r\n* Mètode executat\r\n* Resultat de l'execució.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnN0cnVtZW50YWNpbw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLWptcw==":{"date":1427973276000,"title":"Cues JMS","description":"Missatgeria estándard JMS","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-altres/modul-jms","content":"## Propòsit\r\n\r\nEn aquest apartat s'explica de forma senzilla la infraestructura de missatgeria estándard JMS (Java Messaging Service) de J2EE. Aquest estàndar defineix dues modalitats:\r\n\r\n1. Producció de missatges\r\n2. Consum de missatges, que pot ser asíncron.\r\n\r\nEl consum de missatges assíncrons a l'estàndar J2EE es realitza mitjançant \"Message-Driven Beans\".\r\n\r\nCanigó no incorpora cap llibreria addicional a les ja aportades per Spring per lo que aquest apartat estará enfocat com a guia per a simplificar la publicació i consum de missatge.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nReferència | URL\r\n---------- | ---\r\nSpring JMS | http://static.springsource.org/spring/docs/4.1.0.RELEASE/spring-framework-reference/html/jms.html\r\n\r\n## Glossari\r\n\r\n**JMS**\r\n\r\nJMS o Java Message Service es un estàndard de missatgeria que permet als components de les aplicacions basades en la plataforma J2EE, crear, enviar, rebre i llegir missatges de manera sincrona i asincrona.\r\n\r\n**ConnectionFactory**\r\n\r\nFactoria encarregada de crear una connexió al proveidor del sistema de missatges.\r\n\r\n**Destination**\r\n\r\nPunts de destí dels missatges que s'envien.\r\n\r\n## Descripció detallada\r\n\r\n### Missatgeria Publicació/Subscripció\r\n\r\nLa missatgeria de publicació/subscripció permet a una aplicació enviar missatges a una o múltiples aplicacions. Aquestes aplicacions envien i reben missatges subscrivint-se a un servidor de missatges a una cua o tòpic determinat.\r\n\r\nHi ha dos tipus de missatge depenent de com es consumeixen:\r\n\r\n* Queue: en el cas d'un missatge enviat a una cua, encara que hi hagi varis subscriptors a aquests missatges, únicament es processarà una única vegada pel primer subscriptor que estigui lliure.\r\n* Topic: en el cas d'un missatge enviat a un tòpic, tots els subscriptors a aquests missatges els processaran.\r\n\r\nEls consumidors d'un missatge poden ser síncrons o asíncrons. En general, els consumidors asíncrons escalen millor i tenen un rendiment superior.\r\n\r\nPer aplicacions que s'executen al costat servidor, gairebé sempre sempre s'utilitzaran consumidors asíncrons. Concretament per aplicacions J2ee es fa mitjançant Message-Driven Beans (MDB's) que són EJB's configurats per escoltar i subscriures a cues o tòpics del servidor d'aplicacions.\r\n\r\nA continuació es destaquen alguns paràmetres de configuració dels missatges JMS que cal tenir en compte en el desenvolupament d'aplicacions que publiquin o consumeixin aquests tipus de missatges.\r\n\r\n### Persistència del missatge\r\n\r\nEls missatges JMS poden ser especificats com a persistents o no-persistents.\r\n\r\n* Un missatge persistent garanteix la seva entrega un i només un cop. El missatge no pot ser perdut degut a una fallida del proveïdor JMS, i no pot ser entregat dos cops. No es considerat enviat el missatge fins que no ha estat persistit (a un fitxer ó a una base de dades).\r\n* Un missatge no-persistent no és emmagatzemat. Està garantit que sigui entregat com a molt un cop, però si hi ha una fallida del proveïdor JMS el missatge pot ser perdut.\r\n\r\nEls missatges persistents tenen pitjor rendiment degut al pas addicional d'haver-se d'escriure en disc o a base de dades. Només es recomana utilitzar missatges persistents pels casos d'ús crítics, on no es pot permetre la pèrdua del missatge (p.ex. una trasacció bancària, ...).\r\n\r\n### Destinacions distribuïdes\r\n\r\nUna destinació distribuïda és un conjunt de destinacions que són accessibles com a una única destinació lògica al client. Disposen d'una sola adreça JNDI, i els membres d'aquest conjunt normalment són distribuïts pels membres d'un cluster, on cada destinació pertany a un servidor JMS separat.\r\n\r\nLes aplicacions que usen destinacions distribuïdes tenen més disponibilitat respecte a les tradicionals, ja que els servidor (Weblogic) proporciona balanceig de càrrega i tolerància a fallades pels membres d'una destinació distribuïda en un cluster.\r\n\r\nPer tant, es recomana l'ús de destinacions distribuïdes sempre que les aplicacions publicadores/consumidores es desplegin en un cluster de Weblogic.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal- lar Quartz es necessari afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<org.opensymphony.quartz.version>2.2.1</org.opensymphony.quartz.version>\r\n<commons.collections.version>4.0</commons.collections.version>\r\n<org.springframework.version>4.1.0.RELEASE</org.springframework.version>\r\n\r\n<dependency>\r\n\t<groupId>org.springframework</groupId>\r\n\t<artifactId>org.springframework.jms</artifactId>\r\n\t<version>$org.springframework.version}</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>javax.jms</groupId>\r\n\t<artifactId>com.springsource.javax.jms</artifactId>\r\n\t<version>1.1.0</version>\r\n</dependency>\r\n<!-- Active MQ -->\r\n<dependency>\r\n\t<groupId>org.apache.activemq</groupId>\r\n\t<artifactId>com.springsource.org.apache.activemq</artifactId>\r\n\t<version>5.3.0</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>org.apache.xbean</groupId>\r\n\t<artifactId>com.springsource.org.apache.xbean.spring</artifactId>\r\n\t<version>3.6.0</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>org.apache.geronimo.specs</groupId>\r\n\t<artifactId>com.springsource.javax.management.j2ee</artifactId>\r\n\t<version>1.0.1</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del servei de cues el podriem dividir en els següents punts:\r\n\r\n* Configuració de la infraestructura\r\n* Configuració del productor\r\n* Configuració del consumidor\r\n* Externalització de les propietats d'aquests beans\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/jms-config.xml\r\n\r\nConfiguració dels arxius de propietats\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/jms.properties\r\n\r\nDins d'aquest arxiu romandrien les propietats per a la gestió de la invocació:\r\n\r\nExemple d'arxiu de propietats:\r\n\r\n```\r\n*.jms.physicalNameDestination=cat.gencat.cttit.jms.test\r\n*.jms.acknowledge=auto\r\n*.jms.uri=tcp://localhost:0\r\n``\r\n\r\n\r\n## Utilització del Mòdul\r\n\r\nEn aquest exemple es configurarà:\r\n\r\n* Arxiu de configuració de Spring per a la càrrega de beans implicats en l'enviament i consum de missatges JMS.\r\n* Arxiu de propietats de configuració.\r\n* Productor de missatges.\r\n* Listener/consumidor de missatges.\r\n* Classe de Test per certificar el se funcionament.\r\n\r\n**jms-config.xml**\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n       xmlns:p=\"http://www.springframework.org/schema/p\"\r\n       xmlns:context=\"http://www.springframework.org/schema/context\"\r\n       xmlns:jms=\"http://www.springframework.org/schema/jms\"\r\n       xmlns:amq=\"http://activemq.apache.org/schema/core\"\r\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\r\n                           http://www.springframework.org/schema/beans/spring-beans.xsd\r\n                           http://www.springframework.org/schema/context\r\n                           http://www.springframework.org/schema/context/spring-context.xsd\r\n                           http://www.springframework.org/schema/jms\r\n                           http://www.springframework.org/schema/jms/spring-jms.xsd\r\n                           http://activemq.apache.org/schema/core\r\n                           http://activemq.apache.org/schema/core/activemq-core.xsd\">\r\n\r\n    <context:component-scan base-package=\"cat.gencat.ctti.testing.jms\" />\r\n\r\n    <!--  ActiveMQ Broker Embegut -->\r\n    <amq:broker id=\"broker\" useJmx=\"false\" persistent=\"false\">\r\n        <amq:transportConnectors>\r\n            <amq:transportConnector uri=\"${jms.uri}\" />\r\n        </amq:transportConnectors>\r\n    </amq:broker>\r\n\r\n    <!--  ActiveMQ Destination  -->\r\n    <amq:queue id=\"destination\" physicalName=\"${jms.physicalNameDestination}\" />\r\n\r\n    <!-- JMS ConnectionFactory al broker embegut -->\r\n    <amq:connectionFactory id=\"jmsFactory\" brokerURL=\"${jms.brokerURL}\" />\r\n\r\n    <!-- Configuració del productor -->\r\n    <bean id=\"jmsProducerConnectionFactory\"\r\n          class=\"org.springframework.jms.connection.SingleConnectionFactory\"\r\n          depends-on=\"broker\"\r\n          p:targetConnectionFactory-ref=\"jmsFactory\" />\r\n\r\n    <bean id=\"jmsProducerTemplate\" class=\"org.springframework.jms.core.JmsTemplate\"\r\n          p:connectionFactory-ref=\"jmsProducerConnectionFactory\"\r\n          p:defaultDestination-ref=\"destination\" />\r\n\r\n    <!-- Configuració del consumidor -->\r\n    <bean id=\"jmsConsumerConnectionFactory\"\r\n          class=\"org.springframework.jms.connection.SingleConnectionFactory\"\r\n          depends-on=\"broker\"\r\n          p:targetConnectionFactory-ref=\"jmsFactory\" />\r\n\r\n    <jms:listener-container container-type=\"default\"\r\n                            connection-factory=\"jmsConsumerConnectionFactory\"\r\n                            acknowledge=\"${jms.acknowledge}\">\r\n        <jms:listener destination=\"org.springbyexample.jms.test\" ref=\"jmsMessageListener\" />\r\n    </jms:listener-container>\r\n\r\n    <!-- Contador per al consumidor i la clase de test per verificar el número de missatges enviats -->\r\n    <bean id=\"counter\" class=\"java.util.concurrent.atomic.AtomicInteger\" />\r\n\r\n</beans>\r\n```\r\n\r\n<div class=\"message information\">\r\nEn aquest cas s'ha fet servir un servidor ActiveMQ embegut que Spring s'encarrega de aixecar. En el cas d'apuntar a un servidor remot, s'hauria d'eliminar les referències a aquest i apuntar al nou broker.\r\n</div>\r\n\r\n\r\nDestacar que els beans del consumidor i productor han de'estar al package \"cat.gencat.ctti.testing.jms\" perque component-scan aixequi de manera automàtica els beans de Spring.\r\n\r\n**jms.properties**\r\n\r\n```\r\n*.jms.physicalNameDestination=cat.gencat.cttit.jms.test\r\n*.jms.acknowledge=auto\r\n*.jms.uri=tcp://localhost:0\r\n*.jms.brokerURL=vm://localhost\r\n```\r\n\r\n**JmsMessageProducer.java**\r\n\r\n```java\r\n@Component\r\npublic class JmsMessageProducer {\r\n\r\n    private static final Log logger = LogFactory.getLog(JmsMessageProducer.class);\r\n\r\n    protected static final String MESSAGE_COUNT = \"messageCount\";\r\n\r\n    @Autowired\r\n    private JmsTemplate template = null;\r\n    private int messageCount = 100;\r\n\r\n    /**\r\n     * Generació dels missatges\r\n     */\r\n    @PostConstruct\r\n    public void generateMessages() throws JMSException {\r\n        for (int i = 0; i < messageCount; i++) {\r\n            final int index = i;\r\n            final String text = \"Message number is \" + i + \".\";\r\n\r\n            template.send(new MessageCreator() {\r\n                public Message createMessage(Session session) throws JMSException {\r\n                    TextMessage message = session.createTextMessage(text);\r\n                    message.setIntProperty(MESSAGE_COUNT, index);\r\n                    logger.info(\"Sending message: \" + text);\r\n                    return message;\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nL'annotació PostConstruct fa que el métode generateMessage s'executi un cop Spring instanciï/creï el bean **JmsMessageProducer**.\r\n\r\n**JmsMessageListener.java**\r\n\r\n```java\r\n@Component\r\npublic class JmsMessageListener implements MessageListener {\r\n\r\n    private static final Log logger = LogFactory.getLog(JmsMessageListener.class);\r\n\r\n    @Autowired\r\n    private AtomicInteger counter = null;\r\n\r\n    /**\r\n     * Implementació de <code>MessageListener</code>.\r\n     */\r\n    public void onMessage(Message message) {\r\n        try {\r\n            int messageCount = message.getIntProperty(JmsMessageProducer.MESSAGE_COUNT);\r\n\r\n            if (message instanceof TextMessage) {\r\n                TextMessage tm = (TextMessage)message;\r\n                String msg = tm.getText();\r\n                logger.info(\"Processed message '\" + msg + \"'.  value=\" + messageCount);\r\n                counter.incrementAndGet();\r\n            }\r\n        } catch (JMSException e) {\r\n            logger.error(e.getMessage(), e);\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nConsumim asincronament els missatges que el productor ha anat enviat a la cua.\r\n\r\n**JmsMessageListenerTest.java**\r\n\r\n```java\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(locations = {\"jms-config.xml\"})\r\npublic class JmsMessageListenerTest {\r\n\r\n    private static final Log logger = LogFactory.getLog(JmsMessageListenerTest.class);\r\n\r\n    @Autowired\r\n    private AtomicInteger counter = null;\r\n\r\n    @Test\r\n    public void testMessage() throws Exception {\r\n        assertNotNull(\"Counter is null.\", counter);\r\n        int expectedCount = 100;\r\n        logger.info(\"Testing...\");\r\n        // Esperem que el listener processi tots els missatges\r\n        Thread.sleep(2 * 1000);\r\n        assertEquals(\"Message is not '\" + expectedCount + \"'.\", expectedCount, counter.get());\r\n    }\r\n\r\n}\r\n```\r\n\r\nEns assegurem que el contador ha arribat a 100, lo que asegura que el consumidor ha rebut els 100 missatges del productor.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLWptcw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1qcGE=":{"date":1427444776000,"title":"JPA","description":"Mòdul de persistència de Base de Dades.","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-core/modul-jpa","content":"## Propòsit\r\n\r\nAquest mòdul proporciona accés amb transaccionalitat amb la BBDD, permetent la execució d'operacions dintre de transaccions.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'hibernate fitxers es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.persistence.jpa.version>[1.1.0,1.2.0)</canigo.persistence.jpa.version>\r\n\r\n<dependency>\r\n <groupId>cat.gencat.ctti</groupId>\r\n <artifactId>canigo.persistence.jpa</artifactId>\r\n <version>${canigo.persistence.jpa.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/jpa.properties\r\n\r\nPropietat | Requerit | Descripció\r\n--------- | -------- | ----------\r\n*.persistence.database | Si | Sistema de base de dades al que es conectarà.\r\n*.persistence.dialect | Si | El nom de classe de que permet a JPA generar SQL per a una base de dades relacional en particular: <br> - org.hibernate.dialect.Oracle9Dialect <-- Versió 9<br> - org.hibernate.dialect.Oracle10gDialect <-- Versió 10g<br> - org.hibernate.dialect.Oracle8iDialect <-- Versió 8i<br> - org.hibernate.dialect.MySQL5Dialect <-- Versió 5<br> - org.hibernate.dialect.MySQLDialect <-- Versions < 5<br> - org.hibernate.dialect.HSQLDialect<br> - org.hibernate.dialect.PostgreSQLDialect\r\n*.persistence.showSQL | No | Escriu totes les sentències SQL al log aplicatiu.<br> Per defecte: true\r\n*.persistence.generateDdl |No | Exporta el DDL (Data Definition Language) a la BD després de que l'EntityManagerFactory s'inicialitzi, creant/actualitzant les taules.<br> Valor per defecte: false\r\n*.persistence.hibernate.connection.release_mode | No | Serveix per especificar quan Hibernate ha d'alliberar les connexions JDBC. Una connexió JDBC es manté fins que la sessió es tancada explícitament o desconnectat per defecte. Per a un datasource JTA s'hauria de seleccionar after_statement, i per non-JTA after_transaction. En mode auto, es seleccionarà after_statement per a JTA i CMT, i afte_transaction per JDBC.<br> Per defecte: auto\r\n*.persistence.hibernate.connection.autocommit | No | Habilita l'autocommit per a connexions pooled JDBC\r\n*.persistence.hibernate.generate_statistics | No | Hibernate recopila informació útil per a tunning.<br> Per defecte: false\r\n*.persistence.hibernate.jdbc.use_scrollable_resultset | No | Habilita l'ús de JDBC2 scrollable resultsets a Hibernate.<br> Per defecte: true\r\n\r\n## Utilització del Mòdul\r\n\r\n###  JSF\r\n\r\nPer a utilitzar aquest mòdul, cal crear un bean i una jsf:\r\n\r\n**crudBean.java**\r\n\r\n```java\r\n@Component(\"crudBean\")\r\n@Lazy\r\npublic class CRUDBean {\r\n\r\n\tprivate String name;\r\n\tprivate String password;\r\n\tprivate UsersDAO<User,Integer> dao = null;\r\n\tprivate User user = null;\r\n\tprivate DataModel model = null;\r\n\tprivate static final Log logger = LogFactory.getLog(CRUDBean.class);\r\n\r\n\t@Autowired\r\n\tpublic void setDao(UsersDAO<User,Integer> dao) {\r\n\t\tthis.dao = dao;\r\n\t}\r\n\r\n\tpublic String getPassword() {\r\n\t\treturn password;\r\n\t}\r\n\r\n\tpublic void setPassword(String password) {\r\n\t\tthis.password = password;\r\n\t}\r\n\r\n\tpublic String getName() {\r\n\t\treturn name;\r\n\t}\r\n\r\n\tpublic void setName(String name){\r\n\t\tthis.name = name;\r\n\t}\r\n\r\n\t@Transactional(propagation=Propagation.REQUIRED)\r\n\tpublic void save(){\r\n\t\tUser user = new User();\r\n\t\tuser.setName(this.getName());\r\n\t\tuser.setPassword(this.getPassword());\r\n\t\tdao.save(user);\r\n\t}\r\n\r\n\tpublic String update(){\r\n\t\tlogger.debug(\"Init update\");\r\n\t\tUser tmpUser = dao.get(this.user.getId());\r\n\t\tlogger.debug(\"Content: \" + tmpUser);\r\n\t\ttmpUser.setName(getName());\r\n\t\ttmpUser.setPassword(getPassword());\r\n\t\tdao.update(tmpUser);\r\n\t\tdao.flush();\r\n\t\tlogger.debug(\"End update\");\r\n\t\treturn \"item_list\";\r\n\t}\r\n\r\n\tpublic User getUser(){\r\n\t\treturn user;\r\n\t}\r\n\r\n\tpublic DataModel getUsers(){\r\n\t\tmodel = new ListDataModel(dao.findByNamedQuery(\"findAllOrderBy\"));\r\n\t\treturn model;\r\n\t}\r\n\r\n\tpublic String detailSetup() {\r\n\t\tuser = (User)model.getRowData();\r\n        return \"item_detail\";\r\n    }\r\n}\r\n```\r\n\r\n**crud.jsf**\r\n\r\n```java\r\n<h:form id=\"beanValidatorForm\">\r\n     <rich:panel style=\"width:40%\">\r\n\t<f:facet name=\"header\">\r\n\t     <h:outputText value=\"#{msg.crudNewUser}\" />\r\n\t</f:facet>\r\n\t<h:panelGrid columns=\"3\">\r\n\t     <h:outputText value=\"#{msg.crudName}:\" />\r\n              <h:inputText value=\"#{crudBean.name}\" id=\"name\"/>\r\n\t     <rich:message for=\"name\" />\r\n\t     <h:outputText value=\"#{msg.crudPassword}:\" />\r\n\t     <h:inputText value=\"#{crudBean.password}\" id=\"password\"/>\r\n              <rich:message for=\"password\" />\r\n\t     <f:facet name=\"footer\">\r\n\t          <a4j:commandButton value=\"#{msg.crudSave}\" action=\"#{crudBean.save}\" reRender=\"userList\" />\r\n\t     </f:facet>\r\n\t</h:panelGrid>\r\n     </rich:panel>\r\n</h:form>\r\n```\r\n\r\n### STRUTS+TAGLIBS\r\n\r\nPer a utilitzar el mòdul cal crear una Acció i una JSP:\r\n\r\n**persistence.xml**\r\n\r\n```\r\n<persistence xmlns=\"http://java.sun.com/xml/ns/persistence\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd\" version=\"1.0\">\r\n\r\n     <persistence-unit name=\"canigo\" transaction-type=\"RESOURCE_LOCAL\">\r\n          <provider>org.hibernate.ejb.HibernatePersistence</provider>\r\n          <non-jta-data-source>jdbc/formacioDS</non-jta-data-source>\r\n\r\n          <properties>\r\n               <property name=\"hibernate.dialect\" value=\"org.hibernate.dialect.H2Dialect\"/>\r\n          </properties>\r\n     </persistence-unit>\r\n\r\n</persistence>\r\n```\r\n\r\n**CrudExempleAction.java**\r\n\r\n```java\r\npublic class CrudExempleAction extends DispatchActionSupport {\r\n\r\n\tprivate static final Log logger = LogFactory.getLog(CrudExempleAction.class);\r\n\tprivate final String FORWARD_INICI = \"success\";\r\n\tprivate final String FORWARD_SHOW_ELEMENT = \"mostrar\";\r\n\tprivate final String FORWARD_ERROR = \"error\";\r\n\tprivate ValueListActionHelper valueListActionHelper;\r\n\tprivate CrudExempleBO crudExempleBO;\r\n\r\n\t/**\r\n\t * Mètode que es crida pel reqCode=inici\r\n\t * @param mapping ActionMapping\r\n\t * @param form ActionForm\r\n\t * @param request HttpServletRequest\r\n\t * @param response HttpServletResponse\r\n\t * @return ActionForward\r\n\t * @throws Exception exception\r\n\t */\r\n\tpublic ActionForward inici(ActionMapping mapping, ActionForm form, HttpServletRequest request,\r\n\t\tHttpServletResponse response) throws Exception {\r\n\t\tlogger.info(\"[CrudExempleAction][Inici] - Inici\");\r\n\t\tvalueListActionHelper.search(mapping, form, request, response);\r\n\t\tlogger.info(\"[CrudExempleAction][Inici] - Fi\");\r\n\t\treturn mapping.findForward(FORWARD_INICI);\r\n\t}\r\n\r\n\t/**\r\n\t * Mètode que es crida pel reqCode=desar\r\n\t * @param mapping ActionMapping\r\n\t * @param form ActionForm\r\n\t * @param request HttpServletRequest\r\n\t * @param response HttpServletResponse\r\n\t * @return ActionForward\r\n\t * @throws Exception exception\r\n\t */\r\n\tpublic ActionForward desar(ActionMapping mapping, ActionForm form, HttpServletRequest request,\r\n\t\t\tHttpServletResponse response) throws Exception {\r\n\r\n\t\tTbEntitats entitat = null;\r\n\r\n\t\ttry {\r\n\t\t\tlogger.info(\"[CrudExempleAction][desar] - Inici\");\r\n\r\n\t\t\tSpringBindingActionForm springBindingActionForm = (SpringBindingActionForm) form;\r\n\t\t\tCrudExemplePojo pojoForm = (CrudExemplePojo)springBindingActionForm.getTarget();\r\n\r\n\t\t\tentitat = new TbEntitats();\r\n\t\t\tentitat.setNom(pojoForm.getNom());\r\n\t\t\tentitat.setTelefon(new Long(pojoForm.getTelefon()));\r\n\t\t\tentitat.setAdreca(pojoForm.getAdreca());\r\n\t\t\tcrudExempleBO.addEntitat(entitat);\r\n\r\n\t\t\tvalueListActionHelper.search(mapping, form, request, response);\r\n\t\t\tlogger.info(\"[CrudExempleAction][desar] - Fi\");\r\n\t\t\treturn mapping.findForward(FORWARD_INICI);\r\n\t\t} catch (Exception e) {\r\n\t\t\te.printStackTrace();\r\n\t\t\treturn mapping.findForward(FORWARD_ERROR);\r\n\t\t}\r\n\t}\r\n}\r\n```  \r\n\r\n**CrudExempleBOImpl**\r\n\r\n```java\r\npublic class CrudExempleBOImpl implements CrudExempleBO {\r\n\r\n\tprivate UniversalHibernateDAO hibernateDAO;\r\n\r\n\tpublic Long addEntitat(TbEntitats entitat) throws Exception {\r\n\r\n\t\tTbEntitats vo = new TbEntitats();\r\n\t\tBeanUtils.copyProperties(vo, entitat);\r\n\t\tLong id = (Long)hibernateDAO.save(vo);\r\n\t\thibernateDAO.flush();\r\n\t\treturn id;\r\n\t}\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1qcGE="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnRlcm5hY2lvbmFsaXR6YWNpbw==":{"date":1426150815000,"title":"Mòdul d'internacionalització","description":"Mòdul d'internacionalització.","sections":"Canigó. Documentació versió 3.x","weight":5,"path":"/canigo-documentacio-versions-3x-core/modul-internacionalitzacio","content":"## Propòsit\r\n\r\nEl mòdul d'internacionalització té com a objectiu principal permetre el\r\ndesenvolupament d'aplicacions en el que no sigui necessària cap\r\nreenginyeria cada vegada que s'incorpori un nou llenguatge a\r\nl'aplicació.\r\n\r\nEn general tota aplicació internacionalitzada pot realitzar-se de dues\r\nformes diferenciades:\r\n\r\n1.  Mitjançant la rèplica d'un conjunt de pàgines per a cada idioma.\r\n2.  Mitjançant un únic conjunt de pàgines que obtenen diferents literals\r\n    de forma externa segons l'idioma.\r\n\r\nLa primera solució, fins ara utilitzada en moltes pàgines Web, implica\r\nun cost gran de rèplica i manteniment, ja que qualsevol nou requeriment\r\no canvi comporta realitzar més d'un desenvolupament, un per cada idioma.\r\n\r\nLa segona solució, recomanada per Canigó permet que:\r\n\r\n1.  Es puguin afegir llenguatges sense haver de realitzar canvis al\r\n    codi.\r\n2.  Els texts, imatges i missatges s'emmagatzemen de forma externa al\r\n    codi.\r\n3.  La informació (per exemple dates) es pot formatejar segons l'idioma\r\n    de l'usuari\r\n\r\n## Glossari\r\n\r\n**i18N (Internationalization)**\r\n\r\ni18N o Internationalization (el 18 correspon a les 18 lletres que hi ha\r\nentre la I inicial i la n final) és el procés d'agafar una aplicació\r\ndissenyada i reestructurar-la per a què pugui ser usada en diferents\r\nlocalitats o bé definir el procés de crear-la per a ser totalment\r\nflexible per executar-se en qualsevol localitat. Java defineix les\r\nclasses bàsiques d'ús de la internacionalització.\r\n\r\n## Instal.lació i configuració\r\n\r\n### Instal.lació\r\n\r\nEl mòdul de configuració s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació (Struts o JSF), l'eina de\r\nsuport al desenvolupament inclourà la referència dins del pom.xml. En\r\ncas d'una instal- lació manual afegir les següents línies al pom.xml de\r\nl'aplicació:\r\n\r\n~~~~ {.code-java}\r\n<canigo.core.version>[3.1.0,3.2.0)</canigo.core.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.core</artifactId>\r\n          <version>${canigo.core.version}</version>\r\n</dependency>\r\n~~~~\r\n\r\n### Configuració\r\n\r\nPer a configurar el mòdul d'internacionalització s'han de manipular els\r\nsegüents fitxers:\r\n\r\n1.  Definició dels fitxers de traduccions (típicament els fitxers dels\r\n    diferents idiomes: application.properties,\r\n    application_XX_XX.properties)\r\n2.  Definició de la integració amb el servei de presentació (web.xml)\r\n3.  Definició dels idiomes i literals suportats (només JSF).\r\n\r\nNo requereix configuració per a inicialitzar el mòdul per part del\r\ndesenvolupador. Els xmls de configuració del servei es troben\r\ninternalitzats dins del jar del core, i s'inicialitzarà de manera\r\nautomàtica un cop arrenqui l'aplicació.\r\n\r\nEls arxius de configuració d'idiomes de l'aplicació han d'estar en la\r\nsegüent ubicació:\r\n\r\n<PROJECT_ROOT>/src/main/resources/config/i18n/*.properties\r\n\r\nAutomàticament el mòdul d'internacionalització carregarà tots els arxius\r\nde configuració d'idiomes perquè posteriorment puguin ser explotats per\r\nl'aplicació.\r\n\r\n#### Definició dels fitxers de traducció\r\n\r\nUbicació:\r\n\r\n <PROJECT_ROOT>/src/main/resources/config/i18n/*.properties\r\n\r\nExplicació:\r\n\r\nEls fitxers de traducció són els fitxers que contenen els missatges en\r\nels diferents idiomes. Es basen en l'ús de la internacionalització de\r\nJava (i18n o Internationalization).\r\n\r\n Aquests fitxers s'han de construir tenint en compte que:\r\n\r\n1.  La seva extensió ha de ser '.properties' (es denominen resource\r\n    bundles).\r\n2.  Per cada idioma que volguem suportar cal crear un nou fitxer. Aquest\r\n    fitxer tindrà la següent nomenclatura:\r\n    'nomFitxer__lg_pa._properties', on 'lg' correspon al codi del\r\n    llenguatge i 'pa' correspon al codi del país pel qual volem definir\r\n    els literals.\r\n3.  El seu contingut es basa en l'ús de parells clau-valor tal i com es\r\n    mostra a continuació:\r\n\r\nFitxer de multiidioma application.properties\r\n\r\n~~~~ {.code-java}\r\nclau_1=valor_1\r\nclau_2=valor_2\r\n...\r\n~~~~\r\n\r\nEn cas de que l'idioma escollit per l'usuari no correspongui amb cap\r\nfitxer, es pot crear un fitxer per defecte. Aquest fitxer tindrà el\r\nformat 'nomFitxer.properties'.\r\n\r\nExemple:\r\n\r\n1.  'applicationResources_en.properties', per representar els literals\r\n    en anglès\r\n2.  'applicationResources_es.properties', per representar els literals\r\n    en castellà\r\n3.  'applicationResources_ca.properties', per representar els literals\r\n    català\r\n4.  'applicationResources.properties', per representar els literals de\r\n    qualsevol altre idioma\r\n\r\nMés informació dels codis de pais e idioma:\r\n\r\n-   [Codis d'idioma\r\n    (ISO-639)](http://ftp.ics.uci.edu/pub/ietf/http/related/iso639.txt)\r\n-   [Codis de pais\r\n    (ISO-3166)](http://www.chemie.fu-berlin.de/diverse/doc/ISO_3166.html)\r\n\r\n<div class=\"message warning\">\r\nEn cas de que per un llenguatge determinat existeixi un fitxer específic, l'obtenció del literal a partir d'una clau s'obtindrà des d'aquest fitxer. Si no es troba la clau en cap cas s'anirà al fitxer per defecte. Així doncs és important que es mantinguin actualitzats els fitxers de recursos per cada idioma de l'aplicació per evitar problemes. És important que es proporcioni un fitxer de recursos per defecte. Aquest serà el fitxer utilitzat  pel servei en cas de que el llenguatge escollit per l'usuari no correspongui a cap dels fitxers de recursos definits.\r\n</div>\r\n\r\n#### Definició de la integració amb el mòdul de presentació\r\n\r\nFitxer de configuració: web.xml\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/webapp/WEB-INF/web.xml\r\n\r\nPer integrar el mòdul d'internacionalització amb el mòdul de presentació\r\ns'han de definir els següents filtres a nivell d'aplicació:\r\n\r\n##### Localization Filter\r\n\r\nAquest filtre s'encarrega d'exposar el mòdul d'internacionalització per\r\ntal de que sigui accessible a tota la capa web. Comú tant aplicacions\r\nJSF com a Struts.\r\n\r\nAtributs:\r\n\r\n**Atribut**  | **Requerit** | **Valor**\r\n------------ | ------------ | ---------\r\nfilter-name  | Sí           | Nom del filtre<br>Exemple: Localization Filter\r\nfilter-class | Sí           | cat.gencat.ctti.canigo.arch.web.core.filters.LocalizationFilter\r\n\r\n~~~~ {.code-java}\r\n<filter>\r\n    <filter-name>Localization Filter</filter-name>\r\n    <filter-class>cat.gencat.ctti.canigo.arch.web.core.filters.LocalizationFilter</filter-class>\r\n</filter>\r\n~~~~\r\n\r\n##### Struts Locale Filter\r\n\r\nAquest filtre s'encarrega de d'integrar el mòdul d'internacionalització\r\nexposat pel filtre comú de Localization Filter per tal que des de Struts\r\nes pugui fer ús de fitxers d'internacionalització.\r\n\r\nAtributs:\r\n\r\n**Atribut**  | **Requerit** | **Valor**\r\n------------ | ------------ | ---------\r\nfilter-name  | Sí           | Nom del filtre<br>Exemple: Struts Locale Filter\r\nfilter-class | Sí           | cat.gencat.ctti.canigo.arch.web.struts.filter.StrutsLocaleFilter\r\n\r\n~~~~ {.code-java}\r\n<filter>\r\n   <filter-name>Struts Locale Filter</filter-name>\r\n   <filter-class>cat.gencat.ctti.canigo.arch.web.struts.filter.StrutsLocaleFilter</filter-class>\r\n</filter>\r\n~~~~\r\n\r\n#### Definició dels idiomes i literals suportats (només JSF)\r\n\r\nUbicació proposada:\r\n<PROJECT_ROOT>/src/main/webapp/WEB-INF/faces-config.xml\r\n\r\nLa configuració del locale permet definir amb quin nom s'exposaran les\r\npropietats a les pàgines JSF, i els idiomes permesos i per defecte del\r\nnavegador en cas de que no sigui informat.\r\n\r\nPer defecte, l'eina de suport al desenvolupament de Canigó informa\r\naquest valors segons les opcions seleccionades durant la creació de\r\nl'aplicació.\r\n\r\n~~~~ {.code-java}\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<faces-config version=\"1.2\" xmlns=\"http://java.sun.com/xml/ns/javaee\"\r\n xmlns:xi=\"http://www.w3.org/2001/XInclude\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-facesconfig_1_2.xsd\">\r\n\r\n    <application>\r\n\r\n        .......\r\n        <locale-config>\r\n        <default-locale>ca_ES</default-locale>\r\n        <supported-locale>es</supported-locale>\r\n        <supported-locale>en</supported-locale>\r\n        <supported-locale>de</supported-locale>\r\n    </locale-config>\r\n    <resource-bundle>\r\n            <base-name>config.i18n.applicationResources</base-name>\r\n            <var>msg</var>\r\n        </resource-bundle>\r\n        .......\r\n        </application>\r\n        ........\r\n</faces-config>\r\n~~~~\r\n\r\nEn l'exemple anterior l'idioma per defecte és Català, el locales\r\nsuportats: espanyol, anglès i alemany.\r\n Els recursos de l'aplicació es podran accedir des de la JSF a partir\r\ndel nom de variable **msg** i trobaran situats a:\r\n\r\n<PROJECT_ROOT>/src/main/resources/config/i18n/applicationResources.properties\r\n\r\n~~~~ {.code-java}\r\n<h:outputText value=\"#{msg.formulari_agregarCanvisArxiusIntegrats}\"/>\r\n~~~~\r\n\r\n#### Definició dels literals suportats (només Struts)\r\n\r\nUbicació proposada:\r\n<PROJECT_ROOT>/src/main/resources/struts/struts-config.xml\r\n\r\nAquest arxiu engloba la configuració de Struts, dins d'aquest podem\r\ndefinir els recursos que seran accessibles des de les pàgines web. Per\r\ntal d'habilitar aquesta internacionalització s'ha d'informar el tag\r\nmessage-resources.\r\n\r\n**Atribut** | **Requerit** | **Valor**\r\n----------- | ------------ | ---------\r\nparameter   | Sí           | Ruta per punts on estan localitzats els literals\r\nnull        | No           | Informant aquesta propietat com a \"false\" mostrará els recursos no informats com a ?key? enlloc de mostrar null\r\n\r\n~~~~ {.code-java}\r\n<message-resources parameter=\"i18n.applicationResources\" null=\"false\" />\r\n~~~~\r\n\r\nSi es vol exposar més d'un arxiu de literals crear tants tags\r\nmessage-resources com siguin necessaris.\r\n\r\n~~~~ {.code-java}\r\n<message-resources parameter=\"i18n.applicationResources\" null=\"false\" />\r\n<message-resources parameter=\"i18n.anotherApplicationResources\" null=\"false\" />\r\n<message-resources parameter=\"i18n.thirdApplicationResources\" null=\"false\" />\r\n~~~~\r\n\r\n## Utilització del mòdul\r\n\r\n### JSF\r\n\r\nSuposant que els recursos estan exposats a la variable **msg** i com a\r\nliterals tenim:\r\n\r\n**applicationResources.properties**\r\n\r\n~~~~ {.code-java}\r\nnomFormulari=Nom del formulari\r\n~~~~\r\n\r\n**prova.jsf**\r\n\r\n~~~~ {.code-java}\r\n<h:outputText value=\"#{msg.nomFormulari}\"/>\r\n~~~~\r\n\r\nSi la key del literal a mostrar conté un punt s'ha de mostrar de la\r\nsegüent manera:\r\n\r\n~~~~ {.code-java}\r\n<h:outputText value=\"#{msg['nom.formulari']\"/>\r\n~~~~\r\n\r\nI si el literal és del tipus cadena=Hola {0} {1} es poden passar\r\nparàmetres de la següent manera:\r\n\r\n~~~~ {.code-java}\r\n<h:outputFormat value=\"#{msg['cadena']}\">\r\n   <f:param value=\"Ramon\" />\r\n   <f:param value=\"Sala\" />\r\n</h:outputFormat>\r\n~~~~\r\n\r\n### Struts\r\n\r\nSuposant els següents literals:\r\n\r\n**applicationResources.properties**\r\n\r\n~~~~ {.code-java}\r\nnomFormulari=Nom del formulari\r\n~~~~\r\n\r\n**prova.jsf**\r\n\r\n~~~~ {.code-java}\r\n<font face=\"verdana\">\r\n  <bean:message key=\"formulari.errorActivacio\" />\r\n</font>\r\n~~~~\r\n\r\n## Preguntes freqüents\r\n\r\n### Accés manual al servei d'internacionalització\r\n\r\nEncara que no és una pràctica comú es pot accedir al mòdul d'idiomes\r\ndesde qualsevol bean de l'aplicació gestionat per Spring. Per recuperar\r\naquest bean el desenvolupador pot realitzar una crida de forma externa\r\nmitjançant el patró ['Dependency\r\nInjection'](http://martinfowler.com/articles/injection.html)\r\nal mòdul i les seves propietats d'entorn.\r\n\r\n- Injecció de dependències mitjançant xml. Per exemple:\r\n\r\nRuta proposada: <PROJECT_ROOT>/src/main/resources/spring/exemple-beans-config.xml\r\n\r\n~~~~ {.code-java}\r\n<bean id=\"myBean\"  class=\"cat.gencat.app.exemples.Injection\">\r\n    <property name=\"i18nResource\" ref=\"messageSource\" />\r\n</bean>\r\n~~~~\r\n\r\nLa clase Injection tindria la següent estructura:\r\n\r\n~~~~ {.code-java}\r\nimport cat.gencat.ctti.canigo.arch.core.i18n.I18nResourceBundleMessageSource;\r\n\r\npublic class Injection {\r\n     I18nResourceBundleMessageSource i18n;\r\n     private static final Log LOGGER= LogFactory.getLog(Injection.class);\r\n\r\n     public void setI18nResource(I18nResourceBundleMessageSource i18nResource){\r\n         this.i18n = i18nResource;\r\n     }\r\n     \r\n     public void executeCommand(){\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(i18n.getMessage(\"test.label\"));\r\n        }\r\n     }\r\n}\r\n~~~~\r\n\r\nSpring s'encarregarà d'injectar el bean d'internacionalització dins del\r\nbean \"myBean\" executant el mètode setI18nResource.\r\n\r\n-   Injecció de dependències mitjançant anotacions:\r\n\r\n~~~~ {.code-java}\r\nimport cat.gencat.ctti.canigo.arch.core.i18n.I18nResourceBundleMessageSource;\r\n\r\npublic class Injection {\r\n     \r\n     private static final Log LOGGER= LogFactory.getLog(Injection.class);\r\n     \r\n     @Autowired\r\n     I18nResourceBundleMessageSource i18n;\r\n     article table {\r\n    margin:1em 0;\r\n}\r\n     public void executeCommand(){\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(i18n.getMessage(\"test.label\"));\r\n        }\r\n     }\r\n}\r\n~~~~\r\n\r\nL'anotació @Autowired injecta en aquest cas, un bean de tipus\r\ncat.gencat.ctti.canigo.arch.core.i18n.I18nResourceBundleMessageSource\r\nque Spring trobarà en el context de l'aplicació.\r\n\r\n### Claus amb punts en JSF\r\n\r\nA diferencia de Struts l'accés a propietats amb punts a la seva clau\r\ncanvia:\r\n\r\nExemple de claus amb punts:\r\n\r\n~~~~ {.code-java}\r\nusuaris.name=Nom\r\nusuaris.dni=DNI\r\nusuauri.surname=Cognoms\r\n~~~~\r\n\r\nPer accedir aquest tipus de clau des d'una pàgina JSF es necessari\r\naccedir de la següent manera:\r\n\r\n**pageExemple.jsf**\r\n\r\n~~~~ {.code-java}\r\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\" standalone=\"yes\" ?>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\r\n    xmlns:ui=\"http://java.sun.com/jsf/facelets\"\r\n xmlns:f=\"http://java.sun.com/jsf/core\"\r\n xmlns:h=\"http://java.sun.com/jsf/html\"\r\n xmlns:c=\"http://java.sun.com/jstl/core\"\r\n xmlns:t=\"http://myfaces.apache.org/tomahawk\">\r\n \r\n<ui:composition template=\"../layouts/template.jsf\">\r\n   <h:outputText value=\"\\#{msg['usuaris.name']}\"/>\r\n</ui:composition>\r\n</html>\r\n~~~~\r\n\r\n## Exemples\r\n\r\n### Exemple de Test unitari\r\n\r\nCom a exemple d'utilització es mostra com podem fer una prova unitària:\r\n\r\n1.  Creem la classe de test 'I18nTest' i afegim un mètode 'testI18N()'\r\n2.  Creem els diferents fitxers de literals\r\n\r\n~~~~ {.code-java}\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(locations = {\"../canigo-core.xml\"})\r\npublic class I18nTest{\r\n    \r\n    @Autowired\r\n    I18nResourceBundleMessageSource messageResource;\r\n\r\n    @Test\r\n    public void testI18N() {\r\n       try {\r\n            Assert.assertEquals(\"Hola!\", messageResource.getMessage(\"var1\"));\r\n            Assert.assertEquals(\"Hi!\", messageResource.getMessage(\"var1\", Locale.UK));\r\n            Assert.assertEquals(\"Attaaaaaack!\", messageResource.getMessage(\"var1\", Locale.US));\r\n        }\r\n        catch(NoSuchMessageException ex){\r\n            Assert.assertTrue(\"var1 not found\", false);\r\n        }    \r\n    }\r\n}\r\n~~~~\r\n\r\nFitxers dels diferents idiomes (application_xx_XX.properties):\r\n\r\n-   **application.properties (fitxer per defecte)**\r\n\r\n    ~~~~ {.code-java}\r\n    var1=Hola!\r\n    ~~~~\r\n\r\n-   **application_en_US.properties (fitxer pel 'Locale' 'US')**\r\n\r\n    ~~~~ {.code-java}\r\n    var1=Attaaaaaack!\r\n    ~~~~\r\n\r\n-   **application_en_GB.properties (fitxer pel 'Locale' 'GB')**\r\n\r\n    ~~~~ {.code-java}\r\n    var1=Hi!\r\n    ~~~~","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1pbnRlcm5hY2lvbmFsaXR6YWNpbw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1sb2dnaW5nLWFkbWlu":{"date":1427449467000,"title":"Administració de logs","description":"Mòdul per administrar els logs de l'aplicació","sections":"Canigó. Documentació versió 3.x","weight":10,"path":"/canigo-documentacio-versions-3x-core/modul-logging-admin","content":"## Propòsit\r\n\r\nAquest mòdul permet administrar els logs de l'aplicació proporcionant les següents funcionalitats:\r\n\r\n* Canviar en calent el nivell de log dels diferents paquets de l'aplicació\r\n* Visualització de fitxers de logs en temps real mitjançant streaming amb WebSockets\r\n* Descarregar els fitxers de logs\r\n\r\n## Instal·lació i Configuració\r\n\r\n### Instal·lació\r\n\r\nLa instal·lació del Mòdul d'Administració de Logs es pot incloure automàticament a través del [Plugin de Canigó per a Eclipse](/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf), o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.operation.logging.version>[1.0.0,1.1.0)</canigo.operation.logging.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.operation.logging</artifactId>\r\n    <version>${canigo.operation.logging.version}</version>\r\n</dependency>\r\n```\r\nAquest mòdul requereix Java 7, per tant, cal tenir la següent configuració per la compilació amb Maven:\r\n\r\n```\r\n<plugin>\r\n    <artifactId>maven-compiler-plugin</artifactId>\r\n    <configuration>\r\n        <source>1.7</source>\r\n        <target>1.7</target>\r\n    </configuration>\r\n</plugin>\r\n```\r\n\r\n### Configuració\r\n\r\n#### Client\r\n\r\nSi s'utilitza el Plugin de Canigó per a Eclipse s'instal·la automàticament una plana \"loggingAdministration.html\" dins l'aplicació.  En cas de realitzar la instal·lació de forma manual s'ha de descarregar la [part estàtica](/related/canigo/documentacio/modul-logging/canigo.operation.logging_static.zip).\r\n\r\n<div class=\"message warning\">\r\nDes del CS Canigó no es realitzen adaptacions al <a href=\"http://www.gencat.cat/web/guies/estil/\">PIV de la Generalitat de Catalunya</a>. És responsabilitat del proveïdor d'aplicacions fer les adaptacions necessàries segons els requeriments que tingui l'aplicació.\r\n</div>\r\n\r\nEl contingut estàtic està preparat per a ser ubicat al directori `<aplicacio>\\src\\main\\webapp\\`. Si es vol canviar aquesta ubicació s'han de modificar les URLs existents en aquests fitxers.\r\n\r\n##### Keep Alive\r\n\r\nEl client implementa un procés de \"keep alive\" que s'executa cada 30 minuts. D'aquesta manera el servidor el considerarà com a actiu mentre no es tanqui aquesta plana \"loggingAdministration.html\".\r\n\r\n#### Servidor\r\n\r\nAquesta és l'API REST que publica el Mòdul d'Administració de Logs:\r\n\r\n * `<appContext>/api/logs/list` (GET): mostra la llista de loggers i els nivells (DEBUG, INFO, ERROR, FATAL, WARN)\r\n * `<appContext>/api/logs/appenders` (GET): mostra la llista d'appenders de tipus file\r\n * `<appContext>/api/logs/change` (PUT): canvia el nivell d'un logger\r\n * `<appContext>/api/logs/startwatch` (PUT): comença a monitorizar un fitxer de log\r\n * `<appContext>/api/logs/stopwatch`(PUT): deixa de monitorizar un fitxer de log\r\n * `<appContext>/api/logs/keepwatch`(PUT): missatge de monitorització activa (keep alive) per un fitxer de log\r\n * `<appContext>/api/logs/downloadLog/{index}` (GET): descarrega d'un fitxer de log\r\n\r\nLes URLs per accedir als serveis REST que ofereix aquest Mòdul d'Administració de Logs han estan definides tenint en compte que al fitxer de configuració `<aplicacio>\\src\\main\\webapp\\WEB-INF\\web.xml` es tingui configurat el DispatcherServlet de Spring per interceptar el patró **/api/***. En cas que es canviïn aquestes URLs caldrà revisar el client.\r\n\r\nPer tal d'evitar un deadlock en l'escriptura de logs a fitxer i el corresponent enviament de missatge a client, cal realitzar la següent configuració en el fitxer de configuració log4j.xml:\r\n\r\n```\r\n<category name=\"org.springframework.messaging.simp.broker.SimpleBrokerMessageHandler\">\r\n  <level value=\"off\" />\r\n</category>\r\n```\r\nAquesta configuració només serà necessària en cas que els logs de Spring s'escriguin en un appender de tipus file.\r\n\r\n##### Alliberament de recursos\r\n\r\nEl mòdul executa un procés cada 45 minuts que valida si s'ha rebut algun missatge de \"keep alive\" d'algun client per els fitxers de log configurats en l'aplicació. En cas que no haver rebut cap missatge per un fitxer de log concret en aquest periode de 45 minuts s'alliberaran els recursos associats per a la monitorització d'aquell fitxer (watcher thread).\r\n\r\n### Utilització del Mòdul\r\n\r\nPer a utilitzar el mòdul s'ha de desplegar l'aplicació i accedir-hi a `http://<host>:<port>/<appContext>/loggingAdministration.html`. Per exemple: `http:\\\\localhost:8080\\aplicacioProva\\loggingAdministration.html`\r\n\r\n![Pantalla Configuració nivells de log](/related/canigo/documentacio/modul-logging/configuracio_nivell_logs.png \"Configuració nivells de log\")\r\n\r\nLa pantalla inicial mostra els paquets de l'aplicació. Amb els botons DEBUG - INFO - ERROR - FATAL - WARN es pot modificar els nivell de log de cada paquet.\r\n\r\n\r\n![Pantalla Visualització fitxers de log](/related/canigo/documentacio/modul-logging/visualitzacio_fitxers_log.png \"Visualització fitxers de log\")\r\n\r\nEn aquesta segona pestanya es pot seleccionar el fitxer de log que es desitgi monitoritzar, prement el botó Connectar, o descarregar amb el botó Descarregar.\r\n\r\nAmb el cercador es pot resaltar en groc el text que es desitgi trobar.\r\n\r\n### Consideracions de seguretat\r\n\r\nEs recomana que aquest mòdul es securitzi per a que només els usuaris amb rol Administrador puguin accedir-hi, tant a la plana html, com als serveis REST del backend proporcionats al mòdul.\r\n\r\n### Demo\r\n\r\nDes del CS Canigó es proporciona una [demo online](http://canigo-admin-logs.eu-gb.mybluemix.net/loggingAdministration.html) d'aquest nou mòdul. Podeu trobar el codi font d'aquesta demo en el següent [repositori de Github](https://github.com/cs-canigo/demoAdminLogs).\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1sb2dnaW5nLWFkbWlu"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1tb25pdG9yaXR6YWNpbw==":{"date":1427453980000,"title":"Monitorització","description":"Monitorització de l'aplicació.","sections":"Canigó. Documentació versió 3.x","weight":8,"path":"/canigo-documentacio-versions-3x-core/modul-monitoritzacio","content":"## Introducció\r\n\r\nUn dels aspectes més innovadors de la nova versió 3 del Framework Canigó és la possibilitat de disposar inicialment d'un component de monitorització de l'aplicació sense haver de fer cap desenvolupament addicional per part dels desenvolupadors de les aplicacions. Aquest component permet:\r\n\r\n* Fer un seguiment de les peticions que rep l'aplicació.\r\n* Comprovar l'estat del sistema.\r\n* Administració dels paràmetres de configuració d'aquesta monitorització.\r\n\r\n### SEGUIMENT DE LES PETICIONS\r\n\r\nRespecte al tipus de peticions, l'eina visualitza:\r\n\r\n* Número de peticions.\r\n* Temps mitjà de les peticions.\r\n* Peticions errònies.\r\n\r\nLes peticions que es mostren són les efectuades contra el servidor d'aplicació des de que l'aplicació rep una petició fins que aquesta finalitza i la retorna al client.\r\n\r\n![Peticions per minut](/related/canigo/documentacio/modul-monitoritzacio/Peticions.jpg \"Peticions rebudes per minut\")  \r\nFigura 1 Nombre de peticions rebudes per minut\r\n\r\n![Temps de procés](/related/canigo/documentacio/modul-monitoritzacio/Temps.jpg \"Temps promig de procés\")  \r\nFigura 2 Temps promig en processar les peticions\r\n\r\n![Peticions errònies](/related/canigo/documentacio/modul-monitoritzacio/Error.jpg \"Nombre de peticions errònies\")  \r\nFigura 3 Nombre de peticions que han finalitzat amb error (no controlat)\r\n\r\n### COMPROVACIÓ DE L'ESTAT DEL SISTEMA\r\n\r\nEn aquesta part de la monitorització es podrà visualitzar l'estat de les diferents parts del sistema configurades (per configurar aquesta part de la monitorització mirar el mòdul d'instrumentació), com podria ser la comprovació de la connectivitat contra base de dades o contra un servei web.\r\n\r\nLa informació d'aquesta funcionalitat es mostrarà en una taula amb la següent informació:\r\n\r\n* Mètode\r\n* Temps transcorregut (ms)\r\n* Estat\r\n\r\n![Estat del sistema](/related/canigo/documentacio/modul-monitoritzacio/Estat.jpg \"Estat del sistema\")  \r\nFigura 4 Taula d'informació de l'estat del sistema\r\n\r\n### ADMINISTRACIÓ DELS PARÀMETRES DE CONFIGURACIÓ\r\n\r\nPer últim l'eina també ofereix la possibilitat de configurar la longitud de les mostres que apareixen en les gràfiques i l'interval de mostreig entre mostres. Per defecte ofereix una visualització de l'evolució de les peticions de 8 hores amb intervals de 1 minut.\r\n\r\n![Configuració gràfiques](/related/canigo/documentacio/modul-monitoritzacio/Config.jpg \"Configuració gràfiques\")  \r\nFigura 5 Pantalla de configuració per a les gràfiques de monitorització","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1tb25pdG9yaXR6YWNpbw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1zZWd1cmV0YXQ=":{"date":1427968134000,"title":"Seguretat","description":"Autentificació i autorització d'usuaris.","sections":"Canigó. Documentació versió 3.x","weight":9,"path":"/canigo-documentacio-versions-3x-core/modul-seguretat","content":"## Propòsit\r\n\r\nEl Servei de Seguretat té com a propòsit principal gestionar l'autentificació i l'autorització dels usuaris de les nostres aplicacions. L'objectiu de l'autentificació és comprovar que l'usuari és qui diu ser, mentre que l'autorització s'encarrega de comprovar que realment té accés al recurs sol.licitat.\r\n\t\r\n<div class=\"message warning\">\r\nL'especificació JAAS (Java Authorization and Authentication) de J2EE proporciona els mecanismes necessaris de seguretat. Cada servidor d'aplicacions pot implementar l'estàndard però ho fa de diferents formes produint problemes de compatibilitat.  \r\nL'especificació JAAS s'orienta principalment a temes d'autentificació, mentre que els temes d'autorització pateixen de moltes carències.\r\n</div>\r\n\r\nActualment, i a causa del seu grau de maduresa i facilitat Canigó recomana l'ús de 'Spring Security 3.0' com framework base i les extensions que Canigó proporciona.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal- lar el mòdul de seguretat es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.security.version>[1.1.0,1.2.0)</canigo.security.version>\r\n<spring.security.facelets.tag.support.version>[1.0.0,1.1.0)</spring.security.facelets.tag.support.version>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.security</artifactId>\r\n\t<version>${canigo.security.version}</version>\r\n</dependency>\r\n<dependency>\r\n\t<groupId>org.springframework.security.taglibs</groupId>\r\n\t<artifactId>spring.security.facelets.tag.support</artifactId>\r\n\t<version>${spring.security.facelets.tag.support.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament i es descompon en les parts següents:\r\n\r\n* Configuració dels filtres de l'aplicació Web\r\n* Configuració de l'Autenticació\r\n* Configuració de l'Autorització\r\n* Configuració de la font de dades de l'esquema de seguretat\r\n* Configuració tags de seguretat en les pàgines\r\n\r\n#### Configuració dels filtres de l'aplicació Web\r\n\r\nSpring Security utilitza un conjunt de filtres per a detectar aspectes de l'autorització i autentificació. Per a fer-los servir definirem en el fitxer 'WEB-INF/web.xml el codi següent:\r\n\r\n```\r\n<filter>\r\n    <filter-name>springSecurityFilterChain</filter-name>\r\n    <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>\r\n</filter>\r\n<filter-mapping>\r\n    <filter-name>springSecurityFilterChain</filter-name>\r\n    <url-pattern>/*</url-pattern>\r\n</filter-mapping>\r\n```\r\n\r\nPer a més informació consultar la pàgina http://static.springsource.org/spring-security/site/docs/3.0.x/reference/security-filter-chain.html\r\n\r\n#### Configuració de l'Autenticació\r\n\r\nEn la configuració de l'Autentificació tindrem en consideració:\r\n\r\n* Seleccionar la configuració de la font en que es realitza l'autentificació (per arxiu de propietats, base de dades, LDAP, per servei integrador al servidor corporatiu basat en HTTPS, ...)\r\n* Configurar el formulari d'autentificació web i la seqüència de cerca on ha de realitzar-se l'autentificació.\r\n\r\nDins d'aquest mòdul trobem els següents proveidors de seguretat:\r\n\r\n* Seguretat InMemory\r\n* Seguretat Base de dades\r\n* Seguretat LDAP\r\n* Seguretat GICAR\r\n* Seguretat SACE\r\n\r\nEls diferents proveidors comparteixen els següents arxius de configuració:\r\n\r\n* security.properties: Propietats del servei de seguretat\r\n* app-custom-security.xml: Arxiu XML amb la configuració de seguretat.\r\n* security.users.properties: Llistat en format pla dels usuaris/password/rols de l'aplicació per al proveidor \"InMemory\".\r\n\r\nLa disposició dels arxius és la següent:\r\n\r\n* Ubicació: <PROJECT_ROOT>/src/main/resources/config/props/security.users.properties\r\n* Ubicació: <PROJECT_ROOT>/src/main/resources/spring/app-custom-security.xml\r\n* Ubicació: <PROJECT_ROOT>/src/main/resources/config/props/security.properties\r\n\r\n```\r\n<security:http pattern=\"/css/**\" security=\"none\"/>\r\n<security:http pattern=\"/images/**\" security=\"none\"/>\r\n<security:http pattern=\"/js/**\" security=\"none\"/>\r\n\r\n<!--  Secure patterns -->\r\n<security:http>\r\n  \t<security:intercept-url pattern=\"/**/views/login.xhtml\" \t\taccess=\"IS_AUTHENTICATED_ANONYMOUSLY\" />\r\n\t<security:intercept-url pattern=\"/**/views/logout.xhtml\" \t\t\taccess=\"IS_AUTHENTICATED_ANONYMOUSLY\"/>\r\n\t<security:intercept-url pattern=\"/**/views/monitoring.xhtml\"\t\taccess=\"ROLE_ADMIN\" />\r\n\t<security:intercept-url pattern=\"/**/views/propertyExpose.xhtml\"\taccess=\"ROLE_ADMIN\" />\r\n\t<security:intercept-url pattern=\"/**/views/moduleList.xhtml\"\t\taccess=\"ROLE_ADMIN\" />\r\n\t<security:intercept-url pattern=\"/**/views/logReader.xhtml\" \t\taccess=\"ROLE_ADMIN\"/>\r\n\t<security:intercept-url pattern=\"/**/views/**\" \t\t\t\t\taccess=\"ROLE_USER\"/>\r\n\r\n\t    \r\n\t<security:form-login \tlogin-processing-url=\"/AppJava/j_spring_security_check\"\r\n\t\t\t\t\t\t\tlogin-page=\"/AppJava/views/login.xhtml?set-locale=ca_ES\" \r\n\t\t\t\t\t\t\tauthentication-failure-url=\"/AppJava/views/login.xhtml?set-locale=ca_ES&amp;error=1\"/>\r\n\t<security:logout logout-url=\"/AppJava/views/logout.xhtml\" />\r\n\t<security:access-denied-handler error-page=\"/views/accessDenied.xhtml\"/>\r\n\t\t\r\n</security:http>\r\n\t\r\n<security:authentication-manager>\r\n\r\n<!--Proveidor de seguretat-->\r\n\r\n</security:authentication-manager>\r\n```\r\n\r\n#### Configuració de la Font d'Autorització per base de dades\r\n\r\nPer a configurar la font d'autorització mitjançant base de dades és necessari:\r\n\r\n* Configurar l'arxiu de propietats security.properties.\r\n* Conigurar el proveidor de seguretat dins de la configuració de seguretat de Spring.\r\n\r\nEls dos arxius es generen i configuren de manera automàtica mitjançant l'eina de desenvolupament.\r\n\r\nLes propietats de l'arxiu security.properties son les següents:\r\n\r\nPropietat                    | Requerit | Descripció\r\n---------------------------- | -------- | ----------------------------------------------------------\r\n*.security.database.jndiName | Si       | Nom JNDI d'accés a la BD. Obligatori per a connexions JNDI\r\n*.security.database.url      | Si       | URL de connexió a la base de dades\r\n*.security.database.username | Si       | Usuari de connexió a la base de dades\r\n*.security.database.password | Si       | Password de connexió a la base de dades\r\n\r\nLa configuració del provider en app-custom-security.xml per aquest proveidor és la següent:\r\n\r\n* Afegim el provider al authentication manager.\r\n* Afegim el tipus de codificador de password per tal de comparar el password de base de dades i el que ens ha proporcionat l'usuari de l'aplicació. Aquest codificador suporta: plaintext, sha, sha-256, md5, md4, ssha. Si en la base de dades tenim emmagatzemat els password d'usuari en md5, i marquem \"password-encode\" com a md5, de manera automàtica, el password proporcionat per l'usuari via formulari de login (j_password) es codificarà en md5 per posteriorment ser comparat amb el emmagatzemat a la base de dades.\r\n\r\n```\r\n<security:authentication-manager>\r\n\t<security:authentication-provider>\r\n                <security:password-encoder hash=\"plaintext\"/>\r\n\t\t<security:jdbc-user-service data-source-ref=\"dataSource\"/>\r\n\t</security:authentication-provider>\r\n</security:authentication-manager>\r\n```\r\n\r\n<div class=\"message warning\">\r\nAccés base de dades\r\n\r\nL'eina de suport al desenvolupament automatitza la instal- lació del mòdul de persistència si aquest no ha estat instal- lat prèviament pel desenvolupador.\r\n</div>\r\n\r\n#### Configuració de l'Autorització per SACE\r\n\r\nPer a configurar l'acces a SACE és necessari:\r\n\r\n* Configurar l'arxiu de propietats security.properties.\r\n* Conigurar el proveidor de seguretat dins de la configuració de seguretat de Spring.\r\n\r\nEls dos arxius es generen i configuren de manera automàtica mitjançant l'eina de desenvolupament.\r\n\r\nLes propietats de l'arxiu **security.properties** son les següents:\r\n\r\nPropietat                                  | Requerit | Descripció\r\n------------------------------------------ | -------- | --------------------------------------------------------------------------------------\r\n*.security.sace.userNameFormat             | No       | Format del camp userName. Per defecte: NIF. Valors possibles: NIF, INTERNAL_CODE\r\n*.security.sace.authoritiesbyUserNameQuery | No       | Aquesta propietat permet especificar la query SQL per a recollir els rols dels usuaris\r\n*.security.sace.keyStore                   | Si       | Localització de la keystore\r\n*.security.sace.keyStorePassPhrase         | Si       | Password de la keystore\r\n*.security.sace.url                        | Si       | URL del servei de SACE\r\n\r\n<div class=\"message warning\">\r\nCertificats/keystore<br>\r\nCal tenir el contenidor de certificats desplegat amb l'aplicació per a poder fer la connexió correctament amb SACE. Per això és important que tingueu aquest fitxer dins el vostre projecte normalment dins \"src/main/resources/keystore\" i així es desplegarà dins \"WEB-INF/classes/keystore\". A més cal que configureu les dues propietats \"keyStore\" i \"keyStorePassPhrase\". La paraula clau del contenidor que us hemo posat disponible és \"saceTrust_pre2007\"\r\n</div>\r\n\r\nLa configuració del proveidor dins de l'ariux de **app-custom-security.xml**:\r\n\r\n```\r\n<security:authentication-manager>\r\n\t<security:authentication-provider ref=\"saceProvider\"/>\r\n</security:authentication-manager>\r\n\r\n<bean id=\"saceProvider\" class=\"cat.gencat.ctti.canigo.arch.security.provider.sace.SACEAuthenticationProvider\">\r\n\t<description>SACE Provider</description>\r\n\t<property name=\"authenticationDao\" ref=\"saceAuthenticationDao\"/>\r\n</bean>\r\n\r\n<bean id=\"saceAuthenticationDao\" class=\"cat.gencat.ctti.canigo.arch.security.SACEPasswordAuthenticationDaoStub\">\r\n\t<description>SACE Authentication DAO</description>\r\n\t<property name=\"i18nResourceBundleMessageSource\" ref=\"messageSource\" />\r\n\t<property name=\"userNameFormat\" value=\"${security.sace.userNameFormat}\" />\r\n\t<property name=\"hostName\" value=\"${security.sace.url}\" />\r\n\t<property name=\"keyStore\" value=\"${security.sace.keyStore}\" />\r\n\t<property name=\"keyStorePassPhrase\" value=\"${security.sace.keyStorePassPhrase}\" />\r\n\t<property name=\"authoritiesDAO\" ref=\"saceAuthoritiesDAO\"/>\r\n</bean>\r\n\r\n<bean id=\"saceAuthoritiesDAO\" class=\"cat.gencat.ctti.canigo.arch.security.provider.sace.authorities.AuthoritiesDAOImpl\">\r\n\t<description>Authorities DAO implementation for SACE. Gets granted authorities for specified user</description>\r\n\t<property name=\"authoritiesByUsernameQuery\" value=\"${security.sace.authoritiesbyUserNameQuery:#{null}}\"/>\r\n\t<property name=\"dataSource\" ref=\"dataSource\"/>\r\n</bean>\r\n```\r\n\r\n<div class=\"message warning\">\r\nConnexió a SACE<br>\r\nPer a realitzar les proves en desenvolupament podem instal- lar un VPN Client per connectar-se al servidor SACE (consultar el document 'Directori Corporatiu de la Generalitat de Catalunya - Guia d'integració d'aplicacions v3.7').ç\r\n</div>\r\n\r\n#### Configuració de l'Autorització per LDAP\r\n\r\nPer a configurar l'acces a LDAP és necessari:\r\n\r\n* Configurar l'arxiu de propietats security.properties.\r\n* Conigurar el proveidor de seguretat dins de la configuració de seguretat de Spring.\r\n\r\nEls dos arxius es generen i configuren de manera automàtica mitjançant l'eina de desenvolupament.\r\n\r\nLes propietats de l'arxiu security.properties son les següents:\r\n\r\nPropietat                           | Requerit | Descripció\r\n----------------------------------- | -------- | -----------------------------------------------------------------------\r\n*.security.ldap.url                 | Si       | Direcció del servidor ldap separat amb dos punts \":\" del port\r\n*.security.ldap.manager.dn          | Sí       | Identificador de l'usuari administrador del LDAP\r\n*.security.ldap.manager.password    | Si       | Password del l'usuari administrador del LDAP\r\n*.security.ldap.user.search.filter  | No       | Filtre de cerca dels usuaris dintre de l'estructura del LDAP. Per defecte: (uid={0})\r\n*.security.ldap.user.search.base    | Si       | String base de la ubicació dels usuaris dintre de l'estructura del LDAP\r\n*.security.ldap.group.search.base   | Si       | String base de la ubicació dels grups dintre de l'estructura del LDAP\r\n*.security.ldap.group.search.filter | No       | Filtre de cerca dels grups dintre de l'estructura del LDAP. Per defecte: (cn={0})\r\n\r\nPer a realitzar les proves en desenvolupament podem instal- lar un servidor LDAP senzill (veure l'apartat 'Eines de Suport' per a més referència).\r\n\r\nConfiguració del provider en **app-custom-security.xml**:\r\n\r\n* Afegim el provider al authentication manager.\r\n* Afegim la connexió al LDAP server\r\n\r\n```\r\n<security:authentication-manager>\r\n    <security:ldap-authentication-provider\r\n        server-ref=\"ldapLocal\"\r\n        user-search-filter=\"${security.ldap.user.search.filter:(uid={0})}\"\r\n        user-search-base=\"${security.ldap.user.search.base}\"\r\n        group-search-base=\"${security.ldap.group.search.base}\"\r\n        group-search-filter=\"${security.ldap.group.search.filter:(cn={0})}\">\r\n\r\n        <security:password-compare/>\r\n    </security:ldap-authentication-provider>\r\n</security:authentication-manager>\r\n\r\n<security:ldap-server url=\"${security.ldap.url}\" id=\"ldapLocal\" manager-dn=\"${security.ldap.manager.dn}\"\r\nmanager-password=\"${security.ldap.manager.password}\"/>\r\n```\r\n\r\n#### Configuració de l'Autorització per arxiu de propietats\r\n\r\nAquest proveidor de seguretat es recolça en un arxiu de propietats per carregar en memòria els usuaris/password/rols de l'aplicació.\r\n\r\nPer a configurar l'acces mitjançant un arxiu de propietats és necessari:\r\n\r\n* Configurar l'arxiu de propietats **security.users.properties**.\r\n* Conigurar el proveidor de seguretat dins de la configuració de seguretat de Spring (**app-custom-security.xml**).\r\n\r\nL'arxiu que conté aquesta configuració **security.users.properties** te el següent format:\r\n\r\n    username=password,grantedAuthority[,grantedAuthority][,enabled|disabled]\r\n\r\nExemple de configuració:\r\n\r\n```\r\nuser=password,ROLE_USER,enabled\r\nadmin=password,ROLE_USER,ROLE_ADMIN,enabled\r\n```\r\n\r\n#### Configuració del provider en **app-custom-security.xml**:\r\n\r\n* Afegim el provider al authentication manager.\r\n* Afegim el tipus de codificador de password per tal de comparar el password de l'arxiu de propietats i el que ens ha proporcionat l'usuari de l'aplicació. Aquest codificador suporta: plaintext, sha, sha-256, md5, md4, ssha.\r\n\r\n```\r\n<security:authentication-manager>\r\n\t<security:authentication-provider>\r\n\t\t<security:password-encoder hash=\"plaintext\"/>\r\n\t\t<security:user-service properties=\"classpath:/config/props/security.users.properties\"/>\r\n\t</security:authentication-provider>\r\n</security:authentication-manager>\r\n```\r\n\r\n#### Configuració de la Font d'Autorització per GICAR\r\n\r\nPer a configurar l'acces a GICAR és necessari:\r\n\r\n* Configurar l'arxiu de propietats **security.properties**.\r\n* Configurar el proveidor de seguretat dins de la configuració de seguretat de Spring.\r\n\r\nEls dos arxius es generen i configuren de manera automàtica mitjançant l'eina de desenvolupament:\r\n\r\nLes propietats de l'arxiu **security.properties** son les següents:\r\n\r\nPer a configurar l'acces a GICAR és necessari configurar l'arxiu de propietats **security.properties**. Aquest arxiu es genera automàticament des de l'eina de suport, i te el següent format:\r\n\r\nPropietat                                   | Requerit | Descripció\r\n------------------------------------------- | -------- | -----------------------------------\r\n*.security.gicar.httpGicarHeaderUsernameKey | No       | Aquesta propietat indica quin és el camp de la capçalera HTTP_GICAR que conté el nom de l'usuari autenticat a GICAR. Per defecte: NIF\r\n\r\nLa configuració específica del proveidor és el següent:\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans \txmlns=\"http://www.springframework.org/schema/beans\"\r\n\t\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\t\txmlns:security=\"http://www.springframework.org/schema/security\"\r\n\t\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \thttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd\r\n\t\t\t\t\t       http://www.springframework.org/schema/security \thttp://www.springframework.org/schema/security/spring-security-3.0.xsd\">\r\n\r\n\t<security:http pattern=\"/css/**\" security=\"none\"/>\r\n\t<security:http pattern=\"/images/**\" security=\"none\"/>\r\n\t<security:http pattern=\"/js/**\" security=\"none\"/>\r\n\r\n\t<!--  Secure patterns -->\r\n\t<security:http>\r\n  \t    <security:intercept-url pattern=\"/**/views/login.xhtml\" \t\t\taccess=\"IS_AUTHENTICATED_ANONYMOUSLY\" />\r\n\t    <security:intercept-url pattern=\"/**/views/logout.xhtml\" \t\t\taccess=\"IS_AUTHENTICATED_ANONYMOUSLY\"/>\r\n\t    <security:intercept-url pattern=\"/**/views/monitoring.xhtml\"\t\taccess=\"ROLE_ADMIN\" />\r\n\t    <security:intercept-url pattern=\"/**/views/propertyExpose.xhtml\"\taccess=\"ROLE_ADMIN\" />\r\n\t    <security:intercept-url pattern=\"/**/views/moduleList.xhtml\"\t\taccess=\"ROLE_ADMIN\" />\r\n\t    <security:intercept-url pattern=\"/**/views/logReader.xhtml\" \t\taccess=\"ROLE_ADMIN\"/>\r\n\t    <security:intercept-url pattern=\"/**/views/**\" \t\t\t\t\taccess=\"ROLE_USER\"/>\r\n\r\n\r\n\t    <security:logout logout-url=\"/views/logout.xhtml\" />\r\n\t    <security:access-denied-handler error-page=\"/views/accessDenied.xhtml\"/>\r\n\t\t\r\n\t<!-- GICAR -->\r\n\t    <security:form-login login-processing-url=\"/j_spring_security_check\" login-page=\"/j_spring_security_check\" />\r\n\t    <security:custom-filter ref=\"proxyUsernamePasswordAuthenticationFilter\" before=\"FORM_LOGIN_FILTER\" />\r\n\t</security:http>\r\n\r\n\t<security:authentication-manager alias=\"authenticationManager\">\r\n\t\t<!-- GICAR -->\r\n\t\t<security:authentication-provider ref=\"gicarProvider\"/>\r\n\t</security:authentication-manager>\r\n\r\n\t<!-- GICAR -->\r\n\t<bean id=\"proxyUsernamePasswordAuthenticationFilter\" class=\"cat.gencat.ctti.canigo.arch.security.authentication.ProxyUsernamePasswordAuthenticationFilter\">\r\n\t\t<property name=\"siteminderAuthentication\" \t\tvalue=\"true\" />\r\n\t\t<property name=\"authenticationManager\" \t\t\tref=\"authenticationManager\" />\r\n\t\t<property name=\"authenticationFailureHandler\" \tref=\"failureHandler\" />\r\n\t</bean>\r\n\r\n\t<bean id=\"failureHandler\" class=\"org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler\">\r\n\t\t<property name=\"defaultFailureUrl\" value=\"/gicar-error.html\" />\r\n\t</bean>\r\n\r\n\t<bean id=\"gicarProvider\" class=\"cat.gencat.ctti.canigo.arch.security.provider.siteminder.SiteminderAuthenticationProvider\">\r\n\t\t<description>GICAR Provider</description>\r\n\t\t<property name=\"userDetailsService\" ref=\"gicarUserDetailsService\"/>\r\n\t</bean>\r\n\r\n\t<bean id=\"gicarUserDetailsService\" class=\"cat.gencat.ctti.canigo.arch.security.provider.gicar.GICARUserDetailsServiceImpl\">\r\n\t\t<description>User Detail service implementation for GICAR provider</description>\r\n\t\t<property name=\"httpGicarHeaderUsernameKey\" value=\"${security.gicar.httpGicarHeaderUsernameKey:NIF}\"/>\r\n\t\t<property name=\"authoritiesDAO\" ref=\"authoritiesDAO\"/>\r\n\t</bean>\r\n\r\n\t<bean id=\"authoritiesDAO\" class=\"cat.gencat.ctti.canigo.arch.security.provider.sace.authorities.AuthoritiesDAOImpl\">\r\n\t\t<description>Authorities DAO implementation for SACE. Gets granted authorities for specified user</description>\r\n\t\t<property name=\"dataSource\" ref=\"dataSource\"/>\r\n\t</bean>\r\n</beans>\r\n```\r\n\r\nAmb aquesta configuració ha de ser possible autoritzar un usuari que prèviament ha estat auntenticat en el servei de GICAR. Per aquest motiu és necessari rebre certes dades referents a aquesta autenticació ja realitzada. A la capçalera HTML podrem accedir a aquestes dades:\r\n\r\n```\r\nHTTP_GICAR=CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;\r\nUNITAT_MENOR=CTTI Qualitat\r\n```\r\n\r\nOn CODIINTERN és el codi intern, el NIF el NIF, EMAIL l'adreça de correu electrònic registrada al Director Corporatiu, UNITAT_MAJOR és l'organització i UNITAT_MENOR és la unitat.\r\n\r\n<div class=\"message warning\">\r\nEn cas de que l'aplicació utilitzi la separació entre codi estàtic i dinàmic és necessari indicar la següent propietat dintre del bean proxyUsernamePasswordAuthenticationFilter:\r\n<br><br>\r\n\r\n<b>&lt;property name=\"filterProcessesUrl\" value=\"/AppJava/j_spring_security_check\" /&gt;</b>\r\n\r\n</div>\r\n\r\n**Logout**\r\n\r\nPer tots els mètodes d'autentificació, el procediment de logoff consisteix en invalidar la sessió, forçant així que el servei de seguretat intervingui en la següent petició solicitant la nova identificació de l'usuari.\r\n\r\nEn el cas de Gicar, però, aquesta autentificació és realitzada per un sistema extern a l'aplicació i, per tant, s'ha de comunicar a aquest sistema extern la intenció de fer el logoff. El mecanisme previst per fer-ho consisteix en una URL de Gicar que, al ser invocada, realitza el logoff.\r\n\r\nAquest enllaç de logout és depenent de l'agent de SiteMinder que l'aplicació fa servir per a comunicar-se amb el Policy Server.\r\n\r\nAixí doncs, els enllaços de logout són els següents:\r\n\r\n* Per a una aplicació ubicada en els apaches corporatius de internet: http://sso.gencat.cat/siteminderagent/forms/logoff.html\r\n* Per a una aplicació ubicada en els apaches corporatius de intranet: http://sso.gencat.intranet/siteminderagent/forms/logoff.html\r\n* Per a una aplicació amb apache \"pròpi\": http://****.gencat.***/siteminderagent/forms/logoff.html;\r\n\r\n#### Configuració tags de seguretat en les pàgines\r\n\r\nSpring Security permet incorporar tags a les pàgines JSP/JSF per tal de controlar la lògica d'aquesta segons els rols de l'usuari.\r\n\r\n**Configuració JSF\r\n\r\nPer a incorporar els tags dins de la JSF s'ha de referenciar el espai de noms (nameSpace) de seguretat dins del tag HTML de la pàgina:\r\n\r\n```\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\r\n\txmlns:ui=\"http://java.sun.com/jsf/facelets\"\r\n\txmlns:f=\"http://java.sun.com/jsf/core\"\r\n\txmlns:h=\"http://java.sun.com/jsf/html\"\r\n\txmlns:c=\"http://java.sun.com/jstl/core\"\r\n\txmlns:sec=\"http://www.springframework.org/security/facelets/tags\">\r\n....\r\n....\r\n....\r\n</html>\r\n```\r\n\r\nUna vegada definida la referència a la llibreria i el seu prefix 'sec', podem incorporar els següents tags a la pàgina JSF:\r\n\r\nPropietat     | Requerit | Valor\r\n------------- | -------- | ------------------------------------------------------------------------------------------------------------\r\nifAllGranted  | No       | L'usuari ha de tenir tots els rols de l'atribut \"roles\" perquè el contingut dins del tag (body) sigui mostrat.\r\nifAnyGranted: | No       | L'usuari ha de tenir qualsevol dels rols de l'atribut \"roles\" perquè el contingut dins del tag (body) sigui mostrat.\r\nifNotGranted  | No       | L'usuari no ha de tenir cap dels rols de l'atribut \"roles\" perquè el contingut dins del tag (body) sigui mostrat.\r\n\r\nExemple:\r\n\r\n```\r\n<sec:ifAnyGranted roles=\"ROLE_USER, ROLE_ADMIN\">\r\n    <h:outputText>\r\n       Només visible per usuaris que tinguin el ROLE_USER o ROLE_ADMIN.\r\n       Un usuari amb només el rol ROLE_GESTOR no podria visualitzar el contingut.\r\n    </h:outputText>\r\n</sec:ifAnyGranted>\r\n\r\n<sec:ifAllGranted roles=\"ROLE_USER, ROLE_ADMIN\">\r\n   <h:outputText>Només visible per a usuaris que tinguin els dos rols (ROLE_USER, ROLE_ADMIN) assignats.</h:outputText>\r\n</sec:ifAllGranted>\r\n\r\n<sec:ifNotGranted roles=\"ROLE_USER\">\r\n   <h:outputText>Visible per a usuaris que no tinguin assignat el rol \"ROLE_USER\"</h:outputText><br/>\r\n</sec:ifNotGranted>\r\n```\r\n\r\n**Configuració Struts/Taglib**\r\n\r\nDes de la versió JSP 1.2 no és necessari configurar en el fitxer 'web.xml' la referència a les llibreries. Podem referenciar directament per mitjà d'una url el jar, tal com es mostra a continuació:\r\n\r\n    <%@ taglib prefix=\"sec\" uri=\"http://www.springframework.org/security/tags\" %>\r\n\r\nExemple de text només visible per administradors:\r\n\r\n```\r\n<sec:authorize access=\"hasRole('ROLE_ADMIN')\">\r\nText només visible per un administrador\r\n</sec:authorize>\r\n\r\n<sec:authorize access=\"hasAnyRole('ROLE_ADMIN, ROLE_USER')\">\r\nText només visible per un usuari amb rol \"ROLE_ADMIN\" i/o \"ROLE_USER\".\r\n</sec:authorize>\r\n```\r\n\r\nPer a més informació sobre el tag \"sec\", consultar la pàgina [Spring Security 3.x Taglib](http://static.springsource.org/spring-security/site/docs/3.1.x/reference/taglibs.html)\r\n\r\n## Eines de Suport\r\n\r\n### Servidor LDAP de proves: openLDAP\r\n\r\nEls diferents passos per a instal- lar openLDAP i importar un directori LDAP d'exemple són:\r\n\r\n* Baixar openLDAP per a Windows http://sourceforge.net/projects/openldapwindows/ i instal- lar-ho.\r\n* Canviar la configuració per defecte de openldap. Copiar les dades següents en un fitxer slapd.conf. Copiarem el slapd.conf en la mateixa carpeta que openLDAP.\r\n\r\n```\r\n#######################################################################\r\n# See slapd.conf(5) for details on configuration options.\r\n# This file should NOT be world readable.\r\n#######################################################################\r\nucdata-path ./ucdata\r\ninclude ./etc/schema/core.schema\r\ninclude ./etc/schema/cosine.schema\r\ninclude ./etc/schema/inetorgperson.schema\r\n\r\n# Define global ACLs to disable default read access.\r\n\r\n# Do not enable referrals until AFTER you have a working directory\r\n# service AND an understanding of referrals.\r\n#referral ldap://root.openldap.org\r\n\r\npidfile ./var/run/slapd.pid\r\nargsfile ./var/run/slapd.args\r\n\r\n#######################################################################\r\n# BDB database definitions\r\n#######################################################################\r\n\r\n###database bdb\r\n###suffix \"dc=my-domain,dc=com\"\r\n###rootdn \"cn=Manager,dc=my-domain,dc=com\"\r\n\r\ndatabase bdb\r\nsuffix dc=\"mycompany\",dc=\"com\"\r\nrootdn \"cn=Manager,dc=mycompany,dc=com\"\r\n\r\nrootpw secret\r\nEines de Suport\r\n\r\ndirectory ./var/openldap-data\r\nindex objectClass eq\r\n```\r\n\r\n* Obrir una pantalla \"DOS command\", anar a la carpeta on hem instal- lat el programa i arrancar openLDAP amb la comanda\r\n\r\n```\r\n.\\slapd -d 1\r\n```\r\n\r\nSi tot ha funcionat bé, hauríem de veure una sortida com la següent:  \r\n    \r\n![Execució Open LDAP](/related/canigo/documentacio/modul-seguretat/ServeiSeguretat_img012.jpg.gif)\r\n\r\n* Copiar les dades següents en un fitxer setup.ldif. Aquest fitxer conté un directori LDAP de l'empresa \"mycompany.com\" amb 2 persones: \"gestoruser\" i \"usuari\". Copiarem el setup.ldif en la mateixa carpeta que openLDAP.\r\n\r\n```\r\n### Top level definition\r\n#dn: dc=mycompany,dc=com\r\n#objectClass: top\r\n#objectClass: dcObject\r\n#objectClass: domain\r\n#dc: mycompany\r\n\r\n### organizationalUnit : PEOPLE\r\n# Definition of people\r\ndn: ou=people,dc=mycompany,dc=com\r\nobjectClass: top\r\nobjectClass: organizationalUnit\r\nou: people\r\n\r\n# Gestor User\r\ndn: uid=gestoruser,ou=people,dc=mycompany,dc=com\r\nobjectClass: person\r\nobjectClass: inetOrgPerson\r\ncn: State App\r\ndisplayName: App Admin\r\ngivenName: App\r\nmail: gestor@fake.org\r\ntitle: ROLE_ADMIN\r\nsn: Gestor\r\nuid: gestoruser\r\nuserPassword: gestorpassword\r\n\r\n# usuario normal\r\ndn: uid=usuario,ou=people,dc=mycompany,dc=com\r\nobjectClass: person\r\nobjectClass: inetOrgPerson\r\ncn: State App\r\ndisplayName: App Admin\r\ngivenName: App\r\nmail: usuario@fake.org\r\ntitle: ROLE_USER\r\nsn: Usuario\r\nuid: usuario\r\nuserPassword: usuariopassword\r\n```\r\n\r\nObrir una altra pantalla \"DOS command\", anar a la carpeta on hem instal- lat el programa i importar les dades amb la comanda:\r\n\r\n```\r\nldapadd -x -D \"cn=Manager,dc=mycompany,dc=com\" -W -f setup.ldif\r\n```\r\n\r\nLa contrasenya per defecte és \"secret\".\r\n\r\n### Jxplorer\r\n\r\nComprovarem que la importació de dades ha funcionat amb Jxplorer, un client LDAP Java i opensource.\r\n\r\n* Baixar Jxplorer a la url http://sourceforge.net/projects/jxplorer/ i instal- lar-ho\r\n* Prémer el botó per a connectar-se al nostre directori LDAP.\r\n\r\nLa contrasenya per defecte és \"secret\". La pantalla següent mostra els valors de la diferents paràmetres:\r\n\r\n![Configuració paràmetres JXplorer](/related/canigo/documentacio/modul-seguretat/ServeiSeguretat_img013.jpg.gif)\r\n\r\nSi tot ha funcionat bé, hauríem de veure la pantalla següent:\r\n\r\n![Resultat JXplorer](/related/canigo/documentacio/modul-seguretat/ServeiSeguretat_img014.jpg.gif)\r\n\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1zZWd1cmV0YXQ="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXdlYnNlcnZpY2Vz":{"date":1427976156000,"title":"Webservices","description":"Webservices","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-altres/modul-webservices","content":"## Propòsit\r\n\r\nEl propòsit d'aquest apartat es introduir al desenvolupador en la configuració i ús d'una infraestructura de Webservices en dues modalitats:\r\n\r\n* Exportació de serveis Java mitjançant Web Services.\r\n* Importació de Web Services externs, generació si cal de classes Java d'invocació.\r\n\r\nJa que Canigó 3 no disposa d'un servei addicional de Webservices, l'enfocament d'aquest apartat es el de simplificar tant la definició de Web Services a partir de serveis Java simples (que no tindran dependències amb la implementació particular de Web Services) així com la de facilitar la invocació a Web Services externs.\r\n\r\nPer aquesta aproximació s'ha fet servir Spring WS, JAXB i OXM.\r\n\r\n## Context i Escenaris d'Ús\r\n\r\nLa integració de WebServices no es troba ubicat dins del framework de Canigó com a un servei addicional. Ens recolzarem en les classes de Spring WS per a realitzar els exemples d'integració.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nReferència | URL\r\n---------- | ---\r\nSpring Web Services | http://static.springsource.org/spring-ws/sites/2.0/reference/html/\r\n\r\n## Glossari\r\n\r\n**EndPoint**\r\n\r\nUna interfície endpoint, també coneguda com a interfície de servei endpoint (SEI), és un terme utilitzat en la plataforma J2EE quan s'exposa un Enterprise Java Bean com a servei web. Un client accedeix a partir d'aquesta interfície, que com a totes les interfícies, defineix el mètodes de negoci del bean.\r\n\r\n**OXM**\r\n\r\nLa API OXM (spring-oxm.jar) proporciona integració entre les APIs més populars de marshalling de XML (JAXB1, JAXB2, Castor, Jibx).\r\n\r\n**JAXB**\r\n\r\nJava Architecture for XML Binding (JAXB) és una API que proporcionar als desenvolupadors una eina de mapping de classes Java a la seva representació XML.\r\n\r\n**Marshalling**\r\n\r\nÉs el procés que s'encarrega de transformar la representació d'un objecte en memoria (Java Object) en un format que encaixi amb el canal de comunicació amb el que es treballa (XML).\r\n\r\n**UnMarshalling**\r\n\r\nÉs el procés invers al Marshalling, la representació en format XML passa a convertir-se en una Java Object.\r\n\r\n**XSDL**\r\n\r\nUn arxiu WSDL és un arxiu XML que descriu la forma de comunicació, es a dir, els requsisits de protocol i els formats dels missatges necessaris per interactuar amb els serveis llistats en el seu catàleg. Així un arxiu WSDL funciona com a interficie pública del web service.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nLa instal.lació del servei requereix de la utilització de la llibreria 'spring-ws-core' i les dependències indicades a l'apartat 'Introducció-Versions i Dependències'.\r\n\r\n### Configuració\r\n\r\nAquest punt el dividirem en dues parts segons si volem exposar un servei o bé som consumidor(clients) de ell:\r\n\r\n#### Configuració com a client\r\n\r\nLa configuració del web implica els següents passos:\r\n\r\n* Definir l'arxiu de propietats amb les dades del webservice.\r\n* Generar les classes Java i els seus bindings a partir del WSDL del Webservice.\r\n* Definir l'arxiu de configuració de Spring: client, marshallers, WebserviceTemplate.\r\n* Definir el client que realitzarà la crida.\r\n* Test d'exemple\r\n\r\n#### Definició de l'arxiu de propietats\r\n\r\nFitxer de configuració: webservices.properties\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props\r\n\r\n    *.ws.uri=http://ws.cdyne.com/WeatherWS/Weather.asmx\r\n\r\nContindrà les URLs del webservices segons l'entorn al que es vulgui atacar.\r\n\r\n#### Generar les classes Java i els seus bindings a partir del WSDL del Webservice\r\n\r\nPer aquest procés s'utilitzarà un plugin de maven. Aquest serà l'encarregat de generar el codi Java i les anotacions de binding de manera automàtica a partir del WSDL.\r\n\t\r\n    És recomanable generar aquestes classes en un projecte extern, i posteriorment afegir aquest projecte com a dependència del projecte\r\n\r\n**pom.xml**\r\n\r\n```\r\n....\r\n<build>\r\n\t<plugins>\r\n\t\t...........\r\n                ...........\r\n\r\n\t\t<plugin>\r\n\t\t\t<groupId>org.apache.cxf</groupId>\r\n\t\t\t<artifactId>cxf-codegen-plugin</artifactId>\r\n\t\t\t<version>2.2.10</version>\r\n\t\t\t<executions>\r\n\t\t\t\t<execution>\r\n\t\t\t\t\t<id>generate-sources</id>\r\n\t\t\t\t\t<phase>generate-sources</phase>\r\n\t\t\t\t        <configuration>\r\n\t\t\t\t\t        <sourceRoot>${basedir}/src/main/java</sourceRoot>\r\n                                                <wsdlOptions>\r\n\t\t\t\t\t\t\t<wsdlOption>\r\n\t\t\t\t\t\t\t\t<wsdl>http://wsf.cdyne.com/WeatherWS/Weather.asmx?wsdl</wsdl>\r\n\t\t\t\t\t\t\t</wsdlOption>\r\n\t\t\t\t\t\t</wsdlOptions>\r\n\t\t\t\t\t</configuration>\r\n\t\t\t\t\t<goals>\r\n\t\t\t\t\t\t<goal>wsdl2java</goal>\r\n\t\t\t\t\t</goals>\r\n\t\t\t\t</execution>\r\n\t\t\t</executions>\r\n\r\n\t\t\t<dependencies>\r\n\t\t\t\t<dependency>\r\n\t\t\t\t\t<groupId>org.jvnet.jaxb2_commons</groupId>\r\n\t\t\t\t\t<artifactId>jaxb2-basics</artifactId>\r\n\t\t\t\t\t<version>0.6.0</version>\r\n\t\t\t\t</dependency>\r\n\t\t\t\t<dependency>\r\n\t\t\t\t\t<groupId>org.jvnet.jaxb2_commons</groupId>\r\n\t\t\t\t\t<artifactId>jaxb2-basics-runtime</artifactId>\r\n\t\t\t\t\t<version>0.6.0</version>\r\n\t\t\t\t</dependency>\r\n\t\t\t</dependencies>\r\n\t\t</plugin>\r\n\t</plugins>\r\n</build>\r\n......\r\n```\r\n\r\nAquest plugin generarà automàticament el codi Java de el WSDL informat, en aquest cas: http://ws.cdyne.com/WeatherWS/Weather.asmx?wsdl. Un servei web gratuït per a consultar el temps a partir del ZIP code.\r\n\r\n### Definir l'arxiu de configuració de Spring\r\n\r\nFitxer de configuració: canigo-webservices-config.xml\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/spring\r\n\r\n```\r\n<bean id=\"messageFactory\" class=\"org.springframework.ws.soap.saaj.SaajSoapMessageFactory\">\r\n\t<property name=\"soapVersion\">\r\n\t\t<util:constant static-field=\"org.springframework.ws.soap.SoapVersion.SOAP_12\" />\r\n\t</property>\r\n</bean>\r\n\r\n<bean id=\"webServiceTemplate\" class=\"org.springframework.ws.client.core.WebServiceTemplate\">\r\n\t<constructor-arg ref=\"messageFactory\" />\r\n\t<property name=\"marshaller\" ref=\"marshaller\" />\r\n\t<property name=\"unmarshaller\" ref=\"marshaller\" />\r\n\t<property name=\"defaultUri\" value=\"${ws.uri}\" />\r\n</bean>\r\n\r\n<bean id=\"webServiceClient\" class=\"cat.gencat.ctti.canigo.demo.ws.WebServiceClientImpl\">\r\n\t<property name=\"webServiceTemplate\" ref=\"webServiceTemplate\"/>\r\n\t<property name=\"defaultUri\" value=\"${ws.uri}\" />\t\t\r\n</bean>\r\n\r\n<bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\">\r\n\t<property name=\"classesToBeBound\">\r\n\t\t<list>\r\n\t\t\t<value>com.cdyne.ws.weatherws.ArrayOfForecast</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.ArrayOfWeatherDescription</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.Forecast</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.ForecastReturn</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetCityForecastByZIP</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetCityForecastByZIPResponse</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetCityWeatherByZIP</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetCityWeatherByZIPResponse</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetWeatherInformation</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.GetWeatherInformationResponse</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.POP</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.Temp</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.WeatherDescription</value>\r\n\t\t\t<value>com.cdyne.ws.weatherws.WeatherReturn</value>\r\n\t\t</list>\r\n\t</property>\r\n</bean>\r\n```\r\n\r\nEn aquesta configuració destacar classesToBeBound: que és el conjunt de classes de les quals OXM farà el marshalling i unmarshalling sense necessitat de manipular XML per part del desenvolupador.\r\n\r\n### Definir el client que realitzarà la crida\r\n\r\nCodi d'exemple per a la crida al webservice.\r\n\r\n**WebServiceClientImpl.java**\r\n\r\n```java\r\npublic class WebServiceClientImpl implements WebServiceClient {\r\n\t\r\n\tprivate WebServiceTemplate webServiceTemplate;\r\n\r\n\tpublic void setWebServiceTemplate(WebServiceTemplate webServiceTemplate) {\r\n\t\tthis.webServiceTemplate = webServiceTemplate;\r\n\t}\r\n\r\n\tpublic void setDefaultUri(String defaultUri) {\r\n\t\twebServiceTemplate.setDefaultUri(defaultUri);\r\n\t}\r\n\r\n\tpublic GetCityForecastByZIPResponse simpleSendAndReceive(String zip) {\r\n\t\t\t\t\r\n\t\tGetCityForecastByZIP request = new GetCityForecastByZIP();\r\n\t\trequest.setZIP(zip);\r\n\t\t\t\t\r\n\t\treturn (GetCityForecastByZIPResponse)webServiceTemplate.marshalSendAndReceive(request);\r\n\t}\r\n\r\n}\r\n```\r\n\r\n**WebServiceClient.java**\r\n\r\n```java\r\npublic interface WebServiceClient {\r\n\tGetCityForecastByZIPResponse simpleSendAndReceive(String zip);\r\n}\r\n```\r\n\r\nDefinir un test per a certificar el seu funcionament\r\n\r\n**WebServiceClientTest .java**\r\n\r\n```java\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(locations = {\"ws-context.xml\"})\r\npublic class WebServiceClientTest {\r\n\t\r\n\tprivate static final Log LOGGER = LogFactory.getLog(WebServiceClientTest.class);\r\n\t\r\n\t@Autowired\r\n\tpublic WebServiceClient client;\r\n\t\r\n\t@Before\r\n\tpublic void init(){\r\n\t\tAssert.assertNotNull(client);\r\n\t}\r\n\t\r\n\t@Test\r\n\tpublic void testCall(){\r\n\t\tGetCityForecastByZIPResponse response = client.simpleSendAndReceive(\"35004\");\r\n\t\t\r\n\t\tAssert.assertNotNull(response);\r\n\t\tAssert.assertEquals(\"Moody\", response.getGetCityForecastByZIPResult().getCity());\r\n\t\tAssert.assertEquals(\"AL\", response.getGetCityForecastByZIPResult().getState());\r\n\t\tAssert.assertEquals(\"Birmingham\", response.getGetCityForecastByZIPResult().getWeatherStationCity());\r\n\t\t\r\n\t\t\r\n\t\tfor(Forecast forecast : response.getGetCityForecastByZIPResult().getForecastResult().getForecast()){\r\n\t\t\tLOGGER.debug(forecast.getDate() + \": \" + forecast.getDesciption());\r\n\t\t}\r\n\t}\r\n}\r\n```\r\n\r\n### Configuració com a EndPoint\r\n\r\nLa configuració del webservice implica els següents passos:\r\n\r\n* Configuració del web.xml.\r\n* Definir l'arxiu de configuració de Spring: marshallers, endpoints.\r\n* Definir el Endpoint\r\n\r\nEn aquest punt considerem que l'usuari coneix o ha generat l'arxiu XSD (Schema) que defineix el contracte del webservice.\r\n\r\n### Configuració del web.xml.\r\n\r\nEl primer punt a considerar és la càrrega i generació d'un nou context d'spring amb les dades del WS.\r\n\t\r\nAquesta context és independent del context de Spring de l'aplicació web. Si el desenvolupador vol integrar un servei propi de canigó, l'haurà de referenciar directament dins del contextConfigLocation del servlet de Spring WS.\r\n\r\nAquest servlet MessageDispatcherServlet carregarà els arxius de configuració dins del seu context de Spring, i definirá el mapping de les peticions contra aquest servei.\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<web-app xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \r\n         xmlns=\"http://java.sun.com/xml/ns/javaee\" \r\n         xmlns:web=\"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\" \r\n         xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee \r\n                             http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\" \r\n\t     id=\"WebApp_ID\" version=\"2.5\">\r\n\r\n\t........\r\n\t\r\n    <servlet>\r\n        <servlet-name>ws-canigo</servlet-name>\r\n        <servlet-class>org.springframework.ws.transport.http.MessageDispatcherServlet</servlet-class>\r\n\t\t<init-param>\r\n\t\t\t<param-name>contextConfigLocation</param-name>\r\n\t\t\t<param-value>classpath:/spring-ws-context.xml</param-value>\r\n\t\t</init-param>\r\n    </servlet>\r\n\r\n    <servlet-mapping>\r\n        <servlet-name>ws-canigo</servlet-name>\r\n        <url-pattern>/*</url-pattern>\r\n    </servlet-mapping>\r\n\t\r\n\t.........\r\n\t\r\n</web-app>\r\n```\r\n\r\n### Definir l'arxiu de configuració de Spring\r\n\r\nDins de l'arxiu de configuració definim:\r\n\r\n* L' estrategia de resolució del Endpoint (en aquest cas per anotacions).\r\n* Configuració de OXM per tal d'aplicar marshalling i unmarshalling sobre les dades d'entrada i sortida del Endpoint.\r\n* Indicar al marshaller quins son els beans que contenen l'informació de binding.\r\n* Exportar el XSD com a WSDL de manera transparent.\r\n\r\nRuta proposada:\r\n/src/main/resources/spring-ws/spring-ws-context.xml\r\n\t\r\n<div class=\"message information\">\r\nEn el cas de que l'aplicació web de tipus Canigó no sigui exclusivament un webservice, evitar que el context de l'aplicació Web carregui els beans\r\nde Spring WS introduïnt-los en la carpeta /src/main/resources/spring/. Això carregaria de manera automàtica els beans de Spring WS, consumint memoria innecesariament\r\nja que el context de l'aplicació web no és el mateix que el del webservice.\r\n</div>\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n       xmlns:p=\"http://www.springframework.org/schema/p\"\r\n       xmlns:context=\"http://www.springframework.org/schema/context\"\r\n       xsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n                           http://www.springframework.org/schema/beans/spring-beans.xsd\r\n                           http://www.springframework.org/schema/context\r\n                           http://www.springframework.org/schema/context/spring-context.xsd\">\r\n\r\n    <context:component-scan base-package=\"cat.gencat.ws.example.service\" />\r\n\r\n    <bean id=\"echo\" class=\"org.springframework.ws.wsdl.wsdl11.DefaultWsdl11Definition\"\r\n          p:portTypeName=\"Echo\"\r\n          p:locationUri=\"/echoService/\"\r\n\t\t  p:targetNamespace=\"http://mycompany.com/hr/definitions\">\r\n        <property name=\"schema\">\r\n            <bean class=\"org.springframework.xml.xsd.SimpleXsdSchema\"\r\n                  p:xsd=\"classpath:/config/xsd/echo.xsd\" />\r\n            </bean>\r\n        </property>        \r\n    </bean>\r\n\r\n    <bean class=\"org.springframework.ws.server.endpoint.mapping.PayloadRootAnnotationMethodEndpointMapping\"/>\r\n\r\n    <bean class=\"org.springframework.ws.server.endpoint.adapter.MarshallingMethodEndpointAdapter\">\r\n        <constructor-arg ref=\"marshaller\"/>\r\n    </bean>\r\n\r\n    <bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\"\r\n          p:contextPath=\"cat.gencat.ws.example.schema.beans\" />\r\n\r\n</beans>\r\n```\r\n\r\n### Definir el Endpoint\r\n\r\nInterficie que defineix les operacions públiques del WS.\r\n\r\n**MarshallingEchoService.java**\r\n\r\n```\r\npublic interface MarshallingEchoService {\r\n    \r\n    /**\r\n     * Return Echo response\r\n     */\r\n    public EchoResponse echoEcho(EchoRequest request);\r\n\r\n}\r\n```\r\n\r\nLa anotació @Endpoint indica que es tracta d'un EndPoint, Spring gracies a component-scan i la clase PayloadRootAnnotationMethodEndpointMapping mapeja les peticions i respostes contra aquest bean.\r\n\r\nDe manera transparent el marshaller s'encarregarà de la conversió de XML a object i de object a XML.\r\n\r\n**EchoEndpoint.java**\r\n\r\n```java\r\n@Endpoint\r\npublic class EchoEndpoint implements MarshallingEchoService {\r\n    \r\n    /**\r\n     * Return Echo response\r\n     */\r\n    @PayloadRoot(localPart=\"echoEcho\", namespace=\"http://mycompany.com/hr/definitions\")\r\n    public EchoResponse echoEcho(EchoRequest request) {\r\n        return new EchoRequest().setMessage(request.getMessage());        \r\n    }\r\n\r\n}\r\n```\r\n\r\nDes d'un client d'aquest WS (revisar configuració com a client) realitzem la crida i recuperem el valor retornat:\r\n\r\n**EchoServiceClient.java**\r\n\r\n```java\r\npublic class EchoServiceClient implements MarshallingEchoService {\r\n   \r\n    @Autowired\r\n    private WebServiceTemplate wsTemplate;\r\n\r\n    private static final Log LOGGER = LogFactory.getLog(EchoServiceClient.class);\r\n   \r\n    /**\r\n     * Gets person list.\r\n     */\r\n    public EchoResponse echoEcho(EchoRequest request) {\r\n        EchoResponse response = \r\n            (EchoResponse) wsTemplate.marshalSendAndReceive(request);\r\n\r\n        if(LOGGER.isDebugEnabled(()){\r\n\t    LOGGER.debug(response.getMessage());\r\n        }\r\n\r\n        return response;\r\n        \r\n    }\r\n   \r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtYWx0cmVzL21vZHVsLXdlYnNlcnZpY2Vz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hbnRpdmlydXM=":{"date":1426763195000,"title":"Antivirus","description":"Accés a l'escaneig d'arxius mitjançant el servei d'antivirus Centrals del CTTI.","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-integracio/modul-antivirus","content":"## Propòsit\r\n\r\nAquest mòdul permet l'escaneig d'arxius mitjançant el servei d'antivirus Centrals del CTTI.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'Antivirus es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.antivirus.version>[1.2.0,1.3.0)</canigo.integration.antivirus.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.antivirus</artifactId>\r\n    <version>${canigo.integration.antivirus.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/antivirus.properties\r\n\r\nPropietat                              | Requerit | Descripció\r\n-------------------------------------- | -------- | ----------\r\n*.antivirus.remote                     | Sí       | Paràmetre que indica si l'escaneig dels arxius es realitza de forma remota o no. Si fos de forma remota l'arxiu a escanejar s'ha de pujar abans al servidor d'antivirus centrals, procés que fa automàticament el mòdul. En cas de remote a fals s'enten que l'arxiu ja es troba pujat al servidor d'antivirus centrals. <br>Valor per defecte: true\r\n*.antivirus.serverIp                   | Sí       | IP del Host on es troba el Servidor d'antivirus Centrals.<br>  antivirus.gencat.intranet per entorns productius <br> preproduccio.antivirus.gencat.intranet per entorns preproductius i d'altres\r\n*.antivirus.serverPort                 | Sí       | Port del Host on es troba el Servidor d'antivirus Centrals.<br> Valor per defecte: 1344\r\n*.antivirus.numDayDBExpirationWarning  | Sí       | Número de dies que han de passar per que una definició de virus de la base de dades d'antivirus centrals es consideri caducada. <br>Valor per defecte: 15\r\n\r\n## Utilització del Mòdul\r\n\r\nPer a utilizar aquest mòdul s'ha de demanar la llibreria sym-7.5.jar enviant un correu a la bústia canigó <oficina-tecnica.canigo.ctti@gencat.cat>\r\n\r\n### JSF\r\n\r\nPer a configurar el mòdul és necessari:\r\n\r\n* Crear un managed bean de JSF que contingui la lògica d'invocació al servei d'antivirus.\r\n* Pàgina JSF per a realitzar la invocació al managed bean.\r\n\r\n**AntivirusBean.java**\r\n\r\nManaged Bean de JSF que gestiona la crida al servei d'antivirus.\r\n\r\nEn aquest bean es pot veure:\r\n\r\n** Inyecció del servei d'antivirus via annotacions (@Autowired) de Spring.\r\n** Inserció del missatge de resultat de l'operació que posteriorment sera recuperat pel formulari JSF.\r\n\r\n```java\r\n/**\r\n * Classe d'exemple d'invocació al servei d'antivirus\r\n *\r\n * @author cscanigo\r\n *\r\n */\r\n@Component(\"antivirusBean\")\r\n@Lazy\r\npublic class AntivirusBean {\r\n\r\n    private static final Log log = LogFactory.getLog(AntivirusBean.class);\r\n\r\n    @Autowired\r\n    private Antivirus service;\r\n\r\n    private UploadedFile upFile;\r\n\r\n\r\n        /**\r\n         * Getter file\r\n         * @return file\r\n         */\r\n    public UploadedFile getUpFile(){\r\n        return upFile;\r\n    }\r\n\r\n        /**\r\n         * Setter file\r\n         * @param file\r\n         */\r\n    public void setUpFile(UploadedFile upFile){\r\n        this.upFile = upFile;\r\n    }\r\n\r\n         /**\r\n         * Escaneig de l'arxiu pujat al servidor\r\n         *\r\n         */\r\n    public void scan(){\r\n        String resultat = null;\r\n        log.info(\"AntivirusAction [scan] - Inici\");\r\n        ResultatEscaneig res = null;\r\n        try {\r\n\r\n            res = service.scan(getUpFile().getBytes());\r\n\r\n            if (res != null) {\r\n                switch (res.getEstat()) {\r\n                case 0:\r\n                    log.info(\"AntivirusAction [scan] - arxiu sense Virus\");\r\n                    resultat = \"Arxiu sense Virus\";\r\n                    break;\r\n                case -1:\r\n                    log.info(\"AntivirusAction [scan] - arxiu amb Virus!\");\r\n                    StringBuffer sb = new StringBuffer();\r\n                    sb.append(\"Arxiu amb Virus!\");\r\n                    if(res.getArrayVirus()!=null){\r\n                        for(InfectionInfo i : res.getArrayVirus()){\r\n                            sb.append(i.getFileName() + \" - \" + i.getViolationName() + \"; \");\r\n                        }\r\n                        resultat = sb.toString();\r\n                    }\r\n                    break;\r\n                case 1:\r\n                    log.info(\"AntivirusAction [scan] - Warning\");\r\n                    resultat = res.getMissatge();\r\n                    break;\r\n                default:\r\n                    log.info(\"AntivirusAction [scan] - Error en el procés d'escaneig\");\r\n                    resultat = \"S'ha produit un error\";\r\n                }\r\n            }\r\n\r\n            FacesContext.getCurrentInstance().addMessage(\"antivirusForm\", new FacesMessage(\r\n                    FacesMessage.SEVERITY_INFO, \"Resultat del escaneig: \" + resultat, null));\r\n\r\n            log.info(\"AntivirusAction [scan] - Final\");\r\n        } catch (AntivirusException ae) {\r\n            log.error(\"AntivirusException - Antivirus (\"+ service.getClass()+\"): \" + service\r\n                    + \" \" + ae.getStackTrace());\r\n            FacesContext.getCurrentInstance().addMessage(\"antivirusForm\", new FacesMessage(\r\n                    FacesMessage.SEVERITY_ERROR, \"Resultat del escaneig: \" + ae.getMessage(), null));\r\n        } catch (IOException e) {\r\n            log.error(\"AntivirusException - Antivirus (\"+ service.getClass()+\"): \" + service\r\n                    + \" \" + e.getStackTrace());\r\n            FacesContext.getCurrentInstance().addMessage(\"antivirusForm\", new FacesMessage(\r\n                    FacesMessage.SEVERITY_ERROR, \"Resultat del escaneig: \" + e.getMessage(), null));\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n**antivirus.jsf**\r\n\r\nInvocació del métode \"scan\" del managed bean de JSF definit anteriorment com a \"antivirusBean\". El Tag message mostrarà el resultat de la crida (veure FacesContext.getCurrentInstance().addMessage(\"antivirusForm\"....).\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\" standalone=\"yes\" ?>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\r\n    xmlns:ui=\"http://java.sun.com/jsf/facelets\"\r\n    xmlns:f=\"http://java.sun.com/jsf/core\"\r\n    xmlns:h=\"http://java.sun.com/jsf/html\"\r\n    xmlns:c=\"http://java.sun.com/jstl/core\"\r\n    xmlns:t=\"http://myfaces.apache.org/tomahawk\">\r\n\r\n\r\n<ui:composition template=\"layouts/template.jsf\">\r\n    <ui:define name=\"ariadna\">\r\n        <h:outputLink value=\"index.jsf\">\r\n            <h:outputFormat>#{msg.breadCrumbInit}</h:outputFormat>\r\n        </h:outputLink>\r\n    </ui:define>\r\n    <ui:define name=\"body\">\r\n        <h1>${msg.menuIntegrationAntivirus}</h1>\r\n        <h:form id=\"antivirusForm\" enctype=\"multipart/form-data\">\r\n            <h:panelGrid columns=\"1\">\r\n                <t:inputFileUpload id=\"fileupload\" value=\"#{antivirusBean.upFile}\"    size=\"20\" />\r\n                <h:commandButton value=\"#{msg.antivirusUploadFile}\" action=\"#{antivirusBean.scan}\" />\r\n                <h:message for=\"antivirusForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n            </h:panelGrid>\r\n        </h:form>\r\n    </ui:define>\r\n</ui:composition>\r\n\r\n</html>\r\n```\r\n<div class=\"message warning\">\r\nPujada d'arxius al servidor<br>\r\nPer a l'exemple s'ha fet servir a més el mòdul de fileupload per tal de gestionar la pujada d'arxius al servidor i el posterior escaneig d'aquest.\r\n</div>\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hbnRpdmlydXM="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC10cmFjZXM=":{"date":1425571902000,"title":"Mòdul de traces","description":"Mòdul de detecció d'errades.","sections":"Canigó. Documentació versió 3.x","weight":7,"path":"/canigo-documentacio-versions-3x-core/modul-traces","content":"## Introducció\r\n\r\n### Propósit\r\n\r\nEl mòdul de traces té com a missió:\r\n\r\n-   Detectar i localitzar amb més facilitat errors de l'aplicació\r\n-   Entrada de dades incorrectes segons la lògica del sistema\r\n-   Seguiment per a auditoria\r\n\r\nPer a que això pugui ser portat a terme, el servei ofereix la\r\npossibilitat de:\r\n\r\n1.  Definir nivells de traces (d'informació, fatals, errors, etc.)\r\n2.  Definir en quines sortides es generarà la traça: consola, fitxers,\r\n    base de dades, correu electrònic, etc.\r\n3.  Canviar en qualsevol moment quin és el mínim nivell de traces que\r\n    volem mostrar, sense haver d'afectar a les classes que generen les\r\n    traces\r\n4.  Definir el format de sortida de les nostres traces: incorporar\r\n    l'hora, el número de línia del codi on s'ha produït i la seva\r\n    classe, etc.\r\n5.  Incorporar informació de context a la traça: usuari, IP del client,\r\n    etc.\r\n\r\n### Documents i Fonts de Referència\r\n\r\nNom          | Adreça\r\n------------ | ------------\r\nLog4J Manual | https://logging.apache.org/log4j/1.2/manual.html\r\nJMX i Mbeans | http://download.oracle.com/javase/6/docs/technotes/guides/jmx/tutorial/tutorialTOC.html\r\n\r\n### Glossari\r\n\r\n**Log4J**\r\n\r\nUn dels framework de traces més extés. Es basa en l'ús de Appenders,\r\nCategories i Layouts. Veure l'annex per a més informació.\r\n\r\n**JMX**\r\n\r\nDel acrònim Java Management eXtensions, JMX és la tecnologia que\r\ndefineix una arquitectura de gestió, la API, els patrons de disseny, i\r\nels serveis de monitorització/administració d'aplicacions Java.\r\n\r\n**Mbean**\r\n\r\nSimilar al model JavaBeans i amb una interfície estàtica, els Mbeans\r\nexposen mètodes per obtenir i assignar valors remotament i en temps\r\nd'execució, ideal per a gestionar modificacions/administració de\r\npropietats en calent.\r\n\r\n## Descripció detallada\r\n\r\n### Arquitectura i components\r\n\r\nA més de les funcionalitats oferides per la pròpia API de Log4j, Canigó\r\ndisposa d'un conjunt de components addicionals:\r\n\r\n1.  Configuració de traces multientorn.\r\n2.  MBean per a modificar el nivell de traces en calent d'una aplicació.\r\n3.  Layout per a traces amb format XML.\r\n4.  Eina de consulta de logs en calent.\r\n5.  Afegir informació contextual als logs.\r\n\r\n### Instal- lació i configuració\r\n\r\n#### Instal- lació\r\n\r\nEl mòdul de traces s'inclou per defecte dins del core de Canigó 3.\r\nDurant el procés de creació de l'aplicació (Struts o JSF), l'eina de\r\nsuport al desenvolupament inclourà la referència dins del pom.xml. En\r\ncas d'una instal- lació manual afegir les següents línies al pom.xml de\r\nl'aplicació:\r\n\r\n```java\r\n<canigo.core.version>[3.1.0,3.2.0)</canigo.core.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.core</artifactId>\r\n          <version>${canigo.core.version}</version>\r\n```\r\n\r\n#### Configuració\r\n\r\nL'eina de desenvolupament de Canigó 3 genera de manera automàtica els\r\ndiferents arxius de configuració de traces per entorn:\r\n\r\n-   log4j.int.xml Arxiu de configuració per al entorn d'integració.\r\n-   log4j.pre.xml Arxiu de configuració per al entorn de preproducció.\r\n-   log4j.pro.xml Arxiu de configuració per al entorn de producció.\r\n-   log4j.xml Arxiu de configuració per defecte. En el cas de no trobar\r\n    cap configuració específica per al entorn, aquesta pasarà a ser la\r\n    per defecte.\r\n\r\nDirectori de configuració: <PROJECT_ROOT>/src/main/resources/log4j/*.xml\r\n\r\nPer cadascun dels entorns els nivells de logs varien.\r\n\r\nExemple de configuració log4j.xml en local:\r\n\r\n```xml\r\n<log4j:configuration xmlns:log4j='http://jakarta.apache.org/log4j/'\r\n debug=\"true\">\r\n\r\n    <!-- Architecture appender -->\r\n    <appender name=\"file\" class=\"org.apache.log4j.DailyRollingFileAppender\">\r\n        <param name=\"DatePattern\" value=\"'.'yyyyMMdd\" />\r\n        <param name=\"File\"\r\n            value=\"/export/AppJavaDades/AppExemple-${weblogic.Name}.log\" />\r\n        <param name=\"Append\" value=\"true\" />\r\n        <layout class=\"org.apache.log4j.PatternLayout\">\r\n            <param name=\"ConversionPattern\"\r\n                value=\"canigo Message: %d{dd MMM yyyy HH:mm:ss,SSS} %-5p [%t] %c - %m%n - %X{APPID}\" />\r\n        </layout>\r\n    </appender>\r\n    <appender name=\"console\" class=\"org.apache.log4j.ConsoleAppender\">\r\n        <layout class=\"org.apache.log4j.PatternLayout\">\r\n            <param name=\"ConversionPattern\"\r\n                value=\"canigo Message: %d{dd MMM yyyy HH:mm:ss,SSS} %-5p [%t] %c - %m%n - %X{APPID}\" />\r\n        </layout>\r\n    </appender>\r\n    <category name=\"cat.gencat.ctti.canigo.arch\">\r\n        <level value=\"debug\" />\r\n        <appender-ref ref=\"console\" />\r\n        <appender-ref ref=\"file\" />\r\n    </category>\r\n    <root>\r\n                <appender-ref ref=\"console\" />\r\n        <level value=\"info\" />\r\n    </root>\r\n</log4j:configuration>\r\n```\r\n\r\nD'aquesta configuració d'exemple destaquem:\r\n\r\n-   Existeixen dos tipus d'appender, un que mostrarà la informació per\r\n    la consola del servidor d'aplicacions, i un altre que inserirà les\r\n    traces a un log que rotarà automàticament cada dia.\r\n-   Les traces provinents del package \"cat.gencat.ctti.canigo.arch\" es\r\n    visualitzaran tant en la consola d'arranc del servidor com a un\r\n    arxiu de logs.\r\n-   Els packages restants (aplicació i llibreries de tercers) es\r\n    mostraran només per consola i amb nivell de log INFO.\r\n\r\nA continuació es mostren les configuracions més comuns de Log4J\r\n(mitjançant appenders) i algunes de més específiques que per la seva\r\ncomplexitat són necessàries d'explicar. En alguns casos, es tracten\r\nd'implementacions disponibles en la comunitat, en d'altres desenvolupats\r\nespecíficament per Canigó. Es recomana una lectura prèvia del manual de\r\nlog4j per conèixer en detall la configuració de log4j.  \r\n\r\n#### Appenders\r\n\r\n##### Configuració de l'ús de appender per consola\r\n\r\nClasse: org.apache.log4j.ConsoleAppender\r\n\r\nS'afegeixen les traces traces al \"System.out\" o \"System.err\". Per a\r\ninformació detallada sobre les propietats de l'appender consultar el\r\nmanual de Log4J.\r\n\r\nExemple:\r\n\r\n```xml\r\n<appender name=\"console\"  class=\"org.apache.log4j.ConsoleAppender\">\r\n    <layout  class=\"org.apache.log4j.PatternLayout\">\r\n       <param name=\"ConversionPattern\"  value=\"canigo Message: %-5p [%t] %c -  %m%n\"/>\r\n    </layout>\r\n</appender>\r\n```\r\n\r\n##### **Configuració de l'ús de appender per fitxer rotatiu**\r\n\r\nClasse: org.apache.log4j.DailyRollingFileAppender\r\n\r\nPermet establir un tamany màxim de fitxer i cada vegada que el fitxer de\r\nlog supera aquest tamany es crea un fitxer de traces nou. Aquest procés\r\nes fa diàriament o segons la freqüència especificada. Per a informació\r\ndetallada sobre la forma d'especificar les diferents freqüències i\r\npropietats de l'appender consultar el manual de Log4J.\r\n\r\nEl format del fitxer (texte pla o XML) el defineix el *layout* associat\r\na l'*appender* com veurem posteriorment.\r\n\r\n##### **Configuració de l'ús de Appender per Correu Electrònic**\r\n\r\nClasse: org.apache.log4j.SMTPAppender\r\n\r\nEnvia les traces per correu electrònic. Per a informació detallada sobre\r\nles propietats de l'appender consultar el manual de Log4J.\r\n\r\n##### **Configuració de l'ús de Appender per SNMP**\r\n\r\nClasse: org.apache.log4j.ext.SNMPTrapAppender\r\n\r\nEnvia les traces com a missatges TRAP pel protocol de control de xarxa\r\nSNMP a un administrador de xarxa. El manual de Log4J és molt reticent en\r\ndefinir el seu ús. Degut a la seva complexitat es fa esmena en aquest\r\napartat de cóm utilitzar-lo.\r\n\r\nEs poden especificar els següents paràmetres:\r\n\r\n**Paràmetre** | **Requerit** | **Descripció**\r\n------------- | ------------ | --------------\r\nImplementationClassName | Sí | Implementació del protocol snmp. Podem escollir entre dos valors en funció de la versió del protocol que vulguem fer servir: *org.apache.log4j.ext.WengsoftSNMPTrapSender* (v1,v2 ó v3) ó *org.apache.log4j.ext.JoeSNMPTrapSender* (v1 ó v2)\r\nManagementHost | Sí | Direcció IP del host a on està l'administrador de xarxa a on s'enviaran els missatges SNMP\r\nManagementHostTrapListenPort | Sí | Port a on està l'administrador de xarxa a on s'enviaran els missatges SNMP\r\nEnterpriseOID | Sí | paràmetre propi del protocol SNMP\r\nLocalIPAddress | Sí | IP des d'on s'envien els missatges\r\nLocalTrapSendPort | Sí | Port des d'on s'envien els missatges\r\nGenericTrapType | Sí | Paràmetre propi del protocol SNMP\r\nSpecificTrapType | Sí | Paràmetre propi del protocol SNMP\r\nCommunityString | Sí | Paràmetre propi del protocol SNMP\r\nThreshold |  Sí | Nivell més baix pel que es generaran els missatges TRAP\r\n\r\nExemple:\r\n\r\n```xml\r\n<appender name=\"snmp\" class=\"org.apache.log4j.ext.SNMPTrapAppender\">\r\n    <param name=\"ImplementationClassName\" value=\"org.apache.\r\n    log4j.ext.WengsoftSNMPTrapSender\"/>\r\n    <param name=\"ManagementHost\" value=\"127.0.0.1\"/>\r\n    <param name=\"ManagementHostTrapListenPort\" value=\"8001\"/>\r\n    <param name=\"EnterpriseOID\" value=\"1.3.6.1.4.1.24.0\"/>\r\n    <param name=\"LocalIPAddress\" value=\"127.0.0.1\"/>\r\n    <param name=\"LocalTrapSendPort\" value=\"161\"/>\r\n    <param name=\"GenericTrapType\" value=\"6\"/>\r\n    <param name=\"SpecificTrapType\" value=\"12345678\"/>\r\n    <param name=\"CommunityString\" value=\"public\"/>\r\n    <param name=\"ForwardStackTraceWithTrap\" value=\"true\"/>\r\n    <param name=\"Threshold\" value=\"DEBUG\"/>\r\n    <param name=\"ApplicationTrapOID\" value=\"1.3.6.1.4.1.24.12.10.22.64\"/>\r\n    <layout class=\"org.apache.log4j.ext.SnmpDelimitedConversionPatternLayout\">\r\n    <param name=\"ValuePairDelim\" value=\"/\"/>\r\n    <param name=\"VarDelim\" value=\";\"/>\r\n    <param name=\"ConversionPattern\" value=\"%-5p;1.3.6.1.4.1.24.100.1/%t;1.\r\n    3.6.1.4.1.24.100.2/%c;1.3.6.1.4.1.24.100.3/%m;1.3.6.1.4.1.24.100.4\" />\r\n</layout>\r\n</appender>\r\n```\r\n\r\n##### Configuració de l'ús de Appender per Base de Dades\r\n\r\nClasse: org.apache.log4j.jdbcplus.JDBCAppender\r\n\r\nInstal- lació: Per a poder fer ús d'aquest appender cal descarregar una\r\nllibreria, disponible a la url\r\nhttp://www.dankomannhaupt.de/projects/index.html\r\n\r\nEs poden definir els paràmetres:\r\n\r\n**Paràmetre** | **Requerit** | **Descripció** |\r\n------------- | ------------ | -------------- |\r\nurl | Sí | Url de connexió a la base de dades | \r\nusername | Sí | Nom usuari connexió a la base de dades | \r\npassword | Sí | Password connexió a la base de dades | \r\nconector | Sí | Connector a la base de dades. Els valors disponibles són:  1.  org.apache.log4j.jdbcplus.examples.MySqlConnectionHandler  2. org.apache.log4j.jdbcplus.examples.OracleConnectionHandler  En cas de que no es disposi de connector per la base de dades seleccionada es pot realitzar una implementació de la interfície '*org.apache.log4j.jdbcplus.JDBCConnectionHandler'*  |\r\nsqlHandler | Sí | Adaptador que proporciona la cadena per fer la inserció d'un registre.  Usar: ' org.apache.log4j.jdbcplus.examples.SqlHandler '\r\nsql |  Sí | Patró d'inserció dels valors en la base de dades  (Veure patrons a continuació) | \r\ntable | Sí | Taula en la que s'emmagatzemaran les traces | \r\ncolumn | Sí | Crear un paràmetre amb nom 'column' per cada columna a inserir. Indicar com a valor:  nom_de_columna~patró~valor  On patró correspon a un dels possibles patrons de la sql | \r\nbuffer | No | Nombre d'insercions a la base de dades que es fan a la vegada  Valor per defecte:1 | \r\ncommit | No | Especificar si es vol autocommit en cada inserció.  Valor per defecte:true | \r\ndbclass | Sí | Driver utilitzat (específic de la BD) | \r\nquoteReplace | No | Indicar 'true' si es volen reemplaçar les cometes simples (') per poder inserir a la base de dades | \r\nlayoutPartsDelimiter | No | Delimitador dels patrons de layout.  És la cadena que utilitzarem per separar els diferents patrons definits dins del tag ConversionPattern del tag Layout.  Podrem escollir el patró que volem usar en cada columna indicant @LAYOUT:num_del_patro@  Ex: <param name=\"ConversionPattern\" value=\"patro1#~~#patro2#~~#patro3\"/>  On layoutPartsDelimiter=\"#-#\" | \r\n\r\nPatrons del paràmetre sql:\r\n\r\n**Patró**           | **Descripció**\r\n------------------- | --------------\r\n(INC)               | Comptador incremental per cada traça\r\n(PRIO)              | Prioritat de la traça (DEBUG, INFO,...)\r\n(ID)                | Classe que implementa JDBCIDHandler i que proporciona el valor per aquesta columna.\r\n(IPRIO)             | **Prioritat de la traça en format numèric** \r\n(DYNAMIC)           | Valor dinàmic que proporciona una classe que implementa JDBCColumnHandler\r\n(STATIC)            | Valor estàtic\r\n(CAT)               | Nom de la categoria\r\n(THREAD)            | Nom del thread\r\n(MSG)               | Missatge de la traça sense format\r\n(LAYOUT)            | Missatge de la traça formatejat amb el patró especificat en el param ConversionPattern.\r\n@LAYOUT:num_patró@ | Missatge de la traça formatejat amb el patró especificat en el param ConversionPattern, en la posició indicada per num_patró\r\n(TIMESTAMP)         | Moment en que es llença de la traça\r\n(THROWABLE)         | Error associat a la traça\r\n(NDC)               | Informació contextual de la traça *(nested diagnostic context)*\r\n@MDC:key@           | Informació contextual de la traça sota una clau predeterminada *(mapped diagnostic context)*\r\n\r\nExemple:\r\n\r\n~~~~ {.code-java}\r\n<appender name=\"JDBCPooled\" class=\"org.apache.log4j.jdbcplus.JDBCAppender\">\r\n    <param name=\"url\" value=\"jdbc:mysql://localhost/test\" />\r\n    <param name=\"username\" value=\"eulo\" />\r\n    <param name=\"password\" value=\"eulo\" />\r\n    <param name=\"sql\" value=\"INSERT INTO TEST (prio, cat, thread,\r\n    msg, layout_msg, throwable, ndc, mdc, mdc2, info, addon, created_by)\r\n    VALUES (' (PRIO)', ' (CAT)', ' (THREAD)', ' (MSG)', '@LAYOUT:1@',\r\n    ' (THROWABLE)', ' (NDC)', '@MDC:MyMDC@', '@MDC:MyMDC2@', 'info timestamp:\r\n    (TIMESTAMP)', 'addon', 'me')\"/>\r\n    <param name=\"buffer\" value=\"1\"/>\r\n    <param name=\"commit\" value=\"true\"/>\r\n    <param name=\"dbclass\" value=\"com.mysql.jdbc.Driver\"/>\r\n    <param name=\"quoteReplace\" value=\"true\"/>\r\n    <param name=\"throwableMaxChars\" value=\"3000\"/>\r\n    <param name=\"layoutPartsDelimiter\" value=\"#-#\"/>\r\n    <layout class=\"org.apache.log4j.PatternLayout\">\r\n    <param name=\"ConversionPattern\" value=\"[%t] %m####%d\\{dd.MM.yyyy\\}\r\n    #-#%d\\{HH:mm:ss\\}\"/>\r\n</layout>\r\n</appender>\r\n~~~~\r\n\r\nTambé podem indicar el nom de les columnes i el seu valor amb param name=\"column\" i posant a value:\r\n\r\nnom_de_columna~patró~valor\r\n\r\nOn patró correspon a un dels possibles patrons. D'aquesta manera no fa falta el paràmetre sql.\r\n\r\n~~~~ {.code-java}\r\n<param name=\"table\" value=\"logtest\" />\r\n<param name=\"column\" value=\"id~ID~org.apache.log4j.jdbcplus.\r\nexamples.MyIDHandler\" />\r\n<param name=\"column\" value=\"prio~PRIO\" />\r\n<param name=\"column\" value=\"cat~CAT\" />\r\n<param name=\"column\" value=\"thread~THREAD\" />\r\n<param name=\"column\" value=\"msg~MSG\" />\r\n<param name=\"column\" value=\"layout_msg~LAYOUT\" />\r\n<param name=\"column\" value=\"info~DYNAMIC~org.apache.log4j.jdbcplus.\r\nexamples.MyColumnHandler\" />\r\n<param name=\"column\" value=\"mdc~MDC~MyMDC\" />\r\n<param name=\"column\" value=\"created_on~TIMESTAMP\" />\r\n<param name=\"column\" value=\"created_by~STATIC~me\" />\r\n<param name=\"usePreparedStatements\" value=\"true\"/>\r\n\r\n<param name=\"layoutPartsDelimiter\" value=\"#-#\"/>\r\n<!- layout with conversion pattern ->\r\n<layout class=\"org.apache.log4j.PatternLayout\">\r\n<!- conversion pattern with 4 parts separated by ##, second part is empty -->\r\n<param name=\"ConversionPattern\" value=\"[%t] %m####%d\\{dd.MM.yyyy\\}#-#%\r\nd\\{HH:mm:ss\\}\"/>\r\n</layout>\r\n~~~~\r\n\r\n#### Layouts\r\n\r\n##### PatternLayout\r\n\r\nClasse:\r\n[org.apache.log4j.PatternLayout](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html)\r\n\r\nPermet especificar la sortida amb patrons de conversió. El seu ús és equivalent a la funció printf del llenguatje C.\r\n\r\nAlguns dels caràcters de conversió més interessants són (per a més referènciaconsultar la API de la classe):\r\n\r\n**Caràcter** | **Descripció**\r\n------------ | --------------\r\n%c           | Nom del \"logger\"\r\n%C           | Mostrar el nom qualificat de la classe que ha llençat el missatge.\r\n%d           | Mostrar la data en la que es va produir el missatge. A continuació opcionalment pot aparèixer el patró de conversió de data. Si no s'especifica s'utilitza per defecte **ISO 8601.** <br>Exemple: %d{dd MMM yyyy HH:mm:ss,SSS}.\r\n%L           | Número de línia a on es va llençar el missatge (**no fer servir si es necessita un bon rendiment**).\r\n%m           | Missatge\r\n%p           | Prioritat/nivell del missatge (WARN,...).\r\n%X{clau}     | Informació contextual \"clau\"\r\n%n           | Separador de línia (un \\n).\r\n\r\nEl resultat de l'aplicació d'aquests patrons són missatges de text pla\r\nuniformement formatejats.\r\n\r\n##### XMLLayout\r\n\r\nClasse:\r\n[org.apache.log4j.XMLLayout](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/xml/XMLLayout.html)\r\n\r\nLa sortida d'aquest \"layout\" consisteix en una sèrie de \"log4j:event\"\r\nnodes XML. Aquest \"layout\" no deixa un fitxer XML ben format, sinó que\r\nestà pensat per a ser inclòs com a entitat externa a un altre fitxer per\r\na formar un fitxer XML correcte.\r\n\r\n Per exemple, si abc és el nom del fitxer a on van les traces, el fitxer\r\nXML correcte seria:\r\n\r\n~~~~ {.code-java}\r\n<?xml version=1.0\"?>\r\n<!DOCTYPE log4j*:*eventSet **\r\n    <!ENTITY* data SYSTEM  \"*file:///abc\">]>\r\n          <log4j:eventSet version=\"1.2\"  xmlns:log4j=\"http://jakarta.apache.org/log4j/\">\r\n              &data;\r\n          </log4j:eventSet>\r\n~~~~\r\n\r\nQualsevol informació de tipus contextual (com ara l'userId) s'ha\r\nd'incloure dins la informació contextual del log i automàticament\r\ns'inclourà en la traça:\r\n\r\n~~~~ {.code-java}\r\n<log4j:event logger=\"net.gencat.ctti.canigo.services.logging.test.\r\nLoggingClient\" timestamp=\"1127746730256\" level=\"DEBUG\" thread=\"main\">\r\n<log4j:message><![CDATA[Log property file: log4j-test.xml.es-c7pym1j]]></log4j:message>\r\n<log4j:NDC><![CDATA[userId: me]]></log4j:NDC>\r\n</log4j:event>\r\n~~~~\r\n\r\n##### PatternXMLLayout\r\n\r\nClasse:\r\n[org.apache.log4j.XMLLayout](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/xml/XMLLayout.html)\r\n\r\nLa sortida d'aquest \"layout\" és una combinació de PatternLayout i\r\nXMLLayout.\r\n\r\nA l'igual que l'XMLLayout, aquest \"layout\" no deixa un fitxer XML ben\r\nformat, si no que també està pensat per a ser inclòs com a entitat\r\nexterna a un altre fitxer per a formar un fitxer XML correcte.\\\r\n El fitxer xml resultant tindrà una estructura semblant a XMLLayout, amb\r\nla diferència que el atributs no seran els de l'XMLLayout(*loggin,\r\ntimestamp, level i thread*), sinó que els podrem definir nosaltres\r\nmateixos, seguint els patrons de PatternLayout.\r\n\r\nEs permet definir els següents paràmetres:\r\n\r\n**Paràmetre**          | **Requerit** | **Descripció**\r\n---------------------- | ------------ | --------------\r\nNameSpace              | Sí           | Indica el namespace que l'xml mostrarà en els tags (<name_space:event>). Si no es defineix, mostrarà únicament el nom del tag (<event>)\r\nNodeName               | Sí           | Indica el nom del node principal(<registre>). Per defecte és \"event\" (<event>)\r\nAttrValuePairDelim     | Sí           | Indica quin caràcter servei de separador entre un atribut i el seu valor (usar '=' per defecte).\r\nAttrVarDelim           | Sí           | Indica quin caràcter serveix de separador entre els diferents atributs\r\nAttrConversionPattern  | Sí           | Defineix els diferents atributs dels events del log. El valor dels atributs pot seguir els mateixos patrons que en *PatternLayout.*\r\nNodesValuePairDelim    | Sí           | Indica quin caràcter serveix de separador entre els noms dels nodes i el seu valor\r\nNodesVarDelim          | Sí           | Indica __quin caràcter serveix de separador entre els diferents nodes\r\nNodesConversionPattern | Sí           | Defineix els diferents nodes dels events del log. El valor dels nodes també pot seguir els mateixos patrons que en PatternLayout.\r\nThrowable              | Sí           | Indica que es mostraran les excepcions llançades. A value definirem el nom del tag que inclourà l'excepció.\r\nExceptionMaxLength     | No           | Indica el nombre màxim de caràcters que mostrarem de l'excepció. Per defecte són 256 caràcters.\r\n\r\nExemple:\r\n\r\n~~~~ {.code-java}\r\n<appender name=\"file\" class=\"org.apache.log4j.RollingFileAppender\">\r\n<param name=\"File\" value=\"D:/logs/logging4.log.xml\"/>\r\n<param name=\"Append\" value=\"true\"/>\r\n<param name=\"MaxFileSize\" value=\"50KB\"/>\r\n<param name=\"maxBackupIndex\" value=\"3\"/>\r\n<layout class=\"net.gencat.ctti.canigo.services.logging.log4j.xml.PatternXMLLayout\">\r\n<param name=\"NameSpace\" value=\"log4j\"/>\r\n<param name=\"NodeName\" value=\"registre\"/>\r\n<param name=\"AttrValuePairDelim\" value=\"=\"/>\r\n<param name=\"AttrVarDelim\" value=\";\"/>\r\n<param name=\"AttrConversionPattern\" value=\"attr1=%-5p;attr2=%t;attr3=%c\" />\r\n<param name=\"NodesValuePairDelim\" value=\"=\"/>\r\n<param name=\"NodesVarDelim\" value=\";\"/>\r\n<param name=\"NodesConversionPattern\" value=\"data=%d\\{yyyy MM dd HH:mm:ss\\};\r\nerrorType=0;aplicacio=%c;logger=%F;nivell=%p;classe=%c;metode=metode; pid=%t;\r\nmissatge=%m;user_id=%X\\{userId\\};pagOrigen=%X\\{pagOrigen\\};\" />\r\n<param name=\"Throwable\" value=\"textException\"/>\r\n<param name=\"ExceptionMaxLength\" value=\"256\"/>\r\n</layout>\r\n</appender>\r\n\r\nUn exemple de sortida amb aquesta configuració és:\r\n\r\n<log4j:registre\r\nattr1=\"ERROR\"\r\nattr2=\"SNMP Server\"\r\nattr3=\"net.gencat.ctti.canigo.services.logging.snmp.test.TestListener\">\r\n<log4j: Data>2005 10 13 13:29:21</log4j: Data>\r\n<log4j:errorType>0</log4j:errorType>\r\n<log4j:aplicacio>net.gencat.ctti.canigo.services.logging.snmp.test.TestListener</log4j:aplicacio>\r\n<log4j:logger>Log4JLog.java</log4j:logger>\r\n<log4j:nivell>ERROR</log4j:nivell>\r\n<log4j:classe>net.gencat.ctti.canigo.services.logging.snmp.test.TestListener</log4j:classe>\r\n<log4j:metode>metode</log4j:metode>\r\n<log4j: Pid>SNMP Server</log4j: Pid>\r\n<log4j:textException><![CDATA[java.lang.Exception: Exception Message\r\nat net.gencat.ctti.canigo.services.logging.snmp.test.TestListener.snmpRequest(TestListener.java:38)\r\nat ca.wengsoft.snmp.Core.SnmpDispatcher.notifyEvent(SnmpDispatcher.java:164)\r\nat ca.wengsoft.snmp.Core....]]>\r\n</log4j:textException>\r\n</log4j:registre>\r\n\r\nEn cas que no s'hagués definit el paràmetre NameSpace obtindrem aquest altre format:\r\n\r\n<registre\r\nattr1=\"ERROR\"\r\nattr2=\"SNMP Server\"\r\nattr3=\"net.gencat.ctti.canigo.services.logging.snmp.test.TestListener\">\r\n\r\n<data>2005 10 13 13:30:40</data>\r\n<errorType>0</errorType>\r\n<aplicacio>net.gencat.ctti.canigo.services.logging.snmp.test.TestListener</aplicacio>\r\n<logger>Log4JLog.java</logger>\r\n<nivell>ERROR</nivell>\r\n<classe>net.gencat.ctti.canigo.services.logging.snmp.test.TestListener</classe>\r\n<metode>metode</metode>\r\n<pid>SNMP Server</pid>\r\n<textException><![CDATA[java.lang.Exception: Exception Message\r\nat net.gencat.ctti.canigo.services.logging.snmp.test.TestListener.snmpRequest(TestListener.java:38)\r\nat ca.wengsoft.snmp.Core.SnmpDispatcher.notifyEvent(SnmpDispatcher.java:164)\r\nat ca.wengsoft.snmp.Core....]]>\r\n</textException>\r\n\r\n</registre>\r\n~~~~\r\n\r\n**Incorporació de valors comuns a l'aplicació**\r\n\r\nUtilitzant aquest layout podem crear logs amb valors provinents de\r\nvariables ja especificades en qualsevol punt de l'aplicació.\r\n Exemple: Imaginem que el filtre d'autentificació obté l'usuari i volem\r\nmostrar l'usuari connectat a les nostres traces.\r\n Una possible opció és que la classe que generés la traça accedís\r\nprèviament a l'obtenció de l'usuari connectat (a la sessió, cridant a la\r\nclasse d'autentificació, etc.) i afegís aquesta informació a la traça.\r\nAquesta opció és costosa i poc mantenible. Si volem mostrar a totes les\r\ntraces de la nostra aplicació l'usuari connectat haurem de realitzar\r\naquest procediment. I si després ens demanen que s'afegeixi altra\r\ninformació contextual a totes les traces de l'aplicació?\r\n Per evitar aquestes problemàtiques canigo proporciona la classe '\r\nnet.gencat.ctti.canigo.core.threadlocal.ThreadLocalProperties'.\r\n ThreadLocalProperties.put(\"userId\",\"Usuari1\");\r\n Una vegada introduït en qualsevol punt de l'aplicació aquest atribut,\r\npodem configurar al layout que es mostri aquesta informació utilitzant\r\nel caràcter '$' seguit del nom del atribut.\r\n Exemple:\r\n\r\n~~~~ {.code-java}\r\n<param name=\"NodesConversionPattern\" value=\"data=%d\\{yyyy MM dd  HH:mm:ss\\};user_id=$userId;\" />\r\n~~~~\r\n\r\nAquest paràmetre crearia un tag amb un node '*data'* obtingut amb el\r\npatró de conversió indicat i un tag '*user_id'* amb el valor del\r\nparàmetre *userId* obtingut de l'objecte 'ThreadLocalProperties':\r\n\r\n~~~~ {.code-java}\r\n<log4j:registre>\r\n    <log4j: Data>2005 10 19 11:29:40</log4j:  Data>\r\n    <log4j:user_id>Usuari1</log4j:user_id>\r\n</log4j:registre>\r\n~~~~\r\n\r\n-   Incorporació de missatges estructurats a la traça*\r\n\r\nPer lo general els missatges de traces són cadenes. Si volem generar\r\ninformació adicional estructurada farem ús de l'objecte\r\nBaseLoggingObject per afegir la informació (veure apartat 'Utilització -\r\nGenerar logs amb paràmetres adicionals a un missatge').\r\n\r\nPer mostrar els atributs de l'objecte BaseLoggingObject s'usarà la\r\nsintaxi '**@**' seguida del nom del paràmetre.\r\n\r\n<param name=\"NodesConversionPattern\" value=\"idTramit=@idTramit;\" />\r\n\r\nUtilització del Servei\r\n----------------------\r\n\r\n### Generar Missatges\r\n\r\nPer generar una traça en nivell debug tindriem el següent codi:\r\n\r\n~~~~ {.code-java}\r\npublic class ExempleTrace{\r\n\r\n   private static final Log LOGGER = LogFactory.getLog(ExempleTrace.class);\r\n\r\n   public void execute(){\r\n      if (LOGGER.isDebugEnabled()){\r\n         LOGGER.debug(\"Traça d'exemple\");\r\n      }\r\n   }\r\n\r\n}\r\n~~~~\r\n\r\n### Recomanacions\r\n\r\n#### Recomanacions generals\r\n\r\n-   Mai utilitzar System.out.println.\r\n-   Instancia de manera estàtica i final el log per evitar\r\n    instanciacions innecessàries.\r\n-   Sobreescriu sempre el mètode toString() per donar una representació\r\n    del objecte. Obtenir una traça del tipus className@16cd7d5 no aporta\r\n    res.\r\n-   Valida el nivell de traces abans d'escriure.\r\n\r\n#### Recomanacions davant excepcions\r\n\r\n-   No utilitzar e.printStackTrace.\r\n\r\ne.printStackTrace només imprimeix en consola. Només es podrà visualitzar\r\naquesta informació si s'ha definit un appender de consola.\r\n\r\n~~~~ {.code-java}\r\ntry {\r\n   ................\r\n} catch ( unaException e) {\r\n    e.printStackTrace();\r\n}\r\n~~~~\r\n\r\nUtilitzar LOGGER.error(message, t) on t es la excepció capturada:\r\n\r\n~~~~ {.code-java}\r\ntry {\r\n    ................\r\n} catch (MyException e) {\r\n    LOGGER.error(\"S'ha produït un error: \", e);\r\n    .........................\r\n}\r\n~~~~\r\n\r\n-   No utilitzar LOGGER.error i després rellançar l'excepció si no és\r\n    estrictament necessari:\r\n\r\n~~~~ {.code-java}\r\ntry {\r\n    ................\r\n} catch (MyException e) {\r\n    LOGGER.error(\"S'ha produït un error: \", e);\r\n    throw e;\r\n}\r\n~~~~\r\n\r\nSi en altres nivells es fa el mateix, s'imprimirà les excepcions\r\ndiverses vegades, portant a la confusió.\r\n\r\n-   No eliminar el stacktrace\r\n\r\n~~~~ {.code-java}\r\ntry{\r\n    ......\r\n}catch(MyException e){\r\n    throw new RuntimeException(\"S'ha produït un error: \" + e.getMessage());\r\n}\r\n~~~~\r\n\r\nAquest codi elimina el stacktrace de MyException. Es perd informació\r\nútil sobre la excepció. La alternativa correcta és:\r\n\r\n~~~~ {.code-java}\r\ntry{\r\n   ...\r\n}catch(MyException e){\r\n   throw new RuntimeException(\"S'ha produït un error: \", e);\r\n}\r\n~~~~\r\n\r\n#### Evitar càlculs innecessaris\r\n\r\nUna de les qüestions més importants del sistema de traces és el cost de\r\ncomputació. Si en un moment donat es desactiven determinats nivells de\r\ntraces, tot i que aquesta traça no es generi a la sortida el missatge és\r\navaluat (ja que es troba com un paràmetre de la crida). Si l'avaluació\r\ndel missatge comporta càlculs estem afegint un cost innecessari.\r\n\r\nPer evitar afegir costos addicionals de còmput innecessari es recomana\r\nprèviament comprovar que es troba activat el nivell pel qual generarem\r\nel missatge. Així, per exemple, enlloc de:\r\n\r\n~~~~ {.code-java}\r\nLOGGER.debug(\"....\");\r\n~~~~\r\n\r\nHaurem sempre de realitzar:\r\n\r\n~~~~ {.code-java}\r\nif (LOGGER.isDebugEnabled())\r\nLOGGER.debug(\"....\");\r\n~~~~\r\n\r\n#### Programació de traces\r\n\r\nCom a recomanació de traces i nivell d'aquestes dins d'un mètode podrien\r\nser les següents:\r\n\r\n1.  Traça a nivell debug al començament del mètode, informant els\r\n    paràmetres d'entrada que poden arribar a ser útils per a detectar\r\n    l'operació realitzada.\r\n2.  Traça a nivell info informant de l'operació realitzada, si\r\n    procedeix.\r\n3.  Traça a nivell error o warn per a blocs destinats a la captura\r\n    d'excepcions.\r\n\r\n~~~~ {.code-java}\r\npublic void inserirUsuari(String nom){\r\ntry {\r\n      if (LOGGER.isDebugEnabled()) {\r\n    LOGGER.debug(\"UsuarioDAOImpl:eliminarUsuario ...identificador del usuario:\" + identificadorUsuario);\r\n      }\r\n\r\n      User user = new User();\r\n      user.setName(nom);\r\n      getUserDAO().insert(user);\r\n\r\n      if (LOGGER.isInfoEnabled()) {\r\n     LOGGER.info(\"Usuari \" + user + \" inserit a la BD\");\r\n      }\r\n\r\n }\r\n catch (Exception e) {\r\n    LOGGER.error(\"S'ha produït un error, e);\r\n    ........\r\n }\r\n}\r\n~~~~\r\n\r\n### Generar Informació Contextual\r\n\r\nMoltes vegades no és suficient amb la informació estàndard que es mostra\r\na les traces i és necessari complementar-la amb informació contextual\r\ncóm: usuari que fa la petició, temps d'inici i final, etc. Per afegir\r\naquesta informació, és necessari inicialitzar-la en algun moment de la\r\npetició per què estigui disponible durant tot el processat de la\r\nmateixa. Per tant, el patró de treball a seguir és:\r\n\r\n1.  Inicialització de l'informació addicional abans de processar la\r\n    petició.\r\n2.  Processat de la petició (utilització de l'informació addicional en\r\n    el mòdul de traces).\r\n3.  Finalització de la petició.\r\n\r\n**Canigó** suporta la inserció d'aquesta informació mitjançant la\r\nextensió del filtre\r\nLoggingFilter.\r\nGracies al mètode createCustomParameters, el desenvolupador pot afegir o\r\neliminar paràmetres de la Mapped Diagnostic Context (MDC) de Log4j que\r\nposteriorment seran inserits a les traces de l'aplicació.\r\n\r\nUn exemple de filtre que afegeix informació de l'usuari, adreça i host\r\nremot a les traces podria ser:\r\n\r\n~~~~ {.code-java}\r\n...\r\npublic class ExtendedLoggingFilter extends LoggingFilter {\r\n\r\n     private final static String USERNAME = \"USERNAME\";\r\n     private final static String REMOTEHOST = \"REMOTEHOST\";\r\n     private final static String REMOTEADDR = \"REMOTEADDR\";\r\n\r\n     @Override\r\n     protected Map<String, Object> createCustomParameters( ServletRequest request, ServletResponse response) {\r\n\r\n           Map<String,Object> custom = new HashMap<String, Object>();\r\n       custom.put(REMOTEHOST, request.getRemoteHost());\r\n           custom.put(REMOTEADDR, request.getRemoteAddr());\r\n\r\n       HttpServletRequest httprequest = (HttpServletRequest) request;\r\n           String userLogin = (String)httprequest .getSession().getAttribute(\"userLogin\");\r\n\r\n            if (userLogin!=null) {\r\n                custom.put(USERNAME, userLoginId);\r\n            }\r\n\r\n           return custom;\r\n     }\r\n}\r\n~~~~\r\n\r\nConfiguració del layout per a mostrar les dades:\r\n\r\n~~~~ {.code-java}\r\n<appender name=\"console\" class=\"org.apache.log4j.ConsoleAppender\">\r\n    <layout class=\"org.apache.log4j.PatternLayout\">\r\n        <param name=\"ConversionPattern\" value=\"%-4r [%t] %5p %c %x - %m - %X{USERNAME}%n - %X{REMOTEHOST} - %X{REMOTEADDR}\"/>\r\n    </layout>\r\n</appender>\r\n~~~~\r\n\r\nEines de Suport\r\n---------------\r\n\r\n### Java Templates per a Eclipse\r\n\r\nEclipse ofereix unes eines que faciliten o agilitzen la creació de codi\r\nrepetitiu.\r\n\r\nDins d'Eclipse:\r\n **Window -> Preferences -> Java -> Editor -> Templates.**\r\n\r\nCreem un nou template amb el nom **log**:\r\n\r\n~~~~ {.code-java}\r\nprivate static final ${loggerType:newType(org.apache.commons.logging.Log)} logger =\r\n   ${logFactoryType:newType(org.apache.commons.logging.LogFactory)}\r\n   .getLog(${enclosing_type}.class);\r\n~~~~\r\n\r\nUn cop ja a la classe, si escrivim **log** seguit de CTRL + BARRA ESPAI.\r\nEclipse ens crearà el següent codi automàticament:\r\n\r\n~~~~ {.code-java}\r\nprivate static final Log LOGGER= LogFactory.getLog(NomClasse.class);\r\n~~~~\r\n\r\nUn altre template interessant és el següent:\r\n\r\n~~~~ {.code-java}\r\nif (LOGGER.isDebugEnabled()) {\r\n   LOGGER.debug(${msg});\r\n}\r\n~~~~\r\n\r\nQue generaria el codi recomanat per a traces de nivell DEBUG.\r\n\r\n## Annexos\r\n\r\n### Introducció a Log4J\r\n\r\nEn aquest annex s'ofereix una breu introducció a conceptes de Log4J que\r\ncal entendre per utilitzar el Servei de Traces.\r\n\r\nA Log4J, existeixen varis elements clau:\r\n\r\n1.  Prioritats o nivells de les traces. Log4J defineix per defecte 5\r\n    nivells: DEBUG, INFO, WARN, ERROR i FATAL. Entre ells existeix una\r\n    jerarquia (DEBUG<INFO<WARN<ERROR<FATAL), de forma que si en\r\n    l'aplicació s'ha configurat que només es mostrin traces de nivell\r\n    WARN, també es mostrarien els de nivell ERROR i FATAL.\r\n    \r\n    ![](/related/canigo/documentacio/modul-traces/ServeiTraces_img014.jpg)\r\n    \r\n2.  Categories. Les categories donen control al programador per a\r\n    determinar quins events requereixen ser capturats i quins no. Dins\r\n    de l'aplicació es poden definir diferents categories organitzades\r\n    per jerarquia que en la majoria dels casos es mapejen amb el nom\r\n    qualificat de les classes java, a on cada classe tindria la seva\r\n    categoria. També poden crear-se categories per nom, de manera que\r\n    podria definir-se una categoria que fes traces de les conexions RMI\r\n    de l'aplicació, o de totes les operacions del usuari, etc.\r\n    \r\n3.  Appenders. Els \"appenders\" especifiquen a on es desarà la traça\r\n    definida per a la categoria. Una categoria pot definir diferents\r\n    sortides o \"appenders\" a la vegada (consola, fitxer, correu\r\n    electrònic, base de dades,etc.)\r\n    \r\n4.  Layouts. Permeten especificar com es mostren els events. Per exemple\r\n    podem especificar que ens aparegui l'hora en la que s'ha produït\r\n    l'event, qui ho ha llençat, la línia en la que s'ha fet, etc.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC10cmFjZXM="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kbmk=":{"date":1426783321000,"title":"DNI","description":"Servei de verificació i consulta de DNI de la DGP.","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-integracio/modul-dni","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector, és el de proporcionar un punt d'accés utilitzant la plataforma PICA cap servei de verificació i consulta de DNI de la DGP.\r\n\r\n## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduida al connector de la Pica que simplifica l'utilització del servei de consulta i verificació de DNI's ofert per la generalitat.\r\n\r\n## Context i Escenaris d'ús\r\n\r\nEl connector PICA-DNI es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n## A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Documents i Fonts de Referència\r\n\r\n| Nom Document\r\n| ----------\r\n| Guia d'ús de l'API del Connector PICA-DNI.\r\n| Documentació funcional i tècnica del Connector PICA-DNI.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents funcionalitats referents a les següent operacions amb un DNI:\r\n\r\n**Funcionalitats de Consulta**\r\n\r\n* Consulta Bàsica: Funcionalitat que permet la consulta de les dades d'un DNI subministrant un conjunt mínim de dades.\r\n* Consulta Estesa: Funcionalitat que permet la consulta de les dades d'un DNI donant la possibilitat d'escollir d'entre un conjunt més ampli de dades d'entrada.\r\n\r\n**Funcionalitats de Verificació**\r\n\r\n* **Verificació Bàsica:** Funcionalitat que permet la verificació de les dades d'un DNI subministrant un conjunt mínim de dades.\r\n* **Verificació Estesa:** Funcionalitat que permet la verificació de les dades d'un DNI donant la possibilitat d'escollir d'entre un conjunt més ampli de dades d'entrada.\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent aquests components a les següents url's:\r\n\r\nCodi Font : http://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.dni.pica/1.2.0/\r\n\r\n### Requeriments\r\n\r\nEl connector DNI és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector DNI funcioni correctament sobre l'aplicació que l'utilitzi, s'ha de tenir configurat el servei connector genèric de la PICA 1.1.0.\r\n\r\n## Configuració\r\n\r\nPer configurar el mòdul d'integració PICA-DNI és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-DNI amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml;\r\n\r\n```\r\n<canigo.integration.dni.pica.version>[1.2.0,1.3.0)</canigo.integration.dni.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-DNI -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.dni.pica</artifactId>\r\n    <version>${canigo.integration.dni.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/dni.properties amb el següent contingut:\r\n\r\n```\r\n*.dni.finalitat=[finalitat]\r\n*.dni.urlPica=[urlPica]\r\n*.dni.nifEmisor=[nifEmisor]\r\n*.dni.nomEmisor=[nomEmisor]\r\n*.dni.nomFuncionari=[nomFuncionari]\r\n*.dni.nifFuncionari=[nifFuncionari]\r\n*.dni.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-dni.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n## Utilització del Connector\r\n\r\n### Exemple d'utilització Consulta de DNI\r\n\r\nRecuperar el bean del servei de DNI des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate DniConnectorImpl dniConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nDadesConsultaDni resposta = dniConnector.dniConsultaBasica(numero_document, tipus_document, cognom1, anyNaixement);\r\n```\r\n\r\non, **numero_document** correspon al valor del número del document utilitzat i **tipus_document** correspon al tipus de document que es vol subministrar (Constants.DNI, Constants.NIE, Constants.NIF).\r\nÉs obligatori informar el **cognom1**(primer Cognom) o bé l'**anyNaixement**\r\n\r\nEn cas que es vulgui sobreescriure les dades del funcionari especificats en el fitxer dni.properties, és possible fer-ho abans de fer la crida al servei:\r\n\r\n```java\r\nFuncionari funcionari = new Funcionari();\r\nfuncionari.setNombreFuncionario(\"Nom Cognoms Funcionari\");\r\nfuncionari.setNifFuncionario(\"NIF\");\r\nfuncionari.setEmailFuncionario(\"mail\");\r\n\r\ndniConnector.setFuncionari(funcionari);\r\n\r\nPer consultar l'estat de la resposta;\r\n\r\nEstatResultat estat = resposta.getEstat();\r\n```\r\n\r\n* En cas de que les dades no corresponguin amb un DNI, típicament es retornaran aquestes dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TITULAR NO IDENTIFICADO\", estat.getDescripcio());\r\nAssert.assertEquals(\"0233\", estat.getCodiEstat());\r\n```\r\n\r\n* En cas de que les dades si corresponguin a un DNI, típicament es retornaran les següents dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TRAMITADA\", estat.getDescripcio());\r\nAssert.assertEquals(\"0003\", estat.getCodiEstat());\r\n```\r\n\r\nLes dades associades a la consulta d'un DNI es poden recuperar amb:\r\n\r\n```java\r\nresposta.getTitular();\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn consultar el document de la PICA Guia d'us del servei de DNI v.1.9.pdf disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n\r\n### Exemple d'utilització Verificació DNI\r\n\r\nRecuperar el bean del servei de DNI des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate DniConnectorImpl dniConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nEstatResultat resposta = dniConnector.dniVerificacioBasica(numero_document, tipus_document, nom, cognom1, cognom2, sexe);\r\n```\r\n\r\non, **numero_document** correspon al valor del número del document utilitzat;<br>\r\n**tipus_document** correspon al tipus de document que es vol subministrar (Constants.DNI, Constants.NIE, Constants.NIF);<br>\r\n**nom** nom del titular del DNI;<br>\r\n**cognom1** primer cognom del titular del DNI;<br>\r\n**cognom2** segon cognom del titular del DNI;<br>\r\n**sexe** sexe del titular del DNI (Constants.MASCULI o Constants.FEMENI)\r\n\r\n* En cas de que les dades no corresponguin amb un DNI, típicament es retornaran aquestes dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TITULAR NO IDENTIFICADO\", resposta.getDescripcio());\r\nAssert.assertEquals(\"0233\", resposta.getCodiEstat());\r\n```\r\n\r\n* En cas de que les dades si corresponguin a un DNI, típicament es retornaran les següents dades:\r\n\r\n```java\r\nAssert.assertEquals(\"TRAMITADA\", estat.getDescripcio());\r\nAssert.assertEquals(\"0003\", estat.getCodiEstat());\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn consultar el document de la PICA **Guia d'us del servei de DNI v.1.9.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kbmk="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kb2N1bWVudHVt":{"date":1426765232000,"title":"Documentum","description":"Accés al gestor documental corporatiu del CTTI.","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-integracio/modul-documentum","content":"## Propòsit\r\n\r\nEl propósit del connector és proporcionar una interfície Java per accedir a Documentum. Permetent emmagatzemar i recuperar documents a més d'altres operacions relacionades com crear carpetes i associar propietats.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació del DFC\r\n\r\nPrevi a la utilització del servei cal instal.lar a la màquina de desenvolupament/servidor la DFC's de la versió de Documentum que es farà servir :\r\n\r\n* Documentum 5.3 \r\n* Documentum 6.5\r\n* Documentum 7.1 \r\n\r\nEn cas de no comptar amb aquests instal·lable, es pot sol·licitar a la bústia canigó <oficina-tecnica.canigo.ctti@gencat.cat>\r\n\r\n\r\n\r\nEls passos a seguir en l'instal.lació són els següents (similars a les 3 versions):\r\n\r\n![Instal.lació documentum pas 1](/related/canigo/documentacio/modul-documentum/image005.jpg \"Instal.lació documentum pas 1\")\r\n\r\n![Instal.lació documentum pas 2](/related/canigo/documentacio/modul-documentum/image006.jpg \"Instal.lació documentum pas 2\")\r\n\r\n![Instal.lació documentum pas 3](/related/canigo/documentacio/modul-documentum/image007.jpg \"Instal.lació documentum pas 3\")\r\n\r\n![Instal.lació documentum pas 4](/related/canigo/documentacio/modul-documentum/image008.jpg \"Instal.lació documentum pas 4\")\r\n\r\nAquí indicarem el host i el port del docBroker que conté el magatzem de claus.\r\n\r\n![Instal.lació documentum pas 5](/related/canigo/documentacio/modul-documentum/image009.jpg \"Instal.lació documentum pas 5\")\r\n\r\n![Instal.lació documentum pas 6](/related/canigo/documentacio/modul-documentum/image010.jpg \"Instal.lació documentum pas 6\")\r\n\r\n![Instal.lació documentum pas 7](/related/canigo/documentacio/modul-documentum/image011.jpg \"Instal.lació documentum pas 7\")\r\n\r\n![Instal.lació documentum pas 8](/related/canigo/documentacio/modul-documentum/image012.jpg \"Instal.lació documentum pas 8\")\r\n\r\n![Instal.lació documentum pas 9](/related/canigo/documentacio/modul-documentum/image013.jpg \"Instal.lació documentum pas 9\")\r\n\r\n![Instal.lació documentum pas 10](/related/canigo/documentacio/modul-documentum/image014.jpg \"Instal.lació documentum pas 10\")\r\n\r\nCom a resultat de la instalació es generarà un arxiu amb la configuració d'accés a documentum.\r\n\r\nEn el cas de Documentum 5.3,  aquest es generarà per defecte a **C:\\WINDOWS\\dmcl.ini** i tindrà el format següent:\r\n```\r\n[DOCBROKER_PRIMARY]\r\nhost =es-hg2r02j\r\nport =1489\r\n\r\n[DMAPI_CONFIGURATION]\r\ncache_queries = T\r\ntoken_storage_enabled=F\r\ntoken_storage_path=D:\\Documentum\\apptoken\r\n```\r\n\r\nEn el cas de Documentum 6.5 i 7.1, aquest es generarà per defecte a **C:\\Documentum\\config\\dfc.properties** i tindrà el format següent:\r\n```\r\ndfc.data.dir=C\\:/Documentum\r\ndfc.registry.mode=windows\r\ndfc.search.ecis.enable=false\r\ndfc.search.ecis.host=\r\ndfc.search.ecis.port=\r\ndfc.tokenstorage.dir=C\\:/Documentum/apptoken\r\ndfc.tokenstorage.enable=false\r\ndfc.docbroker.host[0]=nomHostDocumentum\r\ndfc.docbroker.port[0]=PortHostDocumentum\r\ndfc.globalregistry.repository=NomRepositoriClaus\r\ndfc.globalregistry.username=usernameRepositoriClaus\r\ndfc.globalregistry.password=passRepositoriClaus\r\n```\r\n\r\n### Instal·lació del connector\r\n\r\n\r\nPer tal d'instal- lar el mòdul de Documentum es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\nPer a la versió 5.3 de Documentum:\r\n\r\n```\r\n<canigo.integration.documentum.version>[1.1.0,1.2.0)</canigo.integration.documentum.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.documentum</artifactId>\r\n          <version>${canigo.integration.documentum.version}</version>\r\n</dependency>\r\n```\r\n\r\nPer a la versió 6.5\r\n\r\n```\r\n<canigo.integration.documentum.version>[2.1.0,2.2.0)</canigo.integration.documentum.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.documentum</artifactId>\r\n          <version>${canigo.integration.documentum.version}</version>\r\n</dependency>\r\n```\r\n\r\nPer a la versió 7.1\r\n\r\n```\r\n<canigo.integration.documentum.version>[3.0.0,3.1.0)</canigo.integration.documentum.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.documentum</artifactId>\r\n          <version>${canigo.integration.documentum.version}</version>\r\n</dependency>\r\n```\r\n\r\n#### Dependències amb llibreries del DFC instal·lat\r\nEls connectors tenen dependències amb llibreries de la versió del DFC instal·lat. Aquestes llibreries s'inclouen amb la instal·lació del DFC, a la carpeta **C:\\Program Files\\Documentum\\Shared\\**. Caldrà afegir-les al repositori .m2 local per tal que Maven les resolgui.\r\n\r\nPer a la versió de DFC 7.1 , serà necessari instal·lar les següents llibreries :\r\n```\r\nmvn install:install-file -Dfile=\"dfc.jar\" -DgroupId=dfc -DartifactId=dfc -Dversion=7.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"certj.jar\" -DgroupId=certj -DartifactId=certj -Dversion=5.2 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"configservice-api.jar\" -DgroupId=configservice -DartifactId=configservice-api -Dversion=7.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"configservice-impl.jar\" -DgroupId=configservice -DartifactId=configservice-impl -Dversion=7.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"jcmFIPS.jar\" -DgroupId=jcmFIPS -DartifactId=jcmFIPS -Dversion=6.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"jcifs-krb5-1.3.1.jar\" -DgroupId=jcifs-krb5 -DartifactId=jcifs-krb5 -Dversion=1.3.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"cryptojce.jar\" -DgroupId=cryptojce -DartifactId=cryptojce -Dversion=6.1 -Dpackaging=jar\r\nmvn install:install-file -Dfile=\"cryptojcommon.jar\" -DgroupId=cryptojcommon -DartifactId=cryptojcommon -Dversion=6.1 -Dpackaging=jar\r\n```\r\n\r\n\r\n\r\n\r\n### Configuració del connector\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\n#### Propietats del connector\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/documentum.properties\r\n\r\nPropietat                   | Requerit | Descripció\r\n--------------------------- | -------- | ----------\r\n*.documentum.user           | Sí       | Usuari de Documentum\r\n*.documentum.password       | Sí       | Password de Documentum\r\n*.documentum.docBase        | Sí       | Doc base\r\n*.documentum.dir            | Sí       | Directori de Documentum\r\n*.documentum.pathDirectori  | No       | Path directori\r\n*.documentum.pathFitxer     | No       | Path arxiu\r\n*.documentum.nomFitxer      | No       | Nom d'arxiu\r\n*.documentum.extFitxer      | No       | Extensió d'arxiu\r\n*.documentum.pathFitxer2    | No       | Path segon arxiu\r\n*.documentum.nomFitxer2     | No       | Nom del segon arxiu\r\n*.documentum.extFitxer2     | No       | Extensió d'un segon arxiu\r\n*.documentum.pathFitxerOut  | No       | Directori de sortida\r\n*.documentum.dir3           | No       | Directori\r\n*.documentum.user2          | No       | Usuari 2\r\n*.documentum.password2      | No       | Password 2\r\n*.documentum.ACL            | No       | ACL\r\n*.documentum.ACLDomain      | No       | ACL Domain\r\n*.documentum.cicleVida      | No       | Cicle vida\r\n*.documentum.estat          | No       | Estat\r\n*.documentum.grup           | No       | Grup\r\n\r\n#### Propietats del dfc\r\nTambé caldrà incloure al CLASSPATH del projecte el dfc.properties generat durant la instla·lació del DFC. \r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/dfc.properties\r\n\r\n## Utilització del Mòdul\r\n\r\n### JSF\r\n\r\nPer a utilitzar aquest mòdul, cal crear un bean i una jsf:\r\n\r\n**DocumentumBean.java**\r\n\r\nManaged Bean de JSF que gestiona la crida al servei de documentum.\r\n\r\nEn aquest bean es pot visualiztar:\r\n\r\n* Inyecció del servei de Documentum via annotacions (@Autowired) de Spring.\r\n* Inyecció del conector de Documentum via annotacions (@Autowired) de Spring.\r\n* Inyecció del bean de configuració via annotacions (@Autowired) de Spring.\r\n* Inyecció del servei d'internacionaliztació via annotacions (@Autowired) de Spring.\r\n\r\n```java\r\n/**\r\n* Exemple invocació de Documentum 6.5\r\n*\r\n* @author cscanigo\r\n*/\r\n@Component(\"documentumBean\")\r\n@Scope(\"singleton\")\r\n@Lazy\r\npublic class DocumentumBean {\r\n    @Autowired\r\n    private DocumentumService service;\r\n    @Autowired\r\n    private DocumentumConnector documentum;\r\n    @Autowired\r\n    private DocumentumConfigurator configurator;\r\n    @Autowired\r\n    private I18nResourceBundleMessageSource messageResource;\r\n\r\n\r\n    /**\r\n     * Comprovem que es pot fer login al sistema de Documentum\r\n     */\r\n    public void submit(){\r\n\r\n        try{\r\n            service.login(configurator.getUser(), configurator.getPassword(),\r\n                    configurator.getDocBase(), this.documentum);\r\n        }catch(Exception e){\r\n             FacesContext.getCurrentInstance().addMessage(\"documentumForm\", new FacesMessage(\r\n                        FacesMessage.SEVERITY_ERROR, messageResource.getMessage(\"documentumError\"), null));\r\n        }\r\n        FacesContext.getCurrentInstance().addMessage(\"documentumForm\", new FacesMessage(\r\n                FacesMessage.SEVERITY_INFO, messageResource.getMessage(\"documentumSuccess\"), null));\r\n    }\r\n}\r\n```\r\n\r\n**documentum.jsf**\r\n\r\nPàgina JSF que conté un commandButton que realitza la crida al mètode \"submit\" del managed bean de JSF.El Tag message mostrarà el resultat de la crida (veure FacesContext.getCurrentInstance().addMessage(\"documentumForm\"....).\r\n\r\n```\r\n<h:form id=\"documentumForm\">\r\n   <h:panelGrid columns=\"1\">\r\n     <h:commandButton value=\"#{msg.canigoSubmit}\" action=\"#{documentumBean.submit}\" />\r\n     <h:message for=\"documentumForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n   </h:panelGrid>\r\n</h:form>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1kb2N1bWVudHVt"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1qc2Y=":{"date":1426158702000,"title":"Mòdul JSF","description":"Capa de presentació Java Server Faces","sections":"Canigó. Documentació versió 3.x","weight":6,"path":"/canigo-documentacio-versions-3x-core/modul-jsf","content":"## Propòsit\r\n\r\nEl propósit d'aquest document és donar una visió general de quina és l'arquitectura base de la capa de presentació JSF i els seus components, així com la configuració necessària. Es tractarà entre d'altres:\r\n\r\n* Quins són els components principals de l'arquitectura de la capa de presentació\r\n* Quin és el patró recomanat en el desenvolupament de les aplicacions\r\n* Quin és el procediment que segueix l'arquitectura interna de canigo en el tractament d'una petició\r\n\r\n## Instal·lació\r\n\r\n### Instal·lació\r\n\r\nAquest mòdul s'afegeix com a dependència de manera directa durant la creació d'una aplicació JSF 1.x amb l'eina de suport al desenvolupament, també es pot afegir de manera manual dins el pom.xml de l'aplicacio:\r\n\r\n```\r\n<canigo.web.jsf.version>[1.2.0,1.3.0)</canigo.web.jsf.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.web.jsf</artifactId>\r\n          <version>${canigo.web.jsf.version}</version>\r\n</dependency>\r\n```\r\n\r\n## Tecnologies utilitzades\r\n\r\n### JavaServer Faces (JSF)\r\n\r\nJavaServer Faces és un framework d'interficie de components d'usuari del costat del servidor per a aplicacions web basades en la tecnologia Java. Els principals components de la tecnologia son:\r\n\r\n* Una API per a representar componentes d'interficie d'usuari i gestionar el seu estat.\r\n* Gestió d'events, validacions i conversió de dades en el servidor.\r\n* Gestió de la navegació entre pàgines.\r\n* Suport d'internacionalització i accesibilitat.\r\n* Conjunt d'etiquetes JSP personalitzades per a representat components en una pàgina JSP i lligar aquests components a objectes de servidor.\r\n\r\nJSF és una especificació desenvolupada per la Java Community Process. Actualment existeixen quatre versions:\r\n\r\n* JSF 1.0 (11-03-2004)\r\n* JSF 1.1 (27-05-2004) - Especificació JSR-127: http://jcp.org/en/jsr/detail?id=127\r\n* JSF 1.2 (11-05-2006) - Especificació JSR-252: http://jcp.org/en/jsr/detail?id=252\r\n* JSF 2.0 (01-07-2009) - Especificació JSR-314: http://jcp.org/en/jsr/detail?id=314\r\n* JSF 2.2 (21-05-2013) - Especificació JSR-344: http://jcp.org/en/jsr/detail?id=344\r\n\r\nCanigó 3.1 està lligat a la especificació **JSF 2.2**, concretament a la implementació de Sun RI.\r\n\r\nEl nou model de programació i les llibreries d'etiquetes faciliten la construcció i manteniment de les aplicacions web. Amb un mínim esforç es podria:\r\n\r\n* Afegir components rics mitjançant etiquetes a les pàgines JSF.\r\n* Enllaçar events generats per aquest components amb el codi d'aplicació en el servidor.\r\n* Relacionar components de la interficie d'usuari en una pàgina amb dades del servidor.\r\n* Construir interficies d'usuaria amb components reutilitzables i extensibles.\r\n* Guardar i restaurar l'estat de la interficie més allà de la vida de les peticions.\r\n\r\nEn resum, JSF proporciona:\r\n\r\n* Una clara separació entre vista i model.\r\n* Desenvolupament bassat en component, no en peticions. El punt més destacable.\r\n* Les accions de l'usuari es lliguen molt facilment al codi del servidor. Facilitat d'integració d'events del client a components del servidor.\r\n* Creació de families de components visuals per a agilitzar el desenvolupament. Juntament amb els tags per defecte de JSF, s'inclouen els tags proporcionats per Richfaces\r\n\r\n### PrimeFaces\r\n\r\nPrimeFaces és un framework de codi obert que afegeix capacitats Ajax dins de les aplicacions JSF existents sense recorre a JavaScript. PrimeFaces inclou cicle de vida, validacions, conversions i la gestió de recursos estàtics i dinàmics. Els components de PrimeFaces, construits amb suport Ajax i un alt grau de personalització del \"look-and-feel\", poden ser incorporats fàcilment dins de les aplicacions JSF.\r\n\r\nPrimeFaces permet:\r\n\r\n* Intensificar els beneficis de JSF mentre es treballa amb Ajax. PrimeFaces està totalment integrat al cicle de vida de JSF.\r\n* Afegeix les capacitats d'Ajax dins de les aplicacions JSF. No hi ha la necesitat de escriure cap codi Javascript o canviar els components existents per altres amb suport d'Ajax. Mitjançant events activats pel client, s'invoca una petició Ajax que després de canviar dades en el servidor actualitza o renderitza parts de la pàgina indicades pel desenvolupador.\r\n* Crear components rics pròpis amb suport Ajax de manera àgil.\r\n* Suport de \"pells\" o skins. Els desenvolupadors poden integrar nous estils a la UI.\r\n\r\nMés informació a http://www.primefaces.org/.  \r\nGuia d'usuari a http://www.primefaces.org/docs/guide/primefaces_user_guide_5_0.pdf  \r\nExemples i llistat de components suportats a http://www.primefaces.org/showcase/\r\n\r\n### Facelets\r\n\r\nJavaServer Facelets és un framework per a plantilles (templates) centrat en la tecnologia JSF (JavaServer Faces). Les característiques més remarcables d'aquest framework son:\r\n\r\n* Facilitat en la creació del templating per als components i pàgines.\r\n* Habilitat de separar els UIComponents en diferents arxius.\r\n* Suport complet de EL (Expression Language).\r\n* Validació de EL en temps de construcció.\r\n* No és necesaria cap configuració XML.\r\n\r\nMés informació a https://facelets.java.net/\r\n\r\n## Avantatges de JSF sobre Struts\r\n\r\nEls principals avantatges de JSF sobre Struts son:\r\n\r\n* Components personalitzats: JSF permet combinar fàcilment GUIs complexes en un component mentre que Struts no.\r\n* Millor suport per a Ajax: Una gran part de llibreries de components donen suport a Ajax. Struts no te realment aquestes llibreries de components.\r\n* Dona suport per altres tecnologíes de visualització: JSF no está limitat a HTML i HTTP, mentre que Struts sí.\r\n* Accés a beans per nom: JSF permet assignar noms a beans i posteriorment accedir directament a ells des d'un formulari. Struts disposa d'un proces complex per a accedir-hi.\r\n* El llenguatge de expresió (EL) és més concis i potent a JSF.\r\n* Controladors i definicions de beans més simples: JSF no exigeix que el teu controlador i les classes bean siguin exteses a alguna clase pare en particular (per exemple, Action) o facin servir algún mètode en particular (per exemple, execute).\r\n* Arxius de configuració més simples.\r\n* Eines més potents: JSF dispossa d'eines que faciliten al desenvolupador la construcció d'interficies visuals mitjançant eines de \"drag-and-drop\".\r\n\r\n## Descripció Detallada\r\n\r\n### Arquitectura i Components\r\n\r\n#### Cicle de vida\r\n\r\nEl cicle de vida d'una aplicació JSF descriu totes les accions portades a terme desde que el client inicialitza una sessió. La majoria de les fases d'una aplicació JSF son gestionades pel framework JSF, deixant només una petita part com a responsabilitat del desenvolupador. Les fases que compossen el cicle de vida son sis (caixes de color verd) i es poden observar en la següent imatge:\r\n\r\n![Fases de vida framework JSF](/related/canigo/documentacio/modul-jsf/JsfIntro-lifecycle.gif \"Fases de vida framework JSF\")\r\n<br><br>\r\n\r\n#### Restauració de la vista\r\n\r\nUna vista en JSF representa un arbre de componentes IU. Cadascuna de les peticions al servidor te el seu contexto JSF on s'emagatzema un graf de la vista actual de la sesió. La responsabilidad primaria d'aquesta fase es identificar la vista actual des del contexte JSF, en cas de no existir, es creara una vista nova. Si el graf de la vista existeix, es restaura i es mostra al usuari. Aquest procés és automàtic i no és responsabilitat del desenvolupador.\r\n\r\n#### Assignar els valors de la petició\r\n\r\nDesprés de restaurar la vista, els valos ingresats pel client de l'aplicació es mapejen als components UI corresponents. Per exemple, en una interficie que conté un formulari, cada cop que es realitza un enviament d'informació al servidor, JSF iterarà sobre l'arbre de components, agafarà cadascun dels seus valos i els assignarà al component corresponent. Aquest procés és automàtic i no és responsabilitat del desenvolupador.\r\n\r\n#### Validació de les dades d'usuari\r\n\r\nJSF iterarà sobre tots els nodes de l'arbre de components UI cridant tant al validador per defecte (si existeix) com als validadors personificables segons la configuració pròpia de cada component. Aquest procés és automàtic però és responsabilitat del desenvolupador configurar els validadors en cadascun dels components.\r\n\r\n#### Actualitzar objectes del model\r\n\r\nDurant aquesta fase, els valors dels components mapejats i validats es situen en els Java Beans corresponents. Aquest procés és automàtic però es responsabilitat del desenvolupador indicar el mapeig del component amb l'atribut del Java Bean.\r\n\r\n#### Executar la lògica de l'aplicació\r\n\r\nMitjançant el mecanisme de mapeig d'events s'executen les funcions definides en els Java Bean per portar a terme les operacions o lògica de negoci pròpia de l'aplicació. És responsabilitat del programador tant el mapeig d'events com la lògica pròpia de l'aplicació.\r\n\r\n#### Renderització de la resposta\r\n\r\nD'acord amb el mecanisme de mapeig de navegació, en funció dels resultats obtinguts durant la fase anterior, es selecciona o renderitza la vista apropiada a mostrar a l'usuari. És responsabilitat del desenvolupador gestionar la lògica de navegació de l'aplicació.\r\n\r\n### Instal- lació i configuració\r\n\r\n#### Configuració bàsica\r\n\r\n#### Paràmetres de context\r\n\r\nFitxer de configuració: web.xml\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/webapp/WEB-INF/web.xml\r\n\r\nEn aquest apartat definirem els següents paràmetres:\r\n\r\n* **contextConfigLocation:** indica la localització dels beans que posteriorment Spring carregarà al context de l'aplicació. La configuració per defecte proporcionada per l'eina carrega de manera automàtica tots els XMLs aplicatius que es troben en config/spring.\r\n* **javax.faces.application.CONFIG_FILES:** Indica la localització de l'arxiu de faces-config.xml de JSF.\r\n* **javax.faces.DEFAULT_SUFFIX:** Extensió per defecte si l'aplicació web está fent servir url extension mapping.\r\n* **primefaces.THEME:** Nom del skin utilitzat per l'aplicació. Pot ser un literal o bé una expressió EL (#{beanName.property}).\r\n* **facelets.DEVELOPMENT:** Indica que estem en un entorn de desenvolupament, i davant error en la aplicació es mostrarà una pàgina detallada amb la informació del mateix, així com l'arbre de components jsf que tenim en memòria.\r\n\r\n#### Listeners\r\n\r\nFitxer de configuració: web.xml\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/webapp/WEB-INF/web.xml\r\n\r\nEn aquest apartat definirem els següents listeners:\r\n\r\n```\r\ncom.sun.faces.config.ConfigureListener: Encarregat de configurar el runtime de JavaServer Faces.\r\norg.springframework.web.context.ContextLoaderListener: Listener encarregat de carregar els arxius de context (contextConfigLocation). Spring crea un objecte del tipus WebApplicationContext a partir de les definicions dels beans del arxius carregats i l'injecta al ServletContext.\r\norg.springframework.web.context.request.RequestContextListener: Listener que exposa la request al thread actual. Es pot accedir a la request amb les classes LocaleContextHolder i RequestContextHolder.\r\n```\r\n\r\n#### Filtres\r\n\r\nFitxer de configuració: web.xml\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/webapp/WEB-INF/web.xml\r\n\r\nEn aquest apartat definirem els següents filtres:\r\n\r\n    cat.gencat.ctti.canigo.arch.web.core.filters.LoggingFilter: Filtre que inicialitza les traces de l'aplicació. Es pot sobrecarregar aquest filtre per afegir dades aplicatives al pattern de log4j.\r\n    cat.gencat.ctti.canigo.arch.web.jsf.filter.ErrorHandlerFilter: Filtre que s'encarrega de gestionar les peticions errònies no controlades, redirigitn-les a una plana genèrica d'error.\r\n    cat.gencat.ctti.canigo.arch.web.core.filters.LocalizationFilter: Filtre que proporciona a l'aplicació el suport d'internacionalització a l'aplicació.\r\n    cat.gencat.ctti.canigo.arch.web.core.filters.urlrewrite.UrlRewriteFilter: Java Web Filter que permet reescriure les URLs per convertirles en amigables. Més informació a http://www.tuckey.org/urlrewrite/.\r\n\r\n#### Servlets\r\n\r\nFitxer de configuració: web.xml\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/webapp/WEB-INF/web.xml\r\n\r\nEn aquest apartat definirem els següents servlets:\r\n\r\n* javax.faces.webapp.FacesServlet: Representa el motor o engine de les aplicacions JSF.\r\n\r\n#### Separació contingut estàtic i dinàmic (RichFaces 4.x)\r\n\r\nPer tal de poder separar el contingut estàtic i dinàmic en aplicacions Canigó 3 amb JSF 2 + Primefaces 5 cal fer les següents configuracions:\r\n\r\n1) Al fitxer faces-config.xml afegir la següent entrada:\r\n\r\n```\r\n<view-handler>cat.gencat.ctti.canigo.arch.web.jsf.view.CanigoViewHandler</view-handler>\r\n```\r\n\r\n2) I afegir al fitxer web.xml el següent codi:\r\n\r\n```\r\n<context-param>\r\n  <param-name>cat.gencat.ctti.canigo.arch.web.jsf.JSF_RESOURCE_PREFIX</param-name>\r\n  <param-value>/AppJava</param-value>\r\n</context-param>\r\n<context-param>\r\n  <param-name>cat.gencat.ctti.canigo.arch.web.jsf.JSF_RESOURCE_PREFIX_MAPPINGS</param-name>\r\n  <param-value>rfRes;javax.faces.resource</param-value>\r\n</context-param>\r\n```\r\n\r\nEl valor del paràmetre JSF_RESOURCE_PREFIX és el que es concatena abans de les URLs que continguin el valor del paràmetre definit a JSF_RESOURCE_PREFIX_MAPPINGS. En aquest segons paràmetre es poden definir tots els paths que es vulgui separats per ;\r\n\r\n## Estils Canigó (Primefaces 5.0)\r\n\r\n### Introducció\r\n\r\nPer tal de poder adaptar la nova capa de presentació basada en la tecnologia JSF als estils de Canigó s'han de tindre en compte els següents aspectes:\r\n\r\n* Els components de primefaces utilitzats en les nostres JSF's determinen la seva aparença en skins de primefaces, aquests skins són un conjunt de classes definides en uns css.\r\n* Cada component de primefaces té definides una sèrie de classes per defecte. Són aquestes classes les que s'hauran de modificar per tal d'adaptar l'estil d'una JSF al desitjat.\r\n\r\n### Components\r\n\r\nEn aquesta secció es presentarà cada component per separat amb una captura de pantalla, el codi jsf necessari per implementar-lo i l'estil aplicat\r\n\r\n#### Menús\r\n\r\n##### Exemple Component\r\n\r\n![Fases de vida framework JSF](/related/canigo/documentacio/modul-jsf/menu_rf_4x.jpg)\r\n\r\n##### Codi Jsf\r\n\r\n```\r\n<ui:composition>\r\n      <h:form>\r\n\t      <p:dataList value=\"#{menuBean.menu.defaultOpt}\" id=\"llistaMenu\" var=\"menu\" type=\"unordered\" emptyMessage=\"\" >\r\n\t            <h:link rendered=\"#{menu.link != null}\" value=\"#{msg[menu.value]}\" outcome=\"#{menu.link}\" />\r\n                    <p:commandLink rendered=\"#{menu.link == null}\" value=\"#{msg[menu.value]}\"></p:commandLink>\r\n\t\t\t  \r\n\t            <p:dataList value=\"#{menu.submenu}\" id=\"llistaSubmenu\" var=\"submenu\" type=\"unordered\" emptyMessage=\"\">\r\n\t                  <h:link rendered=\"#{submenu.link != null}\" value=\"#{msg[submenu.value]}\" outcome=\"#{submenu.link}\" />\r\n\t                  <p:commandLink rendered=\"#{submenu.link == null}\" value=\"#{msg[submenu.value]}\"></p:commandLink>\r\n\t\t\t    \r\n\t                   <p:dataList value=\"#{submenu.submenu}\" id=\"llistaSubSubmenu\" var=\"subsubmenu\" type=\"unordered\" emptyMessage=\"\">\r\n\t                           <h:link rendered=\"#{subsubmenu.link != null}\" value=\"#{msg[subsubmenu.value]}\" outcome=\"#{subsubmenu.link}\" />\r\n\t                           <p:commandLink rendered=\"#{subsubmenu.link == null}\" value=\"#{msg[subsubmenu.value]}\"></p:commandLink>\r\n\t                   </p:dataList>\r\n\t            </p:dataList>\r\n\t      </p:dataList>\r\n      </h:form>    \r\n</ui:composition>\r\n```\r\n\r\n##### Codi xml\r\n\r\nDefinir el menú en /src/main/resources/spring/app-custom-menu.xml\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:context=\"http://www.springframework.org/schema/context\"\r\n\txmlns:aop=\"http://www.springframework.org/schema/aop\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \r\n\txmlns:p=\"http://www.springframework.org/schema/p\"\r\n\txmlns:util=\"http://www.springframework.org/schema/util\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n            http://www.springframework.org/schema/beans/spring-beans-3.0.xsd\r\n            http://www.springframework.org/schema/aop \r\n\t\t\thttp://www.springframework.org/schema/aop/spring-aop-3.0.xsd\r\n\t\t\thttp://www.springframework.org/schema/context \r\n\t\t\thttp://www.springframework.org/schema/context/spring-context-3.0.xsd\r\n\t\t\thttp://www.springframework.org/schema/util \r\n\t\t\thttp://www.springframework.org/schema/util/spring-util-3.0.xsd\">\r\n\t\r\n\t<bean lazy-init=\"true\" id=\"menuBean\" class=\"cat.gencat.ctti.canigo.arch.web.jsf.MenuBean\">\r\n\t\t<property name=\"menu\">\r\n\t\t\t<map>\r\n\t\t\t\t<entry key=\"defaultOpt\">\r\n\t\t\t\t<list>\r\n\t\t\t\t\t<map>\r\n\t\t\t\t\t\t<entry key=\"value\" value=\"menuApartat1\"></entry>\r\n\t\t\t\t\t\t<entry key=\"submenu\">\r\n\t\t\t\t\t\t\t<list>\r\n\t\t\t\t\t\t\t\t<map>\r\n\t\t\t\t\t\t\t\t\t<entry key=\"value\" value=\"menuSubapartat1\"></entry>\r\n\t\t\t\t\t\t\t\t</map>\r\n\t\t\t\t\t\t\t\t<map>\r\n\t\t\t\t\t\t\t\t\t<entry key=\"value\" value=\"menuSubapartat2\"></entry>\r\n\t\t\t\t\t\t\t\t\t<entry key=\"submenu\">\r\n\t\t\t\t\t\t\t\t\t\t<list>\r\n\t\t\t\t\t\t\t\t\t\t\t<map>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<entry key=\"value\" value=\"menuSubsubapartat1\"></entry>\r\n\t\t\t\t\t\t\t\t\t\t\t</map>\r\n\t\t\t\t\t\t\t\t\t\t\t<map>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<entry key=\"value\" value=\"menuSubsubapartat2\"></entry>\r\n\t\t\t\t\t\t\t\t\t\t\t</map>\r\n\t\t\t\t\t\t\t\t\t\t</list>\r\n\t\t\t\t\t\t\t\t\t</entry>\r\n\t\t\t\t\t\t\t\t</map>\r\n\t\t\t\t\t\t\t\t<map>\r\n\t\t\t\t\t\t\t\t\t<entry key=\"value\" value=\"menuSubapartat3\"></entry>\r\n\t\t\t\t\t\t\t\t</map>\r\n\t\t\t\t\t\t\t\t<map>\r\n\t\t\t\t\t\t\t\t\t<entry key=\"value\" value=\"menuSubapartat4\"></entry>\r\n\t\t\t\t\t\t\t\t</map>\r\n\t\t\t\t\t\t\t</list>\r\n\t\t\t\t\t\t</entry>\r\n\t\t\t\t\t</map>\r\n\t\t\t\t</list>\r\n\t\t\t\t</entry>\r\n\t\t\t</map>\r\n\t\t</property>\r\n\t</bean>\r\n</beans>\r\n```\r\n\r\n#### Taules\r\n\r\n##### Exemple Component\r\n\r\n##### Codi Jsf\r\n\r\n```\r\n<ui:define name=\"body\">\r\n\t<p:dataTable id=\"taulaPropietats\" \r\n\t\tcellpadding=\"0\" cellspacing=\"0\" width=\"700\" border=\"0\" var=\"key\"\r\n\t\tvalue=\"#{propertyService.itemKeys}\" styleClass=\"taula\">\r\n\t\r\n\t\t<p:column>\r\n\t\t\t<f:facet name=\"header\">#{msg.propertyExposeKey}</f:facet>\r\n\t\t\t<h:outputText value=\"${key}\" />\r\n\t\t</p:column>\r\n\t\r\n\t\t<p:column>\r\n\t\t\t<f:facet name=\"header\">#{msg.propertyExposeValue}</f:facet>\r\n\t\t\t<h:outputText value=\"#{propertyService.values[key]}\" />\r\n\t\t</p:column>\r\n\t\r\n\t</p:dataTable>\r\n</ui:define>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtY29yZS9tb2R1bC1qc2Y="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hdmlzb3MtaS1hbGVydGVz":{"date":1426853089000,"title":"Avisos i  alertes","description":"Serveisd'enviament de SMS i CORREU del CTTI a través del servei AVISALERT de la PICA.","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-integracio/modul-avisos-i-alertes","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector és el de proporcionar accés als serveis d'enviament de SMS i CORREU del CTTI a través del servei AVISALERT de la PICA.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduïda al connector de la Pica que simplifica l'utilització dels diferents serveis d'enviament de SMS i MAIL oferts per la generalitat.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector PICA-AVISALERT es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet utilitzar les diferents modalitats del servei AVISALERT en les seves modalitats asíncrones i síncrones, a través de les modalitats de sevei següents:\r\n\r\nServeis Síncrons\r\n\r\n* AVISALERT_SMS\r\n* AVISALERT_CORREU-E\r\n\r\nServeis Asíncrons\r\n\r\n* AVISALERT_SMS\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquest component a la següent url:\r\n\r\nCodi Font:  http://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.avisosalertes.pica/1.1.2/\r\n\r\n#### Requeriments\r\n\r\nEl connector AVISALERT és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector AVISALERT funcioni correctament sobre l'aplicació que l'utilitzi, s'ha de tenir configurat el servei connector genèric de la PICA 1.1.0.\r\n\r\n### Configuració\r\n\r\nPer configurar el mòdul d'integració PICA-AVISALERT és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-AVISALERT amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml:\r\n\r\n```\r\n<canigo.integration.avisosalertes.pica.version>[1.1.0,1.2.0)</canigo.integration.avisosalertes.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-AVISALERT -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.integration.avisosalertes.pica</artifactId>\r\n\t<version><version>${canigo.integration.avisosalertes.pica.version}</version></version>\r\n</dependency>\r\n\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/avisalert.properties amb el següent contingut:\r\n\r\n```\r\n*.avisosalertes.pica.finalitat=[finalitat]\r\n*.avisosalertes.pica.urlPica=http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.avisosalertes.pica.nifEmisor=[nifEmisor]\r\n*.avisosalertes.pica.nomEmisor=[nomEmisor]\r\n*.avisosalertes.nomFuncionari=[nomFuncionari]\r\n*.avisosalertes.nifFuncionari=[nifFuncionari]\r\n*.avisosalertes.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-avisalert.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n### Utilització del Connector\r\n\r\n#### Exemple d'utilització d'un Servei Síncron\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate AvisosAlertesConnectorImpl avisalertService;\r\n```\r\n\r\n2.- Escollir una modalitat de servei síncrona i cridar-la amb els paràmetres que necessiti. En aquest cas es mostra un exemple amb la modalitat d'enviament de correu electrònic:\r\n\r\n```java\r\nString from = \"from@cscanigo.com\";\r\nString to = \"to@cscanigo.com\";\r\nString title = \"cscanigo\";\r\nString message = \"Això és una prova\";\r\nString arxiu = null;\r\nString resposta = avisalertService.avisAlertCorreuESincron(from, to, title, message, arxiu);\r\n```\r\n\r\nL'estat de finalització dependrà del codi retornat:\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA **Guia d'us del servei Avisos i Alertes v2.2.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n\r\n#### Exemple d'utilització d'un Servei Asíncron\r\n\r\n1.- La modalitat d'enviament de SMS, AVISALERT_SMS, suporta l'enviament síncron i asíncron, l'exemple que segueix utilitzarà la seva variant asíncrona. Per poder utilitzar aquesta modalitat de consum el connector de Canigó 3 preveu tres mètodes diferents:\r\n\r\n```java\r\npublic DataResponse avisAlertSMSsimpleASincron(String serviceNumber, String mobile, String message) throws AvisosAlertesException;\r\npublic EstatAsincron getEstatAvisAlertSMSASincron(CridaAsincronaResponseDocument response) throws AvisosAlertesException;\r\npublic String getDadesAvisAlertSMSASincron(IPICAServiceAsincron servei) throws AvisosAlertesException;\r\n```\r\n\r\n2.- El primer serveix per carregar les dades de la consulta al servei i fer la primera petició. Donat que és un servei asíncron retorna un objecte amb l'estat actual de la petició i el temps estimat de finalització d'aquesta.\r\n\r\nIgual que en les peticions síncrones, s'inicialitza el bean del servei del connector:\r\n\r\n```java\r\n@Autowired\r\nprivate AvisosAlertesConnectorImpl avisosAlertesConnector;\r\n```\r\n\r\nEs crida al servei amb les dades pertinents;\r\n\r\n```java\r\nString mobile = MOV_NUMBER;\r\nString serviceNumber = \"6666\";\r\nString message = \"Test\";\r\n\t\t\t\r\nDataResponse resposta = avisosAlertesConnector.avisAlertSMSsimpleASincron(serviceNumber, mobile, message);\r\n```\r\n\r\n3.- El segon serveix per anar comprovant l'estat de la consulta de forma periòdica. Igual que el primer mètode retorna un objecte amb l'estat actual de la petició i el temps estimat per la seva resolució.\r\n\r\n```java\r\nEstatAsincron estat = avisosAlertesConnector.getEstatAvisAlertSMSASincron(resposta.getResponse());\r\n```\r\n\r\n4.- Finalment el tercer mètode recupera el resultat de la petició una vegada confirmat que la petició ha finalitzat.\r\n\r\n```java\r\nString dades = avisosAlertesConnector.getDadesAvisAlertSMSASincron(resposta.getServei());\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA **Guia d'us del servei Avisos i Alertes v2.2.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1hdmlzb3MtaS1hbGVydGVz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0=":{"date":1426777297000,"title":"Enotum","description":"Connector de la Pica que simplifica l'utilització del servei de Notificacions Telemàtiques de la Generalitat.","sections":"Canigó. Documentació versió 3.x","weight":5,"path":"/canigo-documentacio-versions-3x-integracio/modul-enotum","content":"## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduida al connector de la Pica que simplifica l'utilització del servei de Notificacions Telemàtiques de la Generalitat.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents funcionalitats referents a les notificacions telemàtiques:\r\n\r\nFuncionalitats per a l'empleat públic:\r\n\r\n* Enviar tramesa: Creació d'una nova tramesa de notificacions telemàtiques al sistema E-Notum per part del sistema requeridor de notificacions telemàtiques.\r\n* Consultar estat tramesa: Consulta de l'estat d'una tramesa de notificacions telemàtiques per part del sistema requeridor de notificacions telemàtiques.\r\n* Consultar notificacions destinatari: Consulta de les notificacions telemàtiques adreçades al destinatari.\r\n* Consultar detall notificació: Visualització d'una notificació telemàtica per part d'un empleat públic.\r\n* Consultar evidències notificació: Consulta de les evidències d'una notificació telemàtica gestionades per eNotum.\r\n\r\nFuncionalitats per al ciutadà:\r\n\r\n* Consultar detall notificació: Visualització d'una notificació telemàtica per part del destinatari.\r\n* Consultar notificacions destinatari: Consulta de les notificacions telemàtiques adreçades al destinatari.\r\n* Modificar estat notificació: Permet canviar l'estat d'una notificació telemàtica, per qüestions de seguretat un usuari només pugui canviar d'estat les seves pròpies notificacions.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de notificacions electròniques es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.notificacions.electroniques.version>[1.3.0,1.4.0)</canigo.integration.notificacions.electroniques.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.notificacions.electroniques</artifactId>\r\n          <version>${canigo.integration.notificacions.electroniques.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nSon necessaris els següents arxius de configuració:\r\n\r\n* pica.properties\r\n* pica.signature.properties\r\n* client.axis2.xml\r\n* modules.list\r\n* rampart-1.3.mar\r\n* certificats.jks\r\n* notificacions-electroniques.properties\r\n* app-enotum-config.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/client.axis2.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/rampart-1.3.mar\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/modules.list\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/certificats.jks\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/pica.signature.properties\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/app-enotum-config.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/notificacions-electroniques.properties\r\n\r\nPropietat                                         | Requerit | Descripció\r\n------------------------------------------------- | -------- | ----------\r\n*.notificacions.electroniques.picaServiceBeanName | No       | Nom del bean de Spring per a PICA. Per defecte: picaService\r\n*.notificacions.electroniques.urlPica             | Sí       | URL del servei de la PICA\r\n*.notificacions.electroniques.nomEmissor\t\t  | Sí\t\t | Nom de l'emissor\r\n*.notificacions.electroniques.nifEmissor\t\t  | Sí\t     | Nif de l'emissor\r\n\r\nEls valors de urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n## Utilització del Mòdul\r\n\r\n### JSF\r\n\r\nPer a utilitzar aquest mòdul cal:\r\n\r\n* Configurar el fitxer XML de Spring per inicialitzar el servei.\r\n* Crear una classe Managed Bean de JSF que contingui la lògica de la crida al servei.\r\n* JSF que gestioni la crida al managed bean.\r\n\r\n**app-enotum-config.xml**\r\n\r\nArxiu de configuració que inicialitza el servei de notificacions electròniques. Aquest arxiu de configuració es recolza en arxius de configuració interns del servei de Notificacions i PICA per simplificar la seva configuració.\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\r\n    xsi:schemaLocation=\"http://www.springframework.org/schema/beans\r\n           http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\r\n    <bean id=\"picaEnotumService\" parent=\"abstractPicaService\" scope=\"prototype\"/>\r\n\r\n</beans>\r\n```\r\n\r\n**EnotumBean .java**\r\n\r\nManaged Bean de JSF exposat per Spring, i accessible des de la pàgina JSF amb el nom \"enotumBean\".\r\n\r\nEn aquest exemple invoquem el servei de notificacions electròniques i afegim com a missatge de formulari, el resultat\r\nde la seva invocació.\r\n\r\n```java\r\n@Component(\"enotumBean\")\r\n@Scope(\"singleton\")\r\n@Lazy\r\npublic class EnotumBean {\r\n\r\n    @Autowired\r\n    private NotificacionsElectroniquesConnector enotum;\r\n\r\n    /**\r\n     * Get funcionari\r\n     * @return\r\n     */\r\n    private Funcionari getFuncionari() {\r\n        Funcionari funcionari = new Funcionari();\r\n        funcionari.setNombreFuncionario(\"Nom Funcionari\");\r\n        funcionari.setNifFuncionario(\"55555555A\");\r\n        funcionari.setEmailFuncionario(\"jmvila@gfi-info.com\");\r\n        return funcionari;\r\n    }\r\n    /**\r\n     * Submit\r\n     */\r\n    public void submit(){\r\n\r\n        try{\r\n\r\n        String idTramesaNT = \"101230\";\r\n            RespostaConsultarEstatTramesa resposta = enotum.getServeisEmpleatPublic(getFuncionari()).consultarEstatTramesa(idTramesaNT);\r\n\r\n            if(resposta.getError()!=null){\r\n                FacesContext.getCurrentInstance().addMessage(\"enotumForm\", new FacesMessage(\r\n                        FacesMessage.SEVERITY_ERROR, resposta.getError().getDescripcio(), null));\r\n            }else{\r\n                FacesContext.getCurrentInstance().addMessage(\"enotumForm\", new FacesMessage(\r\n                        FacesMessage.SEVERITY_INFO, resposta.getTramesa().getEstatTramesa(), null));\r\n            }\r\n\r\n        }catch(Exception e){\r\n            FacesContext.getCurrentInstance().addMessage(\"enotumForm\", new FacesMessage(\r\n                    FacesMessage.SEVERITY_ERROR, e.getMessage(), null));\r\n        }\r\n\r\n    }\r\n\r\n}\r\n```\r\n\r\n**enotum.jsf**\r\n\r\nPàgina d'exemple que conté un commandButton que realitza la crida al mètode \"submit\" del managed bean de JSF.\r\n\r\n```\r\n<h:form id=\"enotumForm\">\r\n   <h:panelGrid columns=\"1\">\r\n     <h:commandButton value=\"#{msg.canigoSubmit}\" action=\"#{enotumBean.submit}\" />\r\n     <h:message for=\"enotumForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n   </h:panelGrid>\r\n</h:form>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1nZWNhdA==":{"date":1426250442000,"title":"GECAT","description":"Utilització del connector al sistema SAP del Gecat.","sections":"Canigó. Documentació versió 3.x","weight":7,"path":"/canigo-documentacio-versions-3x-integracio/modul-gecat","content":"## Propòsit\r\n\r\nL'objectiu del present document és descriure la metodologia a seguir en la utilització del connector al sistema SAP del Gecat des de qualsevol aplicació Java del Framework J2EE.\r\n\r\nL'abast d'aquest connector es basa en la utilització de les funcions d'alta de factures, consultes i reserves online del SAP de Gecat, així com totes les funcions batch.\r\n\r\nEl connector permet l'accés al SAP mitjançant objectes de consulta. El connector transforma aquests objectes en una cadena de caràcters vàlida per al SAP. La cadena de retorn és transformada novament en un objecte que conté els registres de retorn.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer poder utilitzar el connector haurem de configurar el projecte perque inclogui dues llibreries dll i diferents jars:\r\n\r\nLes llibreries són sapjcorfc.dll i librfc32.dll i s'han de copiar al directori system32.\r\n\r\nPer fer les operacions sobre el sistema SAP del Gecat és necessària la utilització del jar sapjco-2.1.6, que és el connector propi del SAP per fer les crides a les seves funcions BAPI (RFC).\r\n\r\nLes classes que utilitzarem per fer els objectes d'operacions estan en el jar del connector Gecat09 canigo-connectors-gecat09-2.3.2.jar\r\n\r\nLes classes que utilitzarem per fer les operacions han estat generades amb una eina Open Source anomenada JAXB (Java API for Xml Binding), que genera classes java a partir d'un esquema de xml (XMLSchema). Aquesta eina ens permet no solament generar automàticament classes java sinó també fer validacions per comprovar que les dades que contenen els objectes són vàlides. Per això també haurem d'incloure els jars que necessita JAXB:\r\n\r\n* jaxb-api-1.0.1.jar\r\n* jaxb-libs-1.0.6.jar\r\n* jaxb-impl-1.0.5.jar\r\n* jax-qname-1.1.jar\r\n* namespace-1.0.1.jar\r\n* relaxngDatatype-20020414.jar\r\n* xsdlib-2013.6.1.jar\r\n\r\nPer tal d'instal-lar el mòdul de GECAT es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.gecat.version>[1.1.0,1.2.0)</canigo.integration.gecat.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.gecat</artifactId>\r\n          <version>${canigo.integration.gecat.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de l'eina de suport al desenvolupament.\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/sap.properties\r\n\r\nPropietat                | Requerit | Descripció\r\n------------------------ | -------- | ----------\r\n*.sap.client \t         | Sí       | Client\r\n*.sap.username \t         | Sí       | Usuari de connexió\r\n*.sap.password \t         | Sí       | Password de connexió\r\n*.sap.language \t         | Sí       | Idioma\r\n*.sap.hostname \t         | Sí       | Nom del servidor\r\n*.sap.systemNumber \t     | Sí       | SAP system number\r\n*.sap.connectionPool     | No       | Connexió amb pool. Per defecte: true\r\n*.sap.connectionPoolName | No       | Nom del pool. Per defecte: poolCanigoSAP\r\n*.sap.maxNumConnections  | No       | Número de connexions màximes. Per defecte: 5\r\n*.sap.repositoryName     | No       | Nom del repository. Per defecte: ARAsoft\r\n\r\n## Utilització del Mòdul\r\n\r\nLa utilització del Connector es basa principalment en la configuració. L'ús directe des dels clients es permet mitjançant les interfícies definides.\r\n\r\nEl connector del Gecat ofereix tres operacions: alta de factures online, consultes i reserves. Cada operació té una classe que conté tota la informació de l'operació (o crida) i un altra amb la informació que retorna SAP per aquesta operació. Cada classe conté un altra classe per cada línia que tingui l'operació.\r\n\r\nSi per exemple tenim l'operació consultaFactura, que conté una sola línia, daddadesConsulta, haurem de crear un objecte de la classe DadesConsultaFacturaType i un altre de DadesConsultaType. Aquesta última l'omplirem amb totes les dades que facin falta mitjançant els seus mètodes setters (setSocietat, setCodiCreditor, etc..). Un cop omplert del tot aquest objecte (que representa una sola línia), l'assignarem a l'altre (que és el que representa tota la consulta) mitjançant també un mètode setter: dadesConsultaFactura.setDadesConsulta(dadesConsulta). Si tingués més línies, hauríem de fer el mateix per a totes.\r\n\r\nEn el cas en que una mateixa línia pugui aparèixer més d'una vegada la forma de fer les operacions canvia, ja que el conjunt de totes les línies del mateix tipus aniran dins d'una llista.\r\n\r\nUn cop hem creat l'objecte de crida amb totes les dades necessàries, utilitzarem un objecte de la classe GecatConnector per obtenir l'objecte de retorn amb les dades retornades pel SAP.\r\n\r\n### JSF\r\n\r\nGecatBean.java\r\n\r\nManaged Bean de JSF que gestiona la crida al servei de la GECAT.\r\n\r\nEn aquest bean es pot visualiztar:\r\n\r\n* Inyecció del servei de GECAT via annotacions (@Autowired) de Spring.\r\n* Inyecció del servei d'internacionaliztació via annotacions (@Autowired) de Spring.\r\n\r\n```java\r\n    /**\r\n     * Classe d'exemple d'invocació al servei de GECAT\r\n     *\r\n     * @author cscanigo\r\n     *\r\n     */\r\n    @Component(\"gecatBean\")\r\n    @Lazy\r\n    public class GecatBean {\r\n\r\n    \t@Autowired\r\n    \tprivate GecatConnector service;\r\n    \t@Autowired\r\n    \tprivate I18nResourceBundleMessageSource resource;\r\n    \tprivate static final Log log = LogFactory.getLog(GecatBean.class);\r\n            \r\n\r\n            /**\r\n             * Mètode cridat des de la JSF \r\n             *\r\n             */\r\n    \tpublic void execute(){\r\n    \t\ttry {\r\n\r\n    \t\t\tObjectFactory objectFactory = new ObjectFactory();\r\n\r\n    \t\t\t/**\r\n    \t\t\t * creem l'objecte per fer la consulta\r\n    \t\t\t **/\r\n    \t\t\tDadesConsultaTerritoriType dadesConsultaTerritori = objectFactory.createDadesConsultaTerritoriType();\r\n    \t\t\tDadesConsultaType dadesConsulta = objectFactory.createDadesConsultaType();\r\n    \t\t\tdadesConsulta.setCodiTerritori(\"0217188\");\r\n    \t\t\tdadesConsultaTerritori.setDadesConsulta(dadesConsulta);\r\n    \t\t\tDadesConsultaTerritoriRetornType dadesConsultaRetorn = service.consultaTerritori(dadesConsultaTerritori);\r\n\r\n    \t\t\tlog.info(\"getCodiTerritori():\" +\r\n    \t\t\t\t\tdadesConsultaRetorn.getDadesRetorn().getCodiTerritori());\r\n    \t\t\tlog.info(\"getNomTerritori():\" +\r\n    \t\t\t\t\tdadesConsultaRetorn.getDadesRetorn().getNomTerritori());\r\n\r\n    \t\t\tFacesContext.getCurrentInstance().addMessage(\"gecatForm\", new FacesMessage(\r\n    \t\t\t        FacesMessage.SEVERITY_INFO, resource.getMessage(\"gecatSuccess\") + \": \"\r\n    \t\t\t        + dadesConsultaRetorn.getDadesRetorn().getNomTerritori(), null));\r\n    \t      } catch (Exception e) {\r\n    \t    \t  FacesContext.getCurrentInstance().addMessage(\"gecatForm\", new FacesMessage(\r\n    \t\t\t\t        FacesMessage.SEVERITY_ERROR, resource.getMessage(\"gecatError\") + \" - \" + e.getMessage(), null));\r\n    \t      }\r\n    \t}\r\n    }\r\n```\r\n\r\n\r\n**gecat.jsf**    \r\n\r\nInvocació del métode \"execute\" del managed bean de JSF definit anteriorment com a picaBean. El Tag message mostrarà el resultat de la crida (veure FacesContext.getCurrentInstance().addMessage(\"picaForm\"....).\r\n\r\n```\r\n<h:form id=\"gecatForm\">\r\n   <h:panelGrid columns=\"1\">\r\n     <h:commandButton value=\"#{msg.canigoSubmit}\" action=\"#{gecatBean.execute}\" />\r\n     <h:message for=\"gecatForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n   </h:panelGrid>\r\n</h:form>\r\n```\r\n\r\n### Consideracions\r\n\r\nCrides a Gecat sense línies repetides\r\n\r\n* Retorn sense línies repetides\r\n\r\nPer mostrar aquest tipus de crida agafarem com exemple la consulta de partida pressupostària.\r\n\r\nPrimerament crearem tots els objectes que necessitarem per fer el procediment:\r\n\r\n```java\r\ncat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaPartidaPressupostaria.ObjectFactory objectFactory = new cat.gencat.ctti.canigo.arch.integration.gecat.consultes.ConsultaPartidaPressupostaria.ObjectFactory();\r\n```\r\n\r\nLa classe ObjectFactory és, com el seu nom indica, una classe per crear objectes d'altres classes. Aquestes classes són les que ofereix JAXB per crear objectes amb una certa estructura predefinida. Crearem un objecte de la classe ObjectFactory per crear els objectes que serviran per fer la crida (objectFactory).\r\n\r\nSeguidament crearem un objecte que representarà la crida completa. Aquest objecte contindrà un objecte per a cada línia que tingui la crida. Aquests objectes són els que s'han de completar amb la informació de la crida.\r\n\r\n```java\r\nDadesConsultaPartidaPressupostariaType dadesConsultaPartidaPressupostaria = objectFactory.createDadesConsultaPartidaPressupostariaType();\r\n\r\nDadesConsultaType dadesConsulta = objectFactory.createDadesConsultaType();\r\ndadesConsulta.setCentreGestor(\"1006\");\r\ndadesConsulta.setEntitatCP(\"1000\");\r\ndadesConsulta.setExercici(\"2002\");\r\ndadesConsulta.setPosicioPressupostaria(\"D/220100100/4551\");\r\ndadesConsulta.setVinculacio(\"S\");\r\ndadesConsultaPartidaPressupostaria.setDadesConsulta(dadesConsulta);\r\n```\r\n\r\nAmb aquest objecte ja podem fer la crida al SAP mitjançant el mètode consultaPartidaPressupostaria de la classe GecatConnector. Aquesta funció requereix de l'objecte de consulta.\r\n\r\n```java\r\nDadesConsultaPartidaPressupostariaRetornType dadesConsultaRetorn = gecatConnector.consultaPartidaPressupostaria(dadesConsultaPartidaPressupostaria);\r\n```\r\n\r\nEn aquest punt ja tenim l'objecte de retorn llest per a ser utilitzat per l'aplicació.\r\n\r\n```java\r\nSystem.out.println(\"getDenominacio():\" + dadesConsultaRetorn.getDadesRetorn().getDenominacio());\r\n```\r\n\r\n* Retorn amb línies repetides\r\n\r\nPer mostrar aquest tipus de crida agafarem com exemple la consulta de creditor.\r\n\r\nPrimerament crearem tots els objectes que necessitarem per fer el procediment:\r\n\r\n```java\r\nnet.gencat.gecat.consultes.ConsultaCreditor.ObjectFactory objectFactory = new net.gencat.gecat.consultes.ConsultaCreditor.ObjectFactory();\r\n```\r\n\r\nLa classe ObjectFactory és, com el seu nom indica, una classe per crear objectes d'altres classes. Aquestes classes són les que ofereix JAXB per crear objectes amb una certa estructura predefinida. Crearem un objecte de la classe ObjectFactory per crear els objectes que serviran per fer la crida (objectFactory).\r\n\r\nSeguidament crearem un objecte que representarà la crida completa. Aquest objecte contindrà un objecte per a cada línia que tingui la crida.\r\n\r\n```java\r\nDadesConsultaCreditorType dadesConsultaCreditor = objectFactory.createDadesConsultaCreditorType();\r\nDadesConsultaType dadesConsulta = objectFactory.createDadesConsultaType();\r\ndadesConsulta.setNIFoCodiCreditor(\"A53062927\");\r\ndadesConsulta.setRegistreInicial(\"001\");\r\ndadesConsulta.setSocietat(\"1000\");\r\ndadesConsultaCreditor.setDadesConsulta(dadesConsulta);\r\n```\r\n\r\nHaurem de passar al connector l'objecte de consulta mitjançant el mètode consultaCreditor de l'objecte gecatConnector:\r\n\r\n```java\r\nDadesConsultaCreditorRetornType dadesConsultaRetorn = gecatConnector.consultaCreditor(dadesConsultaCreditor);\r\n```\r\n\r\nAra ja tenim l'objecte de retorn llest per a ser utilitzat:\r\n\r\n```java\r\nList finalList = dadesConsultaRetorn.getDadesRetorn().getDadaRetorn();\r\nSystem.out.println(\"dadaRetorn.getAdreca:\" + ((DadaRetornType)finalList.get(0)).getAdreca());\r\n```\r\n\r\n**Crides a Gecat amb línies repetides**\r\n\r\nPer mostrar aquest altre tipus de crida prendrem com exemple l'alta de factures habilitats.\r\n\r\nCrearem tots els objectes que necessitarem per fer el procediment:\r\n\r\n```java\r\ncat.gencat.ctti.canigo.arch.integration.gecat.factures.FacturesHabilitatsOnline.ObjectFactory objectFactory = new cat.gencat.ctti.canigo.arch.integration.gecat.factures.FacturesHabilitatsOnline.ObjectFactory();\r\n```\r\n\r\nLa classe ObjectFactory és, com el seu nom indica, una classe per crear objectes d'altres classes. Aquestes classes són les que ofereix JAXB per crear objectes amb una certa estructura predefinida. Crearem un objecte de la classe ObjectFactory per crear els objectes que serviran per fer la crida (objectFactory).\r\n\r\nSeguidament crearem un objecte que representarà la crida completa. Aquest objecte contindrà un objecte per a cada línia (o conjunt de línies) que tingui la crida.\r\n\r\n```java\r\nDadesAltaFacturesHabilitatsOnlineType dadesAltaFacturaHabilitats = objectFactory.createDadesAltaFacturesHabilitatsOnlineType();\r\nDadesGeneralsFacturaType dadesGeneralsFactura = objectFactory.createDadesGeneralsFacturaType();\r\ndadesGeneralsFactura.setDataCompt(\"24051980\");\r\ndadesGeneralsFactura.setDataDocument(\"01\");\r\n.\r\n.\r\n.\r\ndadesGeneralsFactura.setTransaccio(\"ZD21\");\r\ndadesAltaFacturaHabilitats.setDadesGeneralsFactura(dadesGeneralsFactura);\r\n```\r\n\r\nSi la línia pot estar repetida, com en el cas de retencions habilitat subhabilitat, haurem de crear una llista d'objectes que representen una línia:\r\n\r\n```java\r\nRetencionsHabilitatSubhabilitatType retencionsHS = objectFactory.1createRetencionsHabilitatSubhabilitatType();\r\nList retencionsHSList = retencionsHS.getRetencioHabilitatSubhabilitat();\r\nRetencioHabilitatSubhabilitatType retencioHS = objectFactory.\r\ncreateRetencionsHabilitatSubhabilitatTypeRetencioHabilitatSubhabilitatType();\r\n\r\nretencioHS.setImportBase(\"1500\");\r\nretencioHS.setImportRetencio(\"25000\");\r\nretencioHS.setIndicadorRetencio(\"01\");\r\nretencioHS.setTipusRegistre(\"3\");\r\nretencioHS.setOrder(0);\r\nretencionsHSList.add(retencioHS);\r\n\r\nretencioHS = (RetencioHabilitatSubhabilitatType)retencioHS.getClass().newInstance();\r\nretencioHS.setImportBase(\"1600\");\r\nretencioHS.setImportRetencio(\"26000\");\r\nretencioHS.setIndicadorRetencio(\"01\");\r\nretencioHS.setTipusRegistre(\"3\");\r\nretencioHS.setOrder(1);\r\nretencionsHSList.add(retencioHS);\r\n\r\ndadesAltaFacturaHabilitats.setRetencionsHabilitatSubhabilitat(retencionsHS);\r\n```\r\n\r\nFixem-nos que és important donar un ordre a les línies contingudes en la llista:\r\n\r\n```java\r\nretencioHS.setOrder(0);\r\n```\r\n\r\nAmb aquest objecte ja podem fer la crida al SAP, mitjançant el mètode altaFacturesHabilitats de l'objecte gecatConnector:\r\n\r\n```java\r\nDadesConsultaCreditorRetornType dadesConsultaRetorn = gecatConnector.consultaCreditor(dadesConsultaCreditor);\r\n```\r\n\r\nAra ja disposem de l'objecte de retorn per a ser utilitzat:\r\n\r\n```java\r\nList finalList = dadesAltaFacturaRetorn.getDadesRetorn().getDadaRetorn();\r\nSystem.out.println(\"dadaRetorn.getClasseDocument():\" +\r\n((DadaRetornType)finalList.get(0)).getClasseDocument());\r\n```\r\n\r\n### Usuaris de prova\r\n\r\nS'han habilitat dos usuaris per a fer proves amb el connector de Gecat. Aquests usuaris es poden fer servir en les proves de desenvolupament, però mai per a producció.\r\n\r\n* ZBTCCANIGO per a les interfases \"batch\".\r\n* ZINTCANIGO per a les interfases \"on-line\".\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1nZWNhdA=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1pY2M=":{"date":1426850996000,"title":"ICC","description":"Serveis de normalització d'adreces del Institud Cartografic de Catalunya.","sections":"Canigó. Documentació versió 3.x","weight":8,"path":"/canigo-documentacio-versions-3x-integracio/modul-icc","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector, és el de proporcionar un punt d'accés als serveis de normalització d'adreces del ICC - Institud Cartografic de Catalunya.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional al connector de l'ICC del servei de normalització d'adreces. El servei de geocodificació de l'Institut Cartogràfic de Catalunya permet obtenir una localització geogràfica (coordenades) a partir de la descripció d'un municipi, carrer, adreça , cruïlla (textos), topònim o punt quilomètric d'una carretera.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector icc es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n### Documents i Fonts de Referència\r\n\r\n| Referència\r\n| ---------------\r\n| [Guia d'ús de l'API del Connector ICC](/related/canigo/documentacio/modul-icc/Geocodificador_Manual_Integrador_v1.12.pdf \"Guia d'us de l'API del Connector ICC\").\r\n| [Institud Cartogràfic de Catalunya - ICC](http://www.icc.cat/).\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents funcionalitats referents a les següent operacions:\r\n\r\nFuncionalitats\r\n\r\n* **Localitza adreça:** Funcionalitat que permet obtenir una localització geogràfica (coordenades) a partir de la adreça. ex: C.Balmes,5 (Barcelona).\r\n* **Localitza cruilla:** Funcionalitat que permet obtenir una localització geogràfica a partir d'una cruïlla. ex: Av. Diagonal amb Av.Meridiana (Barcelona)\r\n* **Localitza toponim:** Funcionalitat que permet obtenir una localització geogràfica a partir d'un topònim. ex: platja de la barceloneta.\r\n* **Localitza pk:** Funcionalitat que permet obtenir una localització geogràfica a partir del punt quilomètric d'una carretera. ex: carretera B-100 KM 3.\r\n* **Obtenir informació d'un punt:** Funcionalitat que permet obtenir una informació d'un punt. ex: x-> 430477.74 y ->4582122.725.\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquest component a la següent url:\r\n\r\nCodi Font:  http://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.icc/1.1.0/\r\n\r\n#### Requeriments\r\n\r\nEl connector ICC és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\n### Instal.lació i Configuració\r\n\r\n#### Instal.lació\r\n\r\nPer tal d'instal-lar el connector ICC es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.icc.version>[1.1.0,1.2.0)</canigo.integration.icc.version>\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.icc</artifactId>\r\n    <version>${canigo.integration.icc.version}</version>\r\n</dependency>\r\n```\r\n\r\n#### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/icc.properties\r\n\r\nPropietat                     | Requerit | Descripció\r\n----------------------------- | -------- | ----------\r\n*.iccService.webServiceServer | Sí       | Endpoint del servei ICC.\r\n*.iccService.contrasenya      | Sí       | contrasenya d'access al servei.\r\n*.iccService.usuari           | Sí       | usuari d'acces al servei.\r\n\r\n\r\nCada aplicació que vulgui utilitzar les funcionalitats del ICC, haurà de seguir el següent procediment:\r\n\r\n1. Complimentar el Document d'Alta que es pot trobar aquí. No s'ha de complimentar l'apartat d'organisme sol?licitant i persona de contacte. Aquest organisme i persona sempre ha de ser de l'administració. Si una empresa privada desenvolupa l'aplicació, la petició ha de ser feta per algú de l'administració.\r\n2. Complimentar el document d'enquesta que es pot descarrega d'aquí.\r\n3. Enviar aquests dos documents a la direcció de correu armand.guell@icc.cat demanant l'accés al servei ICC.\r\n\r\nL'usuari i password seran subministrats en aproximadament una setmana després de la petició.\r\n\r\nEls arxius de configuració que contenen els beans del mòdul i que serán carregats per Spring, son automàticament registrats pel core de Canigó, per lo que el desenvolupador no ha de definir cap arxiu XML per aixecar el servei.\r\n\r\n### Utilització del servei\r\n\r\nPer accedir al servei ICC, el desenvolupador pot realitzar una crida de forma externa mitjançant el patró 'Dependency Injection'.\r\n\r\nPodem diferenciar dues formes d'injectar-ho:\r\n\r\n* Per XML:\r\n\r\n```\r\n<bean id=\"iccWebServiceClient\" class=\"cat.gencat.ctti.canigo.arch.integration.icc.IccWebServiceClientImpl\">\r\n\t\t<property name=\"webServiceTemplate\" ref=\"webServiceTemplate\"/>\r\n\t\t<property name=\"defaultUri\" value=\"http://www.icc.cat/geocodificador/ws/wss_1.0\" />\t\t\r\n\t</bean>\r\n\r\n\t<bean id=\"webServiceTemplate\" class=\"org.springframework.ws.client.core.WebServiceTemplate\">\r\n\t\t<constructor-arg ref=\"messageFactory\" />\r\n\t\t<property name=\"interceptors\">\r\n\t\t\t<bean class=\"cat.gencat.ctti.canigo.arch.integration.icc.IccSecurity\">\r\n\t\t\t\t<constructor-arg value=\"USUARI\" />\r\n\t\t\t\t<constructor-arg value=\"CONTRASENYA\" />\r\n\t\t\t</bean>\r\n\t\t</property>\r\n\t    <property name=\"messageSender\">\r\n\t        <bean class=\"org.springframework.ws.transport.http.CommonsHttpMessageSender\" />\r\n\t    </property>\r\n\t\t<property name=\"marshaller\" ref=\"marshaller\" />\r\n\t\t<property name=\"unmarshaller\" ref=\"marshaller\" />\r\n\t\t<property name=\"defaultUri\" value=\"http://www.icc.cat/geocodificador/ws/wss_1.0\" />\r\n\t</bean>\r\n\r\n\t<bean id=\"messageFactory\" class=\"org.springframework.ws.soap.saaj.SaajSoapMessageFactory\">\r\n\t\t<property name=\"soapVersion\">\r\n\t\t\t<util:constant static-field=\"org.springframework.ws.soap.SoapVersion.SOAP_12\" />\r\n\t\t</property>\r\n\t</bean>\r\n\t\r\n\t<!-- serializador con JAXB -->\r\n\t<bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\">\r\n\t\t<property name=\"classesToBeBound\">\r\n\t\t\t<list>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Adreca</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.ArrayOfPuntGeografic</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Cruilla</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.IdNom</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Incidencia</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.InfoAdministrativa</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Localitzacio</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.LocalitzacioCruilla</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Localitzacions</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.LocalitzacionsCruilla</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.ObtenirInfoPuntInput</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.PK2</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Pks</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Punt</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.PuntGeografic</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Toponim</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Toponims</value>\r\n\t\t\t\t\t<value>cat.icc.ws.geocodificador.Via</value>\r\n\t\t\t</list>\r\n\t\t</property>\r\n\t</bean>\r\n```\r\n\r\n* Per anotacions:\r\n\r\n```\r\n@Autowired\r\n@Qualifier(\"iccWebServiceClient\")\r\nIccWebServiceClient client;\r\n```\r\n\r\n#### Excepcions del servei ICC\r\n\r\nEl servei ICC pot generar excepcions IccModuleException. Aquest tipus d'excepcions les genera el servei ICC en els casos de:\r\n\r\nLes excepccions es poden donar degut a:\r\n\r\n* TimeOut a la petició del servei\r\n* Error en el format de les dades d'entrada i/o sortida\r\n* Error en el binding automàtic amb les dades.\r\n\r\nEn el cas de produir-se un error el servei ICC registra en el fitxer de logs de l'aplicació l'error produit, i llença una excepció IccModuleException a la aplicació amb l'informcació de l'excepció.\r\n\r\n#### Exemple d'utilització del servei ICC\r\n\r\n##### Localitza Adreça\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaAdreca() {\r\n\t\ttry {\r\n\t\t\tAdreca adreca = getAdreca();\r\n\t\t\tLocalitzacions response;\r\n\t\t\tresponse = client.localitzaAdreca(adreca);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate Via getVia() {\r\n\t\tVia via = new Via();\r\n\t\tvia.setNom(\"Mas Massonet\");\r\n\t\treturn via;\r\n\r\n\t}\r\n\r\n\tprivate Adreca getAdreca() {\r\n\t\tAdreca adreca = new Adreca();\r\n\t\tadreca.setPoblacio(\"Blanes\");\r\n\t\tadreca.setVia(getVia());\r\n\t\tadreca.setPortal(18);\r\n\t\tadreca.setCodiPostal(\"no\");\r\n\t\tadreca.setLlogaret(new IdNom());\r\n\t\treturn adreca;\r\n\t}\r\n}\r\n```\r\n\r\n##### Localitza Cruïlla\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaCruilla() {\r\n\t\ttry {\r\n\t\t\tCruilla cruilla = getCruilla();\r\n\t\t\tLocalitzacionsCruilla response = client.localitzaCruilla(cruilla);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate Cruilla getCruilla() {\r\n\t\tVia via1 = new Via();\r\n\t\tvia1.setTipus(\"c.\");\r\n\t\tvia1.setNom(\"Balmes\");\r\n\t\tVia via2 = new Via();\r\n\t\tvia2.setNom(\"*\");\r\n\t\tCruilla cruilla = new Cruilla();\r\n\t\tcruilla.setPoblacio(\"Barcelona\");\r\n\t\tcruilla.getVies().add(via1);\r\n\t\tcruilla.getVies().add(via2);\r\n\t\tcruilla.setComarca(new IdNom());\r\n\t\treturn cruilla;\r\n\t}\r\n}\r\n```\r\n\r\n##### Localitza Punt Quilomètric\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaPK() {\r\n\t\ttry {\r\n\t\t\tPK2 pk = getPk();\r\n\t\t\tPks response = client.localitzaPK(pk);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate PK2 getPk() {\r\n\t\tPK2 pk = new PK2();\r\n\t\tpk.setNomCarretera(\"AP-7\");\r\n\t\tpk.setKM(\"56\");\r\n\t\tpk.setCoordenadesGeografiques(false);\r\n\t\treturn pk;\r\n\t}\r\n}\r\n```\r\n\r\n##### Localitza Toponim\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testLocalitzaToponim() {\r\n\t\ttry {\r\n\t\t\tToponim toponim = getToponim();\r\n\t\t\tToponims response = client.localitzaToponim(toponim);\r\n\t\t\tAssert.assertTrue(response.getItem().size() > 0);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate Toponim getToponim() {\r\n\t\tToponim topo = new Toponim();\r\n\t\ttopo.setNom(\"Can Clota\");\r\n\t\ttopo.setCoordenadesGeografiques(false);\r\n\t\treturn topo;\r\n\t}\r\n}\r\n```\r\n\r\n##### Obtenir informació d'un punt\r\n\r\nEl punt pot estar en el datum ED50 o en el datum ETRS89 i les coordenades han d'estar en format UTM.\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.integration.icc.exceptions.IccModuleException;\r\nimport cat.icc.ws.geocodificador.*;\r\n\r\npublic class IccServiceReleaseTest {\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"iccWebServiceClient\")\r\n\tIccWebServiceClient client;\r\n\r\n\tpublic void testObtenirInfoPuntEd50() {\r\n\t\ttry {\r\n\t\t\tObtenirInfoPuntInput obtenirInfoPuntInput = getObtenirInfoPuntInputUTMED50();\r\n\t\t\tInfoAdministrativa response = client.obtenirInfoPunt(obtenirInfoPuntInput);\r\n\t\t\tAssert.assertTrue(response != null);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic void testObtenirInfoPuntEtrs89() {\r\n\t\ttry {\r\n\t\t\tObtenirInfoPuntInput obtenirInfoPuntInput = getObtenirInfoPuntInputETRS89();\r\n\t\t\tInfoAdministrativa response = client.obtenirInfoPunt(obtenirInfoPuntInput);\r\n\t\t\tAssert.assertTrue(response != null);\r\n\t\t} catch (IccModuleException e) {\r\n\t\t\tAssert.assertTrue(false);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate PuntGeografic getPuntGeograficUTMED50() {\r\n\t\tPuntGeografic punt = new PuntGeografic();\r\n\t\tpunt.setX(428263.75);\r\n\t\tpunt.setY(4582861.0);\r\n\t\treturn punt;\r\n\t}\r\n\r\n\tprivate PuntGeografic getPuntGeograficETRS89() {\r\n\t\tPuntGeografic punt = new PuntGeografic();\r\n\t\tpunt.setX(484937.352);\r\n\t\tpunt.setY(4652370.915);\r\n\t\treturn punt;\r\n\t}\r\n\r\n\tprivate PuntGeografic getPuntGeograficBuit() {\r\n\t\tPuntGeografic punt = new PuntGeografic();\r\n\t\treturn punt;\r\n\t}\r\n\r\n\tprivate ObtenirInfoPuntInput getObtenirInfoPuntInputUTMED50() {\r\n\t\tObtenirInfoPuntInput obtenirInfoPuntInput = new ObtenirInfoPuntInput();\r\n\t\tobtenirInfoPuntInput.setPuntUTMED50(getPuntGeograficUTMED50());\r\n\t\tobtenirInfoPuntInput.setPuntUTMETRS89(getPuntGeograficBuit());\r\n\t\treturn obtenirInfoPuntInput;\r\n\t}\r\n\r\n\tprivate ObtenirInfoPuntInput getObtenirInfoPuntInputETRS89() {\r\n\t\tObtenirInfoPuntInput obtenirInfoPuntInput = new ObtenirInfoPuntInput();\r\n\t\tobtenirInfoPuntInput.setPuntUTMED50(getPuntGeograficBuit());\r\n\t\tobtenirInfoPuntInput.setPuntUTMETRS89(getPuntGeograficETRS89());\r\n\t\treturn obtenirInfoPuntInput;\r\n\t}\r\n\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1pY2M="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1waWNh":{"date":1426250442000,"title":"PICA","description":"Interficie d'accés a la PICA (Plataforma d'Integració i Col.laboració Administrativa).","sections":"Canigó. Documentació versió 3.x","weight":10,"path":"/canigo-documentacio-versions-3x-integracio/modul-pica","content":"## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície java per accedir a la PICA (Plataforma d'Integració i Col.laboració Administrativa).\r\n\r\nEl connector amb la PICA disposa de dos tipus de comunicació, un d'ells a través de web service síncron, i l'altre, mitjançant web service asíncron.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de PICA es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.pica.version>[1.1.0,1.2.0)</canigo.integration.pica.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.pica</artifactId>\r\n          <version>${canigo.integration.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nSon necessaris els següents arxius de configuració:\r\n\r\n* pica.properties\r\n* pica.signature.properties\r\n* client.axis2.xml\r\n* modules.list\r\n* rampart-1.3.mar\r\n* certificats.jks\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/pica.properties\r\n\r\nPropietat                      | Requerit | Descripció\r\n-----------------------------  | -------- | ---------\r\n*.pica.modes.passwordType      | No       | Tipus de password per a la PICA. Per defecte: PasswordText\r\n*.pica.requirer.signatureFile  | Sí       | Arxiu de configuració de la seguretat\r\n*.pica.requirer.petitionerId   | Sí       | Identificador del solicitant\r\n*.pica.requirer.transmitionId  | Sí       | Identificador de la transmissió\r\n*.pica.requirer.petitionerName | Sí       | Nom del peticionari\r\n*.pica.requirer.user           | Sí       | Usuari que vol consumir un producte/modalitat de la PICA\r\n*.pica.requirer.password       | Sí       | Password de l'usuari que vol consumir un producte/modalitat de la PICA\r\n*.pica.axisdefinition.location | Sí       | Localització de l'arxiu d'axisdefinition\r\n*.pica.trustStore.location     | No       | Localització de l'arxiu de certificats per a la configuració SSL\r\n*.pica.trustStore.type         | No       | Tipus de keystore\r\n*.pica.trustStore.password     | No       | Password de la keystore\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/client.axis2.xml\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/rampart-1.3.mar\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/axis2client/conf/modules.list\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/certificats.jks\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/cert/pica.signature.properties\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/spring/app-integration-custom.xml\r\n\r\n\r\n    Important\r\n\r\n    Si l'aplicació ha de ser desplegada en format empaquetat (.war, .ear) caldrà indicar la ubicació de la carpeta de configuració d'axis2 com a Path absolut dins el servidor on desplegarà. Aquest Path s'indicarà sobreescrivint el valor de la propietat pica.axisdefinition.location del fitxer pica.properties amb el Path absolut on s'ha deixat la carpeta d'axis2client als servidors. S'haurà de pactar la ubicació amb els responsables del CPD on desplegarà.\r\n\r\n    Exemple:\r\n    pica.properties:\r\n\r\n        int.pica.axisdefinition.location=file:/export/AppJavaDades/int/.../axis2client/\r\n        pre.pica.axisdefinition.location=file:/export/AppJavaDades/pre/.../axis2client/\r\n        pro.pica.axisdefinition.location=file:/export/AppJavaDades/pro/.../axis2client/\r\n\r\n\r\n\r\n## Utilització del Mòdul\r\n\r\n### JSF\r\n\r\n**app-integration-custom.xml**\r\n\r\nAquest arxiu XML conté la configuració de Spring per al servei de PICA. En l'exemple configurem el servei de PICA per invocar el producte/modalitat \"PADRO_MUNICIPI_RESIDENCIA\".\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\r\n\r\n\t<bean id=\"picaCanigoService\" parent=\"abstractPicaService\">\r\n\t\t<property name=\"modalitats\">\r\n\t\t\t<map>\r\n\t\t\t\t<entry key=\"PADRO_MUNICIPI_RESIDENCIA\">\r\n\t\t\t\t\t<bean parent=\"producteModalitatBase\">\r\n\t\t\t\t\t\t<property name=\"signat\" value=\"false\"/>\r\n\t\t\t\t\t\t<property name=\"urlPICA\" value=\"${pica.url}\" />\r\n\t\t\t\t\t\t<property name=\"codCertificado\" value=\"${pica.codCertificado}\"/>\r\n\t\t\t\t\t\t<property name=\"codProducto\" value=\"${pica.codProducto}\"/>\r\n\t\t\t\t\t\t<property name=\"finalidad\" value=\"${pica.finalidad}\"/>\r\n\t\t\t\t\t\t<property name=\"nifEmisor\" value=\"${pica.nifEmissor}\"/>\r\n\t\t\t\t\t\t<property name=\"nombreEmisor\" value=\"${pica.nombreEmisor}\"/>\r\n\t\t\t\t\t</bean>\r\n\t\t\t\t</entry>\r\n\t\t\t</map>\r\n\t\t</property>\r\n\t</bean>\r\n</beans>\r\n```\r\n\r\n<div class=\"message warning\">\r\n<b>Propietats específiques</b>\r\n<br><br>\r\nLes propietats pica.url, pica.codCertificado, pica.codProducto, etc, definides en XML de configuració anterior, son propietats específiques de la modalitat o producte invocat, per lo que s'hauran d'introduir manualment a l'arxiu pica.properties per tal de que el PlaceHolderResolver de Spring pugui resoldre el valor de la propietat durant l'arranc de l'aplicació.\r\n</div>\r\n\r\n**PicaBean.java**\r\n\r\nManaged Bean de JSF que gestiona la crida al servei de la PICA.\r\n\r\nEn aquest bean es pot visualiztar:\r\n\r\n* Inyecció del servei de PSIS via annotacions (@Autowired/@Qualifier) de Spring.\r\n* Inyecció del servei d'internacionaliztació via annotacions (@Autowired) de Spring.\r\n* Invocació del producte/modalitat \"PADRO_MUNICIPI_RESIDENCIA\" definit en el map de modalitats que es troba al fitxer de configuració xml de Spring.\r\n\r\n```java\r\n/**\r\n * Classe d'exemple d'invocació al servei de PICA\r\n *\r\n * @author cscanigo\r\n *\r\n */\r\n@Component(\"picaBean\")\r\n@Lazy\r\npublic class PicaBean {\r\n\r\n\t@Qualifier(\"picaService\")\r\n\t@Autowired\r\n\tprivate IPicaServiceWrapper serviceWrapper;\r\n\t@Autowired\r\n\tprivate I18nResourceBundleMessageSource resource;\r\n\tprivate static final int TIPO_DOC_TITULAR_NIF = 2;\r\n\tprivate static final Log log = LogFactory.getLog(PicaBean.class);\r\n\r\n        /**\r\n         * Crea un objecte funcionari\r\n         *\r\n         * return funcionari\r\n         **/\r\n\tprivate Funcionari creaFuncionari() {\r\n\t\tFuncionari func = new Funcionari(  );\r\n\t\tfunc.setNifFuncionario(\"22222222X\");\r\n\t\tfunc.setNombreFuncionario(\"Nom congnom1 cognom2\");\r\n\t\tfunc.setEmailFuncionario(\"ncognom1cognom2@gencat.net\");\r\n\t\treturn func;\r\n\t}\r\n\r\n        /**\r\n         * Crea un objecte titular\r\n         *\r\n         * return titular\r\n         **/\r\n\tprivate Titular creaTitular() {\r\n\t\tTitular tit = new Titular(  );\r\n\t\ttit.setTitularTipoDocumentacion(TIPO_DOC_TITULAR_NIF);\r\n\t\ttit.setTitularDocumentacion(\"NIF_TITULAR\"); // Es posa el NIF real\r\n\t\ttit.setTitularNombreCompleto(\"NOM_COMPLET_TITULAR\"); // Es posa el nom real\r\n\t\treturn tit;\r\n\t}\r\n\r\n\r\n        /**\r\n         * Crea un objecte dades específiques\r\n         *\r\n         * return DadesEspecifiques\r\n         **/\r\n\tprivate List<DadesEspecifiques> createDadesEspecifiques() {\r\n\t\tList<DadesEspecifiques> dadesEspecifiquesXML= new ArrayList<DadesEspecifiques>(  );\r\n\t\tStringBuffer sb = new StringBuffer( \"<ns1:request xmlns:ns1=\\\"http://www.gencat.net/tfn\\\">\" );\r\n\t\tsb.append( \"<ns1:simpleparam name=\\\"NUMTIT\\\">83746573</ns1:simpleparam>\" );\r\n\t\tsb.append( \"<ns1:simpleparam name=\\\"NUMNIF\\\">111111111H</ns1:simpleparam>\" );\r\n\t\tsb.append( \"</ns1:request>\" );\r\n\r\n\t\tDadesEspecifiques dades = new DadesEspecifiques(  );\r\n\t\tdades.setIdSolicitud( \"1\" );\r\n\t\tdades.setDadesXML( sb.toString(  ) );\r\n\t\tdadesEspecifiquesXML.add( dades );\r\n\r\n\t\treturn datosEspecificosXML;\r\n\t}\r\n\r\n        /**\r\n         * Parsejar la resposta deixant constància en format de traces si la crida ha finalitzat o no correctament\r\n         *\r\n         **/\r\n\tprivate void parseXML(String dadesXML) throws ParserConfigurationException, SAXException, IOException {\r\n\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\r\n\t\tDocumentBuilder builder = factory.newDocumentBuilder();\r\n\t\tInputSource inStream = new InputSource();\r\n\t\tboolean error = false;\r\n\r\n\t\tinStream.setCharacterStream(new StringReader(dadesXML));\r\n\t\tDocument doc = builder.parse(inStream);\r\n\t\tNodeList nodes = doc.getElementsByTagName(\"error\");\r\n\t\tif(nodes.getLength() == 0) {\r\n\t\t\tnodes = doc.getElementsByTagName(\"sol:SolicitudError\");\r\n\t\t\terror = true;\r\n\t\t}\r\n\r\n\t\tfor(int i=0; i<nodes.getLength(); i++) {\r\n\t\t\tNode node = nodes.item(i);\r\n\t\t\tif(node.getNodeType() == Node.ELEMENT_NODE) {\r\n\t\t\t\tElement element = (Element)node;\r\n\t\t\t\tif(!error) {\r\n\t\t\t\t\tlog.info(dadesXML);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlog.info(element.getTextContent());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n        /**\r\n         * Crida al servei sincron de la PICA.\r\n         *\r\n         * return titular\r\n         **/\r\n\tpublic void execute(){\r\n\r\n\t\ttry{\r\n\t\t\tIPICAServiceSincron service = serviceWrapper.getPicaWebServiceSincronInstance(\"PADRO_MUNICIPI_RESIDENCIA\");\r\n\r\n\t\t\tFuncionari func = creaFuncionari();\r\n\t\t\tTitular tit = creaTitular();\r\n\r\n\t\t\tList<DadesEspecifiques> datosEspecificosXML = createDadesEspecifiques();\r\n\r\n\t\t\tservice.setFuncionari(func);\r\n\t\t\tservice.setTitular(tit);\r\n\t\t\tservice.setDadesEspecifiques(datosEspecificosXML);\r\n\r\n                        //Identificador únic de petició\r\n\t\t\tservice.crearPeticio(\"PROVA_OTCANIGO_\" + System.currentTimeMillis());\r\n\r\n\t\t\t//fer peticio\r\n\t\t\tCridaSincronaResponseDocument resp = serviceWrapper.ferPeticioAlServei(service);\r\n\t\t\t//extreure resultat\r\n\t\t\tList<DadesEspecifiques> resposta= serviceWrapper.extreuDadesEspecifiques(service,resp);\r\n\r\n\t\t\tIterator<DadesEspecifiques> it = resposta.iterator();\r\n\t\t\twhile (it.hasNext()) {\r\n\t\t\t\tDadesEspecifiques object = it.next();\r\n\t\t\t\tString dadesXML = object.getDadesXML();\r\n\r\n\t\t\t\t// Parsejar resposta\r\n\t\t\t\tparseXML(dadesXML);\r\n\t\t\t}\r\n\r\n                        //La crida ha finalitzat sense errors. Afegim el missatge de petició finalitzada correctament\r\n                        //al formulari JSF que ha gestionat la crida.\r\n\t\t\tFacesContext.getCurrentInstance().addMessage(\"picaForm\", new FacesMessage(\r\n\t\t\t        FacesMessage.SEVERITY_INFO, resource.getMessage(\"picaSuccess\"), null));\r\n\r\n\t\t}catch(Exception e){\r\n\t\t\tlog.error(\"Error during PICA invocation. \" + e);\r\n                        //S'ha produït un error durant la invocació de la PICA. Afegim el missatge d'error al formulari\r\n                        //JSF que ha gestionat la crida.\r\n\t\t\tFacesContext.getCurrentInstance().addMessage(\"picaForm\", new FacesMessage(\r\n\t\t\t        FacesMessage.SEVERITY_ERROR, resource.getMessage(\"picaError\") + \" - \" + e.toString(), null));\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n```\r\n\r\nCal destacar que l'identificador de la petició ha de ser únic, per aquest motiu es concatena un prefix de text qualsevol amb el timestamp del sistema.\r\nPer a més informació respecte l'especificació tècnica i funcional podeu contactar amb l'OT PICA.\r\nEn aquest exemple, els mètodes privats crearFuncionari() i crearTitular() (creats simplement per aquest test) s'encarreguen de setejar les propietats del funcionari que fa la petició i titular sobre el que es fa la petició respectivament. El mètode també privat createDadesEspecifiques() conté una llista de les sol.licituds, en format XML, que s'enviaran dins la petició.\r\nDins una petició (llista de dades específiques) es poden incloure diverses sol- licituds, els identificadors de les quals han de ser únics dins una mateixa petició. Si volguéssim afegir una altra sol- licitud en l'exemple, només caldria instanciar un nou objecte DadesEspecifiques, amb IdSolicitud=\"2\", un nou StringBuffer amb les dades i afegir-lo a la llista dadesEspecifiquesXML dins del mètode createDadesEspecifiques() de l'exemple.\r\n\r\n**pica.jsf**  \r\n\r\nInvocació del métode \"execute\" del managed bean de JSF definit anteriorment com a picaBean. El Tag message mostrarà el resultat de la crida (veure FacesContext.getCurrentInstance().addMessage(\"picaForm\"....).\r\n\r\n```\r\n<h:form id=\"picaForm\">\r\n   <h:panelGrid columns=\"1\">\r\n     <h:commandButton value=\"#{msg.canigoSubmit}\" action=\"#{picaBean.execute}\" />\r\n     <h:message for=\"picaForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n   </h:panelGrid>\r\n</h:form>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1waWNh"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0td3M=":{"date":1426778360000,"title":"Enotum_WS","description":"Notificacions electròniques Web Service.","sections":"Canigó. Documentació versió 3.x","weight":6,"path":"/canigo-documentacio-versions-3x-integracio/modul-enotum-ws","content":"## Propòsit\r\n\r\nEl propòsit d'aquesta documentació és donar a conèixer el mòdul de WebServices de Canigó3 per Enotum, la seva configuració i el seu ús per part de les aplicacions.\r\n\r\n## Descripció Detallada\r\n\r\nEl Servei de Enotum existeixen dues modalitats de consum especials:\r\n\r\n* NT_ENTREGAR_CANVI_ESTAT_NOTIFICACIO: Permet al sistema que va sol?licitar la creació de la notificació telemàtica ser informat de les transicions automàtiques d'estat. E-Notum gestiona el cicle de vida dels estats associats a les notificacions telemàtiques. És responsable de realitzar certs canvis d'estat sobre la base de timeouts. Quan es produeixen aquests canvis d'estat, és necessari notificar-los al sistema que va sol?licitar la creació de la notificació.\r\n* NT_ERROR_ENVIAMENT_NOTIFICACIO: Aquesta modalitat de consum permet el lliurament des de eNotum als BO dels errors que s'ha produït en el tractament de les trameses de notificacions enviades pels backoffice durant el processament de les notificacions.\r\n\r\nAixí doncs, PICA reb les notificacions de l'emissor amb els diferents errors que s'han produït i els envia al BO corresponent.\r\n\r\nAmbdues necessiten la publicació d'un WebService per part del consumidor del Servei (BO).\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer instal.lar el WebService de notificacions electròniques s'han d'afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.notificacions.electroniques.version.ws>[2.1.0,2.2.0)</canigo.integration.notificacions.electroniques.version.ws>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.notificacions.electroniques.ws</artifactId>\r\n          <version>${canigo.integration.notificacions.electroniques.version.ws}</version>\r\n</dependency>\r\n```\r\n\r\ni en l'apartat de repositoris\r\n\r\n```\r\n<repository>\r\n      <id>org.springframework.security.taglibs.facelets</id>\r\n      <url>http://spring-security-facelets-taglib.googlecode.com/svn/repo/</url>\r\n</repository>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració del WS es porta a terme a través de l'arxiu \"app-custom-enotumWS.xml\". Es recomana que es posi en src/main/resources/spring/app-custom-enotumWS.xml.\r\n\r\nEl contingut d'aquest arxiu és el següent:\r\n\r\n```\r\n<bean id=\"notificacionsElectroniquesAppService\" class=\"[Classe on es troba la implementació dels mètodes exposats al WS]\"/>\r\n\r\n    <bean id=\"notificacionsElectroniquesServiceEndpoint\" class=\"cat.gencat.ctti.canigo.arch.integration.notificacionselectroniques.endpoint.NotificacionsElectroniquesEndpoint\">\r\n        <property name=\"NotificacionsElectroniquesService\" ref=\"notificacionsElectroniquesAppService\"/>\r\n    </bean>\r\n\r\n\r\n    <bean id=\"eNOTUMService\" class=\"org.springframework.ws.wsdl.wsdl11.DefaultWsdl11Definition\"\r\n          p:portTypeName=\"eNOTUMService\" //<--Nom del Servei Web (configurable)\r\n          p:locationUri=\"/ws/services/ENotumService/\" //<--Path del Servei Web (configurable)\r\n          p:targetNamespace=\"http://gencat.net/scsp/esquemes/productes/nt/services\">\r\n          <property name=\"SchemaCollection\" ref=\"schemaCollection\"/>\r\n          <property name=\"createSoap11Binding\" value=\"false\"/>\r\n          <property name=\"createSoap12Binding\" value=\"true\"/>\r\n    </bean>\r\n\r\n     <bean id=\"schemaCollection\" class=\"org.springframework.xml.xsd.commons.CommonsXsdSchemaCollection\">\r\n        <property name=\"xsds\">\r\n            <list>\r\n                <value>classpath:cat/gencat/ctti/canigo/arch/support/notificacions/electroniques/config/xsd/NTServices.xsd</value>\r\n               </list>\r\n        </property>\r\n        <property name=\"inline\" value=\"true\"/>\r\n    </bean>\r\n\r\n    <bean id=\"messageFactory\" class=\"org.springframework.ws.soap.saaj.SaajSoapMessageFactory\">\r\n          <property name=\"soapVersion\" value=\"SOAP_12\" />\r\n      </bean>\r\n\r\n     <bean id=\"marshaller\" class=\"org.springframework.oxm.jaxb.Jaxb2Marshaller\"\r\n          p:contextPath=\"net.gencat.scsp.esquemes.productes.nt:net.gencat.scsp.esquemes.productes.nt.notificacions:net.gencat.scsp.esquemes.productes.nt.services\"/>\r\n\r\n    <bean id=\"marshallingPayloadMethodProcessor\" class=\"org.springframework.ws.server.endpoint.adapter.method.MarshallingPayloadMethodProcessor\">\r\n        <constructor-arg ref=\"marshaller\"/>\r\n    </bean>\r\n\r\n    <bean id=\"defaultMethodEndpointAdapter\" class=\"org.springframework.ws.server.endpoint.adapter.DefaultMethodEndpointAdapter\">\r\n        <property name=\"methodArgumentResolvers\">\r\n            <list>\r\n                <ref bean=\"marshallingPayloadMethodProcessor\"/>\r\n            </list>\r\n        </property>\r\n        <property name=\"methodReturnValueHandlers\">\r\n            <list>\r\n                <ref bean=\"marshallingPayloadMethodProcessor\"/>\r\n            </list>\r\n        </property>\r\n    </bean>\r\n```\r\n\r\n## Utilització del Web Service\r\n\r\nPer poder utilitzar el WebService de Enotum en una aplicació Canigó3 s'han de seguir els següents passos;\r\n\r\n1.- Modificar el web.xml de l'aplicació per afegir el servlet següent:\r\n\r\n```\r\n<!-- Web Service Enotum -->\r\n    <servlet>\r\n        <servlet-name>NT_WS</servlet-name>\r\n        <servlet-class>org.springframework.ws.transport.http.MessageDispatcherServlet</servlet-class>\r\n        <init-param>\r\n            <param-name>contextConfigLocation</param-name>\r\n            <param-value>classpath:spring/app-custom-enotumWS.xml</param-value>\r\n        </init-param>\r\n        <init-param>\r\n            <param-name>transformWsdlLocations</param-name>\r\n            <param-value>true</param-value>\r\n        </init-param>\r\n    </servlet>\r\n\r\n    <servlet-mapping>\r\n        <servlet-name>NT_WS</servlet-name>\r\n        <url-pattern>/ws/*</url-pattern>\r\n    </servlet-mapping>\r\n```\r\n\r\nPosar immediatament a sobre de:\r\n\r\n```\r\n<!--\r\nSession timeout: 30 minutes\r\n-->\r\n <session-config>\r\n  <session-timeout>30</session-timeout>\r\n </session-config>\r\n```\r\n\r\n2.- Configurar els beans **notificacionsElectroniquesAppService** i **eNOTUMService** de l'arxiu src/main/resources/spring/app-custom-enotumWS.xml de la següent forma:\r\n\r\n* notificacionsElectroniquesAppService: Nom de la classe que implementaran les accions a portar a terme a partir de la resposta rebuda pel servei. Un exemple:\r\n\r\n```java\r\nimport net.gencat.scsp.esquemes.productes.nt.notificacions.NotificacioCanviEstat;\r\nimport net.gencat.scsp.esquemes.productes.nt.notificacions.NotificacioCanviEstat.Notificacio;\r\nimport net.gencat.scsp.esquemes.productes.nt.notificacions.NotificacioError;\r\nimport org.apache.commons.logging.Log;\r\nimport org.apache.commons.logging.LogFactory;\r\nimport cat.gencat.ctti.canigo.arch.integration.notificacionselectroniques.NotificacionsElectroniquesService;\r\nimport cat.gencat.ctti.canigo.arch.integration.notificacionselectroniques.exepcions.NotificacionsElectroniquesModuleExcepcion;\r\n\r\n\r\npublic class NotificacionsElectroniquesServiceBasicImpl implements NotificacionsElectroniquesService {\r\n\r\n    private static final Log LOGGER = LogFactory.getLog(NotificacionsElectroniquesServiceBasicImpl.class);\r\n    public void entregarCanviEstatNotificacio(NotificacioCanviEstat notificacioCanviEstat) throws NotificacionsElectroniquesModuleExcepcion {\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(\"Recepció per part del sistema requeridor de notificacions telemàtiques dels canvis d'estat automàtics de la NT.\");\r\n        }\r\n\r\n        if (notificacioCanviEstat != null && notificacioCanviEstat.getNotificacio() != null) {\r\n            if (LOGGER.isDebugEnabled()){\r\n                for (Notificacio notificacio : notificacioCanviEstat.getNotificacio()) {\r\n                    LOGGER.debug(\"Notificació: \" + notificacio.getIdNotificacio() + \". Estat :\" + notificacio.getDescEstat() + \"(\" + notificacio.getCodiEstat()+ \")\");\r\n                }\r\n            }\r\n        } else {\r\n            LOGGER.error(\"Sense notificacions\");\r\n            throw new NotificacionsElectroniquesModuleExcepcion(\"Sense notificacions\");\r\n        }\r\n    }\r\n\r\n    public void errorEnviamentNotificacio(NotificacioError notificacioError) throws NotificacionsElectroniquesModuleExcepcion {\r\n        if (LOGGER.isDebugEnabled()){\r\n            LOGGER.debug(\"Recepció per part del sistema requeridor de notificacions telemàtiques dels errors durant la creació de la NT.\");\r\n        }\r\n\r\n        if (notificacioError != null) {\r\n            if (LOGGER.isDebugEnabled()){\r\n                LOGGER.debug(\"Error en la recepció de la notificació: \" + notificacioError.getIdNotificacio() + \". Codi error: \" + notificacioError.getCodiError());\r\n            }\r\n        } else {\r\n            LOGGER.error(\"Sense error a la notificació\");\r\n            throw new NotificacionsElectroniquesModuleExcepcion(\"Sense error a la notificació\");\r\n        }\r\n    }\r\n}\r\n```\r\n* eNOTUMService: Nom del Bean on es configura el nom del WebService i la ruta d'accés a ell. Un exemple:\r\n\r\n```\r\n<bean id=\"eNOTUMService\" class=\"org.springframework.ws.wsdl.wsdl11.DefaultWsdl11Definition\"\r\n         p:portTypeName=\"eNOTUMService\" //<--Nom del Servei Web (configurable)\r\n         p:locationUri=\"/ws/services/ENotumService/\" //<--Path del Servei Web (configurable)\r\n         p:targetNamespace=\"http://gencat.net/scsp/esquemes/productes/nt/services\">\r\n         <property name=\"SchemaCollection\" ref=\"schemaCollection\"/>\r\n         <property name=\"createSoap11Binding\" value=\"false\"/>\r\n         <property name=\"createSoap12Binding\" value=\"true\"/>\r\n</bean>\r\n```\r\n\r\nEn el cas de l'exemple, el WS es podrà accedir en http://(Host)/(NomApp)/ws/services/ENotumService/eNOTUMService.wsdl\r\n\r\n**IMPORTANT:** Tindre en compte que la url del Servei Web ha de ser coneguda prèviament per Enotum. Normalment s'informa en el document d'alta que la PICA subministra per consumir els serveis d'ENOTUM.\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1lbm90dW0td3M="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2lz":{"date":1425571902000,"title":"PSIS","description":"Validació de Signatures electròniques mitjançant els serveis de PSIS oferts per CatCert.","sections":"Canigó. Documentació versió 3.x","weight":11,"path":"/canigo-documentacio-versions-3x-integracio/modul-psis","content":"## Propòsit\r\n\r\nAquest mòdul permet la validació de Signatures electròniques mitjançant els serveis de PSIS oferts per CatCert.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal- lar el mòdul de PSIS es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```xml\r\n<canigo.integration.psis.version>[1.1.0,1.2.0)</canigo.integration.psis.version>\r\n\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.psis</artifactId>\r\n          <version>${canigo.integration.psis.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/psis.properties\r\n\r\nPropietat          | Requerit | Descripció\r\n------------------ | -------- | -----------\r\n*.psis.urlPica  | Sí       | Url del WebService de PSIS. Valor per defecte: http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.psis.finalitat   | Sí       | Finalitat de l'accés al servei. \r\n*.psis.nifEmisor   | Sí       | Nif de l'emisor\r\n*.psis.nomEmisor   | Sí       | Nom de l'emisor\r\n*.psis.nomFuncionari| Sí      | Nom del funcionari\r\n*.psis.nifFuncionari| Sí      | Nif del funcionari\r\n*.psis.emailFuncionari| Sí    | Email del funcionari\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n## Utilització del Mòdul\r\n\r\n### JSF\r\n\r\nPer a utilitzar aquest mòdul, cal crear un bean i una jsf:\r\n\r\n**PsisBean.java**\r\n\r\nManaged Bean de JSF expossat per Spring, i accesible desde la pàgina JSF amb el nom psisBean.\r\n\r\nEn aquest exemple es valida la caducitat d'un certificat amb PSIS:\r\n\r\n```java\r\nimport java.io.InputStream;\r\nimport javax.faces.application.FacesMessage;\r\nimport javax.faces.context.FacesContext;\r\n\r\nimport net.gencat.pica.psis.schemes.valCertSimpPICARequest.ValCertSimpPICARequestDocument;\r\nimport net.gencat.pica.psis.schemes.valCertSimpPICARequest.ValCertSimpPICARequestDocument.ValCertSimpPICARequest;\r\nimport net.gencat.pica.psis.schemes.valCertSimpPICAResponse.ValCertSimpPICAResponseDocument;\r\n\r\nimport org.apache.commons.io.IOUtils;\r\nimport org.apache.commons.logging.Log;\r\nimport org.apache.commons.logging.LogFactory;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Lazy;\r\nimport org.springframework.stereotype.Component;\r\n\r\nimport cat.gencat.ctti.canigo.arch.integration.psis.PSISConnector;\r\nimport cat.gencat.ctti.canigo.arch.integration.psis.exceptions.PSISException;\r\n\r\n@Component(\"modulPsisBean\")\r\n@Lazy\r\npublic class ModulPsisBean {\r\n\r\n  @Autowired\r\n  private PSISConnector psisServices;\r\n  private static final Log log = LogFactory.getLog(ModulPsisBean.class);\r\n  private static byte[] certificatCaducat = getBytesFromInputStream(\r\n    Thread.currentThread().getContextClassLoader().getResourceAsStream(\"config/cert/certificatCaducat.crt\"));\r\n\r\n  public void testValidarCertificatCaducat() throws PSISException {\r\n    log.debug(\"[testValidarCertificatCaducat]\");\r\n    try{\r\n      ValCertSimpPICARequestDocument document = ValCertSimpPICARequestDocument.Factory.newInstance();\r\n      ValCertSimpPICARequest peticioValidar = ValCertSimpPICARequest.Factory.newInstance();\r\n      peticioValidar.setCertificat(certificatCaducat);\r\n      document.setValCertSimpPICARequest(peticioValidar);\r\n      ValCertSimpPICAResponseDocument resposta = psisServices.validarCertificat(document);\r\n      if (resposta!=null && resposta.getValCertSimpPICAResponse()!=null && resposta.getValCertSimpPICAResponse().getResultat()!=null){\r\n        FacesContext.getCurrentInstance().addMessage(\"psisForm\",\r\n          new FacesMessage( FacesMessage.SEVERITY_INFO,  \"S'ha verificat la caducitat del certificat amb el següent resultat: \"+\r\n          resposta.getValCertSimpPICAResponse().getResultat(), null));\r\n      }else{\r\n        FacesContext.getCurrentInstance().addMessage(\"psisForm\",\r\n          new FacesMessage( FacesMessage.SEVERITY_ERROR, \"No s'ha rebut resposta del servei o el format d'aquesta no es l'esperat\", null));\r\n      }\r\n    } catch (PSISException e) {\r\n      FacesContext.getCurrentInstance().addMessage(\"psisForm\",\r\n        new FacesMessage( FacesMessage.SEVERITY_ERROR, \"S'ha produït un error al servei\", null));\r\n      e.printStackTrace();\r\n    } catch (Exception e) {\r\n      FacesContext.getCurrentInstance().addMessage(\"psisForm\",\r\n        new FacesMessage( FacesMessage.SEVERITY_ERROR, \"S'ha produït un error general\", null));\r\n      e.printStackTrace();\r\n    }\r\n  }\r\n\r\n  private static byte[] getBytesFromInputStream(InputStream is) {\r\n    byte[] resultat = null;\r\n    try {\r\n      resultat = IOUtils.toByteArray(is);\r\n    } catch (Exception e) {\r\n      log.error(e);\r\n    }\r\n    return resultat;\r\n  }\r\n}\r\n```\r\n\r\n**psis.jsf**  \r\nPàgina JSF que conté un commandButton que realitza la crida al mètode \"execute\" del managed bean de JSF.\r\n\r\n```\r\n<h:form id=\"psisForm\">\r\n       <h:panelGrid columns=\"1\">\r\n           <h:commandButton value=\"#{msg.canigoSubmit}\" action=\"#{modulPsisBean.testValidarCertificatCaducat}\" />\r\n           <h:message for=\"psisForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n       </h:panelGrid>\r\n</h:form>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2lz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXA=":{"date":1426760726000,"title":"SAP","description":"Interficie d'accés als Backends SAP de la Generalitat.","sections":"Canigó. Documentació versió 3.x","weight":12,"path":"/canigo-documentacio-versions-3x-integracio/modul-sap","content":"## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície simplificada per accedir a backends SAP de la Generalitat.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer poder utilitzar el connector haurem de configurar el projecte perquè inclogui dues llibreries dll i diferents jars:\r\n\r\nLes llibreries són sapjcorfc.dll i librfc32.dll i s'han de copiar al directori system32.\r\n\r\nPer fer les operacions sobre el sistema SAP és necessària la utilització del jar sapjco-2.1.6, que és el connector propi del SAP per fer les crides a les seves funcions BAPI (RFC).\r\n\r\nLes classes que utilitzarem per fer els objectes d'operacions estan en el jar del connector Gecat09 canigo-connectors-gecat09-2.3.2.jar\r\n\r\nLes classes que utilitzarem per fer les operacions han estat generades amb una eina Open Source anomenada JAXB (Java API for Xml Binding), que genera classes java a partir d'un esquema de xml (XMLSchema). Aquesta eina ens permet no solament generar automàticament classes java sinó també fer validacions per comprovar que les dades que contenen els objectes són vàlides. Per això també haurem d'incloure els jars que necessita JAXB:\r\n\r\n* jaxb-api-1.0.1.jar\r\n* jaxb-libs-1.0.1.jar\r\n* jaxb-impl-1.0.1.jar\r\n* jax-qname-1.1.jar\r\n* namespace-1.0.1.jar\r\n* relaxngDatatype-1.0.1.jar\r\n* xsdlib-1.1.2.jar\r\n\r\nPer tal d'instal-lar el mòdul de SAP es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.sap.version>[1.1.0,1.2.0)</canigo.integration.sap.version>\r\n-\r\n<dependency>\r\n          <groupId>cat.gencat.ctti</groupId>\r\n          <artifactId>canigo.integration.sap</artifactId>\r\n          <version>${canigo.integration.sap.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de l'eina de suport al desenvolupament.\r\n\r\nUbicació: <PROJECT_ROOT>/src/main/resources/config/props/sap.properties\r\n\r\n| Propietat                | Requerit     | Descripció\r\n| ------------------------ | ------------ | --------------\r\n| *.sap.client             | Sí           | Client\r\n| *.sap.username           | Sí           | Usuari de connexió\r\n| *.sap.password           | Sí           | Password de connexió\r\n| *.sap.language           | Sí           | Idioma\r\n| *.sap.hostname           | Sí           | Nom del servidor\r\n| *.sap.systemNumber       | Sí           | SAP system number\r\n| *.sap.connectionPool     | No           | Connexió amb pool. Per defecte: true\r\n| *.sap.connectionPoolName | No           | Nom del pool. Per defecte: poolCanigoSAP\r\n| *.sap.maxNumConnections  | No           | Número de connexions màximes. Per defecte: 5\r\n| *.sap.repositoryName     | No           | Nom del repository. Per defecte: ARAsoft\r\n\r\n## Utilització del Mòdul\r\n\r\n### JSF\r\n\r\nPer a configurar el mòdul és necessari:\r\n\r\n    Crear un managed bean de JSF que contingui la lògica d'invocació al servei SAP.\r\n    Pàgina JSF per a realitzar la invocació al managed bean.\r\n\r\n**SAPBean.java**\r\n\r\nManaged Bean de JSF que gestiona la crida al servei de SAP.\r\n\r\nEn aquest bean es pot veure:\r\n\r\n* Inyecció del conector de SAP via annotacions (@Autowired) de Spring.\r\n* Inyecció del servei d'internacionaliztació via annotacions (@Autowired) de Spring.\r\n* Invocació de la funció BAPI_MATERIAL_GETLIST, taula MATNRSELECTION.\r\n* Inserció del missatge de resultat de l'operació que posteriorment sera recuperat pel formulari JSF.\r\n* En la classe MaterialBean s'introduirà el resultat de l'invocació de la funció SAP de manera transparent.\r\n\r\n```java\r\n/**\r\n * Classe d'exemple d'invocació al servei de SAP\r\n *\r\n * @author cscanigo\r\n *\r\n */\r\n@Component(\"sapBean\")\r\n@Lazy\r\npublic class SAPBean {\r\n\r\n    @Autowired\r\n    private SapConnector connector;\r\n    @Autowired\r\n    private I18nResourceBundleMessageSource resource;\r\n\r\n        /**\r\n         * Execució de la funció SAP BAPI_MATERIAL_GETLIST\r\n         *\r\n         */\r\n    public void execute(){\r\n        try{\r\n            this.connector.connect();\r\n            Collection<Object> col = this.connector.executeFunction(\"BAPI_MATERIAL_GETLIST\",\r\n                    \"MATNRSELECTION\", null, MaterialBean.class);\r\n\r\n            FacesContext.getCurrentInstance().addMessage(\"sapForm\", new FacesMessage(\r\n                    FacesMessage.SEVERITY_INFO, resource.getMessage(\"sapSuccess\") + \": \" + col.size(), null));\r\n        }catch(Exception e){\r\n            FacesContext.getCurrentInstance().addMessage(\"sapForm\", new FacesMessage(\r\n                    FacesMessage.SEVERITY_ERROR, resource.getMessage(\"sapError\") + \" - \" + e.getMessage(), null));\r\n        }finally{\r\n            this.connector.disconnect();\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\n**sap.jsf**\r\n\r\nInvocació del métode \"execute\" del managed bean de JSF definit anteriorment com a \"sapBean\". El Tag message mostrarà el resultat de la crida (veure FacesContext.getCurrentInstance().addMessage(\"sapForm\"....).\r\n\r\n```\r\n<h:form id=\"sapForm\">\r\n   <h:panelGrid columns=\"1\">\r\n      <h:commandButton value=\"#{msg.canigoSubmit}\" action=\"#{sapBean.execute}\" />\r\n      <h:message for=\"sapForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n   </h:panelGrid>\r\n</h:form>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXA="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wYWRybw==":{"date":1426843687000,"title":"Padró","description":"Serveis d'empadronament publicats de la plataforma PICA.","sections":"Canigó. Documentació versió 3.x","weight":9,"path":"/canigo-documentacio-versions-3x-integracio/modul-padro","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector, és el de proporcionar un punt d'accés utilitzant la plataforma PICA cap serveis d'empadronament publicats en aquesta plataforma.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduïda al connector de la Pica que simplifica l'utilització dels diferents serveis d'empadronament oferts per la generalitat.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector PICA-PADRO es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet utilitzar els diferents serveis del PADRO a través de l'accés a través d'una API de les següents modalitats de consum:\r\n\r\nServeis Síncrons\r\n\r\n* PADRO_COMPROVACIO_CONVIVENTS\r\n* PADRO_DADES_CONVIVENTS_PDF\r\n* PADRO_DADES_CONVIVENTS\r\n* PADRO_DADES_TITULAR\r\n* PADRO_DADES_TITULAR_INE\r\n* PADRO_DADES_TITULAR_PDF\r\n* PADRO_MUNICIPI_RESIDENCIA\r\n* PADRO_NUMERO_CONVIVENTS\r\n* PADRO_RESIDENT\r\n* PADRO_RESIDENT_MUNICIPI\r\n* PADRO_VALIDACIO_CONVIVENTS\r\n\r\nServeis Asíncrons\r\n\r\n* PADRO_TITULAR_CERCA\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent aquests components a la següent url:\r\n\r\nCodi Font:  http://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.padro.pica/1.1.1/\r\n\r\n### Requeriments\r\n\r\nEl connector PADRO és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector PADRO funcioni correctament sobre l'aplicació que l'utilitzi, s'ha de tenir configurat el servei connector genèric de la PICA 1.0.\r\n\r\n## Configuració\r\n\r\nPer configurar el mòdul d'integració PICA-PADRO és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-PADRO amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml:\r\n\r\n```\r\n<canigo.integration.padro.pica.version>[1.1.0,1.2.0)</canigo.integration.padro.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-PADRO -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.padro.pica</artifactId>\r\n    <version>${canigo.integration.padro.pica.version}</version>\r\n</dependency>\r\n\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/padro.properties amb el següent contingut:\r\n\r\n```\r\n*.padro.pica.finalitat=[finalitat]\r\n*.padro.pica.urlPica=http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.padro.pica.nifEmisor=[nifEmisor]\r\n*.padro.pica.nomEmisor=[nomEmisor]\r\n*.padro.pica.nomFuncionari=[nomFuncionari]\r\n*.padro.pica.nifFuncionari=[nifFuncionari]\r\n*.padro.pica.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors d finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-padro.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n## Utilització del Connector\r\n \r\n### Exemple d'utilització d'un Servei Síncron\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate PadroConnectorImpl padroService;\r\n```\r\n\r\n2.- Escollir una modalitat de servei síncrona i cridar-la amb els paràmetres que necessiti. En aquest cas es mostra un exemple amb la modalitat padroComprovacioConvivents:\r\n\r\n```java\r\nString numExpedient = \"CAT-1234567890ABCDEF\";\r\nint tipusDocumentacio = Constants.NIE;\r\nString documentacio = \"X02649265X\";\r\nString codMun = \"999\";\r\nint numConv = 99;\r\nString codProv = \"1\";\r\nint idesCat = 0;\r\n\r\nRespuestaComprobacionConvivientes resposta = padroService.padroComprovacioConvivents(\r\n    numExpedient,\r\n    tipusDocumentacio,\r\n    documentacio,\r\n    codMun,\r\n    codProv,\r\n    numConv,\r\n    idesCat\r\n);\r\n```\r\n\r\nL'estat de finalització dependrà del codi retornat:\r\n\r\n```java\r\nresposta.getCodigoResultado();\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA Guia d'us del servei de **PADRO v1.5x.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n\r\n### Exemple d'utilització d'un Servei Asíncron\r\n\r\n1.- L'únic servei asíncron que ofereix el servei de PADRO és el PADRO_TITULAR_CERCA. Per poder utilitzar aquesta modalitat de consum el connector de Canigó 3 preveu tres mètodes diferents:\r\n\r\n```java\r\npublic RespostaCercaTitular  padroTitularCerca(String numExpedient, int tipusDocumentacio, String documentacio) throws PadroException;\r\npublic EstatAsincron getEstatPadroTitularCerca(CridaAsincronaResponseDocument response) throws PadroException;\r\npublic RespostaCercaTitular getDadesPadroTitularCerca(IPICAServiceAsincron servei) throws PadroException;\r\n```\r\n\r\n2.- El primer serveix per carregar les dades de la consulta al servei i fer la primera petició. Donat que és un servei asíncron retorna un objecte amb l'estat actual de la petició i el temps estimat de finalització d'aquesta.\r\n\r\nIgual que en les peticions asíncrones s'inicialitza el bean del servei del connector;\r\n\r\n```java\r\n@Autowired\r\nprivate PadroConnectorImpl padroService;\r\n```\r\n\r\nEs crida al servei amb les dades pertinents:\r\n\r\n```java\r\nString numExpedient = \"123456\";\r\nint tipusDocumentacio = Constants.NIF;\r\nString documentacio = \"46583836G\";\r\n\r\nRespostaCercaTitular resposta = padroConnector.padroTitularCerca(numExpedient, tipusDocumentacio, documentacio);\r\n```\r\n\r\n3.- El segon serveix per anar comprovant l'estat de la consulta de forma periòdica. Igual que el primer mètode retorna un objecte amb l'estat actual de la petició i el temps estimat per la seva resolució.\r\n\r\n```java\r\nEstatAsincron estat = padroConnector.getEstatPadroTitularCerca(resposta.getResponse());\r\n```\r\n\r\n4.- Finalment el tercer mètode recupera el resultat de la peticó una vegada confirmat que la petició ha finalitzat.\r\n\r\n```java\r\nRespostaCercaTitular dades = padroConnector.getDadesPadroTitularCerca(resposta.getServei());\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn i el detall exacte dels objectes retornats consultar el document de la PICA **Guia d'us del servei de PADRO v1.5x.pdf** disponible via petició a requeridors.otpica.ctti@gencat.cat\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wYWRybw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2dk":{"date":1426783321000,"title":"ARESTA (PSGD)","description":"Plataforma de Serveis de Gestió Documental","sections":"Canigó. Documentació versió 3.x","weight":17,"path":"/canigo-documentacio-versions-3x-integracio/modul-psgd","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector és proporcionar un punt d'accés cap a la Plataforma de Serveis de Gestió Documental (PSGD) també coneguda com a ARESTA.\r\n\r\n## Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional que faciliti a les aplicacions l'ús de la PSGD.\r\n\r\n## Context i Escenaris d'ús\r\n\r\nEl connector PSGD es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n## A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Documents i Fonts de Referència\r\n\r\n| Nom Document\r\n| ----------\r\n| [PSGD Manual Integració](/related/canigo/documentacio/modul-psgd/PSGD_Manual_Integració_v5.5.pdf).\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet realitzar les següents accions:\r\n\r\n**Funcionalitats de Documents**\r\n\r\n* **Alta Document:** Alta d’un nou document en el sistema.\r\n* **Baixa Document:** Baixa lògica d’un document del sistema.\r\n* **Check-Out Document:** Marcatge d’un document com a no modificable per estar en possessió d’un determinat usuari i obtenció del document i les seves signatures.\r\n* **Check-In Document:** Substitució d’un document existent en el sistema per un de nou i marcatge com a document modificable, amb les seves signatures associades, si s’escau\r\n* **Editar Metadades Document:** Modificació de les metadades d’un document del sistema.\r\n* **Obtenir Document:** Obtenció d’un document existent en el sistema i els identificadors únics de les seves versions prèvies.\r\n* **Cercar Documents:** Cerca de documents en funció de les seves metadades i contingut.\r\n\r\n**Funcionalitats d'Expedients**\r\n\r\n* **Alta Expedient:** Alta d’un nou expedient en el sistema.\r\n* **Baixa Expedient:** Baixa d’un expedient del sistema.\r\n* **Assignar Document:** Assignar un document existent en el sistema a un expedient existent en el sistema.\r\n* **Eliminar Assignació Document:** Eliminar l’assignació d’un document a un expedient.\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font i binaris referent a aquest component a la següent url:\r\n\r\nhttp://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.psgd/1.1.0/\r\n\r\n### Requeriments\r\n\r\nEl connector PSGD és compatible amb les versions 1.6 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\n## Configuració\r\n\r\nPer configurar el mòdul d'integració PSGD és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul psgd incorporant manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml;\r\n\r\n```\r\n<canigo.integration.psgd.version>[1.1.0,1.2.0)</canigo.integration.psgd.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PSGD -->\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.psgd</artifactId>\r\n    <version>${canigo.integration.psgd.version}</version>\r\n</dependency>\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/psgd.properties amb el següent contingut:\r\n\r\n```\r\n*.psgd.usuari=[usuariPSGD]\r\n*.psgd.password=[passwordPSGD]\r\n*.psgd.url=[urlPSGD]\r\n*.psgd.keystore=[path keystore]\r\n*.psgd.keystore.password=[password keystore]\r\n*.psgd.truststore=[path truststore]\r\n*.psgd.truststore.password=[password truststore]\r\n```\r\n\r\nL’usuari i password per donar d’alta l’aplicació al PSGD s’ha de demanar al gestor del projecte per part de CTTI.\r\n\r\nLa url d'accés dependrà si es vol treballar amb l'entorn de Preproducció (https://preproduccio.gestordocumental.intranet.gencat.cat) o Producció (https://gestordocumental.intranet.gencat.cat).\r\n\r\nEls certificats necessaris per accedir a la url de PSGD s'han de demanar al gestor del projecte per part de CTTI.\r\n\r\nHi ha tres opcions per indicar a l'aplicació on es troba els certificats necessaris:\r\n\r\n* Omplir els valors  referents al keystore/truststore on s'ha incorporat el certificat. S'ha d'indicar si el path pertany al classpath o al sistema de fitxer. Per exemple:\r\n\r\n```\r\n*.psgd.keystore=classpath*:data/psgdKeystore\r\n\r\no\r\n\r\n*.psgd.keystore=file:/aqd/psgd/psgdKeystore\r\n```\r\n\r\n* Deixar sense valor les variables keystore i truststore. L'aplicació utilitzarà el cacerts que tingui configurat JVM. (Per a que funcioni s'ha d'afegir els certificats al cacerts)\r\n\r\n* Deixar sense valor les variables keystore i truststore i indicar el path del keystore a la JVM quan s'inicia l'aplicació amb el següent paràmetre:\r\n\r\n```\r\njavax.net.ssl.trustStore=/aqd/psgd/psgdKeystore\r\n```\r\n\r\n## Utilització del Connector\r\n\r\n### Exemple d'utilització Alta de Document\r\n\r\nRecuperar el bean del servei de PSGD des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate PsgdConnectorImpl psgdConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\n\r\n Document document = new Document();\r\n\t         \r\n DocumentMetaData documentMetaData = new DocumentMetaData();\r\n \r\n documentMetaData.setDocumentName(\"prova.txt\");\r\n documentMetaData.setDocumentTypeCode(\"TD01-010\");\r\n documentMetaData.setTitle(\"Prova\");\r\n documentMetaData.setCreatorID(\"canigo\");\r\n documentMetaData.setDocumentDescriptor(\"descriptor\");\r\n documentMetaData.setOrigin(\"0\");\r\n\r\n InputStream documentData = new FileInputStream(\"pathfitxer\")\r\n \r\n document.setDocumentMetaData(documentMetaData);\r\n \r\n CreateDocumentResponse result = psgdConnector.altaDocument(document, documentData);\r\n\r\n```\r\n El objecte de resposta CreateDocumentResponse retorna el ID del document creat.\r\n\r\n```java\r\n String documentID = result.getResult().getResultData().getDocumentCreated().getDocumentID();\r\n```\r\n\r\n* En cas de que retorni error es pot consultar el code i la descripció de la següent manera:\r\n\r\n```java\r\n String code = result.getResult().getCode();\r\n String descripcio = result.getResult().getDescription();\r\n String descExtended = result.getResult().getExtendedDescription();\r\n```\r\n\r\n### Exemple d'utilització Obtenir Documents\r\n\r\nRecuperar el bean del servei de PSGD des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate PsgdConnectorImpl psgdConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nDocumentGetContentData document = new DocumentGetContentData();\r\n         \r\ndocument.setDocumentID(\"478fbefa-4de5-49c7-881c-1b2e1d1a8535\");\r\ndocument.setReaderID(\"canigo\");\r\n\r\nDocumentResponse result = psgdConnector.descarregarDocument(document);\r\n\r\n```\r\n\r\n El objecte de resposta DocumentResponse retorna el ID, nom, tipus i mida del document demanat. Així com el document en un ByteArrayOutputStream.\r\n\r\n En cas de voler desar el document demanat a disc es podria fer de la següent manera.\r\n\r\n```java\r\nOutputStream outputStream = new FileOutputStream (\"givefilename\"); \r\nresult.getResult().getResultData().getData().writeTo(outputStream);\r\n```\r\n\r\n* En cas de que retorni error es pot consultar el code i la descripció de la següent manera:\r\n\r\n```java\r\n String code = result.getResult().getCode();\r\n String descripcio = result.getResult().getDescription();\r\n String descExtended = result.getResult().getExtendedDescription();\r\n```\r\n\r\nPer consultar la totalitat de possibles codis de retorn consultar el document [PSGD Manual Integració](/related/canigo/documentacio/modul-psgd/PSGD_Manual_Integració_v5.3.pdf).\r\n\r\n## Logs\r\n\r\nSi es vol conéixer la petició JSON que s'està enviant i el JSON que s'està rebent es pot fer a través dels logs.\r\n\r\nAl fitxer Log4j.xml s'ha de posar a debug la classe: cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor\r\n\r\n```xml\r\n<category name=\"cat.gencat.ctti.canigo.arch.integration.psgd.utils\">\r\n\t<level value=\"debug\"/>\r\n</category>\r\n```\r\n\r\nUn exemple de sortida dels logs:\r\n\r\n```\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - ===========================request begin================================================\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - URI : https://preproduccio.gestordocumental.intranet.gencat.cat/service/extendedServices/search/documents\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - Method : POST\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - Request Body : {\"Token\":\"TICKET_fadafc82507d6158937cd2d5a63e667a5d471f0e\",\"Request\":\"SearchDocuments\",\"RequestData\":{\"DocumentSearchCriteria\":{\"DocumentID\":\"476bf6a5-b9ba-4a2f-86c1-665277b31ea0\",\"DocumentDescriptor\":\"a\",\"FolderSetName\":\"C0001\",\"FolderNumber\":\"1\",\"FolderYear\":\"2016\",\"Title\":\"prova\",\"InputRegistryID\":\"1\",\"OutputRegistryID\":\"1\",\"DocumentDateBefore\":\"24/02/2016\",\"DocumentDateAfter\":\"15/02/2016\",\"DocumentTypeName\":\"TD10-010\",\"Text\":\"Mitja\"}}}\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - ==========================request end================================================\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - ============================response begin==========================================\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - status code: 200\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - status text: OK\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - Response Body : {\"Result\":{\"Code\":\"OK\",\"Description\":\"Successful\",\"ResultData\":{\"SearchDocumentsResults\":{\"Found\":\"1\",\"Documents\":[{\"Document\":{\"DocumentMetaData\":{\"DocumentID\":\"476bf6a5-b9ba-4a2f-86c1-665277b31ea0\",\"DocumentName\":\"prova.docx\",\"DocumentTypeName\":\"TD10-010\",\"DocumentDepartmentUnitID\":\"CTT\",\"Title\":\"Prova\",\"OrganName\":\"Organ\",\"CreatorID\":\"canigo\",\"CreationDate\":\"17/02/2016 14:57:09\",\"Signed\":false,\"OwnerID\":\"canigo\",\"ReaderID\":\"canigo\",\"ReadDate\":\"19/02/2016 13:36:14\",\"BinderID\":\"canigo\",\"BindingDate\":\"23/02/2016 09:58:59\",\"UnbinderID\":\"canigo\",\"UnbindingDate\":\"23/02/2016 09:48:19\",\"BindingFolderID\":\"22e77806-349f-4440-a534-cfd6c9ffeeb8\",\"Folders:\":[{\"FolderID\":\"22e77806-349f-4440-a534-cfd6c9ffeeb8\",\"FolderSetName\":\"C0001\",\"FolderNumber\":\"1\",\"FolderYear\":2016,\"OrganName\":\"CTT\",\"OrganCode\":\"CTT\"}]}}}]}}}}\r\ncanigo Message: DEBUG [main] cat.gencat.ctti.canigo.arch.integration.psgd.utils.LoggingRequestInterceptor - =======================response end=================================================\r\n```\r\n\r\nEs recomana no possar el log a nivell de Debug per a Producció.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1wc2dk"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zZ2Rl":{"date":1426854475000,"title":"SGDE","description":"Servei de Gestió del Document Electrònic.","sections":"Canigó. Documentació versió 3.x","weight":14,"path":"/canigo-documentacio-versions-3x-integracio/modul-sgde","content":"## Introducció\r\n\r\nL'SGDE o Servei de Gestió del Document Electrònic ofereix una sèrie de serveis relacionats amb la gestió de documents electrònics. Aquests serveis els ofereixen les plataformes que integren l'SGDE. Actualment existeixen dues:\r\n\r\n* Plataforma Adobe\r\n* STD\r\n\r\nPodeu trobar mes informació sobre els serveis i funcionalitats del SGDE [aquí](/sgde/about/).\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una API que pugui ser utilitzada de forma fàcil pels integradors d'aquest connector per consumir els diferents serveis del SGDE.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector SGDE es troba dins els connectors funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector ofereix els següents serveis:\r\n\r\n**Serveis Plataforma Adobe**\r\n\r\n* **renderitzarFormulari:** Fusiona un formulari amb la plantilla pdf.\r\n* **renderitzarSignarPDF:** Fusiona un formulari amb la plantilla pdf i posteriorment el signa.\r\n* **renderitzarFormulariPDFadjunts:** Fusiona un formulari amb la plantilla pdf i afegeix els annexos indicats\r\n* **renderitzarFormulariPDFaplanatForms:** Fusiona un formulari amb la plantilla pdf donant com a resultat un PDF aplanat. Realitzat amb el mòdul Forms de LC.\r\n* **renderitzarFormulariPDFAplanat:** Fusiona un formulari amb la plantilla pdf donant com a resultat un PDF aplanat. Realitzat amb el mòdul d'Output de LC.\r\n* **renderitzarFormulariPDFA:** Fusiona un formulari amb la plantilla pdf donant com a resultat un PDF/A, que garanteix la compatibilitat d’aquest document al llarg del temps.\r\n* **renderitzarFormulariPDFaplanatSignat:** Fusiona un formulari amb la plantilla pdf, després l'aplana i el signa.\r\n* **extreureDadesFormulari:** Servei per extreure dades d'un formulari.\r\n* **extreureDadesXML:** Servei que extreu les dades introduïdes en un formulari dinàmic.\r\n* **extreureComentaris:** Servei que extreu els comentaris d'un document PDF.\r\n* **extreureComplexAnnexos:** Servei que extreu els annexos d'un document PDF.\r\n* **extreureAnnexos:** Servei que extreu els annexos d'un document PDF.\r\n* **convertirPdfaImatge:** Servei per convertir un pdf a imatge.\r\n* **convertirPdfaPdfA:** Servei per convertir un PDF a PDF/A.\r\n* **aplanarPDF:** Servei per aplanar un pdf.\r\n* **signarPDF:** Servei per a signar un pdf pla.\r\n* **aplanarSignarPDF:** Servei per aplanar i signar un pdf.\r\n\r\n**Serveis STD**\r\n\r\n* **generarCSV:** Servei per la generació d'un Codi Segur a partir d'un arxiu i una clau.\r\n* **composarPDFStream:** Servei que composa un PDF a partir d'una plantilla i d'un document PDF enviat en Stream en la mateixa petició.\r\n* **composarPDFRemot:** Servei que composa un PDF a partir d'una plantilla i d'un document PDF previament pujat al filesystem del STD.\r\n* **convertirPDF:** Servei que converteix un document Ofimàtic (Word, Excel, PowerPoint, Imatges, OpenOffice,...) en PDF.\r\n* **convertirPDFCercable:** Servei que converteix un document Ofimàtic (Word, Excel, PowerPoint, Imatges, OpenOffice,...) en PDF Cercable.\r\n* **convertirComposarPDF:** Servei que converteix i posteriorment composa un arxiu ofimàtic.\r\n* **convertirComposarPDFCercable:** Servei que converteix i posteriorment composa un arxiu ofimàtic cercable.\r\n* **ferOCR:** Servei que extrau el text inclòs a una imatge i el retorna.\r\n\r\n\r\n### Alta Servei\r\n\r\nPer poder utilitzar l'SGDE s'ha d'estar donat d'alta en el servei. Per poder fer-ho s'han d'enviar un mail a oficina-tecnica.canigo.ctti@gencat.cat sol.licitant l'alta a qualsevol de les plataformes que integren el SGDE:\r\n\r\n* Plataforma Adobe: El mail a de contenir la sol·licitud d'alta a l'aplicació d'AutoServei disponible [aqui](/related/SGDE/formulari-alta-plataforma-adobe.xls \"Formulari d'alta plataforma Adobe del SGDE\").\r\n* STD: El mail ha de redactar-se tal qual es descriu en el manual d'usuari del servei. Aquest mail ha de contenir una plantilla degudament complimentada que es pot trobar aquí.\r\n    1. El Centre de Frameworks i Solucions d'Arquitectura respondrà a aquest mail una vegada doni d'alta l'aplicació amb un mail tipus,\r\n    2. L'alta a qualsevol de les dues plataformes s'han de realitzar primer sobre l'entorn de PRE i posteriorment a l'entorn de PRO.\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquest components a la següent url:\r\n\r\nCodi Font:  http://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.sgde/1.2.0/\r\n\r\n#### Requeriments\r\n\r\nEl connector SGDE és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nEl seu ús esta certificat per funcionar correctament en servidors d'aplicacions WL11g i Tomcat6.x.\r\n\r\n### Instal.lació i Configuració\r\n\r\n#### Instal.lació\r\n\r\nLa instal.lació del connector requereix de la utilització de la llibreria 'canigo.integration.sgde' i les dependències indicades a l'apartat 'Introducció-Versions i Dependències'.\r\n\r\nPer afegir aquesta dependència s'ha de modificar el pom.xml de l'aplicació per incloure les llibreries del Connector.\r\n\r\n```\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.integration.sgde</artifactId>\r\n\t<version>1.2.0</version>\r\n</dependency>\r\n\r\n```\r\n\r\nIMPORTANT\r\n\r\nEn el cas de que es vulgui integrar aquest connector en una aplicació que disposi del connector de la PICA, és farà necessari afegir les següents exclusions en aquests últim, per exemple el connector PADRÒ.\r\n\r\n```\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.padro.pica</artifactId>\r\n    <version>1.2.0</version>\r\n    <exclusions>\r\n\t\t<exclusion>\r\n\t\t\t<groupId>org.apache.axis2</groupId>\r\n\t\t\t<artifactId>axis2-jaxws</artifactId>\r\n\t\t</exclusion>\r\n\t\t<exclusion>\r\n\t\t\t<groupId>org.apache.woden</groupId>\r\n\t\t\t<artifactId>woden</artifactId>\r\n\t\t</exclusion>\r\n\t\t<exclusion>\r\n\t\t\t<groupId>org.apache.ws.commons.schema</groupId>\r\n\t\t\t<artifactId>XmlSchema</artifactId>\r\n\t\t/exclusion>\r\n    </exclusions>\r\n</dependency>\r\n```\r\n\r\nEl no afegir aquestes exclusions pot provocar que el connector SGDE no funcioni correctament.\r\n\r\n#### Configuració\r\n\r\n\r\n1.- Per poder configurar el connector SGDE és necessari crear un arxiu anomenat app-integration-sgde.xml situat en src/main/resources/spring/ amb el següent contingut:\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n           http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\t<!-- BEAN SGDE -->\r\n\t<bean id=\"sgdeService\" class=\"cat.gencat.ctti.canigo.arch.integration.sgde.impl.SGDEServiceImpl\" init-method=\"setupService\" scope=\"prototype\">\r\n    \t<description>\r\n\t\t\tSGDE implementation:\r\n\t\t\t\t- formsWSDLUrl: Url de l'wsdl del servei de formularis per les operacions de: renderitzar, extracció de dades, aplanat, ...\r\n\t\t\t\t- stdWSDLUrl: Url de l'wsdl del servei de Transformació de Documents(STD)\r\n\t\t</description>\r\n    \t<property name=\"formsWSDLUrl\" value=\"${sgde.forms.wsdl.url:http://eformularis.pre.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl}\" />\r\n\t\t<property name=\"stdWSDLUrl\" value=\"${sgde.std.wsdl.url:http://sgde.pre.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl}\" />\r\n    </bean>\r\n</beans>\r\n```\r\n\r\non les variables **sgde.forms.wsdl.url** i **sgde.std.wsdl.url** són recuperades de l'arxiu **sgde.properties** que s'ha de crear en src/main/resources/config/props/sgde.properties\r\n\r\n2.- Configuració dels arxius de properties.\r\n\r\nNomés es necessita un arxiu de properties a configurar el sgde.properties.\r\n\r\nEl primer conté només dos paràmetres,\r\n\r\n**sgde.forms.wsdl.url:** Url del WSDL del servei de formularis Adobe.\r\n\r\n* PRE: http://eformularis.pre.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\r\n* PRO: http://eformularis.intranet.gencat.cat/ServeisInvocacio/serveis/ServeisInvocacioV2?wsdl\r\n\r\n**sgde.std.wsdl.url:** Url del WSDL del STD.\r\n\r\n* PRE: http://sgde.pre.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl\r\n* PRO: http://sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl\r\n\r\n### Utilització del Connector\r\n\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate ISGDEService sgdeService;\r\n```\r\n\r\n2.- Escollir un dels serveis del SGDE, per exemple el de CSV.\r\n\r\n```java\r\nResultSTD res = null;\r\nbyte[] STD_ARXIU_PDF_TEST1 = null;\r\ntry {\r\n    STD_ARXIU_PDF_TEST1 = IOUtils.toByteArray(Thread.currentThread().getContextClassLoader().getResourceAsStream(\"data_sgde/prueba_composar.pdf\"));\r\n    res = sgdeService.generarCSV(\"ctti\", \"cscanigo\", STD_ARXIU_PDF_TEST1, \"cscanigo\");\r\n    log.info(\"[SGDEConnectorService][sgdeGeneracioCSVTest][estat: \" + res.getStatus().intValue() + \"]\");\r\n} catch (Exception e) {\r\n    e.printStackTrace();\r\n}\r\n```\r\n\r\nPer més informació sobre els diferents serveis que ofereix el SGDE consultar la documentació disponible [aquí](/sgde/documentacio/).","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zZ2Rl"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXJjYXQ=":{"date":1426781010000,"title":"SARCAT","description":"Serveis que ofereix la plataforma de Sarcat mitjançant la PICA i el seu connector nadiu.","sections":"Canigó. Documentació versió 3.x","weight":13,"path":"/canigo-documentacio-versions-3x-integracio/modul-sarcat","content":"## Propòsit\r\n\r\nAquest mòdul permet consumir els diferents serveis que ofereix la plataforma de Sarcat mitjançant la PICA i el seu connector nadiu. El mòdul permet consumir els serveis oferts pels WebService amb peticions síncrones.\r\n\r\n## Funcionalitats del connector\r\n\r\nEl connector proporciona accés a les següents operacions de Sarcat:\r\n\r\nOperació Sarcat                   | Descripció Funcional | Modalitat PICA | Operació PICA\r\n--------------------------------- | -------------------- | -------------- | -------------\r\nconsultaAssentaments              | Permet obtenir una relació d'assentaments, amb les dades bàsiques, que compleixin uns criteris de filtratge específics. | SARCAT_AL_CONSULTA    | OP_CONSULTA_ASSENTAMENTS\r\ncercaAssentaments                 | Permet obtenir totes les dades d'un assentament concret.                                                               | SARCAT_AL_CONSULTA    |  OP_CERCA_ASSENTAMENTS\r\nrecollirAssentamentsSafataEntrada | Permet recollir assentaments de la safata d'entrada per incorporar-los a d'altres sistemes.                            | SARCAT_AL_CONSULTA    |  OP_RECOLLIR_ENTRADA\r\nrecollirAssentamentsSafataSortida | Permet recollir assentaments de la safata de sortida per incorporar-los a d'altres sistemes.                            | SARCAT_AL_CONSULTA    |  OP_RECOLLIR_SORTIDA\r\nesPresortida                      | Conèixer si un assentament concret és una pre-sortida o una sortida.                                                    | SARCAT_AL_CONSULTA    |  OP_ES_PRESORTIDA\r\ninsertarAssentamentEntrada        | Es registra l'assentament d'entrada i retorna el número d'assentament assignat i la data de registre.                   | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_ENTRADA\r\ninsertarAssentamentSortida        | Es registra l'assentament de sortida i retorna el número d'assentament assignat i la data de registre.                  | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_SORTIDA\r\ninsertarAssentamentSafata         | Donada la informació d'assentaments d'entrada, els grava i retorna el número de registre de cadascun. Addicionalment comprova la validesa de la destinació externa respecte l'unitat de registre associada a l'assentament.                                                                                            | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_SAFATA\r\ninsertarAssentamentPresortida     | Donada la informació X d'assentaments de presortida, els grava i retorna el número de registre de cadascun.             | SARCAT_AL_ALTA        |  OP_INSERTAR_ASSENTAMENTS_PRESORTIDA\r\nnumExp \t\t\t\t\t\t\t  | Permet modificar el número d'expedient prèviament assignat a un assentament d'entrada o sortida realitzat.              | SARCAT_AL_MODIFICACIO |  OP_CANVI_NUM_EXPEDIENT\r\ngetNumsRegistre                   | Permet obtenir un conjunt de números d'assentaments que són reservats per s@rcat de manera exclusiva pel Backoffice que fa la sol- licitud.                                                                                                                                                                             | SARCAT_AL_RESERVA     |  OP_GET_NUM_REGISTRE\r\ncercaAssentamentsHist             | Permet obtenir totes les dades d'un assentament que ha passat pel repositori d'històrics d'assentaments de S@rcat.      | SARCAT_AP_HISTORIC    |  OP_CERCA_ASSENTAMENT_HISTORIC\r\nbaixaAssentament                  | Permet donar de baixa assentaments d'entrada, sortida o presortida prèviament realitzats.                               | SARCAT_AL_BAIXA       |  OP_BAIXA_ASSENTAMENTS\r\nllistarTaulesMestres              | A partir d'una data concreta, s'obtenen totes les actualitzacions realitzades en les taules mestres de S@rcat a partir d'aquesta data.                                                                                                                                                                                   | SARCAT_AL_LLISTA_REG  |  OP_LLISTA_REG\r\nllistarTaulaMestra                | Recuperació de codis o valors possibles per a un determinat concepte o taula mestra.                                    | SARCAT_AP_LLISTA      |  OP_LLISTA_TAULA_MESTRA\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de Sarcat es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.integration.sarcat.pica.version>[1.1.0,1.2.0)</canigo.integration.sarcat.pica.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.sarcat.pica</artifactId>\r\n    <version>${canigo.integration.sarcat.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/sarcat.properties\r\n\r\nPropietat           | Requerit | Descripció\r\n------------------- | -------- | ----------\r\n*.sarcat.urlPica\t | Sí       | Url del WebService de Sarcat. Valor per defecte: http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.sarcat.user       | Sí       | Usuari de Sarcat\r\n*.sarcat.password   | Sí       | Password de l'usuari de Sarcat\r\n*.sarcat.finalitat  | Sí       | Finalitat de l'ús del servei (TEST, PRODUCTIU...)\r\n*.sarcat.nifEmisor | Sí       | Nif de l'emissor\r\n*.sarcat.nomEmisor       | Sí       | Nom de l'emissor\r\n*.sarcat.nomFuncionari   | Sí       | Nom del funcionari\r\n*.sarcat.nifFuncionari  | Sí       | Nif del funcionari\r\n*.sarcat.emailFuncionari  | Sí       | Email del funcionari\r\n\r\nEls valors de finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n## Utilització del Mòdul\r\n\r\n### JSF\r\n\r\nPer a utilitzar el mòdul és necessari:\r\n\r\n* Crear un managed bean de JSF que contingui la lògica d'invocació al servei de SARCAT.\r\n* Pàgina JSF per a realitzar la invocació al managed bean.\r\n\r\n**SarcatPicaBean.java**\r\n\r\nManaged Bean de JSF que gestiona la crida al servei de la PICA.\r\n\r\nEn aquest bean es pot veure:\r\n\r\n* Inyecció del servei de SARCAT via annotacions (@Autowired) de Spring.\r\n* Inyecció del servei d'internacionaliztació via annotacions (@Autowired) de Spring.\r\n* Inserció del missatge de resultat de l'operació que posteriorment sera recuperat pel formulari JSF.\r\n\r\n```java\r\n/**\r\n * Classe d'exemple d'invocació al servei de SARCAT\r\n *\r\n * @author cscanigo\r\n *\r\n */\r\n@Component(\"sarcatPicaBean\")\r\n@Lazy\r\npublic class SarcatPicaBean {\r\n\r\n    private static final Log log = LogFactory.getLog(SarcatBean.class);\r\n\r\n    @Autowired\r\n    private SarcatConnector sarcatConnector;\r\n    @Autowired\r\n    private I18nResourceBundleMessageSource resource;\r\n\r\n    public void cercaAssentament() {\r\n        log.debug(\"SarcatPicaBean START\");\r\n\r\n        FacesMessage facesMessage = null;\r\n\r\n        try {\r\n                Assert.notNull(sarcatConnector);\r\n\r\n                SarcatAlConsultaRequestDocument document = SarcatAlConsultaRequestDocument.Factory.newInstance();\r\n                SarcatAlConsultaRequest request = document.addNewSarcatAlConsultaRequest();\r\n\r\n                AssentamentCerca cerca = request.addNewAssentamentCerca();\r\n                ParametresCerca params =  cerca.addNewParametresCerca();\r\n                params.setDataInici(\"09/03/2011\");\r\n                params.setDataFinal(\"10/03/2011\");\r\n                cerca.setParametresCerca(params);\r\n                cerca.setUrUsuari(\"0001\");\r\n                cerca.setOrdreCerca(OrdreCerca.DATA_ALTA);\r\n                cerca.setTipus(TipusAssentament.ENTRADA);\r\n                   cerca.setDescendent(true);\r\n\r\n                SarcatAlConsultaResponse resposta = sarcatConnector.cercaAssentaments(document).getSarcatAlConsultaResponse();\r\n\r\n            if (resposta.getError().getCodi() != 0) {\r\n                log.error(\"llistat error : \" + resposta.getError().getCodi()    + \" \" + resposta.getError().getDescripcio());\r\n                facesMessage = new FacesMessage(FacesMessage.SEVERITY_ERROR, resource.getMessage(\"sarcatError\")\r\n                        + resposta.getError().getCodi(), null);\r\n                FacesContext.getCurrentInstance().addMessage(\"sarcatForm\", facesMessage);\r\n            } else {\r\n                log.debug(\"long retorn : \" + resposta.getAssentamentArray().length);\r\n                facesMessage = new FacesMessage(FacesMessage.SEVERITY_INFO, resource.getMessage(\"sarcatSuccess\") + \" = \"\r\n                        + resposta.getAssentamentArray().length, null);\r\n                FacesContext.getCurrentInstance().addMessage(\"sarcatForm\", facesMessage);\r\n            }\r\n\r\n        } catch (SarcatException e) {\r\n            log.error(\"Error en SarcatReleaseTest.test1 \" + e.getMessage());\r\n            facesMessage = new FacesMessage(FacesMessage.SEVERITY_ERROR, resource.getMessage(\"sarcatError\") + e.getMessage(), null);\r\n            FacesContext.getCurrentInstance().addMessage(\"sarcatForm\", facesMessage);\r\n        }\r\n        log.debug(\"SarcatPicaBean FINISH\");\r\n    }\r\n\r\n}\r\n```\r\n\r\n**sarcat.jsf**\r\n\r\nInvocació del métode \"execute\" del managed bean de JSF definit anteriorment com a \"sarcatBean\". El Tag message mostrarà el resultat de la crida (veure FacesContext.getCurrentInstance().addMessage(\"sapForm\"....).\r\n\r\n```\r\n<h:form id=\"sarcatForm\">\r\n   <h:panelGrid columns=\"1\">\r\n      <h:commandButton value=\"#{msg.canigoSubmit}\" action=\"#{sarcatPicaBean.execute}\" />\r\n      <h:message for=\"sarcatForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n   </h:panelGrid>\r\n</h:form>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zYXJjYXQ="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zc2M=":{"date":1426846671000,"title":"SSC","description":"Serveis d'accés al Sistema de Signatura Centralitzada de Catcert.","sections":"Canigó. Documentació versió 3.x","weight":15,"path":"/canigo-documentacio-versions-3x-integracio/modul-ssc","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector és el de proporcionar accés al Sistema de Signatura Centralitzada de Catcert (SSC).\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície que utilitzi l'API SmartWrapper per poder donar accés als diferents tipus de signatura que ofereix l'SSC.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector SSC es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n### Documents i Fonts de Referència\r\n\r\n| Nom Document\r\n| ------------\r\n| [GuiaIntegracioSSC.v1.1.pdf] (/related/canigo/documentacio/modul-ssc/GuiaIntegracioSSC.v1.1.pdf \"Guia Integració SSC\")\r\n\r\n## Descripció Detallada\r\n\r\nAquest connector permet utilitzar els diferents serveis de signatura del SSC a través d'una API que el mateix connector ofereix. El nucli principal del SSC és el sistema TrustedX que ofereix l'API SmartWrapper per poder trevallar amb ell. És amb aquesta API amb la cual esta constituit aquest connector.\r\n\r\nEls principals serveis que ofereix el connector són els següents:\r\n\r\n* Accés a la plataforma amb certificat: Totes les aplicacions que desitgin utilitzar l'SSC hauran de disposar d'un certificat amb el qual s'autenticaran per utilitzar la plataforma. Aquest certificat s'haurà de demanar a CatCert.\r\n* Us de magatzem de certificats: Una de les principals funcionalitats del SSC és la signatura desatesa. Això s'aconsegueix configurant en el connector un magatzem de certificats que l'SSC utilitzarà pels diferents processos de signatura.\r\n* Tipus de signatura: L'SSC ofereix els següents tipus de signatura.\r\n    * CMS: Attached / Detached\r\n    * CAdES-BES: Attached / Detached\r\n    * CAdES-T: Attached / Detached\r\n    * XMLDSig: enveloping/enveloped/detached\r\n    * XAdES-BES: enveloping/enveloped/detached\r\n    * XAdES-T: enveloping/enveloped/detached\r\n\r\n### Alta Servei\r\n\r\nPer poder utilitzar l'SSC en PRO s'ha d'estar donat d'alta en el servei. Per poder fer-ho s'han de seguir els següents passos:\r\n\r\n1. Enviar un mail a implantacio@aoc.cat sol- licitant l'alta al servei. Aquí s'espera que l'usuari informi del tipus de signatures que vol generar i se l'informarà del tipus de certificats que ha de sol- licitar.\r\n2. Els certificats a sol- litar s'hauran de fer a través de EACAT.\r\n3. Finalment, el client haurà d'omplir un document d'alta al SSC, on haurà d'especificar el certificat amb el que s'autenticarà, així com els certificats de signatura allotjats en TrustedX que utilitzarà per signar.\r\n4. Una vegada validat el document d'alta, se li donarà accés al SSC en PRO.\r\n\r\nDe cara a utilitzar el servei en PRE, els certificats i documentació necessaria es poden demanar obrint una petició a suport@aoc.cat.\r\n\r\n### Arquitectura i Components\r\n\r\n#### Interfícies i Components Genèrics\r\n\r\nEs pot trobar el codi font referent a aquests component a la següent url:\r\n\r\nCodi Font:  http://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.ssc/1.1.0/\r\n\r\n#### Requeriments\r\n\r\nEl connector SSC és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no es garantit el seu correcte funcionament.\r\n\r\nDonat que l'SSC s'ha desenvolupat per substituir altres sistemes de signatura anteriors s'ha desenvolupat per que sigui compatible amb components de Canigo 2.3.5 en endevant. Tot i això, s'ha de tindre en compte que conté una sèrie de dependències que podrien arribar a donar conflicte en una aplicació ja desenvolupada. Per aquest motiu es recomana consultar les seves dependències.\r\n\r\n### Instal.lació i Configuració\r\n\r\n#### Instal.lació\r\n\r\nLa instal.lació del connector requereix de la utilització de la llibreria 'canigo.integration.ssc' i les dependències indicades a l'apartat 'Introducció-Versions i Dependències'.\r\n\r\nPer afegir aquesta dependència s'ha de modificar el pom.xml de l'aplicació per incloure la llibreria del Connector.\r\n\r\n```\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.integration.ssc</artifactId>\r\n    <version>1.1.0</version>\r\n</dependency>\r\n```\r\n\r\nEl resultat dels processos de signatura moltes vegades són arrays de bytes que es troben codificats en Base64 amb classes d'Axis. Això fa que per la recuperació d'arxius s'hagi d'incorporar una llibreria més en el proyecte:\r\n\r\n```\r\n<dependency>\r\n\t<groupId>axis</groupId>\r\n\t<artifactId>axis</artifactId>\r\n\t<version>1.2.1</version>\r\n</dependency>\r\n```\r\n\r\n#### Configuració\r\n\r\n\r\n1.- Per poder configurar el connector SSC és necessari crear un arxiu anomenat app-integration-ssc.xml situat en src/main/resources/spring/ amb el següent contingut:\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\r\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\r\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \r\n           http://www.springframework.org/schema/beans/spring-beans-4.1.xsd\">\r\n\r\n\t<!-- BEAN SSC -->\r\n\t<bean id=\"sscService\" class=\"cat.gencat.ctti.canigo.arch.integration.ssc.impl.SscConnectorImpl\" scope=\"prototype\">\r\n\t\t<description>\r\n\t\t\tSSC Service for Canigo 3.1\r\n\t\t</description>\r\n\t\t<property name=\"host\" value=\"${ssc.host}\"/>\r\n\t\t<property name=\"distinguishedname\" value=\"${ssc.distinguishedname}\" /> \r\n\t</bean>\r\n\t\r\n</beans>\r\n```\r\n\r\non les variables ssc.host i ssc.distinguishedname són recuperades de l'arxiu ssc.properties que s'ha de crear en src/main/resources/config/props/ssc.properties\r\n\r\n2.- Configuiració dels arxius de properties.\r\n\r\nExisteixen dos arxius de properties per poder confiurar l'SSC. El ssc.properties i el smartwrapper.properties.\r\n\r\nEl primer conté només dos paràmetres,\r\n\r\n* ssc.host: Url del servidor on es troba l'SSC.\r\n    * PRE: https://ssc.preproduccio.catcert.cat:8443/trustedx-gw/SoapGateway\r\n    * PRO: https://ssc.catcert.cat:8443/trustedx-gw/SoapGatewayU1T\r\n\r\n* ssc.distinguishedname: Nom del certificat amb el que l'aplicació s'autentica per consumir els serveis del SSC.\r\n\r\nEl segón, anomenat smartwrapper.properties conté la configuració de l'API SmartWrapper de TrustedX i esta documentat en el document [GuiaIntegracioSSC.v1.1.pdf](/related/canigo/documentacio/modul-ssc/GuiaIntegracioSSC.v1.1.pdf \"Guia Integració SSC\").\r\n\r\nLa ubicació d'aquest últim arxiu es recomana que sigui en el directori src/main/resoruces de l'aplicació que utilitzi el connector.\r\n\r\nNOTA: Les dades de proves del connector relacionades amb certificats de proves s'han de demanar a CatCert\r\n\r\n### Utilització del Connector\r\n\r\n\r\n1.- En el bean on es vulgui disposar dels serveis del connector declarar el servei.\r\n\r\n```java\r\n@Autowired\r\nprivate SscConnectorImpl sscService;\r\n```\r\n\r\n2.- Escollir una modalitat de signatura i passar-li els paràmetres que necessiti. En el cas d'aquest exemple es farà una signatura CAdES-BES en mode ATTACHED.\r\n\r\n```java\r\nfinal String path_in = \"path_arxiu_entrada\";\r\nfinal String path_out = \"path_arxiu_sortida\";\r\nfinal String filename = \"HelloWorld.txt\";\r\n\t\t\r\nlog.info(\"[INFO][Arxiu a signar: \" + path_in + filename);\r\nString data = Util.readBinaryFileB64(path_in + filename);\r\n\t\t\r\nString resposta = sscService.signCadesBes(data, Constants.ATTACHED);\r\n\t\t\r\nString destFilename = path_out + filename.substring(0, filename.lastIndexOf(\".\")) + \"_Signature_CAdES_BES_Attached.p7b\";\r\nUtil.writeBinaryFileB64(destFilename, resposta);\r\n```\r\n\r\nPer més informació sobre els diferents mètodes que ofereix el connector SSC es pot consultar l'API.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC1zc2M="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWZ1c2lvLWRvY3VtZW50cw==":{"date":1427965562000,"title":"Fusió de documents","description":"Mòdul de fusió de documents.","sections":"Canigó. Documentació versió 3.x","weight":2,"path":"/canigo-documentacio-versions-3x-suport/modul-fusio-documents","content":"## Propòsit\r\n\r\nAquest servei permet aplicar un conjunt de canvis definits per un diccionari sobre un document en format WordML.\r\n\r\nEs parteix d'un document que conté un o més marcadors que han de ser substituits i d'un conjunt de diccionaris de substitució.\r\n\r\nPer cada un dels diccionaris de substitució, el servei de merging realitza la substitució de cada marcador pel valor indicat en el diccionari i el resultat és un nou document, també en format WordML.\r\n\r\nEls marcadors consisteixen en una marca d'inici, un texte-clau i una marca de final.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul de fusió es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.merging.version>[1.1.0,1.2.0)</canigo.support.merging.version>\r\n\r\n<dependency>\r\n    <groupId>cat.gencat.ctti</groupId>\r\n    <artifactId>canigo.support.merging</artifactId>\r\n    <version>${canigo.support.merging.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/merging.properties\r\n\r\nPropietat              | Requerit | Descripció\r\n---------------------- | -------- | ---------------------------------------------------------------------\r\n*.merging.initBookmark | No       | Marca d'inici del texte a substituir (2 caràcters). Per defecte: @@.\r\n*.merging.endBookmark  | No       | Marca de final del texte a substituir (2 caràcters). Per defecte: ##h2. Utilització del Mòdul.\r\n\r\n### Utilització del Mòdul\r\n\r\n#### JSF\r\n\r\nPer a utilitzar aquest mòdul, cal crear un bean i una jsf:\r\n\r\n**mergingBean.java**\r\n\r\n```java\r\n@Component(\"mergingBean\")\r\n@Scope(\"singleton\")\r\n@Lazy\r\npublic class MergingBean {\r\n\tprivate String name;\r\n\tprivate String text;\r\n\t@Autowired\r\n\tprivate MergeTemplateEngine engine;\r\n\t@Autowired\r\n\tprivate I18nResourceBundleMessageSource messageResource;\r\n\r\n\r\n\tpublic MergeTemplateEngine getEngine() {\r\n\t\treturn engine;\r\n\t}\r\n\r\n\t/**\r\n\t * Get name\r\n\t * @return\r\n\t */\r\n\tpublic String getName() {\r\n\t\treturn name;\r\n\t}\r\n\r\n\t/**\r\n\t * Set name\r\n\t * @param name\r\n\t */\r\n\tpublic void setName(String name) {\r\n\t\tthis.name = name;\r\n\t}\r\n\r\n\t/**\r\n\t * Get text\r\n\t * @return\r\n\t */\r\n\tpublic String getText() {\r\n\t\treturn text;\r\n\t}\r\n\r\n\t/**\r\n\t * Set text\r\n\t * @param text\r\n\t */\r\n\tpublic void setText(String text) {\r\n\t\tthis.text = text;\r\n\t}\r\n\r\n\t/**\r\n\t * Merge document\r\n\t */\r\n\tpublic void merge(){\r\n\t\tMap<String,String> itemsMap = new HashMap<String,String>();\r\n\t\titemsMap.put(\"name\", getName());\r\n\t\titemsMap.put(\"text\", getText());\r\n\r\n\t\tList<Map<String,String>> dades = new ArrayList<Map<String,String>>();\r\n\t\tdades.add(itemsMap);\r\n\r\n\t\ttry{\r\n\t\t\tInputStream is = Thread.currentThread().getContextClassLoader().getResourceAsStream(\"TestDoc.xml\");\r\n\t\t\tByteArrayOutputStream[] os = getEngine().mergeTemplate(is, dades);\r\n\r\n\t\t\tHttpServletResponse response = (HttpServletResponse) FacesContext.getCurrentInstance()\r\n\t\t\t.getExternalContext().getResponse();\r\n\t\t\tresponse.setContentType(\"application/xml\");\r\n\t\t\tresponse.setHeader(\"Content-Disposition\", \"attachment;filename=\\\"\" +\r\n\t\t\t         \"test.xml\" + \"\\\"\");\r\n\t\t\tresponse.setContentLength(os[0].size());\r\n\t\t\tServletOutputStream ouputStream = response.getOutputStream();\r\n\t\t\touputStream.flush();\r\n\t\t\touputStream.write(os[0].toByteArray(), 0, os[0].size());\r\n\t\t\touputStream.flush();\r\n\t\t\touputStream.close();\r\n\t\t\tFacesContext.getCurrentInstance().responseComplete();\r\n\r\n\t\t\tFacesContext.getCurrentInstance().addMessage(\"mergingForm\", new FacesMessage(\r\n                    FacesMessage.SEVERITY_INFO, getMessageResource().getMessage(\"mergingSuccess\"), null));\r\n\r\n\t\t}catch(Exception e){\r\n\t\t\tFacesContext.getCurrentInstance().addMessage(\"mergingForm\", new FacesMessage(\r\n\t                FacesMessage.SEVERITY_ERROR, \"mergingError\", null));\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic I18nResourceBundleMessageSource getMessageResource() {\r\n\t\treturn messageResource;\r\n\t}\r\n\r\n}\r\n```  \r\n\r\n**merging.jsf**\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\" standalone=\"yes\" ?>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\r\n\txmlns:ui=\"http://java.sun.com/jsf/facelets\"\r\n\txmlns:f=\"http://java.sun.com/jsf/core\"\r\n\txmlns:h=\"http://java.sun.com/jsf/html\"\r\n\txmlns:c=\"http://java.sun.com/jstl/core\">\r\n\r\n\r\n\t<ui:composition template=\"layouts/template.jsf\">\r\n\t\t<ui:define name=\"ariadna\">\r\n\t\t\t<h:outputLink value=\"index.jsf\">\r\n\t\t\t\t<h:outputFormat>#{msg.breadCrumbInit}</h:outputFormat>\r\n\t\t\t</h:outputLink>\r\n\t\t</ui:define>\r\n\t\t<ui:define name=\"body\">\r\n\t\t\t<h1>#{msg.menuSupportMerging}</h1>\r\n\t\t\t<h:form id=\"mergingForm\">\r\n                <h:panelGrid columns=\"2\">\r\n                \t<h:outputText value=\"Name:\" />\r\n                \t<h:inputText id=\"name\" value=\"#{mergingBean.name}\"/>\r\n                \t<h:outputText value=\"Text:\" />\r\n                \t<h:inputTextarea id=\"text\" value=\"#{mergingBean.text}\"/>\r\n                    <h:commandButton value=\"#{msg.canigoSubmit}\" action=\"#{mergingBean.merge}\" />\r\n                    <br/>\r\n                    <h:message for=\"mergingForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n                </h:panelGrid>\r\n            </h:form>\r\n\t\t</ui:define>\r\n\t</ui:composition>\r\n\r\n</html>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWZ1c2lvLWRvY3VtZW50cw=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWxvcGQ=":{"date":1427966947000,"title":"LOPD","description":"Aplicació de protecció de dades.","sections":"Canigó. Documentació versió 3.x","weight":3,"path":"/canigo-documentacio-versions-3x-suport/modul-lopd","content":"## Propòsit\r\n\r\nEl servei de LOPD de Canigó permet assignar un determinat nivell de protecció a les dades de l'aplicació que l'utilitzi.\r\n\r\n## Context i Escenaris d'Ús\r\n\r\nEl servei de LOPD es troba dins dels serveis generals de Canigó.  \r\nEl seu ús és necessari en cas de voler protegir dades sensibles de l'aplicació o d'enregistrar el seu accés.\r\n\r\n## A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del servei.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del servei.\r\n\r\n## Glossari\r\n\r\n**LOPD:** Llei Orgànica de Protecció de Dades\r\n\r\n## Descripció Detallada\r\n\r\n###  Arquitectura i Components\r\n\r\n#### Introducció\r\n\r\nEl servei LOPD ofereix suport a les aplicacions basades en Canigó per facilitar el compliment de la LOPD. Donat que l'aplicació dels mecanismes de seguretat afecta únicament a les dades emmagatzemades en la base de dades s'ha definit un sistema d'anotacions per tal de \"marcar\" les dades sensibles en els TO's (Transfer Object).\r\n\r\n#### Instal-lació\r\n\r\nDisposar del mòdul LOPD és pot fer mitjançant dos camins:\r\n\r\n1.- Utilitzar l'eina de l'entorn de treball de Canigó (plugin per l'eclipse). On es podrà seleccionar el servei dintre del grup \"suport\".\r\n\r\nNOTA: L'eina afegeix automàticament un arxiu anomenat lopd.properties situat en src\\main\\resources\\config\\props\\ que conté la llavor utilitzada per fer el xifrat/desxifrat de les dades. En la versió 1.0.0 del servei aquest paràmetre no s'està utilitzant així que no es necessari configurar-lo.\r\n\r\n2.- Afegir de forma manual les dependències del servei.\r\n\r\nModificar el pom.xml afegint:\r\n\r\n```\r\n<properties>\r\n\t<canigo.support.lopd>[1.3.0,1.4.0)</canigo.support.lopd>\r\n</properties>\r\n\r\n<dependency>\r\n      <groupId>cat.gencat.ctti</groupId>\r\n      <artifactId>canigo.support.lopd</artifactId>\r\n      <version>${canigo.support.lopd}</version>\r\n</dependency>\r\n```\r\n\r\n#### Components del Servei\r\n\r\nEl servei defineix tres nivells de seguretat diferents i dos tipus d'operacions amb les dades. L'aplicació dels nivells de seguretat està bassada en l'ús d'una anotació especial de seguretat anomenada LOPDSecure.\r\n\r\n**Nivells de seguretat**\r\n\r\nEls nivells de seguretat creats inicialment són els següents:\r\n\r\n* LOW: Nivell de seguretat baix. Enregistrament de la dada.\r\n* MED: Nivell de seguretat mitjà. Enregistrament de la dada.\r\n* HIGH: Nivell de seguretat alt. Enregistrament i xifrat/desxifrat de la dada.\r\n\r\n**Operacions amb dades**\r\n\r\nS'han definit dos tipus d'operacions possibles aplicables en funció del nivell de seguretat.\r\n\r\n* Enregistrament de les dades: Operació que registra l'accés d'una dada per part d'un usuari.\r\n* Xifrat/desxifrat de les dades: Operació que xifra o desxifra una dada accedida per un usuari.\r\n\r\n### Ús del servei\r\n\r\n#### Configuració del servei\r\n\r\nA spring s'ha de configurar el servei per a indiciar la classe que realitza l'enregistrament de les dades i el xifrat/desxifrat de les dades.\r\n\r\n```\r\n<bean id=\"aspectLOPD\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.annotation.impl.AspectLOPD\">\r\n    <property name=\"levels\" ref=\"levelsBean\"/>\r\n</bean>\r\n\r\n    <!-- Actions -->\r\n<bean id=\"traceOperation\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.operations.trace.impl.TraceImpl\">\r\n</bean>\r\n\r\n <bean id=\"cipherOperation\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.operations.cipher.impl.BouncyCastleAESCipherImpl\">\r\n    <property name=\"key\" value=\"${lopd.secretkey}\"/>\r\n    <!--Optional -->\r\n    <property name=\"charset\" value=\"UTF-8\"/>\r\n</bean>\r\n\r\n<!-- Levels -->\r\n<bean id=\"lowLevel\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.Low\">\r\n    <property name=\"trace\" ref=\"traceOperation\"/>\r\n</bean>\r\n<bean id=\"medLevel\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.Med\">\r\n    <property name=\"trace\" ref=\"traceOperation\"/>\r\n</bean>\r\n<bean id=\"highLevel\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.High\">\r\n    <property name=\"trace\" ref=\"traceOperation\"/>\r\n    <property name=\"cipher\" ref=\"cipherOperation\"/>\r\n</bean>\r\n\r\n<!-- Defined Levels to be used -->\r\n<bean id=\"levelsBean\" class=\"cat.gencat.ctti.canigo.arch.support.lopd.levels.Levels\">\r\n    <property name=\"low\" ref=\"lowLevel\"/>\r\n    <property name=\"med\" ref=\"medLevel\"/>\r\n    <property name=\"high\" ref=\"highLevel\"/>\r\n</bean>\r\n```\r\n\r\n#### Anotacions\r\n\r\nCom s'ha indicat en punts anteriors l'aplicació de la seguretat es fa amb una anotació. Aquesta Anotació està dissenyada per posar-se en els mètodes setter i getter dels TO's (Transfer Objects) responsables de la transferència de les dades entre la base de dades i els objectes de negoci de l'aplicació.\r\n\r\nUn exemple de com utilitzar la nova anotació seria el següent:\r\n\r\n```java\r\npackage cat.gencat.prova.bean.model;\r\n\r\nimport static javax.persistence.GenerationType.IDENTITY;\r\nimport java.util.Date;\r\nimport javax.persistence.*;\r\nimport org.springframework.context.annotation.Scope;\r\nimport org.springframework.stereotype.Component;\r\n*import cat.gencat.ctti.canigo.arch.support.lopd.annotation.LOPDSecure;*\r\n\r\n/**\r\n * TbUsuaris generated by hbm2java\r\n */\r\n@Entity\r\n@Table(name = \"TB_USUARIS\", schema = \"PUBLIC\")\r\n@NamedQueries({\r\n\t@NamedQuery(\r\n\t\t\tname=\"findUsuarisNomCognom\", \r\n\t\t\tquery=\"FROM TbUsuaris u WHERE u.nom like :nomUsuari AND u.cognoms like :cognomsUsuari\"),\r\n\t@NamedQuery(\r\n\t\t\tname=\"findUsuarisNom\", \r\n\t\t\tquery=\"FROM TbUsuaris u WHERE u.nom like :nomUsuari\"),\r\n\t@NamedQuery(\r\n\t\t\tname=\"findUsuarisCognom\", \r\n\t\t\tquery=\"FROM TbUsuaris u WHERE u.cognoms like :cognomsUsuari\")\r\n})\r\n\r\npublic class TbUsuaris implements java.io.Serializable {\r\n\r\n\tprivate static final long serialVersionUID = -3588947496944606464L;\r\n\tprivate Integer idUsuari;\r\n\tprivate String nom;\r\n\tprivate String cognoms;\r\n\tprivate String nif;\r\n\r\n\tpublic TbUsuaris() {\r\n\t}\r\n\r\n\tpublic TbUsuaris(String nom) {\r\n\t\tthis.nom = nom;\r\n\t}\r\n\r\n\tpublic TbUsuaris(String nom, String cognoms, String nif) {\r\n\t\tthis.nom = nom;\r\n\t\tthis.cognoms = cognoms;\r\n\t\tthis.nif = nif;\r\n\t}\r\n\r\n\t@Id\r\n\t@GeneratedValue(strategy = IDENTITY)\r\n\t@Column(name = \"ID_USUARI\", unique = true, nullable = false)\r\n\tpublic Integer getIdUsuari() {\r\n\t\tSystem.out.println(\"getIdUsuari\");\r\n\t\treturn this.idUsuari;\r\n\t}\r\n\r\n\tpublic void setIdUsuari(Integer idUsuari) {\r\n\t\tSystem.out.println(\"setIdUsuari\");\r\n\t\tthis.idUsuari = idUsuari;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"LOW\")//<--Nova Anotació de seguretat\r\n\t@Column(name = \"NOM\", nullable = false)\r\n\tpublic String getNom() {\r\n\t\tSystem.out.println(\"getNom\");\r\n\t\treturn this.nom;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"LOW\")//<--Nova Anotació de seguretat\r\n\tpublic void setNom(String nom) {\r\n\t\tSystem.out.println(\"setNom\");\r\n\t\tthis.nom = nom;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"MED\")//<--Nova Anotació de seguretat\r\n\t@Column(name = \"COGNOMS\")\r\n\tpublic String getCognoms() {\r\n\t\tSystem.out.println(\"getCognoms\");\r\n\t\treturn this.cognoms;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"MED\")//<--Nova Anotació de seguretat\r\n\tpublic void setCognoms(String cognoms) {\r\n\t\tSystem.out.println(\"setCognoms\");\r\n\t\tthis.cognoms = cognoms;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"HIGH\")//<--Nova Anotació de seguretat\r\n\t@Column(name = \"NIF\")\r\n\tpublic String getNif() {\r\n\t\tSystem.out.println(\"getNif\");\r\n\t\treturn this.nif;\r\n\t}\r\n\r\n\t@LOPDSecure(level = \"HIGH\")//<--Nova Anotació de seguretat\r\n\tpublic void setNif(String nif) {\r\n\t\tSystem.out.println(\"setNif\");\r\n\t\tthis.nif = nif;\r\n\t}\r\n}\r\n```\r\n\r\nCom es pot apreciar l'anotació\r\n\r\n```\r\n@LOPDSecure(value = [NIVELL_SEGURETAT])\r\n```\r\n\r\nestà informada davant de cada setter i getter on es vol que s'apliqui la seguretat. L'anotació pot posar-se davant d'un getter o davant d'un setter per separat, donant així la possibilitat d'aplicar la seguretat només a un determinat tipus d'accés a la dada.\r\nS'ha de tindre en compte que, en el cas especial de la política de seguretat HIGH, l'anotació ha d'anar en el setter i el getter de la dada en qüestió obligatòriament. Si no es fes així, la dada es xifraria i mai es podria recuperar el seu valor original o bé s'interpretaria com a xifrada quan no ho fos i s'intentaria desxifrar, provocant l'alteració del valor mostrat.\r\n\r\nUn altre aspecte important, també en relació a la política HIGH, és que el tipus de la dada que ha de figurar en la base de dades sempre ha de ser format text. Això és així per que el procés de xifrat transforma la dada (del tipus que sigui) en un array de bytes, perdent qualsevol informació del tipus original. S'haurà de tindre especial atenció en el xifrat de dades del tipus numèric o data, per aquest motiu.\r\n\r\n**Consulta de les dades**\r\n\r\nUna vegada aplicades les anotacions sempre que s'accedeixi a una dada on el seu getter o setter hagi sigut anotat es podrà consultar en el log de l'aplicació una traça com la següent:\r\n\r\n```\r\n[LOPD access entry][Property: Nif][of Class: cat.gencat.prova.bean.model.TbUsuaris][accessed by user: cscanigo][at: 30/11/2011 10:23:12]\r\n```\r\n\r\nDe cara al xifrat de les dades, totes les que hagin sigut anotades amb nivell de seguretat HIGH, apareixeran xifrades en base de dades.","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWxvcGQ="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC10cmlidXRz":{"date":1426838963000,"title":"Tributs","description":"Servei de consulta de dades fiscals de la PICA.","sections":"Canigó. Documentació versió 3.x","weight":16,"path":"/canigo-documentacio-versions-3x-integracio/modul-tributs","content":"## Introducció\r\n\r\nL'objectiu d'aquest connector ,es el de proporcionar accés als 3 grans serveis de consulta de dades fiscals que actualment ofereix la PICA. Aquests tres serveis són:\r\n\r\n* AEAT: Agència Estatal de l'Administració Tributària\r\n* ATC: Agència Tributària de Catalunya\r\n* TGSS: Tresoreria General de la Seguretat Social\r\n\r\na més també es troba integrat el servei AEAT_ATC_TGSS que sintetitza una petita suite de les modalitats de servei dels 3 productes anteriors.\r\n\r\n### Propòsit\r\n\r\nEl propòsit del connector és proporcionar una interfície funcional reduïda al connector de la Pica que simplifica l'utilització del servei de consulta de dades fiscals ofert per la generalitat.\r\n\r\n### Context i Escenaris d'ús\r\n\r\nEl connector PICA-TRIBUTS es troba dins els connectors de serveis funcionals de la Generalitat.\r\n\r\n### A qui va dirigit\r\n\r\nAquest document va dirigit als següents perfils:\r\n\r\n* Programador. Per conèixer l'ús del connector.\r\n* Arquitecte. Per conèixer quins són els components i la configuració del connector.\r\n\r\n## Descripció Detallada\r\n\r\n### Introducció\r\n\r\nCom ja s'ha comentat aquest connector sintetitza peticions als tres grans serveis oferts per la PICA relatius a la consulta de dades fiscals.\r\n\r\n### Serveis\r\n\r\n#### Servei AEAT (Agència Estatal de l'Administració Tributària)\r\n\r\nLa seva finalitat és l'obtenció de dades tributàries de l'AEAT per consultar, per part dels gestors públics, les dades relatives als contribuents que ofereix l'Agència Estatal de l'Administració Tributària.\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei AEAT_PICA v1.7.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> AEAT\"\r\n\r\nModalitats:\r\n\r\n* AEAT_PICA_C1: Està al corrent de pagament/ No està al corrent de pagament.\r\n* AEAT_PICA_C2: Les dades del certificat individual de renda.\r\n* AEAT_PICA_C3: Les dades identificatives del CIF o DNI/NIE corresponent.\r\n* AEAT_PICA_C4: Les dades del certificat de renda per a prestacions socials.\r\n* AEAT_PICA_C5: Les dades del certificat de renda d'agricultors.\r\n* AEAT_PICA_C6: Les dades del certificat de renda per a beques.\r\n* AEAT_PICA_C7: Les dades del certificat de renda per a beques anticipades.\r\n* AEAT_PICA_C8: Les dades del certificat de l'impost d'activitats econòmiques.\r\n\r\nTotes les modalitats anteriors són síncrones.\r\n\r\n#### Servei ATC (Agència Tributària de Catalunya)\r\n\r\nEl servei d'obtenció del certificat de deutes amb la Generalitat de Catalunya té com a objectiu poder consultar per part dels gestors públics les dades que ofereix l'Agència Tributària de Catalunya respecte a deutes amb la Generalitat.\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei de l'ATCv1.4.3.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> ATC\"\r\n\r\nModalitats:\r\n\r\n* ATC_INF_DEUTES_TMP: Modalitat de servei asíncrona que retorna les dades d'un certificat de deutes amb la Generalitat de Catalunya.\r\n\r\n#### Servei TGSS (Tresoreria General de la Seguretat Social)\r\n\r\nEl servei d'obtenció de dades de la seguretat social de la TGSS té com a objectiu poder consultar, per part dels gestors públics, les dades que ofereix la Tresoreria General de la Seguretat Social.\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei de TGSS v1.6.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> TGSS\"\r\n\r\nModalitats:\r\n\r\n* TGSS_AL_CORRENT_PAGAMENT: Especifica si una persona o una organització té algun deute amb la seguretat social en el moment de fer la consulta.\r\n* TGSS_INFORME_SITUACIO: Aquest informe especifica si una persona cotitzava a una data determinada, per tant és un possible sinònim de si la persona treballava o no.\r\n* TGSS_ACREDITACIO_AGRARIA_PROPI: Aquest informe especifica les situacions de les acreditacions de jornades agràries en un període de temps determinat pels valors del filtre.\r\n\r\n#### Servei AEAT_ATC_TGSS\r\n\r\nL'objectiu del Servei de consulta de la situació de deute d'un contribuent respecte de AEAT, ATC i TGSS és l'agrupació dels productes AEAT (Agència Estatal de l'Administració Tributària), ATC(Agència Tributària de Catalunya) i TGSS (Tresoreria General de la Seguretat Social) en una sola consulta per a la obtenció de la situació de deute d'un contribuent a AEAT, ATC i TGSS. En concret, és l'agrupació de les modalitats següents:\r\n\r\n-AEAT: Certificat d'obligacions tributàries (AEAT_PICA_C1)<br>\r\n-ATC: Informe de situació de deutes amb la Generalitat de Catalunya (ATC_INF_DEUTES_TMP)<br>\r\n-TGSS: Informe de situació de deutes de la TGSS (TGSS_AL_CORRENT_PAGAMENT)<br>\r\n\r\nPer una descripció detallada del servei i de les seves modalitats es pot consultar el document \"Guia d'us del servei deutes del contribuent AEAT-ATC-TGSS v1.1.pdf\" disponible en l'àrea privada de http://cttiprojectes.gencat.cat/web/otpica en la secció \"productes Oferts -> Interoperabilitat -> AEAT_ATC_TGSS\"\r\n\r\nModalitats:\r\n\r\n* AEAT_ATC_TGSS_CONSULTA_DEUTES: Modalitats de servei asíncrona que llença una petició de consulta sobre les modalitats anteriorment anomenades dels tres serveis de consulta de dades fiscals AEAT, ATC i TGSS.\r\n\r\nTotes les modalitats anteriors són síncrones.\r\n\r\n## Arquitectura i Components\r\n\r\n### Interfícies i Components Genèrics\r\n\r\nEs pot trobar tota el codi font referent aquests components a les següents url's:\r\n\r\nCodi Font:  http://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.tributs.pica/1.1.0/  \r\n\r\n### Requeriments\r\n\r\nEl connector TRIBUTS és compatible amb les versions 1.5 o superior de Java. Per versions inferiors no és garantit el seu correcte funcionament.\r\n\r\nPer tal de que el connector DNI funcioni correctament sobre l'aplicació que l'utilitzi, es s'ha de tenir configurat el servei connector genèric de la PICA 1.1.0.\r\n\r\n## Configuració\r\n\r\n\r\nPer configurar el mòdul d'integració PICA-DNI és necessari configurar els següents arxius:\r\n\r\n1.- Importar el mòdul PICA-DNI amb el plugin de Canigó 3 de l'eclipse o bé incorporar manualment les seves dependències en el pom.xml de l'aplicació.\r\n\r\nEn el pom.xml:\r\n\r\n```\r\n<canigo.integration.tributs.pica.version>[1.1.0,1.2.0)</canigo.integration.tributs.pica.version>\r\n...\r\n\r\n<!-- Dependencia del mòdul PICA-TRIBUTS -->\r\n<dependency>\r\n        <groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.integration.tributs.pica</artifactId>\r\n\t<version>${canigo.integration.tributs.pica.version}</version>\r\n</dependency>\r\n```\r\n\r\n2.- Crear l'arxiu /config/props/tributs.properties amb el següent contingut:\r\n\r\n```\r\n*.tributs.pica.nifEmisor=[nifEmisor]\r\n*.tributs.pica.nomEmisor=[nomEmisor] #normalment:\"CONSORCI AOC\"\r\n*.tributs.pica.nomEmisorCAT365=[nomEmisor] #normalment:\"CONSORCI AOC\"\r\n*.tributs.pica.finalitat=[finalitat]\r\n*.tributs.pica.url=http://preproduccio.pica.intranet.gencat.cat/pica_cataleg/AppJava/services/\r\n*.tributs.pica.nomFuncionari=[nomFuncionari]\r\n*.tributs.pica.nifFuncionari=[nifFuncionari]\r\n*.tributs.pica.emailFuncionari=[emailFuncionari]\r\n```\r\n\r\nEls valors d finalitat, urlPica, nifEmisor i nomEmisor s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\nNOTA: El valor per defecte de urlPica es la de l'entorn de Pre-producció.\r\n\r\n3.- Configurar l'arxiu /config/props/pica.properties amb el següent contingut:\r\n\r\n```\r\n*.pica.modes.passwordType=PasswordText\r\n*.pica.requirer.signatureFile=classpath:config/cert/signature.properties\r\n*.pica.requirer.petitionerId=[petitionerId]\r\n*.pica.requirer.transmitionId=[transmitionId]\r\n*.pica.requirer.petitionerName=[petitionerName]\r\n*.pica.requirer.password=[password]\r\n*.pica.requirer.user=[password]\r\n*.pica.axisdefinition.location=classpath:axis2client/\r\n*.pica.trustStore.location=classpath:config/cert/certificats.jks\r\n*.pica.trustStore.type=JKS\r\n*.pica.trustStore.password=[trustStore.password]\r\n```\r\n\r\nEls valors entre [] s'han de consultar a la OT PICA en requeridors.otpica.ctti@gencat.cat\r\n\r\n4.- Configurar l'arxiu /spring/app-integration-tributs.xml amb el següent contingut:\r\n\r\n```\r\n<!-- BEAN DE LA PICA -->\r\n<bean id=\"picaService\" class=\"cat.gencat.ctti.canigo.arch.integration.pica.PicaServiceWrapperImpl\" scope=\"prototype\">\r\n    <property name=\"axisDefinition\" value=\"${pica.axisdefinition.location}\"/>\r\n    <property name=\"trustStoreSSLKeystore\" value=\"${pica.trustStore.location}\" />\r\n    <property name=\"trustStoreSSLKeystoreType\" value=\"${pica.trustStore.type}\" />\r\n    <property name=\"trustStoreSSLKeystorePassword\" value=\"${pica.trustStore.password}\" />\r\n    <property name=\"requeridor\" ref=\"requeridor\"/>\r\n    <property name=\"modalitats\">\r\n        <map>\r\n\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\nLes propietats trustStoreSSLKeystore, trustStoreSSLKesytoreType i trustStoreSSLKeystorePassword només són necessàries en cas d'accedir a la url de la PICA mitjançant HTTPS.\r\n\r\n### Utilització del Connector\r\n\r\n#### Exemple d'utilització d'una modalitat de Servei de AEAT\r\n\r\nRecuperar el bean del servei de AEAT des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate AeatConnectorImpl aeatConnector;\r\n```\r\n\r\nFer la crida a la modalitat del servei desitjat, p.e.:\r\n\r\n```java\r\nDadesPeticioAEAT peticio = new DadesPeticioAEAT();\r\npeticio.setNom(\"Cristian\");\r\npeticio.setCognom1(\"Casals\");\r\npeticio.setCognom2(\"Molina\");\r\npeticio.setNomComplet(\"Cristian Casals Molina\");\r\npeticio.setTipusDocument(\"NIF\");\r\npeticio.setDocument(\"39361642V\");\r\n\t\r\nC1PICAResponse resposta = aeatConnector.ObligacionsTributaries(peticio);\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei AEAT_PICA v1.7.pdf\"\r\n\r\n#### Exemple d'utilització del servei ATC\r\n\r\nRecuperar el bean del servei de ATC des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate AtcConnectorImpl atcConnector;\r\n```\r\n\r\nEn aquest cas d'exemple es consumirà la modalitat de servei ATC_INF_DEUTES_TMP que retorna les dades d'un certificat de deutes amb la Generalitat de Catalunya.\r\n\r\nDonat que el servei ATC es consumeix de forma asíncrona la forma correcta per poder consumir-ho es realitza en 3 fases:\r\n\r\n1. Fer petició al Servei\r\n2. Testar l'estat de resolució de la petició\r\n3. Recuperar les dades de la petició\r\n\r\nNOTA: Les dades de nom, cognom1 i 2, nom complet i el valor del document sobre l'exemple son inventades.\r\n\r\n```\r\nDadesPeticioATC peticio = new DadesPeticioATC();\r\n    \t\r\npeticio.setIdioma(\"Català\");\r\npeticio.setNom(\"Nom\");\r\npeticio.setCognom1(\"Cognom1\");\r\npeticio.setCognom2(\"Cognom2\");\r\npeticio.setNomComplet(\"Nom Cognom1 Cognom2\");\r\npeticio.setDocument(\"12341234D\");\r\npeticio.setTipusDocument(\"NIF\");\r\nDataResponse resposta = atcConnector.informeSituacioDeute(peticio); //<-- Petició al servei\r\n    \r\nEstatAsincron estatResposta = atcConnector.getEstatInformeSituacioDeute(resposta.getResponse()); //<-- Comprovació estat petició\r\nint tempsEstimat = estatResposta.getTempsEstimatResposta();\r\n  \r\n...\r\n    \t\r\nInformacio inf = atcConnector.getDadesInformeSituacioDeute(resposta.getServei()); //<-- Recuperació resposta a la petició\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei de l'ATCv1.4.3.pdf\"\r\n\r\n#### Exemple d'utilització d'una modalitat de Servei TGSS\r\n\r\nRecuperar el bean del servei de TGSS des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate TgssConnectorImpl tgssConnector;\r\n```\r\n\r\nEn aquest cas d'exemple es consumirà la modalitat de servei TGSS_AL_CORRENT_PAGAMENT que especifica si una persona o una organització té algun deute amb la seguretat social en el moment de fer la consulta.\r\n\r\nNOTA: Les dades de nom, cognom1 i 2, nom complet i el valor del document sobre l'exemple son inventades.\r\n\r\n```java\r\nDadesPeticioTGSS peticio = new DadesPeticioTGSS();\r\npeticio.setNom(\"Nom\");\r\npeticio.setCognom1(\"Cognom1\");\r\npeticio.setCognom2(\"Cognom2\");\r\npeticio.setNomComplet(null);\r\npeticio.setTipusDocumentacioInt(Constants.TGSS_NIF);\r\npeticio.setDocument(\"12345678B\");\r\n\r\nRespostaAlCorrentDePagament resposta = tgssConnector.alCorrentPagament(peticio);\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei de TGSS v1.6.pdf\"\r\n\r\n#### Exemple d'utilització del servei AEAT_ATC_TGSS\r\n\r\nRecuperar el bean del servei de AEAT_ATC_TGSS des de la classe on es vol utilitzar:\r\n\r\n```java\r\n@Autowired\r\nprivate TgssConnectorImpl tgssConnector;\r\n```\r\n\r\nEn aquest cas d'exemple es consumirà la modalitat de servei AEAT_ATC_TGSS_CONSULTA_DEUTES que retorna les dades conjuntes de les modalitats següents:\r\n\r\n-AEAT: Certificat d'obligacions tributàries (AEAT_PICA_C1)<br>\r\n-ATC: Informe de situació de deutes amb la Generalitat de Catalunya (ATC_INF_DEUTES_TMP)<br>\r\n-TGSS: Informe de situació de deutes de la TGSS (TGSS_AL_CORRENT_PAGAMENT)\r\n\r\nDonat que el servei AEAT_ATC_TGSS es consumeix de forma asíncrona la forma correcta per poder consumir-ho es realitza en 3 fases:\r\n\r\n1. Fer petició al Servei\r\n2. Testar l'estat de resolució de la petició\r\n3. Recuperar les dades de la petició\r\n\r\nNOTA: Les dades de nom, cognom1 i 2, nom complet i el valor del document sobre l'exemple son inventades.\r\n\r\n```java\r\nDadesPeticioAEAT_ATC_TGSS peticio = new DadesPeticioAEAT_ATC_TGSS();\r\n\t\t\t\r\npeticio.setIdioma(\"Català\");\r\npeticio.setTipusDocumentacio(Constants.AAT_NIF);\r\npeticio.setDocument(\"12345678B\");\r\npeticio.setNom(\"Nom\");\r\npeticio.setNomComplet(\"Nom Cognom1 Cognom2\");\r\npeticio.setCognom1(\"Cognom1\");\r\npeticio.setCognom2(\"Cognom2\");\r\n\t\t\t\r\nresposta = aeatAtcTgssConnector.consultaDeutes(peticio); //<-- Petició al servei\r\n\t\t\r\nEstatAsincron estatResposta = aeatAtcTgssConnector.getEstatConsultaDeutes(resposta.getResponse()); //<-- Consulta de l'estat de la petició\r\nint tempsEstimat = estatResposta.getTempsEstimatResposta();\r\n\t\r\n...\r\n\r\nRespostaConsultaDeutes dadesResposta = aeatAtcTgssConnector.getDadesConsultaDeutes(resposta.getServei()); //<-- recuperació de les dades de la petició\r\n```\r\n\r\nPer més informació sobre les dades d'entrada i sortida d'aquesta modalitat es pot consultar el document \"Guia d'us del servei deutes del contribuent AEAT-ATC-TGSS v1.1.pdf\"\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtaW50ZWdyYWNpby9tb2R1bC10cmlidXRz"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXVwbG9hZA==":{"date":1427460735000,"title":"Pujada d'arxius","description":"Pujada d'arxius al servidor.","sections":"Canigó. Documentació versió 3.x","weight":5,"path":"/canigo-documentacio-versions-3x-suport/modul-upload","content":"## Propòsit\r\n\r\nAquest mòdul permet al servidor obtenir fitxers adjunts als formularis HTML de client. A més aquest mòdul permet llegir el fitxer de forma directa, deser-lo al sistema de fitxers, emmagatzemar-lo en una base de dades o enllaçar-ho amb altres mòduls com pot ser el servei d'antivirus.\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'upload de fitxers es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.fileupload.version>[1.1.0,1.2.0)</canigo.support.fileupload.version>\r\n\r\n<dependency>\r\n  <groupId>cat.gencat.ctti</groupId>\r\n  <artifactId>canigo.support.fileupload</artifactId>\r\n  <version>${canigo.support.fileupload.version}</version>\r\n</dependency>\r\n```\r\n\r\n#### JSF\r\n\r\nPer aplicacions Canigó 3 basades en JSF 2.2 s'ha d'afegir la següent dependència amb la llibreria MyFaces Tomahawk, automàticament a través de l'eina de suport al desenvolupament o bé afegint-la manualment en el pom.xml de l'aplicació:\r\n\r\n```\r\n<tomahawk>1.1.14</tomahawk>\r\n<dependency>\r\n    <groupId>org.apache.myfaces.tomahawk</groupId>\r\n    <artifactId>tomahawk21</artifactId>\r\n    <version>${tomahawk}</version>\r\n    <exclusions>\r\n        <exclusion>\r\n            <artifactId>commons-validator</artifactId>\r\n            <groupId>commons-validator</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>itext</artifactId>\r\n            <groupId>com.lowagie</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>jstl</artifactId>\r\n            <groupId>javax.servlet</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>commons-logging</artifactId>\r\n            <groupId>commons-logging</groupId>\r\n        </exclusion>\r\n        <exclusion>\r\n            <artifactId>batik-awt-util</artifactId>\r\n            <groupId>org.apache.xmlgraphics</groupId>\r\n        </exclusion>\r\n    </exclusions>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\n#### JSF\r\n\r\nEn el cas d'utilitzar la opció de JSF, el que fa és afegir al web.xml el següent filtre per a interceptar les peticions multipart/form-data:\r\n\r\n```\r\n<filter>\r\n    <filter-name>Extensions Filter</filter-name>\r\n    <filter-class>org.apache.myfaces.webapp.filter.ExtensionsFilter</filter-class>\r\n    <init-param>\r\n        <param-name>uploadMaxFileSize</param-name>\r\n        <param-value>20m</param-value>\r\n        <description>Set the size limit for uploaded files.\r\n            Format: 10 - 10 bytes\r\n                    10k - 10 KB\r\n                    10m - 10 MB\r\n                    1g - 1 GB\r\n        </description>\r\n    </init-param>\r\n</filter>\r\n<filter-mapping>\r\n    <filter-name>Extensions Filter</filter-name>\r\n    <url-pattern>*.jsf</url-pattern>\r\n</filter-mapping>\r\n```\r\n\r\nCal afegir manualment en la jsf la següent capçalera:\r\n\r\n```\r\nxmlns:t=\"http://myfaces.apache.org/tomahawk\"\r\n```\r\n\r\n#### Struts + Taglibs\r\n\r\nEn el cas d'utilitzar la opció d'Struts + Taglibs, la configuració del servei es realitza mitjançant un fitxer de propietats.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/fileupload.properties\r\n\r\nPropietat | Requerit | Descripció\r\n--------- | -------- | ----------\r\n*.fileUpload.defaultEncoding | No | Direcció IP del servidor Engine Scan del CTTI, responsable dels escaneigs.\r\n*.fileUpload.maxUploadSize   | No | Màxim tamany permés abans que es rebutgin els fitxers. Valor per defecte: -1(no hi ha límit).\r\n*.fileUpload.maxInMemorySize | No | Màxim tamany permés en bytes abans de guardar en disc. Valor per defecte: 10240 (bytes).\r\n*.fileUpload.launchExceptionIfVirusDetected | No | Opció només disponible per a la integració del fileupload i antivirus. Indica si es llençarà una excepció al servei en el cas de que es trobi un virus en l'arxiu pujat. Valor per defecte: true.\r\n\r\n## Utilització del Mòdul\r\n\r\n### JSF\r\n\r\nPer a utilitzar aquest mòdul, cal crear un bean i una jsf:\r\n\r\n***fileUploadBean.java***\r\n\r\n```java\r\n@Component(\"fileUploadBean\")\r\n@Scope(\"singleton\")\r\n@Lazy\r\npublic class FileUploadBean {\r\n\r\n\t@Autowired\r\n\tprivate I18nResourceBundleMessageSource messageResource;\r\n\tprivate UploadedFile uploadedFile;\r\n\r\n\tpublic void submit() {\r\n\r\n\t\ttry {\r\n\t\t\tif(getUploadedFile()!=null & getUploadedFile().getBytes()!=null){\r\n\t\t\t\t// Show succes message.\r\n\t\t\t    FacesContext.getCurrentInstance().addMessage(\"uploadForm\", new FacesMessage(\r\n\t\t\t        FacesMessage.SEVERITY_INFO, messageResource.getMessage(\"fileUploadSuccess\"), null));\r\n\t\t\t}else{\r\n\t\t\t\t// Show succes message.\r\n\t\t\t    FacesContext.getCurrentInstance().addMessage(\"uploadForm\", new FacesMessage(\r\n\t\t\t        FacesMessage.SEVERITY_ERROR, messageResource.getMessage(\"fileUploadError\"), null));\r\n\t\t\t}\r\n\t\t} catch (IOException e) {\r\n\t\t\tFacesContext.getCurrentInstance().addMessage(\"uploadForm\", new FacesMessage(\r\n\t\t\t        FacesMessage.SEVERITY_ERROR, messageResource.getMessage(\"fileUploadError\"), null));\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic UploadedFile getUploadedFile() {\r\n\t\treturn uploadedFile;\r\n\t}\r\n\r\n\tpublic void setUploadedFile(UploadedFile uploadedFile) {\r\n\t\tthis.uploadedFile = uploadedFile;\r\n\t}\r\n\r\n}\r\n```\r\n\r\n**fileUpload.jsf**\r\n\r\n```\r\n<h:form id=\"uploadForm\" enctype=\"multipart/form-data\">\r\n    <h:panelGrid columns=\"3\">\r\n        <h:outputLabel for=\"file\" value=\"#{msg.fileUploadSelectFile}\" />\r\n        <t:inputFileUpload id=\"file\" value=\"#{fileUploadBean.uploadedFile}\" required=\"true\" />\r\n        <h:message for=\"file\" style=\"color: red;\" />\r\n        <h:panelGroup />\r\n        <h:commandButton value=\"#{msg.canigoSubmit}\" action=\"#{fileUploadBean.submit}\" />\r\n        <h:message for=\"uploadForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n    </h:panelGrid>\r\n</h:form>\r\n\r\n```\r\n\r\n### STRUTS+TAGLIBS\r\n\r\nPer a utilitzar el mòdul cal crear una Acció i una JSP:\r\n\r\n**app-fileupload.xml**\r\n\r\n```\r\n<bean name=\"/fileUpload\" class=\"cat.gencat.ctti.canigo.demo.fileupload.FileUploadAction\" scope=\"prototype\">\r\n    <property name=\"pojoClass\" value=\"cat.gencat.ctti.canigo.demo.fileupload.FileUploadPojo\"></property>\r\n    <property name=\"fileUpload\" ref=\"fileUploadService\" />\r\n    <!-- Configuració dels tags -->\r\n    <property name=\"tagsConfiguration\">\r\n        <map>\r\n            <entry key=\"*\">\r\n                <list>\r\n                    <bean parent=\"formTag\">\r\n                        <property name=\"styleId\" value=\"actionForm\"></property>\r\n                        <property name=\"layout\" value=\"true\"/>\r\n                        <property name=\"validationProperties\">\r\n                            <props>\r\n                                <prop key=\"validationType\">SERVER</prop>\r\n                                <prop key=\"validatorName\">uploadValidations</prop>\r\n                            </props>\r\n                        </property>\r\n                    </bean>\r\n                    <bean parent=\"submitTag\">\r\n                        <property name=\"styleId\" value=\"uploadSubmit\"/>\r\n                        <property name=\"mode\" value=\"N,D,N\"/>\r\n                        <property name=\"reqCode\" value=\"valida\"/>\r\n                        <property name=\"key\" value=\"forms.buttons.valida\"/>\r\n                        <bean parent=\"fileFieldTag\">\r\n                            <property name=\"styleId\" value=\"fileText\"></property>\r\n                            <property name=\"layout\" value=\"false\"></property>\r\n                            <property name=\"mode\" value = \"E,E,E\"></property>\r\n                        </bean>\r\n                    </bean>\r\n                </list>\r\n            </entry>\r\n        </map>\r\n    </property>\r\n</bean>\r\n```\r\n\r\n**FileUploadAction.java**\r\n\r\n```java\r\npublic class FileUploadAction extends DispatchActionSupport {\r\n\r\n\tprivate final String FORWARD_SUCCESS = \"success\";\r\n\r\n\tprivate static final Log log = LogFactory.getLog(FileUploadAction.class);\r\n\r\n\tprivate FileUploadService fileUpload;\r\n\r\n\r\n\t/**\r\n\t * Mètode que es crida pel reqCode=inici\r\n\t * @param mapping ActionMapping\r\n\t * @param form ActionForm\r\n\t * @param request HttpServletRequest\r\n\t * @param response HttpServletResponse\r\n\t * @return ActionForward\r\n\t * @throws Exception exception\r\n\t */\r\n\tpublic ActionForward upload(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) throws Exception {\r\n\t\tlog.info(\"FileUploadAction [inici] - Inici\");\r\n\r\n\t\tSpringBindingActionForm actionForm = (SpringBindingActionForm)form;\r\n\t\tFileUploadPojo pojo = (FileUploadPojo) actionForm.getTarget();\r\n\r\n\t\tString[] UPLOADED_FILES = new String[] { \"fitxer\" };\r\n\t\tUploadedFiles uploadedFiles = this.fileUpload.getUploadedFiles(request, UPLOADED_FILES);\r\n\t\tUploadedFile fitxerCarregat = uploadedFiles.getFile(\"fitxer\");\r\n\r\n\t\treturn mapping.findForward(FORWARD_SUCCESS);\r\n\t}\r\n\r\n\tpublic FileUploadService getFileUpload() {\r\n\t\treturn fileUpload;\r\n\t}\r\n\r\n\tpublic void setFileUpload(FileUploadService fileUpload) {\r\n\t\tthis.fileUpload = fileUpload;\r\n\t}\r\n}\r\n```\r\n\r\n**fileUpload.jsp**\r\n\r\n```\r\n<fwk:form styleId=\"actionForm\" action=\"sfileUpload.do?reqCode=upload\" method=\"POST\" enctype=\"multipart/form-data\">\r\n\t<fwk:row>\r\n\t\t<fwk:file styleId=\"fileText\" property=\"fitxer\" key=\"label.fileupload.path\"></fwk:file>\r\n\t</fwk:row>\r\n\t<fwk:row>\r\n\t\t<fwk:submit styleId=\"uploadSubmit\"></fwk:submit>\r\n\t</fwk:row>\r\n</fwk:form>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXVwbG9hZA=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWNvcnJldQ==":{"date":1427456704000,"title":"Correu","description":"Enviament de correu electrònic.","sections":"Canigó. Documentació versió 3.x","weight":1,"path":"/canigo-documentacio-versions-3x-suport/modul-correu","content":"## Propòsit\r\n\r\nAquest mòdul té com a objectiu permetre l'enviament de correus electrònics a una o diverses adreces especificades a qualsevol dels següents recipients:\r\n\r\n* Destinataris principals\r\n* Destinataris secundaris\r\n* Destinataris ocults\r\n\r\nPermet diferents modes d'enviament, tant en text pla, com en mode HTML, i en tots 2 casos oferint la possibilitat d'adjuntar un o més fitxers en mode adjunt o inline. \r\n\r\nVersions i Dependències\r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'enviament de correu es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.mailing.version>[1.1.0,1.2.0)</canigo.support.mailing.version>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.support.mailing</artifactId>\r\n\t<version>${canigo.support.mailing.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/mail.properties\r\n\r\nPropietat                | Requerit | Descripció\r\n------------------------ | -------- | ----------\r\n*.mail.host              | Sí       | Nom del servidor de correu sortint (smtp).\r\n*.mail.port              | No       | Port del servidor de correu sortint (smtp). Valor per defecte: -1.\r\n*.mail.protocol          | No       | Protocol del servidor de correu sortint (smtp).\r\n*.mail.username          | No       | Usuari de connexió al servidor de correu sorting (smtp).\r\n*.mail.password          | No       | Password de l'usuari de connexió.\r\n*.mail.maxAttachmentSize | No       | Tamany màxim permés dels fitxers adjunts. Per defecte: 0 (sense limits).\r\n*.mail.isSmtpSSLEnabled  | No       | Habilitar o deshabilitar SSL.\r\n*.mail.debug             | No       | Activar les traces de debug.\r\n*.mail.timeout           | No       | Timeout pel servidor de correu.\r\n\r\nPer poder utilitzar correctament les propietats isSmtpSSLEnabled, debug i timeout s'ha de declarar un bean com aquest:\r\n\r\n```\r\n<bean id=\"mailSender\" parent=\"mailSenderParent\" class=\"org.springframework.mail.javamail.JavaMailSenderImpl\">\r\n\t<property name=\"javaMailProperties\">\r\n\t\t<map>\r\n\t\t\t<entry key=\"mail.smtp.auth\" value=\"${mail.isSmtpSSLEnabled}\"/>\r\n\t\t\t<entry key=\"mail.smtp.starttls.enable\" value=\"${mail.isSmtpSSLEnabled}\"/>\r\n\t\t\t<entry key=\"mail.smtp.timeout\" value=\"${mail.timeout}\"/>\r\n\t\t\t<entry key=\"mail.smtps.debug\" value=\"${mail.debug}\"/>\r\n\t\t</map>\r\n\t</property>\r\n</bean>\r\n```\r\n\r\nque es recomana declarar en l'arxiu app-support-mailing.xml que s'ha de situar en /src/main/resources/spring/\r\n\r\n## Utilització del Mòdul\r\n\r\n### JSF\r\n\r\nPer a utilitzar aquest mòdul, cal crear un bean i una jsf:\r\n\r\n**mailingBean.java**\r\n\r\n```java\r\npackage cat.gencat.ctti.canigo.app.bean;\r\n\r\nimport javax.faces.application.FacesMessage;\r\nimport javax.faces.context.FacesContext;\r\n\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.context.annotation.Scope;\r\nimport org.springframework.stereotype.Component;\r\n\r\nimport cat.gencat.ctti.canigo.arch.core.i18n.I18nResourceBundleMessageSource;\r\nimport cat.gencat.ctti.canigo.arch.support.mailing.MailService;\r\n\r\n@Component(\"mailingBean\")@Scope(\"request\")\r\npublic class MailingBean {\r\n\r\n\tprivate MailService service;\r\n\tprivate String to;\r\n\tprivate String subject;\r\n\tprivate String from;\r\n\tprivate String cc;\r\n\tprivate String cco;\r\n\tprivate String body;@Autowired\r\n\tprivate I18nResourceBundleMessageSource messageResource;\r\n\tprivate String result;\r\n\r\n\tpublic String getResult() {\r\n\t\tif (result\\ != null) {\r\n\t\t\treturn messageResource.getMessage(result);\r\n\t\t} else {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t}\r\n\r\n\tpublic String getTo() {\r\n\t\treturn to;\r\n\t}\r\n\t\r\n\tpublic void setTo(String to) {\r\n\t\tthis.to = to;\r\n\t}\r\n\t\r\n\tpublic String getSubject() {\r\n\t\treturn subject;\r\n\t}\r\n\t\r\n\tpublic void setSubject(String subject) {\r\n\t\tthis.subject = subject;\r\n\t}\r\n\t\r\n\tpublic String getFrom() {\r\n\t\treturn from;\r\n\t}\r\n\t\r\n\tpublic void setFrom(String from) {\r\n\t\tthis.from = from;\r\n\t}\r\n\t\r\n\tpublic String getCc() {\r\n\t\treturn cc;\r\n\t}\r\n\t\r\n\tpublic void setCc(String cc) {\r\n\t\tthis.cc = cc;\r\n\t}\r\n\t\r\n\tpublic String getCco() {\r\n\t\treturn cco;\r\n\t}\r\n\t\r\n\tpublic void setCco(String cco) {\r\n\t\tthis.cco = cco;\r\n\t}\r\n\t\r\n\tpublic String getBody() {\r\n\t\treturn body;\r\n\t}\r\n\t\r\n\tpublic void setBody(String body) {\r\n\t\tthis.body = body;\r\n\t}\r\n\t\r\n\tpublic MailService getService() {\r\n\t\treturn service;\r\n\t}\r\n\t\r\n\t@Autowired\r\n\tpublic void setService(MailService service) {\r\n\t\tthis.service = service;\r\n\t}\r\n   \r\n    /**\r\n    * Send mail\r\n    */\r\n    String sendMail() {\r\n        try {\r\n            this.service.send(getFrom(), getSubject(), getBody(), false, getTo());\r\n            FacesContext.getCurrentInstance().addMessage(\"mailingForm\", new FacesMessage(FacesMessage.SEVERITY_INFO, messageResource.getMessage(\"mailingSuccces\"), null));\r\n            this.result = \"mailingSuccces\";\r\n        } catch (Exception e) {\r\n            FacesContext.getCurrentInstance().addMessage(\"mailingForm\", new FacesMessage(FacesMessage.SEVERITY_ERROR, e.getMessage(), null));\r\n            this.result = \"mailingError\";\r\n        }\r\n        return \"mail\";\r\n    }\r\n}\r\n```\r\n\r\n**mailing.jsf**\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\" standalone=\"yes\" ?>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\r\nxmlns:ui=\"http://java.sun.com/jsf/facelets\"\r\nxmlns:f=\"http://java.sun.com/jsf/core\"\r\nxmlns:h=\"http://java.sun.com/jsf/html\"\r\nxmlns:c=\"http://java.sun.com/jstl/core\"\r\nxmlns:val=\"http://shale.apache.org/validator\">\r\n\r\n<ui:composition template=\"layouts/template.jsf\">\r\n<ui:define name=\"ariadna\">\r\n<h:outputLink value=\"index.jsf\">\r\n<h:outputFormat>#\r\n{msg.breadCrumbInit}\r\n</h:outputFormat>\r\n</h:outputLink>\r\n</ui:define>\r\n<ui:define name=\"body\">\r\n<h1>$\r\n{msg.menuSupportMailing}\r\n</h1>\r\n<h:form id=\"mailingForm\" onsubmit=\"return validateForm(this);\">\r\n<h:panelGrid columns=\"3\">\r\n<h:outputText value=\"#\r\n{msg.mailingTo}:\" />\r\n\r\n\r\narg=\"#{msg.mailingTo}\r\n\"\r\nserver=\"true\"\r\nclient=\"true\"/>\r\n<val:commonsValidator type=\"email\"\r\narg=\"#\r\n{msg.mailingTo}\r\n\"\r\nserver=\"true\"\r\nclient=\"true\"/>\r\n</h:inputText>\r\n<h:message for=\"to\" errorStyle=\"color: red;\" />\r\n<h:outputText value=\"#\r\n{msg.mailingFrom}:\" />\r\n\r\n\r\narg=\"#{msg.mailingFrom}\r\n\"\r\nserver=\"true\"\r\nclient=\"true\"/>\r\n<val:commonsValidator type=\"email\"\r\narg=\"#\r\n{msg.mailingFrom}\r\n\"\r\nserver=\"true\"\r\nclient=\"true\"/>\r\n</h:inputText>\r\n<h:message for=\"from\" errorStyle=\"color: red;\" />\r\n<h:outputText value=\"#\r\n{msg.mailingCC}\r\n:\" />\r\n<h:inputText id=\"cc\" value=\"\"/>\r\n<h:message for=\"cc\" errorStyle=\"color: red;\" />\r\n<h:outputText value=\"#\r\n{msg.mailingCCO}\r\n:\" />\r\n<h:inputText id=\"cco\" value=\"\"/>\r\n<h:message for=\"cco\" errorStyle=\"color: red;\" />\r\n<h:outputText value=\"#\r\n{msg.mailingSubject}:\" />\r\n\r\n\r\narg=\"#{msg.mailingSubject}\r\n\"\r\nserver=\"true\"\r\nclient=\"true\"/>\r\n</h:inputText>\r\n<h:message for=\"subject\" errorStyle=\"color: red;\" />\r\n<h:outputText value=\"#\r\n{msg.mailingBody}\r\n:\" />\r\n<h:inputTextarea id=\"body\"/>\r\n<h:commandButton value=\"#\r\n{msg.canigoSubmit}\r\n\" action=\"#\r\n{mailingBean.sendMail}\r\n\" />\r\n<br/>\r\n<h:outputText value=\"#\r\n{mailingBean.result}\r\n\"/>\r\n<h:message for=\"mailingForm\" infoStyle=\"color: green;\" errorStyle=\"color: red;\" />\r\n<val:validatorScript functionName=\"validateForm\"/>\r\n</h:panelGrid>\r\n</h:form>\r\n</ui:define>\r\n</ui:composition>\r\n</html>\r\n```\r\n\r\n### STRUTS+TAGLIBS\r\n\r\nPer a utilitzar el mòdul cal crear el fitxer de configuració una Acció i una JSP:\r\n\r\n**app-mailing.xml**\r\n\r\n```\r\n<bean name=\"/mailing\" class=\"cat.gencat.ctti.canigo.demo.mailing.MailingAction\" scope=\"prototype\">\r\n    <property name=\"pojoClass\" value=\"cat.gencat.ctti.canigo.demo.mailing.MailingPojo\"></property>\r\n    <property name=\"mailService\" ref=\"mailService\"></property><\\!-\\- Configuració dels tags \\-->\r\n    <property name=\"tagsConfiguration\">\r\n        <map>\r\n            <entry key=\"*\">\r\n                <list>\r\n                    <bean parent=\"formTag\">\r\n                        <property name=\"styleId\" value=\"actionForm\"></property>\r\n                        <property name=\"layout\" value=\"true\"/>\r\n                        <property name=\"validationProperties\">\r\n                            <props>\r\n                                <prop key=\"validationType\">SERVER</prop>\r\n                                <prop key=\"validatorName\">mailingValidations</prop>\r\n                            </props>\r\n                        </property>\r\n                    </bean>\r\n                    <bean parent=\"textFieldTag\">\r\n                        <property name=\"styleId\" value=\"textField\"></property>\r\n                        <property name=\"layout\" value=\"true\"/>\r\n                        <property name=\"mode\" value=\"E,E,E\"></property>\r\n                    </bean>\r\n                    <bean parent=\"textFieldTag\">\r\n                        <property name=\"styleId\" value=\"labelField\"></property>\r\n                        <property name=\"layout\" value=\"false\"/>\r\n                        <property name=\"mode\" value=\"I,H,I\"></property>\r\n                    </bean>\r\n                    <bean parent=\"textFieldTag\">\r\n                        <property name=\"styleId\" value=\"ocult\"></property>\r\n                        <property name=\"layout\" value=\"false\"/>\r\n                        <property name=\"mode\" value=\"H,H,H\"></property>\r\n                    </bean>\r\n                    <bean parent=\"submitTag\">\r\n                        <property name=\"styleId\" value=\"validaSubmit\"/>\r\n                        <property name=\"mode\" value=\"D,D,D\"/>\r\n                        <property name=\"reqCode\" value=\"enviaMail\"/>\r\n                        <property name=\"key\" value=\"forms.buttons.send\"/>\r\n                    </bean>\r\n                    <bean parent=\"fileFieldTag\">\r\n                        <property name=\"styleId\" value=\"Arxiu\"></property>\r\n                        <property name=\"layout\" value=\"false\"></property>\r\n                        <property name=\"mode\" value = \"E,E,E\"></property>\r\n                    </bean>\r\n                    <bean parent=\"checkboxFieldTag\">\r\n                        <property name=\"styleId\" value=\"checkbox\"></property>\r\n                        <property name=\"layout\" value=\"false\"></property>\r\n                        <property name=\"mode\" value = \"E,E,E\"></property>\r\n                    </bean>\r\n                    <bean parent=\"textAreaFieldTag\">\r\n                        <property name=\"styleId\" value=\"textAreaDescripcio\" />\r\n                        <property name=\"rows\" value=\"3\" />\r\n                        <property name=\"cols\" value=\"30\" />\r\n                        <property name=\"layout\" value=\"true\"/>\r\n                    </bean>\r\n                </list>\r\n            </entry>\r\n        </map>\r\n    </property>\r\n</bean>\r\n```  \r\n\r\n**MailingAction.java**\r\n\r\n```java\r\npublic class MailingAction extends DispatchActionSupport {\r\n\r\n\tprivate final String FORWARD_SUCCESS = \"success\";\r\n\r\n\tprivate static final Log log = LogFactory.getLog(MailingAction.class);\r\n\r\n\tprivate MailService mailService;\r\n\r\n\t/**\r\n\t * Mètode que es crida pel reqCode=inici\r\n\t * @param mapping ActionMapping\r\n\t * @param form ActionForm\r\n\t * @param request HttpServletRequest\r\n\t * @param response HttpServletResponse\r\n\t * @return ActionForward\r\n\t * @throws Exception exception\r\n\t */\r\n\tpublic ActionForward send(ActionMapping mapping, ActionForm form, HttpServletRequest request, HttpServletResponse response) throws Exception {\r\n\t\tlog.info(\"MailingAction [inici] - Inici\");...mailService.send(from, subject, body, false, llistaMails, llistaAttachment);...\r\n\t\treturn mapping.findForward(FORWARD_SUCCESS);\r\n\t}\r\n\r\n\tpublic MailService getMailService() {\r\n\t\treturn mailService;\r\n\t}\r\n\tpublic void setMailService(MailService mailService) {\r\n\t\tthis.mailService = mailService;\r\n\t}\r\n}\r\n```\r\n\r\n**mailing.jsp**\r\n\r\n```\r\n<fwk:form styleId=\"actionForm\" action=\"serveisGeneralsCorreu.do\" method=\"POST\" enctype=\"multipart/form-data\">\r\n    <!-- INICI HIDDENS -->\r\n    <fwk:text styleId=\"ocult\" property=\"reqCode\"></fwk:text>\r\n    <!-- FI HIDDENS -->\r\n    <table class=\"striped_box\" width=\"100%\" border=\"0\" cellspacing=\"0px\">\r\n        <fwk:row>\r\n            <fwk:text styleId=\"textField\" property=\"to\" key=\"label.serveisgenerals.correu.to\"></fwk:text>\r\n        </fwk:row>\r\n        <fwk:row>\r\n            <fwk:text styleId=\"textField\" property=\"from\" key=\"label.serveisgenerals.correu.from\"></fwk:text>\r\n        </fwk:row>\r\n        <fwk:row>\r\n            <fwk:text styleId=\"textField\" property=\"cc\" key=\"label.serveisgenerals.correu.cc\"></fwk:text>\r\n        </fwk:row>\r\n        <fwk:row>\r\n            <fwk:text styleId=\"textField\" property=\"cco\" key=\"label.serveisgenerals.correu.cco\"></fwk:text>\r\n        </fwk:row>\r\n        <fwk:row>\r\n            <fwk:text styleId=\"textField\" property=\"subject\" key=\"label.serveisgenerals.correu.subject\" ></fwk:text>\r\n        </fwk:row>\r\n        <fwk:row>\r\n            <fwk:textarea styleId=\"textAreaDescripcio\" property=\"body\" key=\"label.serveisgenerals.correu.body\"></fwk:textarea>\r\n        </fwk:row>\r\n        <fwk:row>\r\n            <fwk:file styleId=\"Arxiu\" property=\"arxiu\" key=\"label.serveisgenerals.correu.arxiu\"></fwk:file>\r\n            <fwk:checkbox styleId=\"inline\" property=\"isInline\" key=\"label.serveisgenerals.correu.isInline\"></fwk:checkbox>\r\n        </fwk:row>\r\n        <fwk:row>\r\n            <fwk:submit styleId=\"validaSubmit\"></fwk:submit>\r\n        </fwk:row>\r\n    </table>\r\n</fwk:form>\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLWNvcnJldQ=="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0x":{"date":1423239102000,"title":"Versió 1.x","description":"Documentació de la versió 1 del Framework Canigó","sections":"Documentació versions Canigó","taxonomies":[],"weight":2,"path":"/canigo-documentacio-versions-anteriors/versio-1","content":"Des del següent [enllaç](http://canigo.ctti.gencat.cat/docs-canigo-v1/) es pot accedir a la darrera versió de la documentació.\n\n### Changelog\n\n[1.0.1](https://github.com/cs-canigo/docs.canigo1.cs-canigo.github.io/archive/1.0.1.zip) (15/03/2016)\n\n- [CAN-2086](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2086): Actualitzada documentació connector Documentum per l'upgrade a v7.1.\n\n[1.0.0](https://github.com/cs-canigo/docs.canigo1.cs-canigo.github.io/archive/1.0.0.zip) (6/2/2015)\n\n- Versió inicial exportada del Confluence\n\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0x"},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL21hdHJpdXMtY29tcGF0aWJpbGl0YXRz":{"date":1427760000000,"title":"Matrius de Compatibilitats","description":"","sections":"Canigó","weight":1,"path":"/canigo-download-related/matrius-compatibilitats","content":"- [Release 25-05-2011](/related/canigo/download/Matriu+Compatibilitat+Canigó3.pdf)\r\n- [Release 30-11-2011](/related/canigo/download/Matriu+Compatibilitat+Canigó3.0.2.pdf)\r\n- [Release 28-02-2012](/related/canigo/download/Matriu+Compatibilitat+Canigó3.0.3.pdf)\r\n- [Release 14-06-2012](/related/canigo/download/Matriu+Compatibilitat+Canigó3.0.4.pdf)\r\n- [Release 31-10-2012](/related/canigo/download/Matriu+Compatibilitat+Canigó3.0.5.pdf)\r\n- [Release 23-05-2014](/related/canigo/download/Matriu+Compatibilitat+Canigó3.0.6.pdf)\r\n- [Release 20-11-2014](/related/canigo/download/Matriu Compatibilitat Canigo3.1.1.pdf)\r\n- [Release 25-10-2015](/related/canigo/download/Matriu Compatibilitat Canigo3.1.2.pdf)\r\n","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL21hdHJpdXMtY29tcGF0aWJpbGl0YXRz"},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTI=":{"date":1427760000000,"title":"Release Notes Canigó 2.3.20","description":"","sections":"Canigó","weight":1,"path":"/canigo-download-related/release-notes-canigo-2","content":"#### Canvis\r\n\r\n- Canvi [CAN-1726](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1726): Notificacions electròniques <br>\r\n<b>Context</b>: Actualització del connector de la PICA amb el producte NT <br>\r\n<b>Connector afectat</b>: canigo-connectors-nt <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n- Canvi [CAN-1735](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1735): Actualització connector AEAT PICA  <br>\r\n<b>Context</b>: Actualització del connector de la PICA amb el producte AEAT <br>\r\n<b>Connector afectat</b>: canigo-connectors-pica-tributs <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n- Canvi [CAN-1745](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1745): Actualització connector AEAT-TGSS  <br>\r\n<b>Context</b>: Actualització del connector de la PICA amb el producte TGSS <br>\r\n<b>Connector afectat</b>: canigo-connectors-pica-tributs <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n- Canvi [CAN-1824](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1824): Consulta error connector pica  <br>\r\n<b>Context</b>: Arrel d'una consulta sobre el connector de PSIS es detecta que cal actualitzar-ho donat que un dels camp que s'envia a la petició ha passat de ser opcional a obligatori i el connector no deixava informar-ho. <br>\r\n<b>Servei afectat</b>: canigo-connectors-psis <br>\r\n<b>Solució</b>: Modificació del connector  <br>\r\n\r\n#### Bugs sol·lucionats\r\n\r\n- Bug [CAN-1683](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1683) El connector de DNI no permet informar el camp funcionari <br>\r\n<b>Context</b>: Problemes amb la impossibilitat de poder informar un valor a les crides del connector de la PICA-DNI.<br>\r\n<b>Servei afectat</b>: canigo-connectors-pica-dni<br>\r\n<b>Solució</b>: Modificació del connector <br>\r\n\r\n- Bug [CAN-1765](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1765) Problemàtica en l'enviament d'e-mails <br>\r\n<b>Context</b>: Problemes del servei a l'hora d'obtenir el Transport<br>\r\n<b>Servei afectat</b>: canigo-services-mailing<br>\r\n<b>Solució</b>: Modificació del connector <br>\r\n\r\n- Bug [CAN-1884](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1884) Canigó integracions externes per Proxy<br>\r\n<b>Context</b>: Problemes al intentar informar un campal desplegar amb Weblogic si es sobreescriuen certes variables a nivell global d'instància de JVM.<br>\r\n<b>Servei afectat</b>: canigo-services-webservices<br>\r\n<b>Solució</b>: Modificació del servei <br>\r\n\r\n- Bug [CAN-1789](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1789) Botó submit bloquejat a google chrome<br>\r\n<b>Context</b>: Problemes amb el volum de dades que s'envien a validar mitjançant un formulari.<br>\r\n<b>Servei afectat</b>: canigo-services-client<br>\r\n<b>Solució</b>: Modificació de scripts que intervenen a l'enviament de dades de formularis <br>","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTI="},"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTMx":{"date":1427760000000,"title":"Release Notes Canigó 3.1","description":"","sections":"Canigó","weight":1,"path":"/canigo-download-related/release-notes-canigo-31","content":"#### Canvis\r\n\r\n[CAN-1956](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-1956) - Publicació Canigó 3.1.\r\n\r\n\r\n\r\n","objectID":"L2Nhbmlnby1kb3dubG9hZC1yZWxhdGVkL3JlbGVhc2Utbm90ZXMtY2FuaWdvLTMx"},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0y":{"date":1423239102000,"title":"Versió 2.x","description":"Documentació de la versió 2 del Framework Canigó","sections":"Documentació versions Canigó","taxonomies":[],"weight":1,"path":"/canigo-documentacio-versions-anteriors/versio-2","content":"Des del següent [enllaç](http://canigo.ctti.gencat.cat/docs-canigo-v2/) es pot accedir a la darrera versió de la documentació.\n\n### Changelog\n\n[1.0.2](https://github.com/cs-canigo/docs.canigo2.cs-canigo.github.io/archive/v1.0.2.zip) (28/01/2016)\n\n- [CAN-2071](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2071): Actualitzada documentació connectors de la PICA.\n\n[1.0.1](https://github.com/cs-canigo/docs.canigo2.cs-canigo.github.io/archive/v1.0.1.zip) (17/12/2015)\n\n- [CAN-2057](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN-2057): Actualitzada documentació connector Documentum per l'upgrade a v7.1.\n\n[1.0.0](https://github.com/cs-canigo/docs.canigo2.cs-canigo.github.io/archive/v1.0.0.zip) (6/2/2015)\n\n- Versió inicial exportada del Confluence\n\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtYW50ZXJpb3JzL3ZlcnNpby0y"},"L2NlbnRyZS1kZS1zdXBvcnQvY29udGFjdGE=":{"date":1465575102000,"title":"Contacta amb el CS Canigó","description":"","weight":10,"path":"/centre-de-suport/contacta","content":"* [oficina-tecnica.canigo.ctti@gencat.cat](mailto://oficina-tecnica.canigo.ctti@gencat.cat)\r\n* [Centre de Suport Tecnològic al Desenvolupament](http://cstd.ctti.gencat.cat/)","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvY29udGFjdGE="},"L2NlbnRyZS1kZS1zdXBvcnQvYWNjZXM=":{"date":1422115902000,"title":"Accés a les eines de suport","description":"Eines de les que disposem per a comunicar-nos amb el CS Canigó","sections":"Centre de Suport","weight":2,"path":"/centre-de-suport/acces","content":"Per obtenir suport de l'Oficina Tècnica del Framework J2EE s'han de seguir els seguents passos: \r\n\r\n - Accedir a l'eina de Gestió d'Incidències: Es pot accedir mitjançant l'enllaç [Obtenir Suport](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN).\r\n \r\n <CENTER>![PHP](/images/cstd/jira.jpg)</center>\r\n\r\n - Donar d'alta una incidència: Podeu trobar més informació [aquí] (/centre-de-suport-related/obertura-peticions)\r\n - Fer el seguiment\r\n - Tancar la incidència\r\n \r\nPer veure en detall quins son els procediments i protocols que segueix el Centre de Suport Canigó per a cadascuna de les activitats ho pots trobar [aquí] (/centre-de-suport-related/procediments-protocols)","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvYWNjZXM="},"L2NlbnRyZS1kZS1zdXBvcnQvZmFx":{"date":1422115902000,"title":"Preguntes freqüents","description":"Preguntes i peticions més freqüents adreçades al CS Canigó","sections":"Centre de Suport","weight":3,"path":"/centre-de-suport/faq","content":"## Accés al portal\r\n### Com demanar un usuari d'accés?\r\nEnviant un correu a la bústia <oficina-tecnica.canigo.ctti@gencat.cat> amb el següent [formulari](/related/cs/formulari-altes.xls) omplert.\r\n\r\n## Formació\r\n### Com capacitar-se en Canigó?\r\nMitjançant la realització de cursos presencials que es poden sol- licitar a través de la bústia del Centre de Suport\r\n\r\n### Com inscriure's en un curs presencial?\r\nEnviar un correu a la bústia <oficina-tecnica.canigo.ctti@gencat.cat> indicant:\r\n\r\n- Curs i data\r\n- Nombre de persones a inscriure i llistat dels seus noms, dnis i correus eletrònics\r\n- Departament/proveïdor\r\n- Projecte\r\n- Motius de la necessitat\r\n\r\n\r\n### Com sol.licitar un curs presencial fora de calendari?\r\nEnviar un correu a la bústia <oficina-tecnica.canigo.ctti@gencat.cat> indicant:\r\n\r\n- Curs sol.licitat\r\n- Motius de la necessitat de formació\r\n- Projecte associat\r\n- Proveïdor destinatari de la formació\r\n- Data d'inici desitjada\r\n- Nombre d'assistents previstos\r\n\r\n\r\n## Incidències, Peticions de canvi, Consultes i Suport\r\n### Com introduir una incidència, petició de canvi, consulta o petició de suport?\r\nDes del portal escollir l'opció [Obtenir Suport](http://cstd.ctti.gencat.cat/jiracstd/browse/CAN).\r\n\r\n## Col.laboracions\r\n### Com informar d'una col- laboració a Canigó?\r\nSi es considera que una funcionalitat pot ser incorporada a Canigó enviar un correu a la bústia <oficina-tecnica.canigo.ctti@gencat.cat> informant dels objectius de la col.laboració, així com de la informació tècnica si es considera necessari. Qualsevol col.laboració serà avaluada per l'Oficina Tècnica.\r\n\r\nEn cas d'aprovació s'adaptarà als estàndards de qualitat, codificació i documentació de Canigó, i es procedirà a la seva integració per una posterior versió.\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvZmFx"},"L2NlbnRyZS1kZS1zdXBvcnQvcXVlLWVzLWVsLWNz":{"date":1422115902000,"title":"El Centre de suport Canigó","description":"Què és el Centre de suport Canigó?","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport/que-es-el-cs","content":"El Centre de Suport Canigó s'orienta a proporcionar serveis d'acompanyament als Departaments oferint el suport i assessorament tecnològic necessaris per tal d'assolir l'èxit de les seves noves iniciatives tecnològiques així com donar suport al correcte funcionament de les aplicacions i serveis actualment desplegats.\r\n\r\nActualment el Centre de Suport ofereix aquests serveis per a 3 productes diferents:\r\n\r\n* **Framework Canigó**: espai comú de treball per al desenvolupament de noves aplicacions amb tecnologia JEE basades en entorn web. Aquest framework es composa de diferents serveis i proporciona una arquitectura d'aplicacions consistent i única per tots els desenvolupaments.\r\n* **Servei d'Integració Contínua (SIC)**: està composat per diferents sistemes que ens permeten, entre d'altres, el repositori controlat del codi font dels diferents sistemes d'informació de la Generalitat, i la construcció de l'aplicació a partir d'aquest codi i el seu desplegament a les infraestructures de la Generalitat.\r\n* **Plataforma formularis electrònics**: plataforma que permet la interacció amb formularis electrònics basats en Adobe Livecycle ES4. Ofereix les funcionalitats d'extracció de dades dels formularis o la seva renderització, a més de la publicació i activació de nous formularis.\r\n\r\n## Quins són els seus objectius?\r\n\r\nEls objectius principals del Centre de Suport es poden resumir en els següents aspectes:\r\n\r\nPel que fa als usuaris dels productes del Centre de Suport Canigó:\r\n\r\n* Assegurar l'èxit en la construcció i implantació de les aplicacions basades en els nostres productes.\r\n* Garantir la qualitat dels sistemes que es desenvolupin sobre Canigó.\r\n* Assegurar que tota la informació relacionada amb els productes del centre de suport arriba als col- lectius que la necessiten.\r\n* Oferir formació i suport tècnic especialitzat (incidències, consultes, ...)\r\n\r\nPel que fa als propis productes del Centre de Suport Canigó:\r\n\r\n* Asegurar la seva evolució tant a nivell correctiu com evolutiu.\r\n* Garantir la màxima qualitat dels nostres productes, tant pel que fa al codi com al material de suport.\r\n* Planificar, controlar i produir de forma continuada noves versions o evolucions, seguint les necessitats de la Generalitat.\r\n* Garantir la total integració de Canigó, i els altres productes, en l'entorn TIC de la Generalitat de Catalunya.\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvcXVlLWVzLWVsLWNz"},"L2NlbnRyZS1kZS1zdXBvcnQvcm9hZG1hcA==":{"date":1443139200000,"title":"Roadmap CS Canigó","description":"Roadmap del CS Canigó: Canigó, SIC i SGDE","sections":"Roadmap","weight":5,"categories":["canigo","sic","sgde"],"path":"/centre-de-suport/roadmap","content":"Aquest és el Roadmap del CS Canigó per als serveis Canigó, SIC i SGDE:\r\n<iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1ycTBuP_02_fFQYHePMhAxAnNt70R4GyTP4phJn3EHi8&font=Default&lang=ca&initial_zoom=1&height=600&start_at_slide=17' width='100%' height='600' frameborder='0'></iframe>\r\n\r\n*Aquest Roadmap està subjecte a canvis*\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQvcm9hZG1hcA=="},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9lc3RhdC13b3JrZmxvdyBlc3BhaSBzdXBvcnQ=":{"date":1422115902000,"title":"Estats i workflow de l'espai de suport (incidències, consultes i peticions de canvi)","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/estat-workflow espai suport","content":"### Introducció \r\n\r\nL'espai de suport permet reportar diferents activitats relacionades amb el Framework Canigó. Una activitat pot ser una incidència, una consulta o una petició de canvi.\r\n\r\n - Una incidència informa d'un bug en un servei, i per una versió concreta, del Framework Canigó. Aquest bug, si finalment és tal, ha d'acabar generant una petició de canvi (s'ha de fer una actualització del codi font de Canigó).\r\n - Una consulta planteja un dubte relacionat amb l'ús del Framework Canigó o bé amb el propi Framework Canigó.\r\n - De vegades, un projecte concret necessita una funcionalitat no desenvolupada en el Framework Canigó. En aquests casos, es pot sol- licitar una petició de canvi demanant aquesta nova funcionalitat. Per tal de poder valorar correctament la necessitat d'aquesta petició cal que s'informi amb el màxim detall possible el context (situació inicial que requereix del canvi), i necessitat del canvi (per què s'hauria de fer aquest canvi en el Framework. Si s'han provat solucions alternatives, resultat d'aquestes proves, ...).\r\n \r\n Aquests tipus d'activitats tenen definit un workflow que ens permet, en cada moment, identificar l'estat en què es troba l'activitat (si està assignada, si està en progrés, si està pendent, ...).\r\n\r\nEn els següents apartats s'expliquen els diferents estats pels quals pot passar una activitat i el que signifiquen cadascun d'ells. \r\n\r\n#### 1. Incidències i consultes.\r\n\r\n<b>Estats</b>\r\n\r\n - <b>Nou</b>: el reportador ha donat d'alta una nova incidència o consulta. L'OT de Canigó s'encarregarà de classificar (indicar la seva prioritat) i assignar a una persona de l'Oficina Tècnica de Canigó la nova incidència o consulta.<br>\r\n\t\t- Estats següents: <b>Assignat</b>.\r\n - <b>Assignat</b>: la incidència o consulta ha estat assignada a una persona de l'Oficina Tècnica de Canigó que serà l'encarregada de la resolució i seguiment de la mateixa.<br>\r\n\t\t- Estats següents: En <b>progrés</b> (s'ha iniciat la resolució de la incidència o consulta), <b>Assignat</b> (es reassigna aquesta activitat a una altra persona de l'Oficina Tècnica de Canigó).\r\n - <b>En progrés</b>: la persona encarregada de l'activitat ha passat a estudiar la seva resolució.<br>\r\n\t\t- Estats següents: <b>Resolt</b> (la persona encarregada de l'activitat proposa una solució pel problema reportat), <b>Pendent</b> (la persona encarregada de l'activitat considera que falten dades per arribar a la resolució de la mateixa), <b>Assignat</b> (s'escala el problema perquè no es considera una incidència o consulta sinò una petició de canvi que cal estudiar i avaluar, en aquest cas l'activitat s'assignarà a la persona de l'equip encarregada dels Evolutius del Framework Canigó).\r\n - <b>Pendent</b>: l'OT de Canigó està en espera de què el reportador de l'activitat afegeixi les dades que se li han demanat.<br>\r\n\t\t- Estats següents: En <b>progrés</b> (el reportador ha afegit les dades que se li han demanat i es continua amb la resolució de l'activitat), <b>Tancat</b> per \"<b>Falta d'informació</b>\" (en aquest cas han passat tres o més dies des que es va sol- licitar més informació per la resolució de l'activitat i el reportador de la mateixa no l'ha afegida), <b>Assignat</b> (el reportador de l'activitat ha afegit les dades i així ho comunica, opció \"<b>Dades afegides</b>\").\r\n - <b>Resolt</b>: des de l'OT de Canigó s'ha donat una solució per l'activitat reportada.<br>\r\n\t\t- Estats següents: <b>Tancat</b< en aquest cas el reportador de l'activitat pot tancar-la indicant el grau de satisfacció de la solució proposada, valorant-la d'1 a 5. Anàlogament, l'OT de Canigó pot tancar l'activitat per \"<b>Tancada automàticament</b>\" en el cas que el reportador de l'activitat no l'hagi tancat havent transcorregut tres o més dies. Finalment, un altre estat al que es pot arribar a partir d'aquest és \"<b>Assignat</b>\", aquest és l'estat al que s'arriba quan el reportador de l'activitat no queda conforme amb la resolució donada, amb ell indica que vol que la persona encarregada de la resolució de l'activitat proposi una altra solució.\r\n\t\t\r\n####  2. Peticions de canvi.\r\n\r\n<b>Estats</b>\r\n\r\n - <b>Nou</b>: el reportador ha donat d'alta una petició de canvi. L'OT de Canigó s'encarregarà de classificar (indicar la necessitat d'aquest canvi) i assignar-la a una persona de l'Oficina Tècnica de Canigó la nova<br>\r\nEstats següents: <b>Assignat, Resolt.</b>\r\n - <b>Classificat</b>: l'OT ha classificat la necessitat de la petició de canvi.<br>\r\nEstats següents: <b>En valoració</b> en aquest estat, l'OT valora la necessitat del canvi i estudia la seva planificació.\r\n - <b>En valoració</b>: l'OT indica el temps inicial estimat per dur a terme el canvi demanat així com la versió en què es publicarà el canvi.<br>\r\nEstats següents: <b>Aprovat</b> (el canvi demanat s'implementarà per futures versions de Canigó), <b>Pendent</b> (es requereixen mes dades per part del reportador de la petició de canvi per poder fer una valoració correcta de la petició de canvi), <b>Resolt</b> (no cal dur a terme el canvi indicat perquè aquest ja està resolt).\r\n - <b>Aprovat</b>: el canvi demanat s'implementarà per futures versions de Canigó.<br>\r\nEstats següents: <b>Assignat</b>\r\n - <b>Assignat</b>: la petició de canvi ha estat assignada a una persona de l'Oficina Tècnica de Canigó que serà l'encarregada de la implementació del canvi.<br>\r\nEstats següents: <b>En progrés</b>\r\n - <b>En progrés</b>: la persona encarregada de la petició de canvi comença la seva implementació.<br>\r\nEstats següents: <b>Pendent</b> (manca informació per part del reportador del canvi per dur a terme la implementació del canvi) i <b>Resolt</b> (s'ha dut a terme el canvi sol- licitat).\r\n - <b>Pendent</b>: la implementació de la petició de canvi s'ha aturat momentàniament per falta de dades per part del reportador del canvi.<br>\r\nEstats següents: <b>En Progrés</b> (el reportador ha indicat la nova informació i es continua amb la implementació del canvi) i <b>Tancat</b> (el reportador de la petició de canvi no inclou les dades demanades, es tanca la petició de canvi).\r\n - <b>Resolt</b>: s'ha finalitzat el canvi en el codi font del Framework Canigó.<br>\r\nEstats següents: <b>Tancat</b> (s'ha finalitzat el canvi) i <b>Classificat</b> (es reobre la petició de canvi, cal tornar a estudiar-la per classificar-la convenientment).\r\n - <b>Tancat</b>: s'ha finalitzat el canvi.<br>","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9lc3RhdC13b3JrZmxvdyBlc3BhaSBzdXBvcnQ="},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9taWxsb3Jlcy1lc3BhaS1zdXBvcnQ=":{"date":1422115902000,"title":"Millores en l'espai de suport (incidències, consultes i peticions de canvi).","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/millores-espai-suport","content":"S'han afegit les següents funcionalitats en l'espai de suport:\r\n\r\n - S'ha afegit un apartat on es poden consultar les activitats més populars (aquelles activitats no resoltes ordenades per vots). Aquest nou apartat es troba a <b>\"Visualitzar Serveis\"</b> > <b>\"Activitats Populars\"</b>.\r\n","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9taWxsb3Jlcy1lc3BhaS1zdXBvcnQ="},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9vYmVydHVyYS1wZXRpY2lvbnM=":{"date":1422115902000,"title":"Obertura de peticions","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/obertura-peticions","content":"#### Tipus de peticions\r\n\r\nExisteixen 4 tipus diferents de peticions que es poden obrir pel servei Canigó (Framework J2EE).\r\n\r\n#### Peticions de Canvi\r\n\r\nPeticions indicades quan es creu interessant que el Framework reflecteixi algun canvi important en algun dels seus components o bé sorgeix la necessitat de crear algun component nou.\r\n\r\nTotes les peticions de canvi han d'anar acompanyades d'una explicació detallada dels motius pels quals es sol- licita el canvi.\r\n\r\nEl Centre de Suport avaluarà aquesta petició i conclourà si la desenvolupa o no en base a les necessitats de l'aplicació e impacte que aquest tingui sobre el Framework.\r\n\r\nEn cas de que es desenvolupi el canvi, normalment aquest estarà disponible en la següent versió de Canigó.\r\n\r\n#### Peticions de Consulta\r\n\r\nPeticions orientades a la resolució de qüestions relacionades amb la utilització del Framework de Canigó. En aquest tipus de peticions es poden redactar preguntes relacionades amb problemes derivats de l'ús dels components del Framework, errors de desenvolupament i dubtes varis.\r\n\r\nEl mateix Centre de suport s'encarregarà de canviar la categorització de Consulta a Incidència si es detectés un problema a nivell del Framework dintre de la petició.\r\n\r\n#### Peticions d'Incidència\r\n\r\nPeticions relacionades amb errors detectats dintre d'algun component del Framework. Aquests errors poden ser deguts a un ús incorrecte dels components del Framework. Per tal motiu es recomana llegir la documentació del Framework disponible en el portali en cas de dubte, obrir una petició de Consulta.\r\n\r\n#### Peticions de Suport\r\n\r\nPeticions que sol- liciten que el Centre de Suport de Canigó faci un seguiment més proper de l'aplicació per tal de resoldre algun problema específic o bé acompanyar i assessorar a l'aplicació en el transcurs d'un desenvolupament especial amb Canigó.\r\n\r\n\r\n### Dades de les Peticions\r\n\r\nInicialment s'han d'informar una sèrie de dades en el moment de la creació de la petició. Aquestes dades tot i que no siguin obligatòries per tal de crear la petició en el JIRA si ho són de cara a la resolució d'aquesta.\r\nLa carència d'aquestes dades allarga la resolució de la petició en molts casos i és per aquest motiu que es molt recomanable que s'omplin.\r\n\r\nLes peticions de canvi, incidència i consulta tenen les mateixes dades inicials per poder omplir-se. Comentarem aquelles que no són obligatòries i que es molt recomanable omplir per tal de facilitar la seva resolució per part del Centre de Suport.\r\n\r\n - Sumari: Breu descripció del motiu de la petició.\r\n - Urgència: Urgència que l'implica a l'aplicació la resolució de la petició.\r\n - Àmbit: Indica l'entorn on s'està produint el motiu de la petició si aplica.\r\n - Organisme / Projecte Afectat: Organisme i projecte al qual pertany l'aplicació que està obrint la petició.\r\n - Versions afectades: Informa la versió de Canigó que s'està utilitzant si aplica.\r\n - Components: Informa dels components del Framework afectats pel motiu de la petició si aplica.\r\n - Informador: Persona que informa la petició.\r\n - Descripció: Descripció detallada del motiu de la petició.\r\n - Adjunció: Dona la posibilitat d'afegir arxius adjunts a la petició en el moment de la seva creció.\r\n - Telèfon: Telèfon de contacte amb la persona/es responsables de l'aplicació o creadors de la petició.\r\n - Nivell de bloqueig: Grau de bloqueig que la petició provoca en les tasques a desenvolupar dintre de l'aplicació.\r\n - Servidor d'aplicacions: Servidor d'aplicacions que s'està utilitzant per desplegar l'aplicació si aplica.\r\n - JDK: Versió del Java Development Kit que s'està utilitzant per compilar l'aplicació si aplica.","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9vYmVydHVyYS1wZXRpY2lvbnM="},"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9wcm9jZWRpbWVudHMtcHJvdG9jb2xz":{"date":1422115902000,"title":"Procediments i protocols en la gestió d'activitats (incidències, consultes i peticions de canvis)","description":"","sections":"Centre de Suport","weight":1,"path":"/centre-de-suport-related/procediments-protocols","content":"### Pel que fa a l'espai de suport (incidències, consultes i peticions de canvi).\r\n\r\nEn els següents pàgines s'expliquen diferents qüestions de l'espai de suport (incidències, consultes i peticions de canvis).\r\n\r\n - [Estats i workflow de l'espai de suport.] (/centre-de-suport-related/estat-workflow espai suport)\r\n - [Millores en l'espai de suport.] (/centre-de-suport-related/millores-espai-suport)\r\n \r\n### Procediment per classificar un canvi.\r\n\r\nAquí podrà consultar els procediments que es segueixen per classificar i atendre les peticions de canvis: [Procediment de Canvis] ()\r\n\r\n### Procediment per classificar una incidència.\r\n\r\nEn primera instància es tenen en compte el següents paràmetres: <b>àmbit, bloqueig i risc del projecte</b>. D'aquests paràmetres, i consultant unes taules, s'extreu <b>l'impacte del projecte</b>.\r\nEn segona instància es consideren dos paràmetres més: <b>l'impacte del projecte</b> (obtingut al pas anterior) i la <b>urgència de la incidència</b>, d'aquests dos paràmetres, i de nou consultant una altra taula, s'extreu la <b>prioritat de la incidència</b>.\r\n\r\n### Acord de nivell de servei i procediments.\r\n\r\nEl nivell de servei de l'Oficina Tècnica de Canigó considera la prioritat de la incidència per establir uns temps de resposta tant per part de l'OT com per part de l'usuari reportador de la incidència. Es considera, doncs, la següent taula:\r\n\r\n<b>Acords de nivell de servei (en hores)</b>\r\n\r\nPrioritat de la incidència | T0 | T1 | T2\r\n----|----|----|----\r\nMàxima|2|8|4\r\nAlta|2|16|8\r\nMitja|16|24|16\r\nBaixa|16|24|24\r\n\r\nPrioritat de les consultes | T0 | T1 | T2\r\n----|----|----|----\r\nNormal|16|24|24\r\n\r\nOn T0 és el temps màxim que pot transcorre des que es genera una activitat fins que es classifica i s'assigna a una persona de l'equip de l'OT, T1 és el temps màxim que pot transcorre per resoldre l'activitat i T2 és el temps màxim que pot transcorre pel tancament, per part del reportador, de l'activitat.\r\n\r\nPer tant, si una activitat RESOLTA no es tanca en el temps previst, aquesta es tancarà per <b>\"Defecte de forma\"</b>, doncs, implica que l'equip de l'OT ha donat una solució temporal a l'activitat reportada i que la persona reportadora de l'activitat no ha comentat res al respecte; s'entèn, doncs, que la resposta donada ha estat satisfactòria.\r\n\r\nAddicionalment, l'Oficina Tècnica de Canigó podrà tancar activitats reportades per:\r\n\r\n - \"<b>Fora d'àmbit.</b>\"Independentment de l'estat en que es trobi l'activitat, es considera que l'assumpte tractat en l'activitat no és de la competència de l'Oficina Tècnica de Canigó.\r\n - \"<b>Desconeixement del Framework</b>\".Independentment de l'estat en què es trobi l'activitat, es considera que el reportador de l'activitat demostra un desconeixement del framework Canigó, en aquests casos, s'acostumarà a redirigir a l'usuari reportador al Portal de Canigó a l'apartat de [documentació] (/canigo-documentacio).","objectID":"L2NlbnRyZS1kZS1zdXBvcnQtcmVsYXRlZC9wcm9jZWRpbWVudHMtcHJvdG9jb2xz"},"L2Nsb3VkL2Fx":{"date":1462924800000,"title":"Arquitectures tipus","description":"Exemples d'arquitectures","sections":"Container Cloud","weight":3,"toc":true,"categories":["cloud","docker","container","paas"],"path":"/cloud/aq","content":"## Introducció\r\n\r\n### Docker-compose\r\n\r\nEls diferents stacks tecnològics descrits en aquesta plana utilitzen [docker-compose](https://docs.docker.com/compose/).\r\n\r\n#### Desplegament en entorns de desenvolupament\r\n\r\nCal haver [instal·lat](https://docs.docker.com/compose/install/) prèviament docker-compose.\r\n\r\n#### Desplegament a Bluemix\r\n\r\n- Bluemix suporta la creació d'aplicacions multicontainer mitjançant [docker-compose](https://new-console.ng.bluemix.net/docs/containers/container_creating_ov.html#container_compose_ov)\r\n- A diferència que els grup de contenidors, si es vol escalar una de les capes (per exemple, la capa d'aplicació), cal aprovisionar un balancejador, en aquest cas es proposa HAProxy.\r\n- A Bluemix, és necessari configurar un procés d'espera entre els contenidors que tinguin relacions entre ells (per exemple l'aplicació ha d'esperar que la bbdd estigui operativa per a funcionar). Per a realitzar aquesta espera s'utiliza el procés wait-for-it.sh. Un exemple del seu ús es pot veure al [Stack “arquitectura moderna” JEE]({{< relref \"#stack-arquitectura-moderna-jee\" >}})\r\n- En un futur proper serà possible desplegar aplicacions en contenidors definides amb docker-compose a Bluemix mitjançant el [SIC](http://canigo.ctti.gencat.cat/sic/).\r\n\r\n## Stack \"tradicional\" JEE\r\n\r\n![Spring](/related/cloud/spring.png \"Spring\") ![JSF](/related/cloud/jsf.jpg \"JSF\")\r\n\r\nAplicació JSF (Java Server Faces) amb context \"/AppJava\" per separació contingut estàtic i dinàmic.\r\n\r\n<div class=\"message warning\">\r\n<b>Avís</b>\r\n<br>\r\nAquest és un stack que ja no s'hauria d'utilitzar per noves aplicacions.\r\n</div>\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencatcloud/demo-JEE-AppJava).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencatcloud/demo-JEE-AppJava.git demo-JEE-AppJava\r\n$ cd demo-JEE-AppJava\r\n$ mvn package\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d\r\n```\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-JEE-AppJava/src/main/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\ngicar:\r\n build: ./gicarAppJava/\r\n links:\r\n  - demo\r\n ports:\r\n  - 80:80\r\n environment:\r\n  PS_IP: 169.50.103.27\r\n  AgentConfigDocker: a6-demoFORM\r\n  ContainerHostName: [nom del contenidor]\r\n  AGENTNAME: a6-demoform,[nom de domini.gencat.cat]\r\n  HCOGICAR: a6\r\n  GICARUSER: registre\r\n  GICARPWD: registre\r\n  APPSERVER_PORT_8080_TCP_ADDR: demo\r\n  APPSERVER_PORT_8080_TCP_PORT: 8080 \r\n  context: canigoJSF\r\n volumes:\r\n  - /home/canigo/demo-JEE-AppJava/target/canigoJSF-static:/var/www/html/canigoJSF\r\ndb:\r\n  build: ./bbdd/\r\n  ports:\r\n    - 3306:3306\r\n  environment:\r\n    MYSQL_USER : user\r\n    MYSQL_PASSWORD : password\r\n    MYSQL_ROOT_PASSWORD: root\r\n    MYSQL_DATABASE: demo\r\n  volumes:\r\n   - /home/canigo/demo-JEE-AppJava/mysql-datadir:/var/lib/mysql\r\ndemo:\r\n  build: ./app/\r\n  links:\r\n    - db:mybbdd\r\n  volumes:\r\n   - /home/canigo/demo-JEE-AppJava/target/canigoJSF-dynamic:/opt/tomcat/webapps/canigoJSF\r\n  ports:\r\n   - 8080:8080\r\n   - 8000:8000\r\n```\r\nEls paths \"/home/canigo/...\" han d'adaptar-se als locals.\r\n\r\n- _canigoJSF-static_: directori amb el contingut estàtic de l'aplicació\r\n- _canigoJSF-dynamic_: directori amb el contingut dinàmic de l'aplicació\r\n- _mysql-datadir_: directori amb les dades del MySQL. Es crearà amb tot el contingut en iniciar per primera vegada l'aplicació\r\n\r\n<div class=\"message information\">\r\n<b>Informació</b>\r\n<br>\r\nEl valor \"nom del contenidor\" i el \"nom de domini\" els tria l'usuari. Per exemple:<br><br>\r\n<i>ContainerHostName</i>: dev<br>\r\n<i>AGENTNAME</i>: a6-demoform, provademo.gencat.cat<br><br>\r\nEn cas de voler accedir per domini en comptes de localhost, s'ha de mappejar aquest domini/ip al fitxer host\r\n(En linux /etc/host, en Windows C:\\Windows\\System32\\drivers\\etc\\hosts)\r\n</div>\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir des d'un navegador web a http://localhost/canigoJSF i introduïr l'usuari \"NIFDEMO\" i contrasenya \"12345678\". Els contenidors triguen a aixecar-se entre 30s i 60s, i per tant, cal esperar a realitzar l'accés aquest temps ja que en cas contrari l'aplicació no respondrà.\r\n\r\n## Stack \"arquitectura moderna\" JEE\r\n\r\n![Spring](/related/cloud/springboot.png \"Spring Boot\") ![Resftul API](/related/cloud/resftulapi.jpg \"Resftul API\") ![HTML5 JS CSS](/related/cloud/htmljscss.png \"HTML5 JS CSS\")\r\n\r\nAplicació basada en serveis REST i presentació desacoblada\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencatcloud/demo-JEE-REST).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencatcloud/demo-JEE-REST.git demo-JEE-REST\r\n$ cd demo-JEE-REST\r\n$ mvn package\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d\r\n```\r\n\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-JEE-REST/src/main/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\nlb:\r\n image: gencatcloud/haproxy:1.5.1\r\n links:\r\n  - bookstore\r\n ports:\r\n  - 80:80\r\ndb:\r\n  image: gencatcloud/postgres:9.5.3\r\n  ports:\r\n    - 5432:5432\r\n  environment:\r\n    POSTGRES_USER: demospringboot\r\n    POSTGRES_PASSWORD: password\r\n  volumes:\r\n    - /home/canigo/demo-JEE-REST/postgres-datadir:/var/lib/postgresql/data\r\nbookstore:\r\n  build: ./app/\r\n  links:\r\n    - db:postgres\r\n  volumes:\r\n   - /home/canigo/demo-JEE-REST/target/:/tmp\r\n  ports:\r\n    - 8080:8080\r\n    - 8000:8000\r\n  command: bash -c \"/wait-for-it.sh postgres:5432 -t 240 && /entrypoint.sh\"\r\n```\r\n\r\nEl paths “/home/canigo/…” han d’adaptar-se als locals.\r\n\r\n- /home/canigo/demo-JEE-REST/target/: directori on es troba el war de l'aplicació\r\n- /home/canigo/demo-JEE-REST/postgres-datadir: directori amb les dades del Postgres. Es crearà amb tot el contingut en iniciar per primera vegada l'aplicació.\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./src/main/docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir des d'un navegador web a http://localhost/ i introduïr l'usuari \"admin\" i contrasenya \"admin\". Els contenidors triguen a aixecar-se entre 30s i 60s, i per tant, cal esperar a realitzar l'accés aquest temps ja que en cas contrari s'obtindrà un error \"503 Service Unavailable\".\r\n\r\n## Stack MEAN\r\n\r\n![MEAN](/related/cloud/stack_mean.png \"MEAN\")\r\n\r\nAplicació basada en MongoDB+Express+AngularJS+NodeJS\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencatcloud/demo-MEAN).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencatcloud/demo-MEAN.git demo-MEAN\r\n$ cd demo-MEAN\r\n$ docker-compose -f ./docker/docker-compose.yml up -d\r\n```\r\n\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-MEAN/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\ndb:\r\n  image: gencatcloud/mongodb:3.2\r\n  ports:\r\n    - 27017:27017\r\n    - 28017:28017\r\n  environment:\r\n    MONGODB_USER : user\r\n    MONGODB_PASS : password\r\n    MONGODB_DATABASE : contactlist\r\n  volumes:\r\n    - /home/canigo/demo-MEAN/datadir:/data/db\r\ndemo:\r\n  image: gencatcloud/nodejs:4.2.6\r\n  links:\r\n    - db:mybbdd\r\n  volumes:\r\n   - /home/canigo/demo-MEAN:/app\r\n  ports:\r\n   - 3000:3000\r\n  command: bash -c \"cd /app && npm install && node server\"\r\n```\r\n\r\nEl paths “/home/canigo/…” han d’adaptar-se als locals.\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir a http://localhost:3000/.\r\n\r\n## Stack LAMP \r\n\r\n![LAMP](/related/cloud/lamp.gif \"LAMP\")\r\n\r\nAplicació basada en Linux+PHP+MySQL\r\n\r\nPodeu trobar el codi font d'aquesta demo a [Github](https://github.com/gencatcloud/demo-LAMP).\r\n\r\nComandes per iniciar l'aplicació:\r\n\r\n```\r\n$ git clone https://github.com/gencatcloud/demo-LAMP.git demo-LAMP\r\n$ cd demo-LAMP\r\n$ docker-compose -f ./docker/docker-compose.yml up -d\r\n```\r\n\r\nAbans d'executar la última comanda és necessari modificar el fitxer \"docker-compose.yml\" ubicat al directori \"demo-LAMP/docker\":\r\n\r\n_docker-compose.yml_\r\n```\r\ndb:\r\n  build: ./bbdd/\r\n  ports:\r\n    - 3306:3306\r\n  environment:\r\n    MYSQL_USER : user\r\n    MYSQL_PASSWORD : password\r\n    MYSQL_ROOT_PASSWORD: root\r\n    MYSQL_DATABASE: demo\r\n  volumes:\r\n   - /home/canigo/demo-LAMP/mysql-datadir:/var/lib/mysql\r\ndemo:\r\n  build: ./app/\r\n  links:\r\n    - db:mybbdd\r\n  volumes:\r\n   - /home/canigo/demo-LAMP:/var/www/html/demo-LAMP\r\n  ports:\r\n   - 80:80\r\n```\r\n\r\nEl paths “/home/canigo/…” han d’adaptar-se als locals.\r\n\r\nEn cas de voler reconstruir les imatges, cal afegir la opció \"--build\" a la comanda \"docker-compose up\":\r\n\r\n```\r\n$ docker-compose -f ./docker/docker-compose.yml up -d --build\r\n```\r\n\r\nAccedir a http://localhost/demo-LAMP/.\r\n\r\n## Altres\r\n\r\nA més de contenidors Docker, també és possible utilitzar xPaaS i DBaaS. Aquests són alguns casos d'èxit:\r\n\r\n### xPaaS + DBaaS\r\n\r\n- Exemple d'aplicació: http://serveisoberts.gencat.cat\r\n- Desplegat a Bluemix\r\n- Composat per:\r\n\t- Buildpack: NodeJS, amb **escalat automàtic**\r\n\t- DBaaS: MongoDB\r\n\r\n### Docker aplicació + Docker base de dades\r\n\r\n- Exemple d'aplicació: https://jocdelsdrets.gencat.cat\r\n- Desplegat a Bluemix\r\n- Composat per:\r\n\t- Grup de contenidors Docker per a la capa d'aplicació, amb **escalat automàtic**\r\n\t- Contenidor MySQL per a la capa de base de dades\r\n","objectID":"L2Nsb3VkL2Fx"},"L2Nsb3VkL2NhYXM=":{"date":1462924800000,"title":"Plataformes cloud de referència","description":"Bluemix, OpenShift, Azure, ...","sections":"Container Cloud","weight":2,"categories":["cloud","docker","container","paas"],"path":"/cloud/caas","content":"## Cloud Públic\r\n\r\n* **Bluemix**\r\n\t- http://bluemix.net, basat en cloud foundry\r\n\t- Concepte xPaaS: buildpack/runtime, https://console.ng.bluemix.net/docs/cfapps/runtimes.html\r\n\t- Contenidors: Docker, Docker-compose\r\n\t- DBaaS: ElasticSearch, MongoDB <br /><br />\r\n\r\n* **Azure**\r\n\t- http://azure.net\r\n\t- xPaaS: websites/appservice, principalment les .Net\r\n\t- DBaaS: SQLDatabase\r\n\r\n## Cloud Privat\r\n\r\n* **Openshift**\r\n\r\n\t- https://www.openshift.com/enterprise/\r\n\t- xPaaS: runtimes preparats per a fer córrer aplicacions https://www.openshift.com/features/cartridges.html\r\n\t- Contenidors: Docker i orquestració basada en Kubernetes\r\n\r\n","objectID":"L2Nsb3VkL2NhYXM="},"L2Nsb3VkL2NhdGFsZWc=":{"date":1462924800000,"title":"Elements del catàleg","description":"Docker, xPaaS, DBaaS","sections":"Container Cloud","weight":1,"toc":true,"categories":["cloud","docker","container","paas"],"path":"/cloud/cataleg","content":"L'objectiu del \"Container Cloud\" - anomenarem així a les solucions basades en containers (CaaS, Containers as a Service) a cloud públic i privat - , es disposar d'una sèrie d'elements que ens permetin fer córrer el nostre software sobre entorns d'execució \"commodity\", sense conèixer la infraestructura subjacent.\n\nEn aquest sentit, treballarem amb dos elements principals - xPaaS i Docker - i amb altres solucions com a servei -com algunes bases de dades-:\n\n## **xPaaS**\n\nEls xPaaS són runtimes d'execució estàndards i, segons el \"gust\" sobre el que treballem, tindrà denominacions diferents. Anomenarem a tots d'aquesta manera per a unificar conceptes. Actualment, els nostres xPaaS es basaran en Cloud Foundry i OpenShift: \n\n\n- **buildpack** (Cloud Foundry), disponible a **cloud públic**\n\t* Liberty for Java\n\t* Node.js\n\t* Go\n\t* PHP\n\t* Python\n\t* Ruby\n\t* Static site (Nginx)\n\n<br />\n\n- **xpaas** (OpenShift), disponible a **cloud privat**\n\t* Tomcat (7, 8)\n\t* Node.js\n\t* Go\n\t* PHP\n\t* Python\n\t* Ruby\n\nLes denominacions en altres clouds són:\n\n- elastic beanstalk (Amazon Web Services)\n- appservice (Azure)\n- appengine (Google)\n\nEn aquests xPaaS, quan es fa un \"push\" del codi o de l'artefacte, s'aixeca un entorn d'execució amb una potència i nombre d'instàncies prefixades.\n\n\n### Configuració de l'engine\n\nCada xPaaS dona suport a diferents versions de l'engine que ha d'executar el codi. Posem com a exemple el [buildpack Node.js de Cloud Foundry](https://github.com/cloudfoundry/nodejs-buildpack). Per tal de configurar la versió 4.x de l'engine de Node.js corresponent a la versió actual CTTI del [full de ruta](https://portic.ctti.gencat.cat/les_tic/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf#search=full%20de%20ruta), cal fer la següent configuració en el fitxer \"package.json\" ubicat a l'arrel de l'aplicació:\n\n_package.json_\n\n```\n{\n\tname: \"AppDemoNodeJS\",\n\tversion: \"0.0.1\",\n\tprivate: true,\n\tscripts: {\n\t\tstart: \"node app.js\",\n\t\ttest: \"make test\"\n\t},\n\tengines: {\n\t\tnode: \"4.6.0\"\n\t},\n\tdependencies: {\n\t\texpress: \"^4.13.3\",\n\t\t...\n\t},\n\tdevDependencies: {\n\t\tmocha: \"^2.4.5\",\n\t\t...\n\t}\n}\n```\n\nCom es pot observar, en la secció engines cal especificar la versió exacte de Node.js amb que volem que s'executi l'aplicació. En cas que no s'especifiqui, el buildpack executarà la versió per defecte que tingui establerta. En el cas del buildpack Node.js de Cloud Foundry coincideix amb la versió que hem indicat en el descriptor \"package.json\" de l'aplicació:\n\n_manifest.yml_ (veure a [Github](https://github.com/cloudfoundry/nodejs-buildpack/blob/master/manifest.yml))\n\n```\nlanguage: nodejs\ndefault_versions:\n- name: node\n  version: 4.6.0\n...\n```\n\n## **Contenidors (Docker)**\n\nEn quant als contenidors Docker, inicialment, aliniarem les versions del software del Full de Ruta de Programari amb les versions dels contenidors certificats per CTTI. Podeu trobar aquestes imatges certificades a [DockerHub](https://hub.docker.com/r/gencatcloud/).\n\n\n**Element**  | **Versió actual CTTI** | **Docker**\n------------ | ----------------------- | ---------\nApache \t\t | 2.2                     | https://hub.docker.com/r/gencatcloud/httpd/\nApache-GICAR | 1.0 (basada en Apache 2.2)                       | https://hub.docker.com/r/gencatcloud/gicar/\nHaProxy\t\t | 1.5.1                   | https://hub.docker.com/r/gencatcloud/haproxy/\nJava\t\t| 7\t\t|\thttps://hub.docker.com/r/gencatcloud/java/\nMySql \t\t | 5.7                     | https://hub.docker.com/r/gencatcloud/mysql/\nNodeJS \t\t | 4.2.6                     | https://hub.docker.com/r/gencatcloud/nodejs/\nPHP \t\t | 5.3.29                   | https://hub.docker.com/r/gencatcloud/php/\nPostgres\t | 9.5.3\t                   | https://hub.docker.com/r/gencatcloud/postgres/\nTomcat  \t | 7                     | https://hub.docker.com/r/gencatcloud/tomcat/\n\nLa llista anterior no exclou que no es puguin lliurar contenidors que corrin altres productes i personalitzacions. En qualsevol cas, les imatges construïdes passaran per un servei d'avaluació de vulnerabilitats per a garantir en una primera instància la qualitat de les mateixes.\n\nMés informació sobre Docker: https://www.docker.com/\n\n## SaaS\n\n### DBaaS - Base de dades com a servei\n\n- MongoDB, disponible a **cloud públic**\n- ElasticSearch, disponible a **cloud públic** de l","objectID":"L2Nsb3VkL2NhdGFsZWc="},"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXNmdHA=":{"date":1427960649000,"title":"SFTP","description":"Transferència d'arxius de manera segura.","sections":"Canigó. Documentació versió 3.x","weight":4,"path":"/canigo-documentacio-versions-3x-suport/modul-sftp","content":"## Propòsit\r\n\r\nEl servei de SFTP de Canigó permet enviar i rebre arxius entre el servidor on s'executa l'aplicació a altres servidors de forma segura mitjançant l'intercanvi de claus.\r\n\r\nEl servei està basat en les llibreries JSCH i Commons-VFS, la primera es tracta d'un projecte open source que permet la connexió via SSH a qualsevol màquina. La segona llibrería és un projecte també open_source de la Apache Foundation que permet treballar amb més facilitat amb la JSCH, donant eines per crear connexions SFTP (entre d'altres) contra un servidor.\r\n\r\n## Documents i Fonts de Referència\r\n\r\nNom         | URL\r\n----------- | ------------------------------------\r\nJSCH        | [http://www.jcraft.com/jsch/](http://www.jcraft.com/jsch/)\r\nCommons VFS | [http://commons.apache.org/vfs/](http://commons.apache.org/vfs/)\r\n\r\n## Glossari\r\n\r\n**SFTP**  \r\nSecure File Transfer Protocol (Protocol de Transferència Segura d'Arxius), es tracta d'un protocol de transferència de fitxers entre computadors de forma segura.\r\n\r\n**Download**  \r\nRebre arxius des d'un servidor.\r\n\r\n**Upload**  \r\nEnviar arxius a un servidor.\r\n\r\n**Socket**  \r\nPort del servidor habilitat per realitzar la transferència de fitxers/streams mitjançant el protocol SFTP.  \r\n\r\n## Instal.lació i Configuració\r\n\r\n### Instal.lació\r\n\r\nPer tal d'instal-lar el mòdul d'SFTP es pot incloure automàticament a través de l'eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l'aplicació la següent dependència:\r\n\r\n```\r\n<canigo.support.sftp.version>[1.1.0,1.2.0)</canigo.support.sftp.version>\r\n\r\n<dependency>\r\n\t<groupId>cat.gencat.ctti</groupId>\r\n\t<artifactId>canigo.support.sftp</artifactId>\r\n\t<version>${canigo.support.sftp.version}</version>\r\n</dependency>\r\n```\r\n\r\n### Configuració\r\n\r\nLa configuració es realitza automàticament a partir de la eina de suport al desenvolupament.\r\n\r\nL'eina de desenvolupament genera automàticament el fitxer de propietats necessari per a la configuració del servei.\r\n\r\nUbicació proposada: <PROJECT_ROOT>/src/main/resources/config/props/sftp.properties\r\n\r\nPropietat |\tRequerit | Descripció\r\n--------- | -------- | ----------\r\n*.sftp.url |Sí | Host del servidor sftp.\r\n*.sftp.port | No | Port del servidor sftp. Valor per defecte: 22.\r\n*.sftp.username | No | Usuari de connexió al servidor de secure ftp (sftp).\r\n*.sftp.password | No | Password de l'usuari de connexió.\r\n*.sftp.identityPath | No | Path del fitxer de claus privades. El fitxer ha de tenir format OpenSSH (RSA o DSA).\r\n*.sftp.strictHostKeyChecking | No | Indica si volem intercanviar claus amb el servidor o no. Valor per defecte: no.\r\n*.sftp.knownHosts | No | Directori on es troba el fitxer de claus SSH.\r\n*.sftp.proxyType  | No | Tipus de proxy.\r\n*.sftp.proxyHost  | No | Adreça del proxy.\r\n*.sftp.proxyPort  | No | Port del proxy. Valor per defecte: 8080.\r\n*.sftp.userDirIsRoot | No | Possibilitat d'indicar els paths relatius al directori home de l'usuari.<br>true --> Paths relatius a partir del directori home<br>false --> Paths absoluts. Valor per defecte.\r\n*.sftp.uploadChecksum | No | Ofereix la possibilitat de generar i pujar un fitxer de checksum.<br>default --> Generarà i farà l'upload d'un fitxer .md5 a més del fitxer indicat.<br>all --> Generarà i farà l'upload d'un fitxer .md5, .sha1 a més del fitxer indicat.<br>md5 --> Generarà i farà l'upload d'un fitxer .md5 a més del fitxer indicat.<br>sha1 --> Generarà i farà l'upload d'un fitxer .sha1 a més del fitxer indicat.<br>none --> No generarà cap fitxer de checksum. El mateix que si no s'informa aquesta propietat.\r\n*.sftp.uploadChecksumException | No | Serveix per a indicar si un error de checksum és bloquejant o no.<br>true --> Si es produeix un error al generar el fitxer de checksum, es llançarà una excepció i no es pujarà el fitxer al servidor.<br>false --> Si es produeix un error al generar el fitxer de checksum, es mostrarà un log d'error, però continuarà la pujada del fitxer indicat al servidor.\r\n*.sftp.downloadChecksum | No | Ofereix la possibilitat de generar i pujar un fitxer de checksum.<br>default --> Validarà que el fitxer descarregat és correcte mitjançant el fitxer .md5.<br>md5 --> Validarà que el fitxer descarregat és correcte mitjançant el fitxer .md5.<br>sha1 --> Validarà que el fitxer descarregat és correcte mitjançant el fitxer .sha1.<br>none --> No realitzarà cap tipus de validació sobre el fitxer descarregat\r\n*.sftp.downloadChecksumValidation | No | Serveix per a indicar el nivell de bloqueig del checksum.<br>exception --> Si no coincideix el checksum generat del fitxer descarregat amb el que hi ha al servidor es llançarà una excepció.<br>log --> Si no coincideix el checksum generat del fitxer descarregat amb el que hi ha al servidor mostrarà un log d'error.<br>none --> Si no coincideix el checksum generat del fitxer descarregat amb el que hi ha al servidor no farà res..\r\n\r\nEls arxius de configuració que contenen els beans del mòdul i que serán carregats per Spring, son automàticament registrats pel core de Canigó, per lo que el desenvolupador no ha de definir cap arxiu XML per aixecar el servei.\r\n\r\n### Utilització del Mòdul\r\n\r\nPer accedir al mòdul de SFTP, el desenvolupador pot realitzar una crida de forma externa mitjançant el patró 'Dependency Injection'.\r\n\r\nPodem diferenciar dues formes d'injectar-ho:\r\n\r\n* Per XML:\r\n\r\n```\r\n<bean id=\"tractamentClients\"  class=\"cat.gencat.demo.mbean.TractamentClient\">\r\n    <property name=\"sftpService\" ref=\"sftpService\" />\r\n</bean>\r\n```\r\n\r\nLa clase TractamentClient tindria la següent estructura:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.support.sftp.SftpService;\r\npublic class TractamentClient{\r\n   private SftpService sftpService;\r\n\r\n   public void setSftpService(SftpService service){\r\n       this.sftpService = service;\r\n   }\r\n\r\n   public void execute(){\r\n       sftpService.login();\r\n   }\r\n}\r\n```\r\n\r\nInjecció del mòdul de configuració dins del bean \"tractamentClients\". Spring s'encarregarà d'injectar el mòdul de SFTP executant el mètode setSftpService.\r\n\r\n* Per anotacions:\r\n\r\n```java\r\nimport cat.gencat.ctti.canigo.arch.support.sftp.SftpService;\r\n\r\n@Component(\"tractamentClients\")\r\npublic class TractamentClient{\r\n   @Autowired\r\n   private SftpService sftpService;\r\n\r\n   public void execute(){\r\n       sftpService.login();\r\n   }\r\n}\r\n```\r\n\r\n#### Realitzar connexió\r\n\r\nTenim diferents maneres de realitzar la connexió:\r\n\r\n* Els paràmetres de connexió venen informats a l'arxiu de propietats. El mòdul de SFTP farà servir aquestes propietats per gestionar la connexió al servidor.\r\n\r\n```java\r\nsftpService.login();\r\n```\r\n\r\n\r\n* Si no hem indicat a través de la configuració l'usuari i la contrasenya per realitzar la connexió, s'indicarà manualment en al crida.\r\n\r\n```java\r\nsftpService.login(usuari,contrasenya);\r\n```\r\n\r\n* Servidor, usuari, contrasenya i port no informat.\r\n\r\n```java\r\nsftpService.login(usuari, contrasenya, ftpUrl, ftpPort);\r\n```\r\n\r\nPer realitzar una connexió al servidor a través d'un proxy cal informar les següents propietats a l'arxiu de configuració del mòdul:  \r\n \r\n* sftp.proxyType: Tipus de proxy, pot tenir els valors http o socks.\r\n* sftp.proxyHost: Adreça del host.\r\n* sftp.proxyPort: Port del host.\r\n\r\n\r\n#### Realitzar desconnexió del servidor SFTP\r\n\r\nPer realitzar la desconnexió del servidor FTP seguirem un patró com el mostrat en el següent exemple:\r\n\r\n1. Validem que estem conectats.\r\n2. Desconectem en el cas de estar logats al servidor.\r\n\r\n```java\r\nif (sftpService.isLogged()) {\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\n\r\n#### Realitzar download d'un fitxer\r\n\r\nPer realitzar un download d'un fitxer seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    sftpService.downloadFile(fileName, localPath, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode downloadFile() per realitzar el download del fitxer del servidor remot.\r\n3. Realitzar la desconnexió del servidor SFTP.\r\n\r\nEs crida el mètode downloadFile() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | ------------------------------------------------------------------\r\n1     | Si       | String | Nom del fitxer del servidor remot que es vol realitzar el download.\r\n2     | Si       | String | Directori local on es vol guardar el fitxer.\r\n3     | Si       | String | Directori remot on es troba el fitxer a baixar.\r\n\r\nI retorna:\r\n\r\nOrdre | Requerit | Tipus   | Descripció\r\n----- | -------- | ------- | ----------------------------------------------------------------\r\n1     | Si       | boolean | TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n#### Realitzar upload d'un fitxer\r\n\r\nPer realitzar un upload d'un fitxer seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    sftpService.uploadFile(fileName, localPath, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode uploadFile() per realitzar el upload del fitxer del servidor local al servidor remot.\r\n3. Realitzar la desconnexió del servidor SFTP.\r\n\r\nEs crida el mètode uploadFile() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit  | Tipus  | Descripció\r\n----- | --------- | ------ | -----------------------------------------------------------------\r\n1     | Si        | String | Nom del fitxer del servidor remot que es vol realitzar el upload.\r\n2     | Si        | String | Directori local on es troba el fitxer a pujar.\r\n3     | Si        | String | Directori remot on es vol guardar el fitxer.\r\n\r\n#### Obtenir la llista de noms dels fitxers del servidor remot\r\n\r\nPer obtenir la llista de fitxers en una carpeta d'un servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    FileObject[] listFiles = sftpService.listFiles(remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode listFiles() per obtenir una llista de fitxers en una carpeta d'un servidor remot.\r\n\r\nEs crida el mètode listFiles() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | ----------\r\n1     | Sí       | String | Nom de la carpeta del servidor remot d'on es vol obtenir la llista de fitxers.\r\n\r\nEl mètode retorna un array de FileObject, interfícies de la llibrería Commons VFS que ens donen una sèrie de mètodes per a treballar amb els fitxers remots.\r\n\r\n#### Crear un fitxer al servidor remot\r\n\r\nPer crear un fitxer al servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    createFile(fileName, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode createFile() per crear el fitxer en el servidor remot.\r\n\r\nEs crida el mètode createFile() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | -----------\r\n1     | Si       | String | Nom del fitxer a crear en el servidor remot.\r\n2     | Si       | String | Directori remot on es vol crear el fitxer.\r\n\r\nEl mètode retorna un boolean TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n#### Crear un directori al servidor remot\r\n\r\nPer crear un directori al servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    createFolder(folderName, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode createFolder() per crear el fitxer en el servidor remot.\r\n\r\nEs crida el mètode createFolder() que amb els següents paràmetres:\r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | -----------\r\n1     | Si       | String | Nom del directori a crear en el servidor remot.\r\n2     | Si       | String | Directori remot on es vol crear el directori.\r\n\r\nEl mètode retorna un boolean TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n#### Esborrar un fitxer al servidor remot\r\n\r\nPer esborrar un fitxer al servidor remot seguirem un patró com el mostrat en el següent exemple:\r\n\r\n```java\r\nsftpService.login();\r\nif (sftpService.isLogged()) {\r\n    deleteFile(fileName, remotePath);\r\n    sftpService.logout();\r\n}\r\n```\r\n\r\nRealitzarem doncs els següents passos:\r\n\r\n1. Cridem al mètode login() per realitzar la connexió i l'autentificació al servidor remot mitjançant el protocol SFTP.\r\n2. En cas de que la connexió al servidor remot s'hagi realitzat correctament es crida al mètode deleteFile() per crear el fitxer en el servidor remot.\r\n\r\nEs crida el mètode deleteFile() que amb els següents paràmetres: \r\n\r\nOrdre | Requerit | Tipus  | Descripció\r\n----- | -------- | ------ | -----------   \r\n1     | Si       | String | Nom del fitxer a esborrar en el servidor remot.\r\n2     | Si       | String | Directori remot on es troba el fitxer.\r\n\r\nEl mètode retorna un boolean TRUE o FALSE segons s'ha realitzat correcta o incorrectament el procés.\r\n\r\n## Exemples\r\n\r\n### Tests Unitaris\r\n\r\nUn exemple d'utilització del mòdul de SFTP són els tests unitaris.\r\n\r\nS'ha de tenir en compte que s'ha de disposar d'accés a un servidor remot mitjançant el protocol SFTP per poder realitzar els tests.\r\n\r\nSuposem que la configuració del\r\n\r\n```java\r\n/**\r\n * Unit test for mailing service\r\n */\r\n@RunWith(SpringJUnit4ClassRunner.class)\r\n@ContextConfiguration(locations = {\"../../core/config/canigo-core.xml\"})\r\npublic class SftpServiceReleaseTest{\r\n\t// File exchange\r\n\tprivate String fileName\t\t\t\t\t= null;\r\n\tprivate String localPath\t\t\t\t= null;\r\n\tprivate String remotePath\t\t\t\t= null;\r\n\tprivate String tempName \t\t\t\t= null;\r\n\r\n\t@Autowired\r\n\t@Qualifier(\"sftpService\")\r\n\tSftpService sftpService;\r\n\r\n\t@Before\r\n\tpublic void setUp() throws AddressException{\r\n\t\tfileName = \"sftp.properties\";\r\n\t\tremotePath = \"/home/continuum/tmp\";\r\n\t\tlocalPath = this.getClass().getResource(\"/temp/arxiu_pujar.pdf\").getPath();\r\n\t\tlocalPath = localPath.substring(0, (localPath.lastIndexOf(\"/\")+1));\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testLogin() throws Exception {\r\n\t\ttry {\r\n\t\t\tAssert.assertTrue(sftpService.login());\r\n\t\t\tif (sftpService.isLogged()) {\r\n\t\t\t\tsftpService.logout();\r\n\t\t\t}\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testLogout() throws Exception {\r\n\t\ttry {\r\n\t\t\tsftpService.login();\r\n\t\t\tAssert.assertTrue(sftpService.logout());\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testLogoutFailed() throws Exception {\r\n\t\ttry {\r\n\t\t\tAssert.assertFalse(sftpService.logout());\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t* Documentació.\r\n\t*\r\n\t* @throws Exception Documentació\r\n\t*/\r\n\t@Test\r\n\tpublic void testUploadFile() throws Exception {\r\n\t\ttry {\r\n\t\t\tsftpService.login();\r\n\t\t\tif(sftpService.isLogged()) {\r\n                                sftpService.uploadFile(fileName, localPath, remotePath);\r\n\t\t\t        Assert.assertTrue(sftpService.existsFile(fileName, remotePath));\r\n\t\t\t\tsftpService.logout();\r\n\t\t\t}else{\r\n                                Assert.fail();\r\n                        }\r\n\t\t} catch (SftpModuleException e) {\r\n\t\t\tAssert.fail();\r\n\t\t}\r\n\t}\r\n\r\n}\r\n```\r\n","objectID":"L2Nhbmlnby1kb2N1bWVudGFjaW8tdmVyc2lvbnMtM3gtc3Vwb3J0L21vZHVsLXNmdHA="},"L2Nsb3VkL2xpZmVjeWNsZQ==":{"date":1462924800000,"title":"Cicle de vida","description":"Cicle de vida de les aplicacions Cloud containeritzades i xPaas/buildpack","sections":"Container Cloud","weight":3,"categories":[],"path":"/cloud/lifecycle","content":"Gràcies a l'ús del Container Cloud el cicle de vida de les aplicacions pot automatitzar-se de forma fàcil. És aquí on el SIC (Servei d'Integració Continua) té un paper essencial, ja que és l'encarregat de proporcionar els processos per assolir aquesta automatització.\r\n\r\nExpliquem, des d'un inici, quines són les passes que segueix una aplicació fins a arribar a executar-se en el Container Cloud:\r\n\r\n### Definició d'Arquitectura\r\n\r\nÉs en aquesta fase on el proveïdor d'aplicacions, conjuntament amb Integració de Solucions, analitzaran si l'aplicació és susceptible d'anar al Container Cloud. Amb el suport de l'equip d'Administració Cloud i Arquitectura CTTI es prendrà una decisió i es determinarà quin és el cloud destí més apropiat.\r\n\r\n### Alta projecte\r\n\r\nEn aquesta fase s'aprovisionaran els recursos necessaris en el cloud destí i en el SIC per al desplegament de l'aplicació, així com els usuaris d'accés pels proveïdors d'aplicacions per la monitorització de l'aplicació (logs, consum recursos, ...) i el seu desplegament.\r\n\r\n### Construcció i desplegament\r\n\r\nLes aplicacions es construiran i desplegaran sempre des del SIC. Els elements utilitzats per la \"containerització\" de les aplicacions seran els següents:\r\n\r\n#### _xPaaS_\r\n\r\n* Els xPaaS utilitzats seran els buildpacks oficials de CloudFoundry per IBM Bluemix i els xPaaS d'OpenShift per CPD3 Containers. Més informació al [catàleg cloud](http://canigo.ctti.gencat.cat/cloud/cataleg/#xpaas:60ff5dd56c9d5f883640685f4f912b83). \r\n\r\n#### _Contenidors (Docker)_\r\n\r\n* Les imatges utilitzades per les aplicacions han de ser les [oficials de Gencat](http://canigo.ctti.gencat.cat/cloud/cataleg/#contenidors-docker:60ff5dd56c9d5f883640685f4f912b83), o bé extensions d'aquestes. Aquestes imatges han estat certificades per l'equip d'Administració del Cloud. Qualsevol extensió d'aquestes imatges passarà un procés de validació de vulnerabilitats en el procés de construcció al SIC. En cas que l'extensió introdueixi alguna vulnerabilitat l'aplicació no es desplegarà.\r\n\r\nPel que fa als entorns, per defecte existirà un de PROductiu i un altre de PREproductiu. Els desplegaments en aquests entorns es realitzaran seguint l'estratègia de [blue-green deployment](http://martinfowler.com/bliki/BlueGreenDeployment.html).\r\n\r\n  \r\n  \r\n\r\nA continuació mostrem un diagrama on s'il·lustra el flux i els diferents equips que intervenen en el cicle de vida d'una aplicació al Container Cloud:\r\n\r\n![Cicle de Vida Container Cloud](/related/cloud/lifecycle.png)","objectID":"L2Nsb3VkL2xpZmVjeWNsZQ=="},"L2NzL2dpY2Fy":{"date":1465488702000,"title":"Oficina Tècnica de GICAR","description":"Contacte amb l'Oficina Tècnica de GICAR","sections":"","weight":3,"path":"/cs/gicar","content":"De cara a contactar amb l'Oficina Tècnica de GICAR, per a consultes, incidències, o noves integracions, obriu un tiquet a través de:\r\n\r\n\r\n- Via Web: portal d'autoservei https://pautic.gencat.cat.\r\n\r\n- Enviant un correu a [sau.tic@gencat.cat](mailto://sau.tic@gencat.cat) demanant que s'assigni la petició a l'oficina tècnica de GICAR.\r\n\r\n\r\nPer a obtenir més informació sobre com fer peticions d'integració d'aplicacions, formularis, etc, consultar a la següent adreça: https://portic.ctti.gencat.cat/solucions/soltecnologiques/Pagines/Solucions/Sistemes%20d'informaci%C3%B3%20i%20transversals/38-0.aspx","objectID":"L2NzL2dpY2Fy"},"L2NzL2Nsb3Vk":{"date":1465488702000,"title":"Centre de Suport Cloud","description":"Suport al desenvolupament i desplegament d'aplicacions Cloud Públic i Privat basades en contenidors (Docker) i serveis (xPaaS/buildpacks, DBaaS, ...)","draft":false,"weight":2,"path":"/cs/cloud","content":"El **CS de Suport Cloud** donarà resposta a totes aquelles necessitats relacionades amb les solucions de cloud públic i amb el desplegament de solucions basades en tecnologies de containerització (Docker, ...), ja sigui a cloud públic o privat. \r\n\r\n<br />\r\n\r\n- **JIRA**: [http://cstd.ctti.gencat.cat/jiracstd/browse/CLD](http://cstd.ctti.gencat.cat/jiracstd/browse/CLD)\r\n\r\n- **Correu-e**: [suport.cloud@gencat.cat](mailto://suport.cloud@gencat.cat)\r\n\r\n","objectID":"L2NzL2Nsb3Vk"},"L2Rlc3RhY2F0cy9zaWMtdHJhc3Bhcy1zYXU=":{"date":1435622400000,"title":"Traspàs a SAU CTTI","description":"Aquest mes de Juny s'ha començat ha treballar en el traspàs de certes tasques operatives (alta d'usuaris, repositoris al SVN, ...) que realitza l'equip del SIC a SAU CTTI. El traspàs no es farà efectiu fins a l'últim trimestre de l'any.","key":"JULIOL2015","path":"/destacats/sic-traspas-sau","content":"Aquest mes de Juny s'ha començat ha treballar en el traspàs de certes tasques operatives (alta d'usuaris, repositoris al SVN, ...) que realitza l'equip del SIC a SAU CTTI. El traspàs no es farà efectiu fins a l'últim trimestre de l'any.","objectID":"L2Rlc3RhY2F0cy9zaWMtdHJhc3Bhcy1zYXU="},"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1pYmlibGlvLW5vdQ==":{"date":1450396800000,"title":"Canvi de domini del repositori ibiblio a Maven","description":"","sections":"Canigó","path":"/destacats-related/domini-ibiblio-nou","content":"Recentment el repositori Maven d'*ibiblio* ha canviat de domini. Per tal que les aplicacions Canigó que accedeixen a aquest repositori puguin continuar resolent les dependències en aquest, caldrà actualitar-ne la referència.\r\n\r\nLa manera més fàcil de fer-ho sense modificar codi de l'aplicació és mitjançant el fitxer de configuració \"settings.xml\" de la instal·lació de Maven. S'ha d'afegir un mirror al nou domini:\r\n\r\n```\r\n<mirrors>\r\n   \t<mirror>\r\n\t\t<id>repoibiblio</id>\r\n\t\t<name>Repositori ibiblio</name>\r\n\t\t<url>http://maven.ibiblio.org/maven2/</url>\r\n\t\t<mirrorOf>ibiblio</mirrorOf>\r\n\t</mirror>\r\n</mirrors>\r\n\r\n```","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1pYmlibGlvLW5vdQ=="},"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1ub3U=":{"date":1430092800000,"title":"Nou domini per repositoris Maven","description":"","sections":"Canigó","path":"/destacats-related/domini-nou","content":"Es recomana que les aplicacions Caniǵo accedeixin als repositoris Maven de Canigó utilitzant el nou domini \"repos.canigo.ctti.gencat.cat\".\r\n\r\nLa manera més fàcil de fer-ho sense modificar codi de l'aplicació és mitjançant el fitxer de configuració \"settings.xml\" de la instal·lació de Maven. S'ha d'afegir un mirror al nou domini:\r\n\r\n```\r\n<mirrors>\r\n    <mirror>\r\n      <id>repocanigo</id>\r\n      <name>Repositori Canigo</name>\r\n      <url>http://repos.canigo.ctti.gencat.cat/repository/maven2</url>\r\n      <!-- id del repositori Canigo definit a l'aplicació: http://canigo.ctti.gencat.cat/repository/maven2 -->\r\n      <mirrorOf>canigo</mirrorOf>\r\n    </mirror>\r\n  </mirrors>\r\n\r\n```","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL2RvbWluaS1ub3U="},"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdmEtdmVyc2lvLXBpY2E=":{"date":1453939200000,"title":"Nova versió connector canigó PICA DNI","description":"","sections":"Canigó","key":"FEBRER2016","path":"/destacats-related/nova-versio-pica","content":"S'han publicat les versions 1.1.0 de canigo-connectors-pica-dni per a canigó 2 i 1.2.0 de canigo.integration.dni.pica per a canigó 3.\r\n\r\nAmb els nous canvis per a realitzar una consulta de DNI s'ha d'informar el primer cognom o l'any de naixement de la persona que es cerca, juntament amb els actuals camps obligatoris de documentació i tipus de documentació.\r\n\r\nPer a més informació podeu consultar la [documentació del connector](/canigo-documentacio-versions-3x-integracio/modul-dni/)","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdmEtdmVyc2lvLXBpY2E="},"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdS1mb3JtYXQtY29tdW5pY2F0cw==":{"date":1432857600000,"title":"Nou format dels comunicats del CS Canigó","description":"Des del mes de Juny de 2015 els comunicats que s'emeten des del CS Canigó tenen una nous estils adaptats als corporatius","sections":"Canigó","path":"/destacats-related/nou-format-comunicats","content":"Des del mes de Juny de 2015 els comunicats del CS Canigó tenen una nous estils adaptats als corporatius. Aquesta és la maqueta per els nous butlletins:\r\n\r\n<CENTER>![maqueta_butlleti](/images/destacats/maqueta_butlleti.png)</center>\r\n\r\nAquesta plantilla ha estat modificada per adaptar-la als tipus de continguts que s'emeten en els comunicats del CS Canigó: temes d'interés, notícies, gràfiques d'activitat i howto's.\r\n\r\nPer qualsevol suggeriment per tal de millorar aquests comunicats ens podeu fer arribar els vostres comentaris a la [Bústia del CS Canigó](mailto:oficina-tecnica.canigo.ctti@gencat.cat).","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL25vdS1mb3JtYXQtY29tdW5pY2F0cw=="},"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtY2FtcHNyZXF1ZXJpdHM=":{"date":1436140800000,"title":"Recordatori: Obligatorietat de camps àmbit i aplicació als serveis de SGDE","description":"","sections":"SGDE","path":"/destacats-related/sgde-campsrequerits","content":"Us recordem que els camps `ambit` i `aplicacio` passaran a ser obligatoris per a totes les versions del WS publicades a la plataforma. El desplegament d'aquest canvi està planificat pel **28/09/2016** a l'entorn de PRE i el **28/11/2016** a l'entorn de PRO. Per tant, **totes les aplicacions hauran d'haver estat adaptades per informar aquests camps i desplegades en el corresponent entorn abans no es faci efectiu el canvi. En cas contrari les crides seran rebutjades**. Destacar que la validació afegida per aquests camps no suposa  regenerar de nou el client del WS, ja que els camps existeixen, només cal informar-los.\r\n","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtY2FtcHNyZXF1ZXJpdHM="},"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtZGVwcmVjYWNpb3Y4":{"date":1436140800000,"title":"Recordatori: Eliminació de la versió v8 del servei d'Eformularis","description":"","sections":"SGDE","path":"/destacats-related/sgde-deprecaciov8","content":"Us recordem que tenim prevista l'eliminació per aquest any 2016 de la versió v8 del WS del servei d'eFormularis. Aquesta és la versió més antiga del WS, la URL de la qual és la següent per als entorns de PRE i PRO respectivament:\r\n\r\n* http://eformularis.pre.intranet.gencat.cat/ServeisInvocacio/services/ServeisAdobe?wsdl\r\n* http://eformularis.intranet.gencat.cat/ServeisInvocacio/services/ServeisAdobe?wsdl\r\n\r\nPreguem que tots els consumidors d'aquesta versió del WS d'eFormularis es posin en contacte amb el CS Canigó enviant-nos un correu a la bústia o bé creant una tasca de Suport al servei STF del JIRA CSTD. En data 15/7 es recopilaran totes les sol·licituds rebudes per ambdós canals i es planificarà conjuntament amb els responsables CTTI de les aplicacions afectades els deadlines per aquesta versió del WS als entorns de PRE i PRO.\r\n","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3NnZGUtZGVwcmVjYWNpb3Y4"},"L2Rlc3RhY2F0cy1yZWxhdGVkL3NpYy1uZXQ=":{"date":1435622400000,"title":".NET al SIC","description":"","sections":"SIC","path":"/destacats-related/sic-net","content":"La integració del llenguatge .NET al SIC s'està realitzant gràcies a l'ús dels diferents slaves Windows que formen part del nou SIC Multi-CPD. Aquests slaves amb SO Windows permeten la compilació de .NET. Per més informació del nou model SIC MUlti-CPD podeu seguir el següent [enllaç](http://canigo.ctti.gencat.cat/noticies/2015-04-30-SIC-Master-Slave-CPD4/) on es presenta el primer slave posat en marxa a CPD4-TSystems.\r\n\r\nDes de l'equip del SIC s'està treballant en els següents punts:\r\n\r\n* *Custodia de codi*: gestió de versions al SVN del codi font de les aplicacions. Caldrà sol·licitar excepcions per poder emmagatzemar fitxers .dll al SVN.\r\n* *Compilació*: ús del plugin MSBuild de Jenkins per la compilació d'aplicacions .NET. Caldrà especificar la versió de .NET i Visual Studio (mòduls Web i WebApplications). Gestió de dependències amb [NuGet](https://www.nuget.org/).\r\n* *Auditories*: integració amb Fortify (Anàlisi de Seguretat) i CAST (Anàlisi de Qualitat) per auditories de codi.\r\n* *Desplegaments*: desplegaments a IIS amb MSDeploy.\r\n\r\nUn cop hagi finalitzat aquesta integració, es notificarà en un comunicat amb tot el detall pel seu ús per part dels proveïdors d'aplicacions.","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3NpYy1uZXQ="},"L2Rlc3RhY2F0cy1yZWxhdGVkL3VwZ3JhZGUtbmV4dXM=":{"date":1437523200000,"title":"Upgrade Nexus al SIC","description":"","sections":"SIC","path":"/destacats-related/upgrade-nexus","content":"Amb la finalitat de disposar d'un servei actualitzat a les darreres versions de les diferents eines que en formen part s'ha realitzat una actualització del Nexus del SIC. La versió [2.11.3-01](https://support.sonatype.com/entries/94172767-Sonatype-Nexus-2-11-3-Release-Notes) instal·lada, a diferència de la versió anterior existent al SIC, permet configurar repositoris [NuGet](https://www.nuget.org/). NuGet és el gestor de paquets que s'utilitza a .NET, i d'aquesta manera, es segueix preparant el SIC per possibilitar la integració d'aquesta tecnologia.","objectID":"L2Rlc3RhY2F0cy1yZWxhdGVkL3VwZ3JhZGUtbmV4dXM="},"L2dpY2FyL2Rlc2NyaXBjaW8=":{"date":1465402302000,"title":"Descripció del servei","description":"Informació general del servei GICAR","sections":"GICAR","taxonomies":[],"toc":true,"weight":1,"path":"/gicar/descripcio","content":"Aquesta guia descriu els aspectes més rellevants per portar a terme la integració d’aplicacions amb la plataforma de Gestió d’Identitats i Control d’Accés als Recursos (en endavant GICAR). GICAR és l’eina amb que s’ha dotat a la Generalitat de Catalunya per a la gestió centralitzada de les identitats de persones que interactuen amb els sistemes d’informació.\r\n\r\nGICAR proveeix principalment dos grans funcionalitats:\r\n\r\n<br />\r\n\r\n1. **Autenticació**: on es descriuen els mecanismes per integrar el model d’autenticació de GICAR amb les aplicacions que s’hi vagin integrant. \r\n\r\n\tEn el següent esquema s’especifica a mode general quines són les aplicacions que es recomana que siguin integrades amb GICAR a nivell d’autenticació, i quines es recomana que s’integrin per altres sistemes d’autenticació.\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/tipus-autenticacio.png)\r\n\r\n\tPer aplicacions que calgui integrar-les amb sistemes d’autenticació basats en Windows Autentication, caldria adreçar-se a la “Guia d’Integració amb els directoris del nou model TIC”\r\n\r\n\t<br /><br />\r\n\r\n1. **Provisió**: on es descriuen els mecanismes per poder gestionar els recursos (aplicacions) a les que té accés una identitat del Directori Corporatiu.\r\n\r\n\tEs important remarcar que el Directori Corporatiu és el dipòsit central d’identitats de GICAR i que, per tant, és requisit indispensable estar al Directori Corporatiu per poder gaudir de tots els serveis i funcionalitats que aporta la plataforma.\r\n\r\n### Esquema general de GICAR\r\n\r\nPer facilitar la comprensió de la plataforma de Gestió d’Identitats, s’inclou a continuació un esquema de l’arquitectura de capes que configuren la plataforma GICAR.\r\n\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/esquema-general-gicar.png)\r\n\r\n\r\nLa plataforma GICAR es fonamenta bàsicament en dos objectius principals:\r\n- Facilitar la gestió de les identitats (persones) de treballen o col•laboren amb la Generalitat de Catalunya (funcionaris, interins, empreses públiques, externs, etc).\r\n- Facilitar la gestió i el control de l’accés als recursos per part de les identitats, entenent com a recurs qualsevol eina, sistema d’informació o aplicació necessari per a què el professional desenvolupi les seves funcions.\r\n\r\nTal i com s’ha indicat, el dipòsit central d’identitats de GICAR és el Directori Corporatiu de la Generalitat de Catalunya. Aquest Directori permet gestionar els següents tipus de col•lectius d’identitats:\r\n\r\n- El col·lectiu T1: professionals de la Generalitat de Catalunya gestionats des de l’aplicació de personal GIP/SIP, és a dir, tots aquells que cobren la seva nòmina des de l’aplicació de personal.  En general, funcionaris que treballen als departaments.\r\n\r\n- El col·lectiu T2: professionals de la Generalitat no gestionats des de l’aplicació de personal GIP/SIP, és a dir, tots aquells que no cobren la seva nòmina des de GIP/SIP.  En general, personal d’empreses públiques, consorcis, ...\r\n\r\n- El col·lectiu T3: professionals que col•laboren amb la Generalitat. En general, treballadors temporals, oficines liquidadores, personal d’altres administracions / organismes / ens locals, becaris, ...\r\n\r\n\r\nActualment es disposa de dues vies per donar d’alta/baixa/modificar identitats del Directori Corporatiu, que es descriuen a continuació:\r\n\r\n1.\tVia GIP/SIP: utilitzat només per identitats del col.lectiu T1. Quan una identitat modifica el seu estat en el GIPSIP (Alta/Baixa/Modificació), es llança un procés batch que alimenta el Directori Corporatiu amb els canvis que han tingut lloc. El GIPSIP sempre actuarà com a mestre de dades del Directori per identitats tipus T1.\r\n\r\n2.\tVia GDI (Gestió d’Identitats): eina que permet fer l’alta / baixa / modificació d’identitats T1, T2, T3 i no-nominals al Directori Corporatiu. Per les identitats T1, un cop se’ls ha assignat un Lloc de Treball, passaran a dependre exclusivament de GIP/SIP i amb GDI no es podran modificar. \r\n\r\nPel que fa als mecanismes d’autenticació d’usuaris, la plataforma disposa de la següent eina:\r\n\r\n- SiteMinder: que s’ocupa de l’autenticació d’identitats al Directori Corporatiu que intenten accedir a aplicacions Web (ja sigui amb usuari i contrasenya o bé amb certificat Digital). És una eina, com es veurà en el següent punt, que permet disposar de Single Sign On d’aplicacions Web. A banda del Directori Corporatiu, aquest component també permet autenticar usuaris de les administracions locals de Catalunya (a través del directori de l’EACAT), i permet autenticar certificats digitals vàlids, a través del servei de PSIS del Consorci AOC.\r\n\r\nPel que fa als mecanismes de provisió i control d’accés a recursos, GICAR aporta les següents funcionalitats:\r\n\r\n- Disposa d’una eina de Workflow per gestionar les peticions d’alta/baixa/modificació d’accés a recursos (aplicacions)\r\n- Disposa d’una eina de recordatori de contrasenya, que permet que cada identitat del Directori Corporatiu es gestioni la seva pròpia contrasenya.\r\n- Disposa d’una eina per sincronitzar la contrasenya de diferents aplicacions.\r\n- Permet controlar i administrar l’accés a les aplicacions integrades en GICAR\r\n\r\nActualment la plataforma de Gestió d’Identitats disposa de dos entorns:\r\n\r\n- Entorn de Pre-Producció\r\n- Entorn de Producció\r\n\r\n\r\n\r\n","objectID":"L2dpY2FyL2Rlc2NyaXBjaW8="},"L2dpY2FyL3Byb3Zpc2lvLXJlY3Vyc29z":{"date":1465402302000,"title":"Provisió de recursos i aplicacions","description":"","sections":"GICAR","taxonomies":[],"toc":false,"weight":4,"path":"/gicar/provisio-recursos","content":"La plataforma GICAR ofereix un altre ventall de funcionalitats relacionades amb el Control d’Accés a Recursos. Els conceptes bàsics a conèixer es descriuen a continuació:\r\n\r\n1. **Provisió d’usuaris**: GICAR disposa d’un dipòsit central d’informació on s’emmagatzemen atributs relatius al tipus d’autorització que té l’usuari per accedir als repositoris/directoris finals (recursos). Mitjançant aquesta eina es pot aprovisionar/ deprovisionar informació de l’usuari en cadascun dels recursos als que té accés. D’aquesta manera, el sistema permet gestionar l’accés a recursos finals i disposar d’una eina de traçabilitat i control centralitzada.\r\n\r\n1. **Reconciliació**: és el procés mitjançant el qual la plataforma de provisioning garanteix la integritat entre la informació del dipòsit central i la informació d’usuari en el recurs/directori final. Solen ser processos nocturns o de cap de setmana per l’elevat volum de comprovacions que es realitzen.\r\n\r\n1. **Workflow**: eina de la plataforma GICAR utilitzada per aplicar controls de negoci i tecnològics prèviament al provés de provisió/ deprovisió de comtes d’usuari en els recursos/ directori finals. És un portal tipus self-service al que tots els usuaris del Directori Corporatiu poden accedir per efectuar les seves peticions d’accés a recursos. Les fases d’autorització i validació estan reservades a identitats concretes per cada recurs.\r\n\r\n1. **Autogestió de Contrasenyes**: eina de la plataforma GICAR que permet que una identitat del Directori Corporatiu (DC) s’autogestioni la contrasenya del DC mitjançant la resposta de desafiaments prèviament configurats per l’usuari. Actualment, l’usuari ha de respondre 3 preguntes i, en el cas de respondre-les correctament, pot canviar-se la contrasenya.\r\n\r\n1. **Sincronització de Contrasenyes**: eina de la plataforma GICAR que permet sincronitzar la contrasenya d’un recurs/ directori amb la contrasenya del Directori Corporatiu. Es tracta d’un mecanisme bidireccional. \r\n\r\n## Arquitectura i elements pel Control d’Accés a Recursos.\r\n\r\nEn el següent esquema s’inclouen els diferents elements de la plataforma GICAR que intervenen en la gestió del control d’accés a recursos:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/arq_apr.png)\r\n\r\nTal i com s’observa en l’esquema anterior, els elements de la plataforma són:\r\n\r\n1. **OIM (Oracle Identity Manager)**: és l’eina de Gestió d’Identitats i control d’accés a recursos de la Generalitat de Catalunya. Es descriuen a continuació algunes de les característiques més remarcables:\r\n\r\n\t- És eina sincronitzada amb el Directori Corporatiu de la Generalitat per garantir la integritat de la informació.\r\n\r\n\t- La seva funció més important és la provisió de comptes d’usuaris o deprovisió en els recursos finals integrats a la plataforma. Aquesta funció facilita enormement els procesos de gestió i administració d’usuaris de les aplicacions finals.\r\n\r\n\t- Permet disposar de traçabilitat d’accions realitzades en els recursos integrats (alta en un recurs, baixa, modificació, bloqueig, sincronisme de contrasenya, etc)\r\n\r\n\t- Disposa d’un mòdul de sincronisme de contrasenyes amb el Directori Corporatiu que propaga la contrasenya en cas que es vegi modificada cap a o des dels recursos integrats.\r\n\r\n\t- Es poc intrusiu amb els recursos/ aplicacions finals donat que els connectors d’aprovisionament es troben integrats dins la pròpia plataforma i no cal cap tipus d’instal.lació en l’aplicació client.\r\n\r\n\t- Permet activar automatismes de control que analitzen l’estat de les identitats i que poden forçar canvis d’estat en funció de paràmetres prèviament definits.\r\n\r\n\t- Integrat amb l’eina de workflow (explicada posteriorment). OIM recull informació de l’estat d’una identitat pel que fa a l’accés a recursos (bloquejat, actiu, etc)\r\n\r\n\t- Fa servir una base de dades Oracle com a dipòsit d’informació.\r\n\r\n\t- Disposa d’una eina d’autogestió de contrasenyes, que li permet a tot usuari del Directori Corporatiu modificar-se la contrasenya en el cas de respondre correctament al 3 preguntes prèviament emmagatzemades en OIM (desafiaments-resposta)\r\n\r\n1.\t**Workflow**: eina que controla l’estat de les peticions, autoritzacions i aprovacions d’accés a recursos. Fa ús de la mateixa BBDD d’OIM per emmagatzemar tota la informació (Estats de la petició, validadors, etc) \r\n\r\n\tLa provisició o deprovisió de recursos requereix en la majoria de casos d’aprovacions parcials per a que aquestes accions es portin a terme. La funció del portal de workflow és precisament aquesta: permet fer peticions d’alta, baixa i modificació d’accés a recursos, veure quines peticions té pendents d’aprovar un responsable, aprovador o autoritzador, saber a quins recursos ja té accés una identitat, quin és l’estat de les peticions, etc.\r\n\r\n\tLa implantació d’una eina de fluxos de treball (Workflow) aporta molts beneficis:\r\n\r\n\t- Obliga a ordenar i estructurar els fluxos de treball per tal de poder automatitzar la seqüència d’accions a portar a terme i identificar a totes les persones que hi intervenen.\r\n\t- Permet establir mecanismes de control i seguiment dels procediments organitzatius.\r\n\t- Independitza el mètode i flux de treball de les persones que l’executen.\r\n\t- Facilita la mobilitat del personal.\r\n\t- Agilitza el procés d’intercanvi d’informació i agilitza la pressa de decisions d’una organització.\r\n\t- Redueix el paper i les accions manuals, a través de l’automatització.\r\n\t- Es guarden traces de totes les accions portades a terme dins d’un flux.\r\n\t- Els actors d’un flux poden consultar l’estat de les peticions en què hi intervenen.\r\n\t- L’eina permet delegació de funcions\r\n\r\n\tLes fases d’un flux de treball (workflow) per demanar accés, modificació o baixa d’un recurs/ Identitat es descriuen a continuació:\r\n\r\n\t- Creació d’una sol·licitud (petició): en aquesta fase, una identitat del Directori Corporatiu fa una petició d’accés/baixa a un recurs per ell mateix o per una persona que depèn d’ell. \r\n\r\n\t- Autorització orgànica: és l’autorització de la sol·licitud per part d’un responsable orgànic (responsable d’identitat). Aquesta validació es podrà escalar tantes vegades com sigui necessari, fins que algú l’aprovi o denegui.\r\n\r\n\t- Validació tècnica: aquesta validació serà portada a terme per part del responsable del recurs implicat en la petició (pot ser alta o baixa del recurs). Aquesta validació podrà incloure tantes validacions consecutives com calgui ja sigui de responsables funcionals, de responsables de dades, d’administradors d’aplicació, etcètera.\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/wf-fases.png)\r\n\r\n\tEs mostra a continuació una mostra de l’aspecte visual del portal de workflow que podrà ser usat pels usuaris per fer peticions, veure autoritzacions pendents, fer aprovacions tècniques, etc:\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/wf-home.png)\r\n\r\n\tEsmentar que l’eina de workflow, addicionalment a la realització de peticions d’alta o baixa de recursos, també permet sol.licitar l’alta i baixa d’identitats tipus T3 al Directori Corporatiu.\r\n\r\n1.\t**BBDD OIM**: Base de dades on es guarda tota la informació relativa a una identitat:\r\n\r\n\t- Recursos als que té accés\r\n\r\n\t- Estat de les peticions de recursos per una identitat\r\n\r\n\t- Rols amb els que s’ha aprovisionat la identitat\r\n\r\n\t- Etc.\r\n\r\n1.\tRecursos Finals: recursos gestionats per OIM. OIM té la capacitat de connectar-se a aquests recursos per aprovisionar o eliminar comptes d’usuari, així com per validar la integritat de la informació entre OIM i el recurs final (procés de reconciliació).\r\n\r\n## Tipus d'aprovisionament\r\n\r\nTal i com s’ha indicat, l’aprovisionament és l’acció de crear comptes d’usuari en els recursos finals. D’igual forma, el deprovisionament és l’acció d’eliminar comptes d’usuari en els recursos prèviament aprovisionats.\r\n\r\nTant l’aprovisionament com el deprovisionament de comptes d’usuari acostuma a efectuar-se com a resultat d’un procés de workflow. Aquest aprovisionament, deprovisionament pot ser:\r\n\r\n- **Automàtic**: a través d’un connector entre OIM i la taula/repositori de comptes d’usuari i rols de l’aplicació, OIM enviarà la informació establerta a l’aplicació per crear o eliminar una compte d’usuari o bé modificar-ne el rol. Tots aquests canvis, quedaran registrats en OIM i es disposarà de traçabilitat de totes les accions efectuades.\r\n\r\n- **Semi-Automàtic**: pràcticament idèntic a l’Automàtic, però en aquest cas es considera necessària la intervenció humana per perfilar el compte d’usuari aprovisionat en el recurs.\r\n\r\n- **Manual**: a diferència dels altres mecanismes, en aquest cas l’administrador de l’aplicació rep notificació com a resultat del workflow, realitza les modificacions en el recurs afectat i finalment és l’administrador qui tanca el workflow. En aquest cas, no és necessari el desenvolupament de cap connector donat que totes les accions són manuals. Amb el tancament del workflow, OIM té coneixment de les accions que s’han efectuat en el recurs final.\r\n\r\n<img src=\"/related/gicar/modes-aprov.png\" style=\"width:75%\" />\r\n\r\n## Fases per donar accés a un recurs\r\n\r\nUn cop descrites les eines que formen part de la Plataforma GICAR per gestionar els recursos als que té accés una identitat, es descriu a continuació el procés que es segueix (des de l’inici) per donar accés a una identitat a un recurs:\r\n\r\n- Alta de la Identitat al Directori Corporatiu (requisit indispensable): mitjançant l’eina GDI o bé via procés de càrrega des de GIPSIP, es dóna d’alta la identitat al Directori Corporatiu.\r\n\r\n- Accés al Portal de Workflow per sol.licitar accés al recurs (per exemple, la intranet)\r\n\tUna identitat del DC (qualsevol) accedeix al porta i sol.licita un recurs per ell o per una altra identitat.\r\n\tUn autoritzador orgànic s’ocuparà d’autoritzar l’alta.\r\n\tUn validador tècnic s’ocuparà d’una segona validació.\r\n\r\n- Finalitzat correctament el workflow, OIM aprovisiona dades de la identitat al recurs final (creació del compte d’usuari i assignació d’un rol determinat)\r\n\r\n- Si es considera necessari, un administrador de l’aplicació perfila el rol de l’usuari.\r\n\r\n- A partir d’aquest moment, en OIM consta que aquest usuari té accés al recurs aprovisionat i amb el rol que s’hagi sol.licitat.\r\n\r\nEn cas d’estar interessats amb la modalitat d’integració d’aprovisionament d’usuaris amb GICAR poseu-nos amb contacte amb el responsables del servei GICAR de cara a avaluar l’abast del projecte.","objectID":"L2dpY2FyL3Byb3Zpc2lvLXJlY3Vyc29z"},"L2dpY2FyLWludGVncmFjaW8vYXV0aC1taXh0YQ==":{"date":1465402302000,"title":"Servei d’autenticació mixt","description":"Descripció del servei per a usuaris de la Generalitat i per usuaris de l’Administració local (EACAT)","sections":"GICAR","taxonomies":[],"weight":5,"path":"/gicar-integracio/auth-mixta","content":"A través d’aquest mecanisme, les aplicacions de la Generalitat que així ho necessitin, podran delegar la seva autenticació, alhora i de forma federada, contra el directori de usuaris de la Generalitat, i el directori d’usuaris de l’EACAT (Administració Local – Ajuntaments i Consells Comarcals), amb usuari i contrasenya. \r\n\r\nAquesta modalitat d’integració permetrà que les aplicacions que s’integrin amb GICAR i que així ho requereixin, amb una sola integració, puguin delegar l’autenticació contra el col·lectiu d’identitats de GENCAT o, en cas que la identitat no es trobi a GENCAT, contra l’EACAT.\r\n\r\nL’atribut que s’utilitza per a establir el login contra els dos directoris és el NIF (ja és l’atribut que ara mateix s’utilitza per a fer login actualment per les aplicacions integrades amb GICAR i és l’atribut que l’AOC ens ha posat a disposició de l’EACAT per a fer aquesta integració).\r\n\r\nCal destacar que quan l’usuari s’hagi identificat ok contra el Directori de l’EACAT, GICAR només podrà retornar a les aplicacions integrades, com a atribut de resposta, el DNI de l’usuari autenticat (només assegurem que l’usuari és qui diu ser). \r\n\r\nEl que fa GICAR en aquest nou muntatge és:\r\n\r\n- Primer autenticar l’usuari si ve amb certificat (capçaleres estàndard de GICAR): GICAR_ID --> NIF\r\n- En cas que s’hagi autenticat amb usuari i contrasenya, l’anem a buscar primer a DC: GICAR_ID --> NIF\r\n- En cas que no estigui a DC l’anem a buscar a l’EACAT: GICAR_ID, EACAT_ID --> NIF (L’usuari només s’autenticarà al directori del EACAT, si i només si, no està al directori de la Generalitat)\r\n\r\nEs pot veure aquest funcionament en la següent figura:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/diagrama-autenticacio-eacat.png)\r\n\r\nApuntar que hi ha una capçalera que indica a quin directori s’ha autenticat l’usuari, que és la capçalera HTTP_SM_AUTHDIRNAME. Contindrà els valors “DC” o “EACAT” en funció d’on s’hagi autenticat l’usuari.\r\n\r\nEn resum, les capçaleres HTTP que es lliuraran a l’aplicació final integrada, en funció de com s’hagi autenticat l’usuari seran:\r\n\r\n1. Accés amb certificat:\r\n\r\n\t- GICAR_ID --> 00000000T\r\n\r\n \t- HTTP_GICAR_PSIS --> que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’annex D.\r\n\r\n    - SM_AUTHDIRNAME  Contindrà la cadena “Policy Store”\r\n\r\n1. Accés amb usuari del Directori Corporatiu GENCAT\r\n\r\n\t- GICAR_ID --> 00000000T\r\n\r\n \t- GICAR --> CODIINTERN=NFCTPR0001;NIF=00000000T;EMAIL=;UNITAT_MAJOR=CTTI (Cent.Telec.i Tecnol.Inf);UNITAT_MENOR=CTTI (Cent.Telec.i Tecnol.Inf)\r\n\r\n\t- SM_AUTHDIRNAME --> Contindrà la cadena “DC”\r\n\r\n1. Accés amb usuari EACAT (Directori EACAT)\r\n\r\n\t- EACAT_ID --> 00000000T\r\n\r\n\t- GICAR_ID --> 00000000T\r\n\r\n\t- SM_AUTHDIRNAME --> Contindrà la cadena “EACAT”\r\n\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vYXV0aC1taXh0YQ=="},"L2dpY2FyLWludGVncmFjaW8vYXV0aC1zYW1sMg==":{"date":1465402302000,"title":"Servei d’autenticació amb SAML2","description":"","sections":"GICAR","taxonomies":[],"toc":true,"weight":6,"path":"/gicar-integracio/auth-saml2","content":"En cas que l’aplicació a integrar estigui preparada per a treballar amb mecanismes de delegació de l’autenticació a través de protocol SAML2, GICAR disposa de mecanismes per a possibilitar aquesta delegació de l’autenticació a través d’aquest protocol. El producte que utilitza GICAR per a proveir aquesta funcionalitat és el Shibboleth.\r\n\r\nEl Shibboleth de GICAR recull les capçaleres HTTP generades en una sessió de SiteMinder, i genera un ticket SAML2 amb la informació continguda en aquestes capçaleres, que pot rebre una aplicació.\r\n\r\nEn aquests casos és recomanable que l’equip tècnic de l’aplicació contacti amb l’Equip GICAR, per tal de fer un estudi de les possibilitats reals de que l’aplicació delegui l’autenticació a un identity provider extern. Un cop fet aquest estudi en cas que sigui viable es configurarà en l’aplicació aquesta delegació de l’autenticació contra el servei GICAR.\r\n\r\nEs detalla a continuació com funciona una integració mitjançant protocol SAML. Cal comentar abans de descriure el funcionament a què fan referència els següents conceptes:\r\n\r\n- El \"ServiceProvider\" és l’aplicació integrada que demana l’autenticació.\r\n- El “User Agent” és el navegador de l’usuari.\r\n- L’\"Identity Provider\" és el proveïdor d’identitats de GICAR.\r\n\r\n1. Al protocol SAML2, el fluxe el comença l’aplicació integrada que demana l’autenticació (Service Provider). Aquesta, a través d’un HTTP Redirect, sol·licita al Identity Provider un tiquet SAML2.\r\n\r\nD’aquesta manera, l’aplicació consumidora (service provider) de tiquets SAML2 farà un posts a les URL del Identity Provider per a obtenir un tiquet SAML2 vàlid de la següent manera, utilitzant el servei de Redirect/SSO.\r\n\r\n\thttps://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO?SAMLRequest=7b0HYBxJliUmL23Ke39K9UrX4HShCIBgEyTYkEAQ7MGIzeaS7B1pRyMpqyqBymVWZV1mFkDM7Z28995777333nvvvfe6O51OJ%2fff%2fz9cZmQBbPbOStrJniGAqsgfP358Hz8iHjfZolw9Ol638%2bWr%2fBet86ZNz55%2b9lEx2957uPPpw%2f2HD7YPZvn%2b9v7O3mz74MHu%2bfbu%2fZ17ef7w%2fvnO7N5H6U%2fmdVNUy88%2b2hvvfJSeNc06P1s2bbZs6aOd3f3tnQfbuw%2fe7N57tL%2f36P7%2b%2bP7ew5%2f6KH1K%2fRTLrOU35227ah7dvbuq81VdzdbTaVGNi9lq%2b6KYZvX4Il9Os3ZM%2f79LH1Kr6rwo87uvj794vnf3VT4r6nza3n39%2bsuP0pNq2eToeV0vH1VZUzSPltkibx6100do%2f4iQfDSVRo%2fWy2aVT4vzIp99lL5blMvmERNj89vUfVtNq%2fKjo8c82Fpe3fxS1jR5jcF%2bdITByljH2ey8GU%2fbtvCHiA%2fvUuvLYpo3d9t63bSP70pPRzpZLwj%2b2dOXVVlMr9NnVb3INox4d7zLn9CEnnPTcNzHZVldndR51uaffUS95R%2bld48e3%2b1zxdH%2fAw%3d%3d&RelayState=dab8b17c-460d-455e-ac8d-6d8f763afe43\r\n\r\nLes URLs de petició del Identity Provider: https://preproduccio.idp1-gicar.gencat.cat/idp/profile/SAML2/Redirect/SSO\r\n\r\nEl paràmetre SAMLRequest, el qual conté les dades del servidor que demana el tiquet SAML2: \r\n\r\n\tSAMLRequest=7b0HYBxJliUmL23Ke39K9UrX4HShCIBgEyTYkEAQ7MGIzeaS7B1pRyMpqyqBymVWZV1mFkDM7Z28995777333nvvvfe6O51OJ%2fff%2fz9cZmQBbPbOStrJniGAqsgfP358Hz8iHjfZolw9Ol638%2bWr%2fBet86ZNz55%2b9lEx2957uPPpw%2f2HD7YPZvn%2b9v7O3mz74MHu%2bfbu%2fZ17ef7w%2fvnO7N5H6U%2fmdVNUy88%2b2hvvfJSeNc06P1s2bbZs6aOd3f3tnQfbuw%2fe7N57tL%2f36P7%2b%2bP7ew5%2f6KH1K%2fRTLrOU35227ah7dvbuq81VdzdbTaVGNi9lq%2b6KYZvX4Il9Os3ZM%2f79LH1Kr6rwo87uvj794vnf3VT4r6nza3n39%2bsuP0pNq2eToeV0vH1VZUzSPltkibx6100do%2f4iQfDSVRo%2fWy2aVT4vzIp99lL5blMvmERNj89vUfVtNq%2fKjo8c82Fpe3fxS1jR5jcF%2bdITByljH2ey8GU%2fbtvCHiA%2fvUuvLYpo3d9t63bSP70pPRzpZLwj%2b2dOXVVlMr9NnVb3INox4d7zLn9CEnnPTcNzHZVldndR51uaffUS95R%2bld48e3%2b1zxdH%2fAw%3d%3d \r\n\r\nA continuació es presenta una petició típica d’un tiquet SAML2, decodificada en Base64\r\n\r\n1.\tUn cop enviada la sol·licitud d’autenticació del service provider cap al Identity Provider, en funció dels paràmetres continguts en el SAMLRequest, salta el formulari de login de GICAR. L’usuari s’autentica amb usuari i contrasenya o certificat.\r\n\r\n1.\tUn cop l’usuari s’ha autenticat, el identity provider torna a redirigir a l’usuari cap a la URL del service provider retornant via POST al service provider dos paràmetres:\r\n\r\n\t- SAMLResponse: la qual conté la resposta a la petició d’autenticació feta amb anterioritat, codificada en base 64. Després d’haver estat decodificat un valor tipus d’aquesta resposta podria ser el següent:\r\n\r\n\t\t\t<?xml version=\"1.0\" encoding=\"UTF-8\"?><saml2p:Response xmlns:saml2p=\"urn:oasis:names:tc:SAML:2.0:protocol\" Destination=\"https://adfs.ctti.gencat.cat/adfs/ls/\" ID=\"_133a920d5ca854a8a7979f1c3162eb60\" InResponseTo=\"id-5f5c7321-fe8a-4941-a5ec-4d48f027a7c8\" IssueInstant=\"2014-10-07T06:13:51.250Z\" Version=\"2.0\"><saml2:Issuer xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" Format=\"urn:oasis:names:tc:SAML:2.0:nameid-format:entity\">https://idp-gicar.gencat.cat/idp/shibboleth</saml2:Issuer><saml2p:Status><saml2p:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Success\"/></saml2p:Status><saml2:EncryptedAssertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\"><xenc:EncryptedData xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\" Id=\"_cf60828ecfbe1f9a1630ecfd411180e5\" Type=\"http://www.w3.org/2001/04/xmlenc#Element\"><xenc:EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#aes128-cbc\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"/><ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"><xenc:EncryptedKey Id=\"_57045e4cf2bdf58b89dc50bf71741783\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><xenc:EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p\" xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><ds:DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\" xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"/></xenc:EncryptionMethod><ds:KeyInfo><ds:X509Data><ds:X509Certificate>.............DADES XIFRADES..................................... =</xenc:CipherValue></xenc:CipherData></xenc:EncryptedKey></ds:KeyInfo><xenc:CipherData xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\"><xenc:CipherValue>...................................DADES XIFRADES.............................................==</xenc:CipherValue></xenc:CipherData></xenc:EncryptedData></saml2:EncryptedAssertion></saml2p:Response>\r\n\r\n\t- RelayState: El qual torna a prendre el mateix valor que amb anterioritat.\r\n\r\n1.\tL’aplicació captura el SAMLResponse, i decodifica el contingut d’aquest tiquet. Si el resultat del SAML Response significa que el Identity Provider dóna per bona l’autenticació, el Service Provider deixarà passar a l’usuari.\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/saml.png)\r\n\r\nA continuació es detallen els casos d’ús més comuns:\r\n\r\n## Consumidor de SAML2 fet a mida\r\n\r\nCom es deia en la introducció, GICAR disposa d’un “Identity Provider”, construït amb la tecnologia Shibboleth, amb capacitat de facilitar tiquets SAML2 a les aplicacions. \r\n\r\nA continuació es detalla quins són els dominis del Identity Provider als que caldrà accedir per a generar el tiquet de SAML2.\r\n\r\n- Dominis dels Identity Provider de GICAR\r\n\r\n\t\tPRE: \r\n\t\thttps://preproduccio.idp1-gicar.gencat.cat/\r\n\t\thttps://preproduccio.idp4-gicar.gencat.cat/\r\n\r\n\t\tPRO: \r\n\t\thttps://idp1-gicar.gencat.cat/\r\n\t\thttps://idp4-gicar.gencat.cat/\r\n\r\n\r\n- Construcció del SAML Request:\r\n\r\nEn cas que l’aplicació que vulgui cridar via SAML2 a GICAR ha de construir un SAMLRequest que ha de contenir exactament la següent informació, estructurada de la següent forma:\r\n\r\n\t<?xml version=\"1.0\"?> <samlp:AuthnRequest xmlns:saml=\"urn:oasis:names:tc:SAML:2.0:assertion\" Consent=\"urn:oasis:names:tc:SAML:2.0:consent:unspecified\" Version=\"2.0\" Destination=\"https://DOMINI _A_ESPECIFICAR_PER_L’EQUIP_GICAR/idp/profile/SAML2/Redirect/SSO\" ID=\"xxxxxxxxxxxxxxxxxxxxx\" IssueInstant=\"2014-12-24T10:35:25.4269359Z\" IsPassive=\"false\" xmlns:samlp=\"urn:oasis:names:tc:SAML:2.0:protocol\"> <saml:Issuer>https://URL del servei peticionari</saml:Issuer> <samlp:NameIDPolicy AllowCreate=\"True\" Format=\"urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified\" /> </samlp:AuthnRequest>\r\n\r\nEn cas que l’aplicació no pugui generar un SAMLRequest amb aquesta parametrització, no podrà integrar-se directament contra GICAR via SAML2, i haurà d’analitzar una altra via d’integració.\r\n\r\n\r\n- Petició a l’equip GICAR per a incorporar aquesta aplicació com a consumidora del Identity Provider.\r\n\r\n\tCaldrà que l’equip desenvolupador de l’aplicació com a mínim faciliti la següent informació a l’equip GICAR per a que GICAR pugui autenticar a aquest servei:\r\n\r\n\t- entityID = Haurà de contenir el valor del SAML:Issuer indicat en el SAMLRequest de les peticions que farà l’aplicació. Serà normalment la URL del servei peticionari.\r\n\r\n\t- Certificat = Certificat X509 que farà servir l’aplicació consumidora per a desencriptar els tiquets SAML que haurà emès GICAR.\r\n\r\n\t- AssertionConsumerService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST\" = S’haurà d’indicar a quina URL de l’aplicació GICAR haurà de redirigir un cop feta l’autenticació. Serà la URL on es farà la corresponent redirecció, i on es passarà per paràmetre l’atribut SAMLResponse amb el contingut de les respostes que haurà de decodificar i desencriptar l’aplicació.\r\n\r\nCaldrà addicionalment que el desenvolupador especifiqui quina informació voldrà rebre referent a l’usauri que s’haurà autenticat.\r\n\r\n\r\n## Aplicació Sharepoint de Microsoft\r\n\r\nÉs possible tècnicament la integració d’una aplicació Sharepoint 2010 i superior amb GICAR. Per a fer aquesta integració és necessari disposar d’un servidor Windows Server que faci les funcions de Active Directory Federation Services (ADFS).\r\n\r\nL’ADFS és el component de Microsoft que permet la federació dels seus productes amb Identity Providers tercers.\r\n\r\nEn el cas de Sharepoint s’ha provat amb èxit la integració entre GICAR – Shibboleth – ADFS – Sharepoint. \r\n\r\nEn aquest muntatge es configura l’ADFS com a Service Provider del Identity Provider de GICAR. D’aquesta manera, el ADFS és com si fos una aplicació integrada amb GICAR, la qual a la seva hora pot donar accés a múltiples SharePoint i aplicacions del món Microsoft.\r\n\r\n* De cara al Sharepoint:\r\n\t* El ADFS és el seu identity provider.\r\n\r\n* De cara al ADFS:\r\n* \tEl Sharepoint és un dels seus service provider o relying party.\r\n\t* GICAR és el seu identity provider.\r\n\r\nEl funcionament en aquests casos seria el següent:\r\n\r\n1.\tEl Sharepoint que es vol integrar amb GICAR sol·licita un token d’autenticació al ADFS. Per a fer això el Sharepoint provoca un redirect cap al ADFS indicant quin realm d’ADFS farà servir.\r\n\r\n1.\tEl ADFS avalua quins identity providers té disponibles. Troba GICAR com a identity provider disponible i li demana l’autenticació a través de protocol SAML i a través de l’operativa exposada en l’inici del punt 3.7\r\n\r\n1.\tGICAR autentica l’usuari, i redirecciona de nou al ADFS amb el tiquet SAML de resposta.\r\n\r\n1.\tL’ADFS recull els paràmetres del tiquet SAML i crea els claims de l’entorn Microsoft.\r\n\r\n1.\tL’ADFS passa al Sharepoint els claims que sol·licita.\r\n\r\nPer a més detall tècnic per a veure com integrar el Sharepoint-ADFS-GICAR consultar el document “Integració GICAR amb Sharepoint”.\r\n\r\n## Aplicació .NET 4.x\r\n\r\nNativament les aplicacions .NET 4.x suporten delegar l’autenticació a un ADFS, per tant el mecanisme per a integrar una aplicació .NET amb GICAR pot ser de forma nativa via ADFS. Bàsicament el que aquí es farà serà incloure l’aplicació .NET com a nou Relying Party dins del ADFS que té com a únic Identity Provider “GICAR”.\r\n\r\nEl procediment doncs es basarà en l’exposat en l’apartat “Configurar Sharepoint com a Relying Party” i “Configurar Claim Rules per a Sharepoint” del document “Integració GICAR amb Sharepoint\".","objectID":"L2dpY2FyLWludGVncmFjaW8vYXV0aC1zYW1sMg=="},"L2dpY2FyLWludGVncmFjaW8vaW50ZWdyYWNpbw==":{"date":1465402302000,"title":"Tasques per a integrar una aplicació amb SiteMinder","description":"","sections":"GICAR","taxonomies":[],"weight":2,"path":"/gicar-integracio/integracio","content":"Per tal de realitzar la integració d’una aplicació amb SiteMinder (instal·lació de l’agent al frontal web propi de l’aplicació) s’haurà de seguir el següent procediment:\r\n\r\n1. Obertura dels ports dels firewalls per connectar l’Agent de SiteMinder amb el SiteMinder Policy Server. El responsable de l’aplicació sol·licitarà l’obertura dels ports següents:\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/taula-ports-sm.png)\r\n\r\n1. L’interlocutor de CPD interessat en dur a terme la integració, haurà d’omplir el formulari “Petició d’integració d’una aplicació v3.xls” i enviar-les al sau.tic@gencat.cat, amb la capçalera _PET_ORD_9.34 GICAR_ENTORN_Integració XXXX \r\n\r\n1.\tL’Administrador de GICAR, aplicarà les configuracions pertinents, i omplirà el formulari i el retornarà al sol·licitant.\r\n \r\n1.\tEl tècnic de sistemes instal·larà  l’Agent de SiteMinder en el Servidor Web on resideix el frontal a protegir per SiteMinder, fent ús de la informació lliurada en l’apartat 3 .\r\n\r\n1.\tL’administrador de GICAR, consensuadament amb els responsables de l’aplicació, aplica les polítiques de seguretat en SiteMinder.\r\n\r\n1.\tL’integrador de l’aplicació haurà de modificar l’aplicació per poder capturar i tractar les capçaleres HTTP que li envia SiteMinder un cop l’usuari ha estat validat al Directori Corporatiu .\r\n\r\n**Si l’usuari s’ha autenticat amb usuari i contrasenya contra el  obtindrà les següents capçaleres:**\r\n\r\n* **HTTP_GICAR (conté les dades de l’usuari al DC)** = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n* **HTTP_GICAR_ID (conté el NIF de l’usuari al DC)** --> 11112222W\r\n\r\nEls detalls d’aquests camps es poden veure en la següent taula:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/taula-capçalera-gicar.png)\r\n\r\nSi l’usuari s’ha autenticat amb certificat:\r\n\r\n* **HTTP_GICAR (conté dades si l’usuari està al DC, sino ve buida)** = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n* **HTTP_GICAR_ID (conté el NIF de l’usuari)** --> 11112222W\r\n\r\nSota petició podran obtenir-se també les següents capçaleres:\r\n\r\n* **HTTP_GICAR_CERT** (conté el classification level, el issuer, el subject, i el OID del certificat)  --> CLASIFICATIONLEVEL=4;CERTISSUER=C=ES, O=Agencia Catalana de Certificacio (NIF Q-0801176-I), L=Passatge de la Concepcio 11 08008 Barcelona, OU=Serveis Publics de Certificacio ECV-2, OU=Vegeu https://www.catcert.net/verCIC-2 (c)03, OU=Secretaria d'Administracio i Funcio Publica, CN=EC-SAFP;CERTSUBJECT=C=ES, O=Centre Telecomunicacions i Tecnologies de la Informació, OU=Serveis Públics de Certificació CPISR-1, OU=Vegeu https://www.catcert.cat/verCPISR-1 (c)03, SN=GARCIA GARCIA, G=ALBERT, SERIALNUMBER=46587898A, CN=CPISR-1 ALBERT GARCIA GARCIA;CERTIFICATEPOLICY=1.3.6.1.4.1.15096.1.3.1.81\r\n\r\n* **HTTP_GICAR_PSIS**: que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’annex D.\r\n\r\nA partir d’aquest moment, l’aplicació determinarà els privilegis que té l’usuari que hi accedeix.\r\n\r\n\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vaW50ZWdyYWNpbw=="},"L2dpY2FyLWludGVncmFjaW8vbWlncmFjaW8tc2FjZQ==":{"date":1465402302000,"title":"Migració de SACE a GICAR","description":"","sections":"GICAR","taxonomies":[],"weight":7,"path":"/gicar-integracio/migracio-sace","content":"Per motius històrics diverses aplicacions de la Generalitat fan encara l’ús del Servei d’Autenticació Centralitzat (més conegut com a SACE). Aquest és un servei obsolescent que està en fase d’extinció, i es recomana a totes les aplicacions que encara facin ús d’aquest servei, la migració de l’autenticació cap a GICAR.\r\n\r\nAquest apartat pretén donar unes directrius bàsiques sobre com abordar la migració d’una aplicació web integrada amb SACE vers GICAR. Es començarà explicant com s’integren actualment les aplicacions amb el SACE, i a continuació s’exposarà quin és el mecanisme que es proposa per a migrar l’autenticació a GICAR.\r\n\r\n## Funcionament actual de l’autenticació de les aplicacions amb el SACE\r\n\r\nLa manera d’integrar-se amb el SACE, consistia en fer una crida HTTPS a una adreça, passant com a informació un fitxer XML, que de sortida contindrà les dades requerides.\r\n\r\nhttps://sace.xxx.gencat.intranet/SACE/SACE_Logon.aspx\r\n\r\nOn xxx es dc, prepdc i desenvdc per als entorns de Producció, pre-producció i desenvolupament, respectivament. \r\n\t\r\nL’estructura del fitxer XML d’entrada i sortida de dades així com la informació que conté i el seu significat, s’especifica a continuació:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/xmlsace.png)\r\n\r\nEl codi d’operació pot estar informat amb els següents valors:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/saceoperacions.png)\r\n\r\nEls paràmetres d’entrada seran recollits via POST per un camp que es diu XMLIn. Anàlogament, els paràmetres de sortida seran enviats via POST a la pàgina que s’indica en el tag <URL_RETORN> dins del contingut d’un camp que es diu  XMLOut.\r\n\r\nAquest funcionament feia necessari que les aplicacions haguessin de construir-se i presentar un formulari de login, i que aquest formulari de login, o un element dinàmic relacionat, hagués de gestionar els següents punts:\r\n\r\n1.\tTenir tota la lògica de crida a SACE i d’enviament de paràmetres.\r\n2.\tEnviament de paràmetres de SACE cap a l’aplicació.\r\n3.\tParsejat dels paràmetres retornats per SACE.\r\n4.\tGeneració de la sessió de l’usuari en base a aquests paràmetres obtinguts\r\n\r\nEsquemàticament l’aplicació està funcionant ara mateix de la següent manera:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/sacejsp.png)\r\n\r\n## Proposta de canvi de migració de SACE cap a GICAR\r\n\r\nA continuació es descriu una estratègia orientada a la substitució del SACE per GICAR per a les aplicacions que utilitzen SACE. Comentar que l’estratègia que es descriu a continuació és la recomanada per a fer aquest tipus de migracions de SACE a GICAR, però no és la forma recomanada per a realitzar les intragracions amb GICAR per una aplicació que es construeixi des de 0.\r\n\r\nEn primer lloc el canvi suposa que a nivell de CPD, calgui instal·lar l’agent de SiteMinder sobre el servidor web on resideixi l’aplicació.\r\n\r\nA nivell d’aplicacions el canvi proposat es basa en substituir el formulari de login propietari de l’aplicació anterior, per un JSP, ASP, PHP (element dinàmic de servidor), que estarà protegit a nivell de SiteMinder, que es limiti a fer el següent:\r\n\r\n1.\tCapturar les següents capçaleres HTTP:\r\n\r\n- HTTP_GICAR_ID (conté el NIF de l’usuari) --> 11112222W\r\nCaptura obligatòria, a partir del qual s’obtindria el DNI de l’usuari autenticat.\r\n\r\n- HTTP_GICAR (conté les dades de l’usuari al DC) = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\nCaptura addicional, a partir del qual s’obtindrien altres dades de l’usuari autenticat.\r\n\r\n2.\tGenerar la sessió de l’aplicació en base a aquests paràmetres obtinguts en anterioritat.\r\n\r\nAquest element JSP, ASP, PHP seria l’únic punt de l’aplicació que estaria protegit per SiteMinder, d’aquesta forma aquest JSP, quan fos accedit pel navegador de l’usuari, faria saltar el formulari de login de GICAR, i demanaria les credencials a l’usuari.\r\n\r\nPer tant, un cop fet això la traça de navegació de l’usuari seria la següent:\r\n\r\n1. L’usuari accedirà a la url l’aplicació web, a la zona on habitualment li demana fer login. Aquesta zona farà un HTTP-REDIRECT al component dinàmic desenvolupat. \r\n\r\n1. Saltaria la protecció de GICAR (SiteMinder) al intentar accedir al element dinàmic.\r\n\r\n1. L’usuari introdueix la seva credencial (usuari o contrasenya /certificat). \r\n\r\n1. L’agent de SiteMinder genera les capçaleres HTTP corresponents, que indiquen que l’usuari està loguinat a GICAR.\r\n\r\n1. L’element dinàmic desenvolupat captura les capçaleres de GICAR, i genera la sessió a l’usuari en l’aplicació.\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/funcionament-migracio-sace-gicar.png)\r\n\r\nD’aquesta manera, es substitueix el formulari i les llibreries que fan les crides cap a SACE per una URL protegida per GICAR i una llibreria que recull les capçaleres HTTP i generen la sessió de l’aplicació.\r\n\r\nAddicionalment al mètode proposat anteriorment (on només es proposa la protecció amb GICAR d’un únic element dinàmic que és el que recull les capçaleres de GICAR i el que genera la sessió de l’aplicació), també és possible tècnicament que totes les URLs de l’aplicació puguin ser protegides amb GICAR (de fet és el recomanable a nivell de seguretat). El fet de fer-ho d’una forma o d’una altra, depèn del grau d’interacció que tingui aquesta aplicació amb altres elements externs, que impossibilitin la protecció total de l’aplicació amb SiteMinder.\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vbWlncmFjaW8tc2FjZQ=="},"L2dpY2FyLWludGVncmFjaW8vc2FuZGJveA==":{"date":1465402302000,"title":"Entorn de desenvolupament GICAR","description":"Entorn Sandbox per a simular el funcionament de GICAR","sections":"GICAR","taxonomies":[],"draft":false,"weight":8,"path":"/gicar-integracio/sandbox","content":"A continuació s'exposa com simular GICAR en entorns de desenvolupament, amb l'objectiu de que els proveïdors de desenvolupament tinguin una forma senzilla de simular GICAR i testejar-lo sense necessitat de disposar, per exemple, de connexió a la Xarxa de la Generalitat, ni de demanar configuracions a l'Oficina Tècnica de GICAR.\r\n\r\nEs presenten dues estratègies per a fer-ho:\r\n\r\n## Apache amb capçaleres estàtiques\r\n\r\nConfigurant el frontal web apache de cara a que generi de forma automàtica les capçaleres de GICAR. S’ha d’afegir a l’arxiu httpd.conf, el següent:\r\n\r\n- Habilitar el mod_header en el apache.\r\n\r\n- Generar les següents capçaleres a nivell d'apache utilitzant les següents directives:\r\n\r\n\t- RequestHeader set GICAR_ID “00000000T”\r\n\t- RequestHeader set GICAR “CODIINTERN=NRDRJN0001;NIF=00000000T;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\nAquesta configuració fa que l’Apache afegeixi la capçalera GICAR i GICAR_ID, amb valor fix, dins de totes les peticions HTTP rebudes.\r\n\r\n## Docker\r\n\r\nHem creat un contenidor Docker exacte als Apache-GICAR que es poden trobar als CPDs de la Generalitat. Aixecant a l'entorn del desenvolupador aquest  contenidor, amb connexió a un Policy Server de desenvolupament que és visible des dels entorns dels proveïdors, es pot simular el funcionament real d'una aplicació integrada amb GICAR d'una manera molt senzilla (només permet simular proves amb usuari i contrasenya, no amb certificat digital).\r\n\r\nPer a fer això cal seguir el següent procediment:\r\n\r\n1. El proveïdor de desenvolupament s'ha d'instal·lar el docker engine que permet gestionar imatges i contenidors (https://www.docker.com/products/docker-engine), o bé utilitzar l'entorn de desenvolupament de Canigó (http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/).\r\n\r\n1. Dockerfile GICAR (https://hub.docker.com/r/gencatcloud/gicar/) :\r\n\r\n\t\tFROM  centos:6.6\r\n\r\n\t\tRUN yum install httpd glibc libstdc++ ncurses perl unzip tar xz -y\r\n\r\n\t\tENV httpd /etc/httpd\r\n\r\n\t\tRUN mkdir -p ${httpd}/CA/webagent\r\n\r\n\t\tRUN curl -o ${httpd}/CA/webagent.tar.xz http://canigo.ctti.gencat.cat/related/cloud/fitxers-suport/webagent.tar.xz\r\n\t\tRUN tar xfvJ ${httpd}/CA/webagent.tar.xz -C ${httpd}/CA/\r\n\t\tRUN rm ${httpd}/CA/webagent.tar.xz\r\n\r\n\t\tRUN curl -o ${httpd}/conf/config.zip http://canigo.ctti.gencat.cat/related/cloud/fitxers-suport/config.zip\r\n\t\tRUN unzip  -o ${httpd}/conf/config.zip -d  ${httpd}/conf/\r\n\t\tRUN rm ${httpd}/conf/config.zip\r\n\r\n\t\tENV NETE_WA_ROOT ${httpd}/CA/webagent\r\n\t\tENV NETE_WA_PATH ${NETE_WA_ROOT}/bin\r\n\t\tENV CAPKIHOME ${httpd}/CA/webagent/CAPKI\r\n\t\tENV LD_LIBRARY_PATH ${NETE_WA_ROOT}/bin:${NETE_WA_ROOT}/bin/thirdparty:${LD_LIBRARY_PATH}\r\n\t\tENV PATH ${NETE_WA_PATH}:${PATH}\r\n\r\n\t\tRUN mv ${httpd}/conf/headers.cgi /var/www/cgi-bin/\r\n\t\tRUN mv ${httpd}/conf/index.html /var/www/html/\r\n\t\tRUN chmod 755 -R /var/www/cgi-bin/\r\n\t\tRUN chmod 755 -R /var/www/html/\r\n\r\n\t\tRUN echo \"#!/bin/bash\" > /entrypoint.sh\r\n\t\tRUN echo \"set -m\" >> /entrypoint.sh\r\n\t\tRUN echo \"/usr/sbin/apachectl -D FOREGROUND &\" >> /entrypoint.sh\r\n\t\t#RUN echo \"sleep 30\" >> /entrypoint.sh\r\n\t\tRUN echo \"/etc/httpd/CA/webagent/bin/smreghost -i \\$PS_IP -u \\$GICARUSER -p \\$GICARPWD -hn \\$ContainerHostName -hc \\$HCOGICAR -f /etc/httpd/conf/Smhost.conf -o\" >> /entrypoint.sh\r\n\t\tRUN echo \"sed -i -- 's/\\\\\\$AgentConfigDocker/'\\\"\\$AgentConfigDocker\\\"'/g' /etc/httpd/conf/WebAgent.conf\" >>  /entrypoint.sh\r\n\t\tRUN echo \"sed -i -- 's/\\\\\\$AGENTNAME/'\\\"\\$AGENTNAME\\\"'/g' /etc/httpd/conf/LocalConfigGicar.conf\" >> /entrypoint.sh\r\n\t\tRUN echo \"chown apache:apache /etc/httpd/conf/Smhost.conf\" >> /entrypoint.sh\r\n\t\tRUN echo \"fg\" >> /entrypoint.sh\r\n\r\n\t\tRUN chmod 755 /entrypoint.sh\r\n\r\n\t\t#Copiem el fitxer wait-for-it\r\n\t\tCOPY wait-for-it.sh /\r\n\t\tRUN chmod 755 /wait-for-it.sh\r\n\r\n\t\tCMD [\"/entrypoint.sh\"]\r\n\r\n1. Executar la següent comanda per a generar la imatge de l'apache GICAR:\r\n\r\n\t\t$ docker build -t gicar_dev .\r\n\r\n1. Per a demanar la configuració per a arrencar el Docker d'apache GICAR, cal omplir el següent formulari:\r\n\r\n\t<div class=\"form col-xs-12 col-md-12\" id=\"form-sandbox\">\r\n\t<form action='http://formularis.gencat.cat/gencat_forms/AppJava/submitFormulari.do' method='post'>\r\n\r\n\t<div class=\"col-xs-12 col-md-4 \">\r\n\t<label>Peticionari<span class=\"red\">*</span></label><input name='peticionari' type='text' class=\"form-control\" />\r\n\t</div>\r\n\t<div class=\"col-xs-12 col-md-4 \">\r\n\t<label>NIF<span class=\"red\">*</span></label><input name='NIF' type='text' class=\"form-control\" />\r\n\t</div>\r\n\t<div class=\"col-xs-12 col-md-4 \">\r\n\t<label>Correu<span class=\"red\">*</span></label><input name='correu' type='text' class=\"form-control\" />\r\n\t</div>\r\n\r\n\t<div class=\"col-xs-12 col-md-6 \">\r\n\t<label>Lot d'aplicacions<span class=\"red\">*</span></label><br />\r\n\t<select name='lot_aplicacions' class=\"form-control custom_select hasCustomSelect\" >\r\n\t\t<option value='A1'>A1</option>\r\n\t\t<option value='A2'>A2</option>\r\n\t\t<option value='A3'>A3</option>\r\n\t\t<option value='A4'>A4</option>\r\n\t\t<option value='A5'>A5</option>\r\n\t\t<option value='A6'>A6</option>\r\n\t\t<option value='A7'>A7</option>\r\n\t\t<option value='A8'>A8</option>\r\n\t\t<option value='A9'>A9</option>\r\n\t\t<option value='A10'>A10</option>\r\n\t\t<option value='A11'>A11</option>\r\n\t</select>\r\n\t</div>\r\n\r\n\t<div class=\"col-xs-12 col-md-12\">\r\n\t<label>Observacions (informeu els patrons d'url a protegir, així com qualsevol altra qüestió relacionada)<span class=\"red\">*</span></label><textarea name='observacions' class=\"form-control\"> </textarea>\r\n\t</div>\r\n\r\n\t<div class=\"col-xs-12 col-md-3\">\r\n\t<input id=\"codeCaptcha\" type=\"hidden\" value=\"433905973\" name=\"captchaCode\"/>\r\n\t<script type=\"text/javascript\">\r\n\t\t$(function(){\r\n\t\t\t$(\"#refreshKaptchaImage\").click(function () {\r\n\t\t\t\tvar valor =  Math.floor(Math.random()*1000000000);\r\n\t\t\t\t$(\"#codeCaptcha\").attr(\"value\", valor)\r\n\t\t\t\t$(\"#kaptchaImage\").hide().attr(\"src\", \"http://formularis.gencat.cat/gencat_forms/AppJava/generarKaptcha?kaptchaCode=\"+valor).fadeIn();\r\n\t\t\t\t$(\"#captchaAnswer\").attr(\"value\", \"\");\r\n\t\t\t});\r\n\t\t});\r\n\t</script>\r\n\r\n\t<br />\r\n\t<img id=\"kaptchaImage\" src=\"http://formularis.gencat.cat/gencat_forms/AppJava/generarKaptcha?kaptchaCode=433905973\" width=\"200\"/>\r\n\t<img id=\"refreshKaptchaImage\" src=\"http://formularis.gencat.cat/gencat_forms/images/refrescar.png\" style=\"vertical-align: top; cursor:pointer;\"/>\r\n\r\n\t<br />\r\n\t<input type=\"text\" id=\"captchaAnswer\" name=\"captchaAnswer\" class=\"form-control\"/>\r\n\t<br />\r\n\t</div>\r\n\r\n\t<div class=\"col-xs-12 col-md-12\">\r\n\t<input type='submit' class=\"btn bgRed white margin_top_xs\" />\r\n\t</div>\r\n\t<textarea name='meta_inf' style='display:none;'>\r\n\t\t<meta-informacio>\r\n\t\t\t<idFormulari>52697</idFormulari>\r\n\t\t\t<idioma>ca_ES</idioma>\r\n\t\t</meta-informacio>\r\n\t</textarea>\r\n\r\n\t</form>\r\n\t</div>\r\n\t<div  class=\"clearfix\">&nbsp;</div>\r\n\r\n1. Amb les dades que se us proporcionin, podreu arrencar el contenidor amb la següent comanda:\r\n\r\n\t\t$ docker run -d -p 80:80 -e \"PS_IP=[ip]\" -e \"AgentConfigDocker=[aco]\" -e \"ContainerHostName=[nom del contenidor]\" -e \"AGENTNAME=[agent_name],[nom de domini]\" -e \"HCOGICAR=[hco]\" -e \"GICARUSER=[user]\" -e \"GICARPWD=[pwd]\" -e \"APPSERVER_PORT_8080_TCP_ADDR=localhost\" -e \"APPSERVER_PORT_8080_TCP_PORT=8080\" --name gicar_dev gicar_dev\r\n\r\n\r\n1. Si necessiteu configuracions específiques per a connectar al vostre servidor d'aplicacions, podeu per fer el següent:\r\n\r\n\t- Descarregueu el httpd.conf que s'inclou config.zip del Dockerfile\r\n\r\n\t- Creeu la imatge de base de gicar_dev\r\n\r\n\t- Creeu la vostra imatge personalitzada de gicar\r\n\r\n\t\t\tFROM  gicar_dev\r\n\r\n\t\t\t# instal·la els mòduls necessaris, ajp, mod_wl, ...\t\r\n\r\n\t\t\tRUN ...\t\r\n\r\n\t\t\t# copia el fitxer personalitzat httpd.conf a la ruta correcta\r\n\t\t\t\r\n\t\t\tCOPY myhttpd.conf /etc/httpd/conf/httpd.conf\r\n\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vc2FuZGJveA=="},"L2dpY2FyLWludGVncmFjaW8vc2l0ZW1pbmRlcg==":{"date":1465402302000,"title":"Siteminder","description":"Característiques i arquitectura","sections":"GICAR","taxonomies":[],"weight":1,"path":"/gicar-integracio/siteminder","content":"GICAR disposa d’una eina, el SiteMinder, per facilitar l’autenticació d’aplicacions web. A continuació es veurà que és Siteminder, quines són les seves característiques principals, els elements dels quals es composa (Servidor de Polítiques, Agents, Servidor Web i els diferents directoris) i les tasques que s’han de realitzar per tal d’integrar-ne una aplicació. \r\n\r\nA part de tots el punts anteriors que enfoquen l’autenticació de l’usuari contra el Directori Corporatiu de la Generalitat (empleat públic de la Generalitat), al punt 3.6, s’exposaran quins són els passos a seguir per tal de que GICAR pugui proporcionar a una aplicació el servei d’autenticació anònima mitjançant l’ús d’un certificat digital. \r\n\r\nEn cas que l’aplicació a integrar tingui la necessitat de que sigui accedida per usuaris de la Generalitat, i per usuaris de les administracions locals catalanes (AAL), GICAR permet també autenticar aquests usuaris gràcies al servei de validació que proporciona GICAR contra el Directori del Consorci AOC (EACAT). Podeu trobar informació de com fer aquesta integració al punt 3.7.\r\n\r\nAixí doncs i a mode de resum, GICAR permet l’autenticació als següents col·lectius i amb les següents modalitats:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/taula-modalitats-autenticacio.png)\r\n\r\nPer últim en l’apartat 3.8 s’exposa com fer la integració d’una aplicació amb GICAR utilitzant com a protocol d’integració SAML2, indicat per a aplicacions que només puguin delegar l’autenticació a GICAR a través de SAML2.\r\n\r\n\r\n## Característiques de SiteMinder\r\n\r\nSiteMinder és l’eina de la plataforma GICAR que, de forma centralitzada i en alta disponibilitat, s’utilitza per gestionar les polítiques d’accés dels usuaris a les aplicacions web. Per tant, les aplicacions deleguen completament el procés d’autenticació en SiteMinder.\r\n\r\nQuan una aplicació està protegida, quan l’usuari intenta accedir-hi,  SiteMinder li demana a l’usuari les credencials (usuari i contrasenya, o certificat digital) i posteriorment es fa una validació d’aquestes al Directori Corporatiu de la Generalitat de Catalunya. En el cas que el resultat sigui positiu, SiteMinder li lliura a l’aplicació final unes capçaleres HTTP amb informació de l’usuari validat. A partir d’aquest moment, l’aplicació és la que determina quins permisos d’accés o privilegis té l’usuari dins l’aplicació (Autorització).\r\n\r\nEn resum, les característiques més rellevants de SiteMinder són:\r\n\r\n- Seguretat Centralitzada, amb la capacitat d’aplicar polítiques diferents en funció del tipus d’usuari, del col·lectiu al que pertany, del departament, etc.\r\n- Permet disposar d’un entorn de Single Sign On, amb contrasenya única del Directori (autenticació única)\r\n- Alta Disponibilitat dels Servidors de Polítiques\r\n- Disposa d’un registre d’accessos (log) molt complert per processos d’auditoria.\r\n- Servei d’administració per tal de realitzar, per exemple, el manteniment del Servidor de Polítiques.\r\n\r\n\r\n## Arquitectura i elements de SiteMinder\r\n\r\nEl següent gràfic mostra l’arquitectura dels elements de GICAR responsables del procés d’autenticació:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/arquitectura-siteminder.png)\r\n\r\nTal i com s’observa en el gràfic, l’arquitectura de SiteMinder la integren els elements que es descriuen a continuació:\r\n\r\n- SiteMinder Policy Server proporciona i centralitza la gestió de polítiques, autenticació i auditoria per a aplicacions web. El Policy Server és el responsable de:\r\n\t- Aplicar una política de control d’accés sobre les aplicacions integrades.\r\n\t- Realitzar, quan sigui necessari, l’autenticació d’usuari.\r\n\t- Permetre l’accés a determinats recursos d’aquells únicament dels usuaris autoritzats.\r\n\t- Facilitar a les aplicacions les dades necessàries per a la identificació de l’usuari que accedeix al recurs.\r\n\t- Oferir SSO (Single Sign-On) entre totes les aplicacions integrades.\r\n\t- Separar la lògica d’autenticació de la lògica d’aplicació. Això permet modificar el procediment d’autenticació sense afectar a l’aplicació així com aplicar polítiques centralitzades de contrasenyes.\r\n\t\r\n- Agent de SiteMinder: Es tracta d’una extensió del servidor web (un filtre ISAPI en el cas de l’IIS, un mòdul mod en el cas d’Apache) que intercepta les peticions abans de ser processades, tot aplicant la política definida al servidor central. S’instal·la en el Servidor Web on resideix el frontal de l’aplicació i s’ocupen d’interceptar les peticions d’accés a les pàgines web d’aquest servidor. Aquestes peticions són enviades al Servidor de Polítiques de SiteMinder per determinar si l’aplicació està protegida i requereix d’autenticació.\r\nEn línies generals, SiteMinder intercepta totes les peticions rebudes pel servidor web i, abans de passar-la a l’aplicació, verifica que l’usuari estigui autenticat.\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/arquitectura-siteminder2.png)\r\n\r\n- Directori Corporatiu: és el repositori central d’identitats utilitzat per SiteMinder per comprovar la validesa o no d’una identitat que intenta accedir a una aplicació web protegida. En el Directori Corporatiu és on resideix la contrasenya única utilitzada per validar totes les aplicacions integrades amb SiteMinder.\r\n\r\n- Servidor Web: es on resideix el frontal de l’aplicació web a protegir i on cal instal.lar l’agent de SiteMinder.\r\n\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vc2l0ZW1pbmRlcg=="},"L2dpY2FyLWludGVncmFjaW8vd29ya2Zsb3c=":{"date":1465402302000,"title":"Procés d'autenticació amb Siteminder","description":"Descripció del procés i finalització de la sessió activa","sections":"GICAR","taxonomies":[],"weight":3,"path":"/gicar-integracio/workflow","content":"A continuació es descriuen els passos que SiteMinder segueix per portar a terme l’autenticació d’un usuari, i disposar d’un entorn de Single Sign On Web:\r\n\r\n1.\tL’usuari intenta accedir al recurs protegit. Si l’usuari no ha iniciat cap sessió o aquesta ha caducat, l’agent de SiteMinder instal·lat interceptarà la petició per tal de que es produeixi un desafiament d’autenticació (Punt 2). Altrament, si l’usuari té una sessió activa, aquest accedirà directament a l’aplicació.\r\n\r\n1.\tL’Agent de SiteMinder instal·lat en el Servidor Web on resideix el frontal de l’aplicació en qüestió intercepta la petició (primer filtre de virtual hosts) podent:\r\n\r\n\t- Ignorar-la: en el cas que sigui un domini que s’hagi decidit ignorar de la protecció de SiteMinder\r\n\t- Enviar la petició al SiteMinder Policy Server que analitzarà el tipus de protecció, si hi ha una sessió activa, etc.\r\n\r\n1.\tSiteMinder avalua si es tracta d’un recurs protegit\r\n\r\n\t- Si està protegit, SiteMinder avalua si l’usuari té una sessió activa.\r\n\t- Si no té sessió activa, se li  demanen a l’usuari les seves credencials o el Certificat Digital. SiteMinder farà una validació de les credencials al Directori Corporatiu i s’assegurarà de la validesa del certificat. Si tot és correcte, s’obrirà una nova sessió per a l’usuari validat.\r\n\r\n1.\tFeta la validació, SiteMinder (via l’agent) envia a l’aplicació les capçaleres HTTP (indicades en el punt anterior) per a que l’aplicació conegui la identitat de l’usuari validat.\r\n\r\n\tEsmentar que és el browser (client web) de l’usuari el que genera en local la cookie de sessió, mitjançant el qual SiteMinder determina si una sessió està activa o no, així com el temps d’expiració de la mateixa.\r\n\r\n\t![Integració Aplicacions GICAR](/related/gicar/esquema-acces.png)\r\n\r\n1.\tA partir d’aquest moment, és la pròpia aplicació (amb les capçaleres rebudes que identifiquen a la persona autenticada) qui determina si l’usuari està autoritzat, amb quins permisos, etc..\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/esquema-acces2.png)\r\n\r\n## Finalització de la sessió activa\r\n\r\nHi ha dues maneres de terminar una sessió amb GICAR: o bé a través del formulari de logoff específic de GICAR, o bé a partir d’un timeout.\r\n\r\nEl timeout es un paràmetre definit en els Policy Servers que provoca la terminació de la sessió en el cas que s’hagi superat un cert temps sense activitat. Aquest temps màxim d’inactivitat pot ser diferent per cada aplicació. En el cas d’accedir a una aplicació amb GICAR i fer ús del Single Sign On per a accedir a una altra, cal tenir en compte que el temps de timeout no es veurà modificat i seguirà mantenint el valor que estigués indicat per a la primera aplicació.\r\n\r\nUna altra manera per a terminar la sessió, es que l’aplicació invoqui el formulari de logoff que posa a disposició GICAR. Aquest formulari realitza l’esborrat de les cookies associades a la sessió, cosa que provoca la seva finalització. Així doncs, només cal que l’aplicació invoqui una de les URL següents segons l’entorn en que es trobi:\r\n\r\nSi l’aplicació té domini xxx.gencat.cat:\r\n \r\n- A PRE: en funció del que indiquin els administradors de GICAR es farà servir un link o un altre:\r\n\r\n\t- https://preproduccio.idp1-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\t- https://preproduccio.idp4-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\r\n- A PRO: en funció del que indiquin els administradors de GICAR es farà servir un link o un altre:\r\n\r\n\t- https://idp1-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\t- https://idp4-gicar.gencat.cat/siteminderagent/forms/logoff.fcc \r\n\r\nSi l’aplicació té un domini aliè a xxx.gencat.cat, caldrà consultar el tema als responsables de GICAR.\r\n\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vd29ya2Zsb3c="},"L2dpY2FyLWludGVncmFjaW8vYXV0aC1hbm9uaW1h":{"date":1465402302000,"title":"Servei d’autenticació anònima amb GICAR","description":"","sections":"GICAR","taxonomies":[],"weight":4,"path":"/gicar-integracio/auth-anonima","content":"GICAR ofereix també un servei per tal d’autenticar usuaris amb certificat digital (autenticació per a col·lectiu de ciutadania) independentment de que estiguin o no en el Directori Corporatiu de la Generalitat. Aquest servei és útil per a aplicacions que han de ser accedides per col·lectius d’usuaris que no poden ser identificats ni com a T1, T2, ni com a T3, i que per tant no tenen relació laboral amb la Generalitat.\r\n\r\nHi ha la possibilitat d’indicar a GICAR que, per una aplicació en concret, permeti, amb certificat digital, l’accés a usuaris que no pertanyin al Directori Corporatiu de la Generalitat. Això s’aconsegueix protegint el recurs en qüestió amb l’esquema d’autenticació anònima.\r\n\r\n- Descripció del procés d’autenticació utilitzant l’esquema d’autenticació anònima.\r\n  \r\nEl procés que segueix GICAR per a autenticar usuaris és el que s’indica en el següent esquema:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/diagrama-autenticacio-anonima.png)\r\n\r\nA continuació es descriuen els passos que segueix GICAR en aquest esquema d’autenticació:\r\n\r\nSi l’usuari no té cap sessió activa li apareixerà un formulari de login, per tal d’introduir les seves credencials, o autenticar-se amb certificat digital. En aquest punt, i tenint en compte l’esquema d’autenticació anònima hi ha tres opcions, que retornen la següent informació:\r\n\r\n\r\n1.\t**Autenticació amb usuari i contrasenya per usuaris que estan en el DC**:\r\n\r\n\tAquesta opció només serà vàlida si l’usuari està donat d’alta en el Directori Corporatiu. SiteMinder validarà que les credencials introduïdes per l’usuari siguin les correctes en el DC, i, si això es compleix, retornarà la informació bàsica de l’usuari a l’aplicació a través de la capçalera HTTP_GICAR i HTTP_GICAR_ID. Exemples de les capçaleres\r\n\r\n\r\n\t\tHTTP_GICAR (conté les dades de l’usuari al DC) = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n\t\tHTTP_GICAR_ID (conté el NIF de l’usuari al DC) --> 11112222W\r\n\r\n\r\n2.\t**Autenticació amb certificat per usuaris que estan en el DC**:\r\n\r\n\tAquesta casuística es dóna quan un usuari intenta accedir al recurs protegit per GICAR amb certificat digital, i aquest es troba en el Directori Corporatiu de la Generalitat. Les capçaleres que es rebran en aquest cas seran les següents:\r\n\r\n\t\tHTTP_GICAR (conté les dades de l’usuari al DC) = “CODIINTERN=NRDRJN0001;NIF=11112222W;EMAIL=mail.admin@gencat.net;UNITAT_MAJOR=CTTI;UNITAT_MENOR=CTTI Qualitat”\r\n\r\n\t\tHTTP_GICAR_ID (conté el NIF de l’usuari) --> 11112222W\r\n\r\n\t\tDe forma opcional i sota petició es podran sol·licitar les següents capçaleres:\r\n\r\n\t\tHTTP_GICAR_CERT (conté el classification level, el issuer, el subject, i el OID del certificat)  --> CLASIFICATIONLEVEL=4;CERTISSUER=C=ES, O=Agencia Catalana de Certificacio (NIF Q-0801176-I), L=Passatge de la Concepcio 11 08008 Barcelona, OU=Serveis Publics de Certificacio ECV-2, OU=Vegeu https://www.catcert.net/verCIC-2 (c)03, OU=Secretaria d'Administracio i Funcio Publica, CN=EC-SAFP;CERTSUBJECT=C=ES, O=Centre Telecomunicacions i Tecnologies de la Informació, OU=Serveis Públics de Certificació CPISR-1, OU=Vegeu https://www.catcert.cat/verCPISR-1 (c)03, SN=GARCIA GARCIA, G=ALBERT, SERIALNUMBER=46587898A, CN=CPISR-1 ALBERT GARCIA GARCIA;CERTIFICATEPOLICY=1.3.6.1.4.1.15096.1.3.1.81\r\n\r\n\t\tHTTP_GICAR_PSIS: que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’annex D.\r\n\r\n\tCal destacar que la capçalera HTTP_GICAR_PSIS és la única capçalera indicada per a obtenir la informació de les diferents entitats de certificació que permet autenticar GICAR, o de nom i cognoms d’usuari autenticat, donat que és la única que conté les dades de forma estructurada.\r\n\r\n\r\n3.\t**Autenticació amb certificat per usuaris que no estan en el DC (Autenticació Anònima)**:\r\n\r\n\tAquesta casuística es dóna quan un usuari intenta accedir al recurs protegit per GICAR amb certificat digital, i aquest no pertany al Directori Corporatiu de la Generalitat. Les capçaleres que es rebran en aquest cas seran les següents:\r\n\r\n\t\tHTTP_GICAR_ID (conté el NIF de l’usuari) --> 11112222W\r\n\r\n\t\tHTTP_GICAR_CERT (conté el classification level, el issuer, el subject, i el OID del certificat)  --> CLASIFICATIONLEVEL=4;CERTISSUER=C=ES, O=Agencia Catalana de Certificacio (NIF Q-0801176-I), L=Passatge de la Concepcio 11 08008 Barcelona, OU=Serveis Publics de Certificacio ECV-2, OU=Vegeu https://www.catcert.net/verCIC-2 (c)03, OU=Secretaria d'Administracio i Funcio Publica, CN=EC-SAFP;CERTSUBJECT=C=ES, O=Centre Telecomunicacions i Tecnologies de la Informació, OU=Serveis Públics de Certificació CPISR-1, OU=Vegeu https://www.catcert.cat/verCPISR-1 (c)03, SN=GARCIA GARCIA, G=ALBERT, SERIALNUMBER=46587898A, CN=CPISR-1 ALBERT GARCIA GARCIA;CERTIFICATEPOLICY=1.3.6.1.4.1.15096.1.3.1.81\r\n\r\n\t\tHTTP_GICAR_PSIS: que contindrà la resposta de PSIS completa, i estarà enzipada i codificada en base64. Un cop descodificada i desenzipada s’obtindran les dades en la forma que s’especifica en l’annex D.\r\n\r\n\tCal destacar que la capçalera HTTP_GICAR_PSIS és la única capçalera indicada per a obtenir la informació de les diferents entitats de certificació que permet autenticar GICAR, o de nom i cognoms d’usuari autenticat, donat que és la única que conté les dades de forma estructurada.\r\n\r\n\tEn el cas de voler obtenir si un usuari s’ha autenticat amb usuari o contrasenya, o amb certificat:\r\n\r\n\t- Si la capçalera GICAR_PSIS ve informada, l’usuari s’haurà autenticat amb certificat.\r\n\r\n\t- Si la capçalera GICAR_PSIS NO ve informada, l’usuari NO s’haurà autenticat amb certificat. La capçalera GICAR_PSIS només apareix quan un usuari s’ha autenticat amb certificat.\r\n\r\n\tEn cas de voler obtenir el nom i cognoms de la persona que s’ha autenticat amb certificat, o altres dades del Certificat (excepte el DNI de l’usuari autenticat el qual es pot recuperar fàcilment amb la capçalera HTTP_GICAR_ID), es recomana fer-ho sempre amb la capçalera HTTP_GICAR_PSIS.\r\n\r\n\r\n- Tipus de certificats admesos pel servei d’autenticació anònima de GICAR.\r\n\r\nEl servei d’autenticació anònima de GICAR està preparat per a poder realitzar l’autenticació de qualsevol certificat reconegut per CatCert (Agència Catalana de Certificació). Actualment les següents entitats són reconegudes per CatCert:\r\n\r\n- Agència Catalana de Certificació (CATCert)\r\n\t\r\n\t- Entitat de certificació Secretaria d'Administració i Funció Pública (EC-SAFP)\r\n\t- Entitat de certificació Administració Local (EC-AL)\r\n\t- Entitat de certificació Parlament (EC-PARLAMENT)  \r\n\t- Entitat de certificació Universitats i Recerca (EC-UR)\r\n\t- Entitat de certificació Universitat Rovira i Virgili (EC-URV)\r\n\t- Entitat de certificació idCAT (EC-idCAT)\r\n\t- Entitat de certificació Sector Públic (EC-SectorPublic)\r\n\t- Entitat de certificació Ciutadania (EC-Ciutadania)\r\n\r\n- Autoridad de Certificación de la Abogacía (AC Abogacía)\r\n- Autoritat de Certificació de la Comunitat Valenciana (ACCV)\r\n- Agencia Notarial de Certificación (ANCert)\r\n- Asociación Nacional de Fabricantes - Autoridad de Certificación (ANF)\r\n- Camerfima - Certificados Camerales\r\n- Ceres Fábrica Nacional de Moneda y Timbre - Real Casa de la Moneda FNMT - RCM)\r\n- Direcció General de Policia (DNI-E)\r\n- Firmaprofesional\r\n- HealthSign\r\n- Intercambio Electrónico de Datos i Comunicaciones, SL (AC EDICOM)\r\n- Izenpe\r\n- Netfocus (no dóna serveis com a Prestador de Serveis de Certificació)\r\n- AC Organización Médica Colegial de España (OMC)\r\n- Servicio de Certificación de Registradores del Colegio de Registradores de la Propiedad y Mercantiles de España (SCR- CORPME)\r\n","objectID":"L2dpY2FyLWludGVncmFjaW8vYXV0aC1hbm9uaW1h"},"L25vdGljaWVzLzIwMTQtMTItMDktY29ubmVjdG9ycy1jYW5pZ28=":{"date":1418083200000,"title":"Canigó. Publicació serveis i connectors Canigó 3.1","description":"Al mes de Novembre s'han alliberat noves versions dels serveis i connectors que formen part de Canigó 3.1. Aquesta és la referència a la Matriu de compatibilitats de Canigó 3.1. En ella s'especifica el detall de totes les versions dels serveis de Canigó 3.1 i les compatibilitats/dependències entre cadascun d'ells. ","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2014-12-09-connectors-canigo","content":"En aquestes noves versions de serveis i connectors s'han eliminat dependències nnecessàries així com unificat les existents. Per exemple, tots els connectors que utilitzen Axis2 han estat unificats a la versió 1.5.3. Moltes altres com Aspectj, JAX-WS, Bouncy Castle Crypto API, etc. han estat actualitzades.\r\n\r\nTambé s'ha alliberat la versió 1.2.0 del Plugin d'Eclipse per donar suport al desenvolupament d'aplicacions Canigó 3.1. Aquest plugin permet la creació de dos tipus de plantilles d'aplicació:\r\n\r\n- Plantilla HTML/JS i REST: backend basat en serveis REST utilitzant Spring MVC. Presentació desacoblada. (Recomanació CS Canigó)\r\n- Plantilla JSF 2.2 (Primefaces): backend basat en la JSF 2.2 i Primefaces 5.0 com a llibreria de components al frontend.\r\n\r\nAl Portal de Frameworks i Solucions d'Arquitectura podeu trobar la Documentació de Referència de Canigó 3 actualitzada i els binaris de Canigó 3.1 disponibles a la secció de Descàrregues. Per aquest comunicat també s'ha redactat un HowTo destinat a totes aquelles aplicacions desenvolupades amb Canigó 3.0 que vulguin migrar a Canigó 3.1.","objectID":"L25vdGljaWVzLzIwMTQtMTItMDktY29ubmVjdG9ycy1jYW5pZ28="},"L25vdGljaWVzLzIwMTUtMDEtMDgtY2FuaWfDsy1SRVNU":{"date":1420848000000,"title":"Cas d'èxit d'aplicació Canigo 3 amb arquitectura HTML5 + REST","description":"L'arquitectura que des del CS Canigó s'està promovent per aplicacions web ja està sent adoptada per noves aplicacions, com és el cas de l'aplicació d'Ajuts i Subvencions (Transversal)","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-01-08-canigó-REST","content":"L'arquitectura que des del CS Canigó s'està promovent per aplicacions web ja està sent adoptada per noves aplicacions, com és el cas de l'aplicació d'Ajuts i Subvencions (Transversal). Aquesta aplicació Canigó 3 ha utilitzat una arquitectura híbrida, 90% HTML5+REST i un 10% JSP. Aquesta petita part basada en JSP (Java Server Pages) bàsicament s'ha fet per a generar l'estructura de la pàgina (template) en què es basa l'aplicació SPA (Single Page Application, aplicació de pàgina única) on les diferents parts de la pàgina es poden refrescar sense haver de recarregar tota la pàgina. La resta de codi de la capa de presentació és estàtic, no generat des del servidor, utilitzant javascript per a cridar serveis REST/JSON i formatar-los al navegador. Les conclusions per part de l'equip tècnic del projecte han estat molt positives pel que fa l'ús d'aquesta arquitectura respecte a la predecessora basada en JSF (Java Server Faces).\r\n\r\nEl següent diagrama il·lustra les diferents capes d'una aplicació Canigó 3 amb aquesta arquitectura HTML5+REST:\r\n\r\n![Arquitectura Canigó Restful](/images/news/arquitectura-canigo-restful.png)\r\n\r\nCom es pot observar la comunicació entre la capa de presentació i la capa de lògica de negoci es fa mitjançant el controlador REST. Aquest desacoblament entre client (Presentació) i servidor (Negoci-Dades) facilita la implementació de diferents clients (escriptori, mòbil, etc.) per accedir a uns mateixos recursos de servidor. En el comunicat de Novembre 2013 podeu trobar més informació respecte a aquest tipus d'arquitectura i el codi font d'una aplicació demo.\r\n\r\nPel que fa als frameworks a utilitzar a la capa de presentació destaquem els següents:\r\n\r\n- Bootstrap: framework HTML, CSS i Javascript per al desenvolupament d'aplicacions web responsives. Incorpora plugins Javascript que requereixen JQuery. \r\n- AngularJS: framework Javascript per desenvolupament d'aplicacions web. Facilita el desenvolupament a més de proposar patrons de disseny per dur-les a terme. Requereix JQuery. En cas de no estar present a l'aplicació utilitza una versió reduïda (jqLite) que inclou el necessari pel seu funcionament.\r\n- Bootstrap UI: llibreria de components Bootstrap basats en AngularJS.\r\n\r\nA més d'aquestes llibreries que hem destacat existeixen moltes altres (JQuery UI, Backbone.js, Ember.js, etc.). Des del CS Canigó es dóna llibertat pel que fa als frameworks a utilitzar a la capa de presentació sempre que es compleixi la normativa de desenvolupament web del CTTI i el PIV (Programa d'Identificació Visual). \r\n\r\nRecordar que la nova versió de l'entorn de treball de Canigó 3 permet la creació d'una plantilla d'aplicació Canigó 3.1 amb aquesta arquitectura HTML5+REST. En aquesta plantilla s'inclou un exemple de CRUD (Create-Read-Update-Delete) d'una entitat.  Per qualsevol dubte referent a aquest tipus d'arquitectura en aplicacions Canigó 3 us podeu posar en contacte amb l'equip del CS Canigó, preferiblement fent una petició de Suport al JIRA CSTD o enviant un correu a la bústia oficina-tecnica.canigo.ctti@gencat.cat.\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDEtMDgtY2FuaWfDsy1SRVNU"},"L2dpY2FyL2ludGVncmFjaW8td3M=":{"date":1465402302000,"title":"Webservice","description":"Com integrar-se amb el Webservice de GICAR","sections":"GICAR","taxonomies":[],"toc":true,"weight":3,"path":"/gicar/integracio-ws","content":"Actualment, l’aplicació GDI permet realitzar una sèrie d’actuacions sobre les identitats presents en el Directori Corporatiu. L’objectiu del Web Service de GDI es proporcionar aquestes mateixes funcionalitats, per tal que tant usuaris i/o aplicacions puguin disposar d’elles de manera externa a l’eina GDI. Així doncs, el Web Service servirà de connector per a terceres persones, permetent la seva integració amb GICAR.\r\n\r\nLa solució adoptada proporciona una comunicació senzilla mitjançant missatges i documents amb format XML entre les diferents aplicacions Web. En concret, es fa ús del protocol SOAP, que es una particularització de XML.\r\n\r\nEl xifrat de tots els missatges està assegurat a nivell del servidor d’aplicacions (jboss) i es força la comunicació TLS/SSL en totes les comunicacions amb el Web Service, amb certificat de servidor i sense requeriment de certificat en el client.\r\n\r\nA continuació s’especifiquen les dades de connexió al WebService dels diferents entorns PRE i PRO\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/connexio-ws-gicar.png)\r\n\r\n## Arquitectura\r\n\r\nA continuació s’exposa un senzill diagrama indicant les connexions entre les màquines:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/esquema-ws.png)\r\n\r\nTota comunicació cap al GDI vindrà proporcionada pel Web Service, utilitzant preferiblement per a les comunicacions un canal segur SSL per tal d’assegurar protecció a nivell de transport. Tal i com ja s’ha indicat, totes les operacions s’indicaran mitjançant documents XML amb protocol SOAP i amb una estructura predefinida. A més a més, tot document XML caldrà que inclogui l’estàndard ‘Username Token’ per tal de transmetre un identificador junt amb una contrasenya que servirà per a autenticar-se en el sistema (més informació sobre l’estructura de les peticions en 4.3 Llistat d’operacions disponibles).\r\n\r\nAltres sistemes que intervenen en els processos i que s’exposen en el diagrama són:\r\n\r\n- Directori Corporatiu: sistema final a on s’emmagatzemen les dades dels diferents usuaris.\r\n- Oracle Identity Manager (OIM): l’altre sistema final a on es controlen els diferents estats dels usuaris.\r\n- Repositori de gestors: base de dades a on consten els diferents usuaris / aplicacions que tenen permès accedir a les funcionalitats que s’ofereixen, així com de quins privilegis disposen.\r\n\r\n## Flux de peticions\r\n\r\nA continuació es mostra la interacció entre els sistemes per a una petició genèrica al Web Service:\r\n\r\n![Integració Aplicacions GICAR](/related/gicar/flux-ws.png)\r\n\r\n1. S’envia la petició en un document amb format XML i protocol SOAP. \r\n\r\n2. El Web Service extraurà la capçalera que inclou la informació relativa a l’autenticació. Es realitza una validació contra el Directori Corporatiu. Per tal de consumir el WebService caldrà doncs disposar d’un usuari de connexió al WS i caldrà ser demanar a l’Equip GICAR.\r\n\r\n3. Si l’usuari o aplicació passa aquest primer control d’autenticació, es procedirà a comprovar si aquest disposa dels privilegis necessaris per a la petició en qüestió. Per tant, es realitza una segona validació contra el repositori de gestors.\r\n\r\n4. Una vegada s’hagi autenticat correctament a l’usuari o aplicació, es farà una primera validació del contingut del missatge. Es comprovarà que la seva estructura es la correcta i que el format dels camps especificats compleix les especificacions donades (Annex A).\r\n\r\n5. Si la petició supera tots els punts anteriors, es procedirà a executar la sol•licitud. En el cas de que la petició no passi correctament alguna de les comprovacions anteriors, es retornarà a l’usuari un missatge indicant l’error i es procedirà a finalitzar el flux.\r\n\r\n6. Un cop s’ha executat l’acció requerida, s’informarà al peticionari a través d’un missatge de resposta amb una estructura predefinida.\r\n\r\n## Llistat d’operacions disponibles\r\n\r\nLes operacions que s’implementaran en el Web Service són:\r\n\r\n- enableUser: activa la identitat d’un usuari del Directori Corporatiu.\r\n- disableUser: desactiva a un usuari present en el Directori.\r\n- setPasswordUser: insereix una nova contrasenya per a l’usuari indicat.\r\n- lookupUser: busca a un usuari en el Directori i retorna informació sobre ell.\r\n- searchUsers: retorna un llistat amb els usuaris del Directori que compleixin una sèrie de condicions.\r\n\r\nS’ha predefinit per a cadascuna d’aquestes operacions una estructura determinada així com una sèrie de variables que es poden inserir. El Web Service validarà per a cada petició que aquesta s’ajusti al format requerit. \r\n\r\nA continuació es detalla per a cada operació quina estructura ha de tenir, així com les possibles respostes que es retornarà.\r\n\r\n## Capçalera d’autenticació\r\n\r\nTal i com ja s’ha introduït en punts anteriors d’aquest mateix document, el Web Service requereix que totes les operacions incorporin unes credencials per tal d’autenticar els peticionaris contra el Directori Corporatiu. Posteriorment es realitzarà una segona validació d’aquestes credencials per a comprovar si l’usuari/aplicació en qüestió està autoritzat per a demanar-les. \r\nMés informació sobre els diferents mètodes de protecció del Web Service es pot trobar a:\r\n\r\nhttp://www.oasis-open.org/committees/tc_home.php?wg_abbrev=wss\r\n\r\nEn concret, es demana que s’incorporin en els missatges enviats l’estàndard “Username Token” per tal d’informar d’un identificador i una contrasenya. Aquest element vindrà incorporat en una capçalera en el inici de totes les peticions, tal i com es mostra en l’exemple següent:\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t\t<soapenv:Envelope\r\n\t\txmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"\r\n\t\txmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\r\n\t\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\r\n\r\n\t<soapenv:Header>\r\n\r\n\t<wsse:Security xmlns:wsse=\"http://docs.oasisopen.\r\n\torg/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\"\r\n\tsoapenv:mustUnderstand=\"1\">\r\n\t<wsse:UsernameToken xmlns:wsu=\"http://docs.oasisopen.\r\n\torg/wss/2004/01/oasis-200401-wss-wssecurity-utility-\r\n\t1.0.xsd\" wsu:Id=\"UsernameToken-20201168\">\r\n\t<wsse:Username>11111111H</wsse:Username>\r\n\t<wsse:Password Type=\"http://docs.oasisopen.\r\n\torg/wss/2004/01/oasis-200401-wss-username-tokenprofile-\r\n\t1.0#PasswordText\">xxxxxxxx</wsse:Password>\r\n\t</wsse:UsernameToken>\r\n\t</wsse:Security>\r\n\r\n\r\n\t</soapenv:Header>\r\n\r\n\t<soapenv:Body>\r\n\r\n\t<spmlRequest xmlns=\"http://ws.gdi.sia.es\">\r\n\r\n\t...... ......\r\n\t...... ......\r\n\r\n\t</spmlRequest>\r\n\t</soapenv:Body>\r\n\t</soapenv:Envelope>\r\n\r\nCom es pot observar, les credencials d’autenticació estan presents en la capçalera i, per tant, són visibles per a qualsevol que sigui capaç de capturar el missatge. Es per això que es força que tota comunicació que s’estableixi amb el Web Service es realitzi a través d’un canal segur TLS/SSL amb certificat de servidor i sense necessitat de certificat al client. D’aquesta manera s’incorpora una capa de seguretat a nivell de transport que acaba de protegir del tot la comunicació.\r\n\r\n## Mètode enableUser\r\n\r\n- L’objectiu del mètode es habilitar a un usuari ja present el Directori Corporatiu.\r\n- Cal especificar el NIF de la identitat afectada (camp psoID).\r\n\r\nUn exemple de petició seria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<resumeRequest xmlns=”urn:oasis:names:tc:SPML:2:0” xmlns:dsml=”urn:oasis:names:tc:DSML:2:0:core”>\r\n\t<psoID ID=”11111111H”>\r\n\t<targetID ID=”GICAR”/>\r\n\t<containerID ID=”Persones”/>\r\n\t</psoID>\r\n\t</resumeRequest>\r\n\r\n•\tUn exemple de resposta confirmant que s’ha realitzat el canvi seria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:resumeResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0:core” status=”success”/>\r\n\r\nEn el cas de que aparegui algun error es retornarà:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:resumeResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:core” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:resumeResponse>\r\n\r\n## Mètode disableUser\r\n\r\n- Mètode encarregat de desactivar a un usuari en el Directori Corporatiu.\r\n- Cal indicar el NIF de la identitat (camp psoID).\r\n\r\nA continuació es mostra un exemple de petició:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<suspendRequest xmlns=”urn:oasis:names:tc:SPML:2:0” xmlns:dsml=”urn:oasis:names:tc:DSML:2:0:core”>\r\n\t<psoID ID=”11111111H”>\r\n\t<targetID ID=”GICAR”/>\r\n\t<containerID ID=”Persones”/>\r\n\t</psoID>\r\n\t</suspendRequest>\r\n\r\nSi tot es correcte, es retorna:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:suspendResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0:core” status=”success”/>\r\n\r\nEn cas de que es trobi algun error, aquest es notificarà:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:suspendResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:core” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:suspendResponse>\r\n\r\n## Mètode setPasswordUser\r\n\r\n- Mètode encarregat de modificar la contrasenya d’un usuari del Directori Corporatiu.\r\n- Cal indicar el NIF de l’usuari (camp psoID) i la nova contrasenya (camp password).\r\n\r\nUn exemple de petició seria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<setPasswordRequest xmlns=”urn:oasis:names:tc:SPML:2:0”\r\n\txmlns:dsml=”urn:oasis:names:tc:DSML:2:0:password”>\r\n\t<psoID ID=”11111111H”>\r\n\t<targetID ID=”GICAR”/>\r\n\t<containerID ID=”Persones”/>\r\n\t</psoID>\r\n\t<password>contrasenya</password>\r\n\t</setPasswordRequest>\r\n\r\nSi tot es correcte, es retornarà:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:setPasswordResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:password” status=”succes”/>\r\n\r\nPer finalitzar, en el cas de que hagi sorgit un error es retornarà el seu codi així com una breu descripció del mateix:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:setPasswordResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:password” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:setPasswordResponse>\r\n\r\n\r\n## Mètode lookupUser\r\n\r\n- Mètode usat per a fer una cerca d’un usuari en el Directori Corporatiu i recuperar informació de certs atributs.\r\n- Cal indicar el NIF de la identitat a buscar informació dins de la petició.\r\n- Annexat a aquest mateix document es troba un llistat dels camps disponibles en el GDI que són els que es podran retornar en aquesta consulta\r\n\r\nL’estructura de la petició es:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<lookupRequest returnData=”everything” xmlns=”urn:oasis:names:tc:SPML:2:0”>\r\n\t<psoID ID=”11111111H” xmlns=”urn:oasis:names:tc:SPML:2:0”/>\r\n\t</lookupRequest>\r\n\r\nSi tot es correcte, la informació es retornarà estructurada com un llistat tal i com es mostra a continuació:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:lookupResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0” status = “succes”>\r\n\t<ns1:pso>\r\n\t<ns1:psoID ID=”11111111H”/>\r\n\t<ns1:data>\r\n\t<ns2:attr xmlns:ns2=”urn:oasis:names:tc:DSML:2:0:core” name=”employeeID”>\r\n\t<ns2:value>11111111H</ns2:value>\r\n\t</ns2:attr>\r\n\t<ns3:attr xmlns:ns3=”urn:oasis:names:tc:DSML:2:0:core” name=”gencatFirstCognom”>\r\n\t<ns3:value>Martinez</ns3:value>\r\n\t</ns3:attr>\r\n\t<ns4:attr xmlns:ns4=”urn:oasis:names:tc:DSML:2:0:core” name=”gencatSecondCognom”>\r\n\t<ns4:value>Delgado</ns3:value>\r\n\t</ns4:attr>\r\n\r\n\t...           ...         ...\r\n\r\n\t</ns1:data>\r\n\t</ns1:pso>\r\n\t</ns1:lookupResponse>\r\n\r\n\r\nEn cas d’error en algun punt de la validació o en l’execució de la petició es retornarà:\t\r\n\t\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:lookupResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:core” status=”failure”>\r\n\t<ns1:pso>\r\n\t<ns1:psoID ID=”11111111H”/>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:pso>\r\n\t</ns1:lookupResponse>\r\n\r\n## Mètode searchUsers\r\n\r\n\r\n- Mètode encarregat de realitzar una cerca d’usuaris en el Directori Corporatiu. Retorna el NIF i el codi intern (identificador) dels usuaris que compleixin amb els paràmetres de la cerca especificats.\r\n- Caldrà establir com a mínim un paràmetre per a fer la cerca.\r\n- Es podrà utilitzar varis paràmetres de cerca units mitjançant els operadors lògics AND i/o OR.\r\n\r\nCas d’us 1: saber quins usuaris compleixen amb els criteris demanats sense obtenir el detall dels atributs dels usuaris:\r\n\r\nPer exemple, podríem enviar com a petició:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<searchRequest returnData=”identifier” xmlns=”urn:oasis:names:tc:SPML:2:0:search” xmlns:dsml=”urn:oasis:names:tc:DSML:2:0:core”>\r\n\t<query scope=”pso”>\r\n\t<basePsoID ID=””/>\r\n\t<and>\r\n\t<dsml:filter>\r\n\t<dsml:equalityMatch name=”givenName”>\r\n\t<dsml:values>Perico</dsml:values>\r\n\t</dsml:equalityMatch>\r\n\t</dsml:filter>\r\n\t<dsml:filter>\r\n\t<dsml:equalityMatch name=”gencatFirstCognom”>\r\n\t<dsml:values>Martínez</dsml:values>\r\n\t</dsml:equalityMatch>\r\n\t</dsml:filter>\r\n\t</and>\r\n\t</query>\r\n\t</searchRequest>\r\n\r\nUna petició com l’anterior retornaria una resposta com:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:searchResponse xmlns:ns1=”urn:oasis:names:tc:SPML:2:0:search” status=”success”>\r\n\t<ns1:pso>\r\n\t<ns2:psoID xmlns:ns2=”urn:oasis:names:tc:SPML:2:0” ID=”11111111H”/>\r\n\t<ns3:data xmlns:ns3=”urn:oasis:names:tc:SPML:2:0”>\r\n\t<ns4:attr xmlns:ns4=”urn:oasis:names:tc:DSML:2:0:core” name=”codiintern”>\r\n\t<ns4:value>JPNX0001</ns4:value>\r\n\t</ns4:attr>\r\n\t</ns3:data>\r\n\t</ns1:pso>\r\n\t<ns1:pso>\r\n\t<ns5:psoID xmlns:ns5=”urn:oasis:names:tc:SPML:2:0” ID=”12345678Z”/>\r\n\t<ns6:data xmlns:ns6=”urn:oasis:names:tc:SPML:2:0”>\r\n\t<ns7:attr xmlns:ns7=”urn:oasis:names:tc:DSML:2:0:core” name=”codiintern”>\r\n\t<ns7:value>JTNX0001</ns4:value>\r\n\t</ns7:attr>\r\n\t</ns6:data>\r\n\t</ns1:pso>\r\n\t</ns1:searchResponse>\r\n\r\n\r\nObtenint el NIF i el codi intern dels usuaris.\r\n\r\nEn canvi, si hi hagués algun problema es retornaria:\r\n\r\n\t<?xml version=”1.0” encoding=”UTF-8”?>\r\n\t<ns1:searchResponse xmlns:ns1=“urn:oasis:names:tc:SPML:2:0:search” status=”failure”>\r\n\t<Error code=”NNNN” desc=”xxxxxxxxxx”/>\r\n\t</ns1:searchResponse>\r\n\r\n\r\nCas d’us 2: obtenir dades de detall dels usuaris que compleixen amb els criteris de cerca:\r\n\r\nEn aquest cas cal informar el valor searchRequest returnData a Everything.\r\n\r\nPer exemple, podríem enviar com a petició:\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t<searchRequest returnData=\"everything\" xmlns=\"urn:oasis:names:tc:SPML:2:0:search\" xmlns:dsml=\"urn:oasis:names:tc:DSML:2:0:core\">\r\n\t\t<query scope=\"pso\">\r\n\t\t\t<basePsoID ID=\"\" />\r\n\t\t\t\t<dsml:filter>\r\n\t\t\t\t\t<dsml:equalityMatch name=\"employeeID\">\r\n\t\t\t\t\t\t<dsml:values>257*</dsml:values>\r\n\t\t\t\t\t</dsml:equalityMatch>\r\n\t\t\t\t</dsml:filter>\t\t\r\n\t\t</query>\r\n\t</searchRequest>\r\n\r\n\r\nUna petició com l’anterior retornaria una resposta com:\r\n\r\n\t<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\t<ns1:searchResponse xmlns:ns1=\"urn:oasis:names:tc:SPML:2:0:search\" status=\"success\">\r\n\t\t<ns1:pso>\r\n\t\t\t<ns2:psoID xmlns:ns2=\"urn:oasis:names:tc:SPML:2:0\" ID=\"25711341D\" />\r\n\t\t\t<ns3:data xmlns:ns3=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns4:attr xmlns:ns4=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"codiintern\">\r\n\t\t\t\t\t<ns4:value>GCNRMR0001</ns4:value>\r\n\t\t\t\t</ns4:attr>\r\n\t\t\t</ns3:data>\r\n\t\t\t<ns5:data xmlns:ns5=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns6:attr xmlns:ns6=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"carLicense\">\r\n\t\t\t\t\t<ns6:value>actiu</ns6:value>\r\n\t\t\t\t</ns6:attr>\r\n\t\t\t</ns5:data>\r\n\t\t\t<ns7:data xmlns:ns7=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns8:attr xmlns:ns8=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"givenName\">\r\n\t\t\t\t\t<ns8:value>Marta</ns8:value>\r\n\t\t\t\t</ns8:attr>\r\n\t\t\t</ns7:data>\r\n\t\t\t<ns9:data xmlns:ns9=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns10:attr xmlns:ns10=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"gencatFirstCognom\">\r\n\t\t\t\t\t<ns10:value>Cano</ns10:value>\r\n\t\t\t\t</ns10:attr>\r\n\t\t\t</ns9:data>\r\n\t\t\t<ns11:data xmlns:ns11=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns12:attr xmlns:ns12=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"gencatSegonCognom\">\r\n\t\t\t\t\t<ns12:value>Rodríguez</ns12:value>\r\n\t\t\t\t</ns12:attr>\r\n\t\t\t</ns11:data>\r\n\t\t\t<ns13:data xmlns:ns13=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns14:attr xmlns:ns14=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"physicalDeliveryOfficeName\">\r\n\t\t\t\t\t<ns14:value>Centre de Treball Entitat Externa</ns14:value>\r\n\t\t\t\t</ns14:attr>\r\n\t\t\t</ns13:data>\r\n\t\t\t<ns15:data xmlns:ns15=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns16:attr xmlns:ns16=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"department\">\r\n\t\t\t\t\t<ns16:value>ECONOMIA I FINANCES</ns16:value>\r\n\t\t\t\t</ns16:attr>\r\n\t\t\t</ns15:data>\r\n\t\t\t<ns17:data xmlns:ns17=\"urn:oasis:names:tc:SPML:2:0\">\r\n\t\t\t\t<ns18:attr xmlns:ns18=\"urn:oasis:names:tc:DSML:2:0:core\" name=\"gencatResponsable\">\r\n\t\t\t\t\t<ns18:value>40953247E</ns18:value>\r\n\t\t\t\t</ns18:attr>\r\n\t\t\t</ns17:data>\r\n\t\t</ns1:pso>\r\n\t</ns1:searchResponse>\r\n \r\n\r\n","objectID":"L2dpY2FyL2ludGVncmFjaW8td3M="},"L25vdGljaWVzLzIwMTUtMDItMDUtU0dERS1vY3Itc3Rk":{"date":1423094400000,"title":"SGDE. OCR al STD","description":"En el procés de transformació de CPD de l'entorn PROductiu del STD (Sistema de Transformació de Documents), finalitzat el passat 28/1, ha estat publicada una nova versió del WebService de Serveis Invocació STD","sections":["Notícies","home"],"categories":["desenvolupament","sgde"],"path":"/noticies/2015-02-05-SGDE-ocr-std","content":"En el procés de transformació de CPD de l'entorn PROductiu del STD (Sistema de Transformació de Documents), finalitzat el passat 28/1, ha estat publicada una nova versió del WebService de Serveis Invocació STD:\r\n\r\n- [WS v1.0] (http://sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTD?wsdl)\r\n- [WS v2.0 (NOVA VERSIÓ)] (http://sgde.intranet.gencat.cat/ServeisInvocacioSTD/services/ServeisSTDV2?wsdl)\r\n\r\nAquesta nova versió inclou mètodes d'OCR (Optical Character Recognition). A continuació es descriuen breument cadascuna de les funcionalitats proporcionades per aquests nous mètodes:\r\n\r\n- ferOCR: a partir del binari d'una imatge retorna el text resultat del OCR.\r\n- convertirPDFCercable: es passa l'OCR al document a convertir, prèvia conversió a imatge en cas que el document origen no sigui una imatge. El PDF resultat és un PDF \"cercable\".\r\n- convertirComposarPDFCercable: mateixa funcionalitat que l'operació existent \"convertirComposarPDF\" però el document PDF a composar és un PDF \"cercable\", ja que prèviament a la composició s'aplica la funcionalitat de \"convertirPDFCercable\". \r\n\r\nI un diagrama on s'il·lustra el seu funcionament dins el STD:\r\n\r\n<CENTER>![OCR](/images/news/OCR.png)</center>\r\n\r\nEn el Portal de Frameworks i Solucions d'Arquitectura, secció [SGDE] (/sgde/documentacio), podeu trobar tota la informació relacionada amb aquesta versió 2.0 del Webservice de Serveis Invocació STD. Properament es publicarà una nova versió del connector SGDE de Canigó 2 i Canigó 3 que faciliti el seu consum des d'aplicacions Canigó.","objectID":"L25vdGljaWVzLzIwMTUtMDItMDUtU0dERS1vY3Itc3Rk"},"L25vdGljaWVzLzIwMTUtMDMtMDUtU0lDLVBIUA==":{"date":1425513600000,"title":"SIC. PHP","description":"Durant el mes de Febrer s'ha dotat al SIC dels processos necessaris per poder fer desplegaments d'aplicacions PHP en entorns corporatius. A  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels documents de referència.","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-03-05-SIC-PHP","content":"Durant el mes de Febrer s'ha dotat al SIC dels processos necessaris per poder fer desplegaments d'aplicacions PHP en entorns corporatius. A  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels següents documents: \r\n\r\n- <i>Formulari d'alta d'aplicació per al Portal d'Integració Continua (Tasques al Jenkins):</i> en aquest formulari s'ha afegit una nova pestanya \"PHP-Desplegament\" amb els camps necessaris pel desplegament d'aplicacions PHP en entorns d'INT, PRE i PRO. \r\n- <i>Manual d'Integració:</i> afegit detall dels requeriments per la integració d'aplicacions PHP al SIC. \r\n- <i>Manual d'Usuari:</i> afegida informació per l'ús de Jenkins per tal de fer desplegaments d'aplicacions PHP amb el SIC.\r\nLa custòdia de codi d'aplicacions PHP ja era permesa i amb l'afegit dels desplegaments es proveeix al SIC de la possibilitat de gestionar el cicle de vida d'aplicacions desenvolupades amb aquesta tecnologia. Destacar que de la mateixa manera que amb aplicacions JEE, també es permet l'execució de scripts de bases de dades Oracle en els desplegaments automàtics a INT. Per PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD i enviament de correu de sol·licitud de desplegament a SAU CTTI.\r\n\r\nA continuació es mostra un diagrama amb el funcionament global del SIC per aplicacions PHP:\r\n\r\n<CENTER>![PHP](/images/news/SIC_PHP.png)</center>\r\n\r\nComentar que en el roadmap del SIC està l'execució de scripts SQL/PLSQL en MySQL donada la seva presencia en el stack LAMP (Linux - Apache HTTP Server - MySQL- PHP).\r\n\r\nPer qualsevol dubte referent a la integració d'aplicacions PHP al SIC podeu fer una petició de consulta al servei [SICQ] (https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) al JIRA CSTD o adreçar-vos a la bústia <a href=\"mailto://sic.ctti@gencat.cat\">sic.ctti@gencat.cat</a>.\r\n\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDMtMDUtU0lDLVBIUA=="},"L25vdGljaWVzLzIwMTUtMDMtMDUtY2FuaWfDsy1jYXB0Y2hh":{"date":1425513600000,"title":"Canigó. Captcha en aplicacions Canigó 3","description":"Els Captcha són tests utilitzats per a diferenciar entre persones i robots que tracten d'evitar un mal ús de les aplicacions per part de robots/programes automàtics. En aplicacions Canigó els Captcha poden resultar molt útils per a validar que s'està fent un ús correcte de les accions destinades a l'usuari final de l'aplicació com per exemple omplir i enviar formularis","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-03-05-canigó-captcha","content":"Els Captcha són tests utilitzats per a diferenciar entre persones i robots que tracten d'evitar un mal ús de les aplicacions per part de robots/programes automàtics. En aplicacions Canigó els Captcha poden resultar molt útils per a validar que s'està fent un ús correcte de les accions destinades a l'usuari final de l'aplicació com per exemple omplir i enviar formularis.\r\n\r\nDes del CS Canigó recomanem l'ús de [Google ReCaptcha] (http://www.google.com/recaptcha/intro/index.html)  degut a la senzillesa de la seva implementació, la facilitat d'ús per a l'usuari final de l'aplicació i la seguretat que proporciona. Google ReCaptcha és una evolució dels Captcha originals que fa més difícil per als programes OCR el reconeixement de les paraules a introduir.\r\n\r\n<CENTER>![captcha](/images/news/captcha.png)</center>\r\n\r\nPer qualsevol dubte referent a la integració dels Captcha a les aplicacions Canigó podeu fer una petició de consulta al servei [CAN] (https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) al JIRA CSTD o adreçar-vos a la bústia <a href=\"mailto://oficina-tecnica.canigo.ctti@gencat.cat\">oficina-tecnica.canigo.ctti@gencat.cat</a>.","objectID":"L25vdGljaWVzLzIwMTUtMDMtMDUtY2FuaWfDsy1jYXB0Y2hh"},"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDIC1hdXRvcml0emFjaW8tcmVwb3NpdG9yaXM=":{"date":1428192000000,"title":"SIC. Nova política d'autorització d'accés a repositoris","description":"Els repositoris de Subversion de l'antic model existents al SIC només comptaven amb un control d'accessibilitat (autenticació). Els usuaris podien accedir a determinats repositoris en funció del grup al qual se'ls hi havia assignat amb control total (Read/Write). En els repositoris del nou model s'ha incorporat un control d'autorització que permet definir els permisos sobre el contingut accedit (Read o Read/Write)","sections":["Notícies","home"],"categories":["desenvolupament","sic"],"path":"/noticies/2015-04-05-SIC -autoritzacio-repositoris","content":"Els repositoris de Subversion de l'antic model existents al SIC només comptaven amb un control d'accessibilitat (autenticació). Els usuaris podien accedir a determinats repositoris en funció del grup al qual se'ls hi havia assignat amb control total (Read/Write). En els repositoris del nou model s'ha incorporat un control d'autorització que permet definir els permisos sobre el contingut accedit (Read o Read/Write)\r\n\r\nAquesta nova característica ha permès limitar els permisos del grup d'administradors de CPD als repositoris de les aplicacions per tal que només puguin descarregar contingut (Read), salvant el risc i responsabilitat que comportava l'accés total (Read/Write) als repositoris als quals tenien accés en l'antic model.\r\n\r\n<CENTER>![sic](/images/news/RML_vs_CPD_permissions.png)</center>\r\n\r\nEls nous repositoris de [Subversion] (http://svn.intranet.gencat.cat/) compten ara amb un total de 532 codis de diàleg donats d'alta. En el següent gràfic es mostren el total de codis de diàleg distribuïts per àmbits:\r\n\r\nPer qualsevol consulta referent a la política d'accés als repositoris de Subversion es pot fer arribar una petició de consulta al JIRA CSTD al servei [SICQ] (https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o bé enviar un correu a la <a href=\"mailto://sic.ctti@gencat.cat\">bústia del SIC</a>.\r\n\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDIC1hdXRvcml0emFjaW8tcmVwb3NpdG9yaXM="},"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDLW1pZ3JhY2nDsw==":{"date":1428192000000,"title":"SIC. Migració a nou model TIC finalitzada","description":"El passat mes de Març ha finalitzat la migració d'aplicacions al SIC de l'antic model, basat en departaments i acrònims d'aplicació, cap al nou, basat en àmbits i codis de diàleg","sections":["Notícies","home"],"categories":["desenvolupament","sic"],"path":"/noticies/2015-04-05-SIC-migració","content":"El passat mes de Març ha finalitzat la migració d'aplicacions al SIC de l'antic model, basat en departaments i acrònims d'aplicació, cap al nou, basat en àmbits i codis de diàleg.\r\n\r\nEls nous repositoris de [Subversion] (http://svn.intranet.gencat.cat/) compten ara amb un total de 532 codis de diàleg donats d'alta. En el següent gràfic es mostren el total de codis de diàleg distribuïts per àmbits:\r\n\r\n<CENTER>![sic](/images/news/codisdialeg_per_ambit.png)</center>\r\n\r\nEls repositoris de l'antic model es conserven com a backup però s'hi ha deshabilitat l'accés. Aquests es mantindran fins al 30 / 6, i passada aquesta data s'eliminaran. Destacar que totes aquelles persones que no hagin demanat permisos als nous repositoris no hi tindran accés donat que no s'han migrat usuaris i permisos. Aquest és l'enllaç a la [secció de documentació](/sic/documentacio) on es pot trobar el formulari de gestió d'usuaris del SIC. \r\n\r\nPer qualsevol consulta referent a la migració de repositoris es pot fer arribar una petició de consulta al JIRA CSTD al servei [SICQ] (https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o bé enviar un correu a la <a href=\"mailto://sic.ctti@gencat.cat\">bústia del SIC</a>.\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMDUtU0lDLW1pZ3JhY2nDsw=="},"L25vdGljaWVzLzIwMTUtMDQtMjQtU0lDIC1wdWJsaWNhY2lvLWFudGl2aXJ1cw==":{"date":1429833600000,"title":"Canigó. Nova versió del connector Antivirus","description":"S'han publicat noves versions del connector d'Antivirus de Canigó 3 i Canigó 2. El funcionament d'aquestes versions, 1.2.0 i 2.3.21-SNAPSHOT respectivament, ha estat certificat amb la versió 7.5 de l'API de Symantec corresponent a la versió instal·lada per el nou Antivirus corporatiu. Cal destacar els canvis de dominis realitzats en la transformació del servei d'Antivirus. Les aplicacions han de fer canvis a la seva configuració per accedir-hi.","sections":["Notícies","home"],"categories":["desenvolupament","canigo"],"path":"/noticies/2015-04-24-SIC -publicacio-antivirus","content":"Durant el mes d'Abril han estat publicades les versions [1.2.0](http://repos.canigo.ctti.gencat.cat/repository/maven2/cat/gencat/ctti/canigo.integration.antivirus/1.2.0/) del [Connector d'Antivirus] (/canigo-documentacio-versions-3x-integracio/modul-antivirus/) per a Canigó 3 i [2.3.21-SNAPSHOT](http://repos.canigo.ctti.gencat.cat/repository/maven2/canigo/connectors/canigo-connectors-antivirus/2.3.21-SNAPSHOT/) per a Canigó 2.\r\n\r\nAquestes noves versions utilitzen la versió 7.5 de l’API de Symantec. Per a poder utilitzar aquesta API s’ha de sol·licitar el jar “sym-7.5.jar” a la bústia de canigó <oficina-tecnica.canigo.ctti@gencat.cat> al no estar disponible a cap repositori públic Maven. Altrament l’aplicació no podrà compilar. La instal·lació haurà de fer-se en els repositoris locals dels desenvolupadors. Aquesta llibreria ja ha estat incorporada internament al SIC (Servei d’Integració Contínua) per a compilacions de releases d’aplicacions.\r\n\r\nPer a continuar utilitzant l'API de Symantec 4.3.1 s'ha de mantenir la versió 1.1.0 del connector (o anterior) en cas de Canigó 3 i 2.3.20 (o anterior) en cas de Canigó 2. No s'han detectat incompatibilitats en l'ús d'aquesta versió de l'API en l'accés al nou servei d'Antivirus.\r\n\r\nEls nous dominis d'accés al Servei d'Antivirus són:\r\n\r\nEntorn         | Domini \t\t\t\t\t\t\t\t\t\t| port\r\n-------------- | ----------------------------------------------\t| -----\r\npreproducció   | preproduccio.antivirus.intranet.gencat.cat     | 1344\r\nproducció      | antivirus.intranet.gencat.cat       \t\t\t| 1344\r\n\r\nEl port d'accés, ICAP (1344), no és un dels estàndars (80-http, 443-https). És per aquest motiu que s’han de gestionar les regles de firewall per habilitar la connectivitat cap al servei d’Antivirus des dels servidors d'aplicacions.\r\n\r\nPer a obtenir més informació del Mòdul d'Antivirus podeu consultar la documentació del [Connector d'Antivirus] (/canigo-documentacio-versions-3x-integracio/modul-antivirus/) al Portal de Frameworks i Solucions d’Arquitectura.\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMjQtU0lDIC1wdWJsaWNhY2lvLWFudGl2aXJ1cw=="},"L25vdGljaWVzLzIwMTUtMDQtMzAtU0lDLU1hc3Rlci1TbGF2ZS1DUEQ0":{"date":1430352000000,"title":"SIC. Multi-CPD - Desplegaments a CPD4-TSystems","description":"El SIC - Multi CPD basat en l'arquitectura Master/Slave de Jenkins ja s’ha començat a implantar. El primer CPD on s’ha posat en marxa el Slave de Jenkins per als desplegaments d’aplicacions ha estat a CPD4-TSystems. Aquest slave és controlat pel Jenkins Master (CPD1-HP), el qual li delegarà el desplegament de les aplicacions ubicades a CPD4-TSystems.","sections":["Notícies","home"],"categories":["sic"],"path":"/noticies/2015-04-30-SIC-Master-Slave-CPD4","content":"El SIC - Multi CPD basat en l'arquitectura Master/Slave de Jenkins ja s’ha començat a implantar. El primer CPD on s’ha posat en marxa el Slave de Jenkins per als desplegaments d’aplicacions ha estat a CPD4-TSystems. Aquest slave és controlat pel Jenkins Master (CPD1-HP), el qual li delegarà el desplegament de les aplicacions ubicades a CPD4-TSystems.\r\n\r\nEls avantatges d’aquesta arquitectura Master/Slave són els següents:\r\n\r\n- *Distribució de la càrrega de treball*: l'execució de les tasques (jobs) es realitza en els slaves.\r\n- *Reduïr el tràfic a XCAT*: els artefactes es promouen entre entorns dins el CPD.\r\n- *Minimitzar les connectivitats entre CPDs*: el master només necessita connexió ssh amb els slaves. L'execució de les tasques per el desplegament la realitzen els slaves dins els CPDs.\r\n\r\n<CENTER>![SIC_MultiCPD_Slave_CPD4.png](/images/news/SIC_MultiCPD_Slave_CPD4.png)</center>\r\n\r\nDestacar que entre els diferents slaves i el master hauran de sincronitzar-se certes dades  (artefactes resultat, logs execució, ...). D'aquesta manera el master centralitza tota la informació i pot presentar-la a l'usuari al [Portal de Jenkins](http://hudson.intranet.gencat.cat).\r\n\r\nEs recorda el procediment per a poder realitzar desplegaments de les aplicacions des de SIC:\r\n\r\n- Custodiar el codi font de l'aplicació al [SVN del SIC](http://svn.intranet.gencat.cat). Si encara no es disposa d'un espai per el codi de diàleg demanar-ne la creació enviant el \"Formulari d’alta d’aplicació per a la Custòdia de codi al SIC\" que podeu trobar dins la secció de [Documentació del SIC](http://canigo.ctti.gencat.cat/sic/documentacio/) al Portal de Frameworks i Solucions d'Arquitectura.\r\n- Demanar l'alta de jobs a Jenkins mitjançant el \"Formulari d’alta d’aplicació per al Portal d’Integració Contínua (Jenkins)\" disponible també en la secció de [Documentació del SIC](http://canigo.ctti.gencat.cat/sic/documentacio/).\r\n\r\nAquests formularis han de ser lliurats a la [bústia del SIC](mailto:sic.ctti@gencat.cat) pel responsable de l'aplicació (persona dins el CTTI o d’un Departament).\r\n\r\nPer a obtenir més informació relativa al SIC podeu accedir a la [secció SIC](http://canigo.ctti.gencat.cat/sic/) dins el Portal de Frameworks i Solucions d'Arquitectura. Per consultes o suport preferiblement fer una petició al [Servei SICQ del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o bé enviar un correu a la [bústia del SIC](mailto:sic.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDQtMzAtU0lDLU1hc3Rlci1TbGF2ZS1DUEQ0"},"L25vdGljaWVzLzIwMTUtMDUtMjktU0lDLVVwZ3JhZGUtU1ZO":{"date":1432857600000,"title":"SIC. Upgrade versió Subversion al SIC","description":"En breu s'actualitzarà la versió de SVN del servidor de SIC, passant d'una 1.6.11 a una 1.8.13. Aquesta actualització comportarà una sèrie de millores en rendiment, robustesa i seguretat al SVN de SIC.","sections":["Notícies","home"],"categories":["sic"],"key":"JUNY2015","path":"/noticies/2015-05-29-SIC-Upgrade-SVN","content":"En breu s'actualitzarà la versió de SVN del servidor de SIC, passant d'una 1.6.11 a una 1.8.13. Aquesta actualització comportarà una sèrie de millores al SVN de SIC, de les quals destaquem les següents:\r\n\r\n||Subversion 1.6|Subversion 1.8|\r\n|----------------------|-----------|-------------|\r\n|Llibreria client HTTP|neon* |serf (+rendiment)|\r\n|Sistema d'arxius al repositori|basat en Berkeley DB* |basat en FSFS (+robustesa)|\r\n|Llistat d'arxius|En accedir a l'arrel del repositori d'àmbit es presentaran totes les carpetes de codi diàleg (tot i que només deixa accedir a les que es té permís).| En accedir a l'arrel del repositori d'àmbit, només es presenten les carpetes de codi diàleg a les que es pot accedir.|\r\n*Deprecat per Apache\r\n\r\nTrobareu més detall dels canvis a la pàgina oficial de les [Release Notes de la versió 1.8 de Subversion](https://subversion.apache.org/docs/release-notes/1.8.html).\r\n\r\n#### Compatibilitat amb clients SVN < 1.8\r\nEs recomana a aquells usuaris de SIC que continuen treballant amb un client anterior a la 1.8.X que s'actualitzin també a aquesta versió per tal que puguin aprofitar al màxim les millores que introduirà aquesta versió.\r\n\r\nPer a obtenir més informació relativa al SIC podeu accedir a la [secció SIC](http://canigo.ctti.gencat.cat/sic/) dins el Portal de Frameworks i Solucions d'Arquitectura. Per consultes o suport preferiblement fer una petició al [Servei SICQ del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ) o bé enviar un correu a la [bústia del SIC](mailto:sic.ctti@gencat.cat).","objectID":"L25vdGljaWVzLzIwMTUtMDUtMjktU0lDLVVwZ3JhZGUtU1ZO"},"L25vdGljaWVzLzIwMTUtMDYtMDItQ2FuaWdvLVBsdWdpbg==":{"date":1433203200000,"title":"Canigó. Actualització del plugin de Canigó per Eclipse","description":"Recentment s'ha publicat una nova versió del Plugin de Canigó per Eclipse. Aquesta versió és compatible amb la versió d'Eclipse Luna (4.4) per a dos de les seves 2 distribucions: Eclipse IDE for Java Developers i Eclipse IDE for Java EE Developers. A banda d'aquesta actualització del plugin també s'ha certificat el seu funcionament en S.O. Linux.","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"key":"JUNY2015","path":"/noticies/2015-06-02-Canigo-Plugin","content":"Recentment s'ha publicat una nova versió del Plugin de Canigó per Eclipse. Aquesta versió és compatible amb la versió d'Eclipse Luna (4.4) per a dos de les seves distribucions: Eclipse IDE for Java Developers i Eclipse IDE for Java EE Developers. A banda d'aquesta actualització del plugin també s'ha certificat el seu funcionament en S.O. Linux.\r\n\r\nA la següent taula s'aporta el detall de les diferents versions existents del plugin:\r\n\r\n*Nota: en la taula es mostra la última \"fix\" version de cada \"minor\" version*\r\n\r\n|Versió Plugin|Versió Canigó|Versió JSF|Spring MVC|Versió Eclipse|Compatibilitat S.O.|\r\n|-----|---|---|---|--------------|-------|\r\n|**1.0.1**|3.0.1|1.2|N/A|Helios (3.6.1)|Windows|\r\n|**1.1.0**|3.0.2|2.0|N/A|Helios (3.6.1)|Windows|\r\n|**1.2.1**|3.1.x|2.2|4.1.0.RELEASE|Helios (3.6.1)|Windows|\r\n|**1.3.1**|3.1.x|2.2|4.1.0.RELEASE|Luna (4.4)*|Windows + Linux|\r\n\r\n*Per a fer servir la versió 1.3.1 del Plugin amb la distribució JEE d'Eclipse Luna cal aplicar un patch que consisteix en substituïr una llibreria de la instal·lació base:\r\n\r\n+ La llibreria que cal sobreescriure es troba a: \\<eclipse_home\\>/plugins/org.eclipse.m2e.maven.runtime_1.5.1.20150109-1819/jars/maven-embedder-3.2.1.jar\r\n+ La llibrería amb la que s'ha de sobreescriure es pot descarregar des d'[aquest enllaç](http://canigo.ctti.gencat.cat/devenv/patch_plugin_canigo/maven-embedder-3.2.1.jar)\r\n\r\nUn cop finalitzat aquest procediment ja es pot crear un projecte Canigó des de l'Eclipse: New -> Other -> Asistent projectes Canigó -> Crear un projecte Canigó. Trobareu més informació relativa al Plugin de Canigó a la [documentació](http://canigo.ctti.gencat.cat/canigo-download-related/plugin-canigo/).","objectID":"L25vdGljaWVzLzIwMTUtMDYtMDItQ2FuaWdvLVBsdWdpbg=="},"L25vdGljaWVzLzIwMTUtMDYtMTUtU0lDLURlc3BsZWdhbWVudHMgSm9icyBSZW1lZHk=":{"date":1434326400000,"title":"SIC. Peticions desplegament via Remedy","description":"Fins ara totes les peticions de desplegament de les aplicacions a entorns PRE i PRO realitzades des del SIC es demanaven via correu a SAU (sau.ctti@gencat.cat). El SIC està evolucionant per tal que aquestes peticions de desplegament es sol·licitin via Remedy a mida que van migrant les aplicacions a aquest nou sistema.","sections":["Notícies","home"],"categories":["sic"],"key":"JULIOL2015","path":"/noticies/2015-06-15-SIC-Desplegaments Jobs Remedy","content":"Fins ara totes les peticions de desplegament de les aplicacions a entorns PRE i PRO realitzades des del SIC es demanaven via correu a SAU (sau.ctti@gencat.cat). El SIC està evolucionant per tal que aquestes peticions de desplegament es sol·licitin via Remedy a mida que van migrant les aplicacions a aquest nou sistema.\r\nPer tal d'assolir aquest objectiu s'estan adaptant els jobs de Jenkins del SIC per tal d'integrar-se amb Remedy. Aquesta integració es realitzarà en 2 fases:\r\n\r\n+ 1a Fase: Es deshabilitarà l'execució de tots els jobs de PRE/PRO de les aplicacions que ja es trobin a Remedy. Gràcies a un sistema d'alertes seran fàcilment identificables els jobs afectats. A més, s'han enviat comunicats informatius als usuaris Release Manager d'aquestes aplicacions.\r\n+ 2a Fase: S'implementarà la integració SIC - Remedy per tal de permetre que els jobs obrin peticions de desplegament a PRE/PRO mitjançant la generació d'un canvi en mode DRAFT a Remedy. S'aplicarà aquesta integració als jobs deshabilitats i es reactivaran. La previsió es que a finals de Juliol es realitzi aquesta activació.\r\n\r\nMentre no s'hagi completat aquesta integració, el procediment que caldrà seguir per a demanar desplegaments d’aquestes aplicacions serà el definit per Gestió de Serveis, és a dir, obrint una RFC directament a Remedy demanant el desplegament i indicant a CPD la ubicació de l'artefacte i les instruccions de desplegament.\r\n\r\nUna vegada completat, a mesura que les aplicacions amb jobs al SIC migrin a Remedy, l'equip del SIC actualitzarà els jobs de desplegament per tal que utilitzin aquesta via.\r\n\r\nL'escenari final contempla que totes les aplicacions estiguin integrades a Remedy, però fins llavors al SIC ens trobarem en una situació com la següent:\r\n\r\n<CENTER>![SIC-Desplegament-Remedy.png](/images/news/SIC-Desplegament-Remedy.png)</center>\r\n\r\nPer qualsevol dubte relatiu a aquesta integració del SIC amb Remedy us podeu posar en contacte amb l'equip del SIC a la bústia del [SIC](mailto:sic.ctti@gencat.cat).","objectID":"L25vdGljaWVzLzIwMTUtMDYtMTUtU0lDLURlc3BsZWdhbWVudHMgSm9icyBSZW1lZHk="},"L25vdGljaWVzLzIwMTUtMDEtMDktU0lDLW5vdS1tb2RlbA==":{"date":1420675200000,"title":"SIC. Calendari de migració d'aplicacions al nou model","description":"Tal com es va notificar al comunicat de Novembre 2014 aviat començarà la migració d'aplicacions per adaptar-se al nou model TIC. Per organitzar aquest procés de migració s'ha elaborat un calendari i s'ha publicat a la plana principal del SVN del SIC, secció \"Calendari de migració d'aplicacions al SIC\"","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-01-09-SIC-nou-model","content":"Tal com es va notificar al comunicat de Novembre 2014 aviat començarà la migració d'aplicacions per adaptar-se al nou model TIC. Per organitzar aquest procés de migració s'ha elaborat un calendari i s'ha publicat a la plana principal del SVN del SIC, secció \"Calendari de migració d'aplicacions al SIC\". A continuació s'enumeren els principals aspectes en que consisteix aquesta migració:\r\n\r\n- La migració començarà a partir del 26-01-15 i durarà fins al 03-03-15\r\n- La migració es durà a terme en franges horàries de 14h a 18h minimitzant l'impacte en el servei durant les hores de més activitat\r\n- La migració implicarà un tall de servei però aquest només afectarà al bloc d'aplicacions a migrar en la franja horària corresponent \r\n- Les aplicacions a migrar s'han separat en blocs segons l'àmbit al qual pertanyen. Per a aquells àmbits amb major volum d'aplicacions a migrar ha calgut distribuir-les en diversos blocs, fet que provocarà que la migració d'aplicacions de tot l'àmbit s'allargui més d'un dia en la franja horària esmentada anteriorment. En aquests casos s'oferirà l'alternativa d'unificar els blocs i realitzar la migració en dies complets però tenint en compte que l'aturada del servei durarà tota la jornada, de 08h a 18h\r\n- El calendari es troba obert a modificacions. En cas de produir-se alguna, es publicarà i s'informarà d'aquest canvi\r\n\r\nAmb 2 setmanes d'antelació a les dates publicades al calendari s'emetrà el corresponent comunicat als Responsables d'Arquitectura, Responsables de Qualitat i als Release Managers de l'Àmbit afectat alertant de l'inici d'aquesta migració i aportant més informació relativa al procés.\r\n\r\nEs recorda la importància d'haver tramitat prèviament a aquesta migració la creació dels usuaris Release Manager de lot i àmbit de les aplicacions, donat que l'accés al nou repositori es troba restringit a aquests usuaris. Aquest és l'enllaç a la plana de Documentació del SIC on podeu trobar el Formulari de Gestió d'usuaris al SIC per sol·licitar aquestes altes.\r\nL'accés als repositoris SVN del nou model per les aplicacions que seran migrades no s'habilitarà fins que finalitzi la seva migració. Aquesta mesura s'ha pres per evitar conflictes de duplicitat de codis entre repositori antic i nou.\r\n\r\nPer qualsevol dubte referent a aquest procés de migració us podeu posar en contacte amb l'equip del SIC, preferiblement fent una petició de Suport al JIRA CSTD o enviant un correu a la bústia sic.ctti@gencat.cat.","objectID":"L25vdGljaWVzLzIwMTUtMDEtMDktU0lDLW5vdS1tb2RlbA=="},"L25vdGljaWVzLzIwMTUtMDItMDItU0lDLXRyYW5zZm9ybWFjaW8tc2VydmVp":{"date":1417478400000,"title":"SIC. Transformació del servei","description":"El passat 13/11 es va efectuar la transformació del servei SIC al CPD1-HP. En el següent diagrama es mostren els components més rellevants de la capa d'aplicacions i com es realitza la redirecció dels dominis cap als servidors del SIC","sections":["Notícies","home"],"categories":["SIC"],"path":"/noticies/2015-02-02-SIC-transformacio-servei","content":"El passat 13-11-2014 es va efectuar la transformació del servei SIC al CPD1-HP. En el següent diagrama es mostren els components més rellevants de la capa d'aplicacions i com es realitza la redirecció dels dominis cap als servidors del SIC: \r\n\r\n![Nou SIC](/related/sic/SIC-CPD1.png)\r\n\r\nPer a tots els usuaris del SIC que accedeixen als serveis per domini, ja sigui \"hudson.intranet.gencat.cat\" (Jenkins) o \"svn.intranet.gencat.cat\" (Subversion), el canvi ha estat transparent donat que la connectivitat al nou servidor està oberta i la resolució dels noms per DNS es va canviar el 13/11 per a accedir als nous servidors. Destacar que degut a requeriments d'infraestructura des d'aquesta data és obligatori l'accés per domini, deixant de funcionar l'accés directe per IP (10.48.143.21).\r\n\r\nEls usuaris del SIC poden trobar tots els recursos als quals accedien a l'entorn antic en les mateixes URLs. No han canviat les referències a repositoris de Subversion ni a jobs de Jenkins. També es manté tota la informació històrica (tags, històric de modificacions, execucions de jobs, etc.).\r\n\r\nEn aquesta transformació s'han fet millores en l'arquitectura del SIC així com actualitzat diferents peces del software que formen part del servei. Els serveis de Jenkins i Nexus ara corren en diferents instàncies de servidors web Tomcat 7.0.50 (Java JRE 1.7.0_51), aïllant les possibles incidències i intervencions que es puguin realitzar en un respecte a l'altre. Les versions de Jenkins i Nexus actuals al SIC són 1.509.4 i 2.10.0 respectivament. Per aquest últim s'ha fet un upgrade de la versió 1.8.0.1 que hi havia instal·lada a l'antic servidor.\r\n\r\nEn aquest procés de transformació de CPD s'ha donat de baixa el servei Sonar (sonar.intranet.gencat.cat). Es segueix recomanant però l'ús d'aquest tipus d'eines en entorns de desenvolupament, prèviament a l'alliberament de noves versions de les aplicacions al SIC. L'eina corporativa per l'anàlisi de qualitat de codi és CAST. Més informació al Portal de Qualitat a la secció Eines - CAST.\r\n\r\nEn cas de tenir qualsevol dubte o detectar qualsevol afectació conseqüència d'aquesta transformació us podeu posar en contacte amb l'equip del SIC preferiblement via JIRA CSTD al servei SICQ o bé enviant un correu a la bústia sic.ctti@gencat.cat","objectID":"L25vdGljaWVzLzIwMTUtMDItMDItU0lDLXRyYW5zZm9ybWFjaW8tc2VydmVp"},"L25vdGljaWVzLzIwMTUtMDItMDUtQ2FuaWdvLWludGVncmFjaW8tc2VydmVpcy1yZXN0LWdpY2Fy":{"date":1423094400000,"title":"Canigó. Integració de serveis REST amb GICAR","description":"Les aplicacions Canigó 3 basades en l'arquitectura HTML5/JS+REST han de tenir en compte una sèrie de consideracions en cas que estiguin integrades amb GICAR. En concret, és probable que hagin de sol·licitar que s'apliquin les següents excepcions","sections":["Notícies","home"],"categories":["desenvolupament","canigó"],"path":"/noticies/2015-02-05-Canigo-integracio-serveis-rest-gicar","content":"Les aplicacions Canigó 3 basades en l'arquitectura HTML5/JS+REST han de tenir en compte una sèrie de consideracions en cas que estiguin integrades amb GICAR. En concret, és probable que hagin de sol·licitar que s'apliquin les següents excepcions:\r\n\r\n- <i>Habilitar mètodes \"PUT\" i \"DELETE\"</i>: aquests mètodes HTTP són utilitzats en serveis RESTful per operacions de modificació/inserció de dades (PUT) i eliminació (DELETE). És molt habitual per tant en aplicacions que utilitzen REST, sobretot de backoffice on es realitza administració d'informació, que requereixin aquests mètodes HTTP.\r\n\r\n- <i>Deshabilitar la validació GICAR de la cometa simple (‘) al querystring</i>: els agents GICAR instal·lats en els frontals corporatius, a més de gestionar l'autenticació d'usuaris, també inclouen validacions de seguretat. Una d'aquestes validacions no permet la cometa simple (‘) en el querystring. Al deshabilitar aquesta validació es torna imprescindible que les aplicacions protegeixin el seu codi per evitar SQL Injection. En el cas d'aplicacions Canigó 3 es recomana fer ús del \"Parameter Binding\" de JPA (Java Persistence Api) alhora de setejar paràmetres en sentències JPQL (Java Persistence Query Language) o SQL (Structured Query Language).\r\n\r\nQuan s’hagin de fer aquestes excepcions cal que el responsable de la solució afectada obri un tiquet a <a href=\"mailto://sau.tic@gencat.cat\">sau.tic@gencat.cat</a> en el servei GICAR,  demanant l’excepció pertinent (aquestes identificades o unes altres), indicant també l’aplicació que ho requereix.\r\n\r\nUs deixem una referència al comunicat de Canigó de Novembre 2013 on podeu trobar un exemple d'aplicació Canigó 3 amb arquitectura HTML5/JS+REST. Per qualsevol dubte relacionat amb l'ús d'aquest tipus d'arquitectura en aplicacions Canigó 3 podeu fer una petició de consulta al [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) o enviar un correu a la <a href=\"mailto://oficina-tecnica.canigo.ctti@gencat.cat\">Bústia del CS Canigó</a>. ","objectID":"L25vdGljaWVzLzIwMTUtMDItMDUtQ2FuaWdvLWludGVncmFjaW8tc2VydmVpcy1yZXN0LWdpY2Fy"},"L25vdGljaWVzLzIwMTUtMDgtMzEtU0lDLUludGVncmFjacOzLWRlbC1TSUMtYS1SZW1lZHk=":{"date":1440979200000,"title":"SIC. Obertura de peticions al SIC via Remedy","description":"Degut a que els sistemes de suport a l'usuari de la Generalitat de Catalunya s'estan integrant a Remedy, el CS Canigó està treballant en la integració del SIC a aquest sistema.","sections":["Notícies","home"],"categories":["sic"],"key":"SEPTEMBRE2015","path":"/noticies/2015-08-31-SIC-Integració-del-SIC-a-Remedy","content":"Degut a que els sistemes de suport a l'usuari de la Generalitat de Catalunya s'estan integrant a [Remedy](https://pautic.gencat.cat), el CS Canigó està treballant conjuntament amb l'equip de SAU-Remedy en la integració del SIC a aquest sistema. \r\n\r\nFins ara, les peticions es gestionaven mitjançant el Servei de SIC al [JIRA del CSTD](http://cstd.ctti.gencat.cat) o a través del [correu electrònic de la bústia SIC](mailto:sic.ctti@gencat.cat). \r\n\r\nEn breu s'activarà el servei 'Framework SIC' a Remedy i les peticions a SIC ja es podran d'obrir mitjançant aquesta eina. Tant les noves peticions de SIC via JIRA CSTD com les rebudes via bústia SIC, es redirigiran internament cap a Remedy.\r\n\r\nEs deixarà un mes de convivència entre els tres mètodes d’entrada (bústia, JIRA i Remedy). Transcorregut aquest temps, es tancarà definitivament la bústia de SIC i el servei de SIC al JIRA CSTD i totes les peticions s'hauran de gestionar via Remedy.\r\n\r\n<center>![peticions_sic_a_Remedy.png](/images/news/peticions_sic_a_Remedy.png)</center>\r\n\r\nS'emetrà un comunicat oficial informant d'aquest canvi de gestió sobre les peticions SIC on s'ampliarà aquesta informació i s'actualitzarà la documentació sobre SIC del portal per tal de reflectir aquest canvi.\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDgtMzEtU0lDLUludGVncmFjacOzLWRlbC1TSUMtYS1SZW1lZHk="},"L25vdGljaWVzLzIwMTUtMDctMjQtQ2FuaWdvLUFycXVpdGVjdHVyYS1hcGxpY2FjaW8tcmVjb21hbmFkYQ==":{"date":1437696000000,"title":"Canigó. Arquitectura aplicació recomanada","description":"Des del CS Canigó es segueix treballant per potenciar el desenvolupament d'aplicacions amb arquitectures client/servidor desacoblades basades en serveis Rest i HTML5/JS. Aquest tipus d'arquitectura facilita el desenvolupament de la part client i servidor de forma independent.","sections":["Notícies","home"],"key":"AGOST2015","categories":["desenvolupament","canigó"],"path":"/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada","content":"Des del CS Canigó es segueix treballant per potenciar el desenvolupament d'aplicacions amb arquitectures client/servidor desacoblades basades en serveis REST i HTML5/JS. Aquest tipus d'arquitectura facilita el desenvolupament de la part client i servidor de forma independent el que suposa una sèrie d'avantatges entre els quals destaquem:\r\n\r\n* *Diferents equips de desenvolupament*: permet tenir equips especialitzats en maquetació per la capa de presentació i tècnics JEE per el backend.\r\n* *Múltiples clients*: disposar de diferents clients (Ex. web, aplicacions natives a dispositius mòbils) que consumeixen uns mateixos serveis.\r\n* *Modularització*: backend modularitzat, és a dir, diferents aplicacions  fins i tot implementades amb diferents tecnologies. Per a l’usuari seria transparent en tenir un client web únic.\r\n* *Rendiment*: és possible desplegar les planes HTML en un servidor web (Apache, Nginx) amb la resta del contingut estàtic i els serveis en un contenidor de servlets (Ex. Tomcat) o servidor d'aplicacions  (Ex. Weblogic). El fet que les planes HTML puguin ser servides directament per un servidor web sense necessitat d'arribar al servidor d'aplicacions fa que es pugui tenir un millor rendiment.\r\n\r\nL'aplicació SICJA (Sistema d'Informació de la Comissió Jurídica Assessora) del Departament de Presidència està sent desenvolupada amb aquesta arquitectura  i les impressions rebudes tant per l'usuari com per l'equip tècnic estan sent molt positives.\r\n\r\nEl desenvolupament d'aplicacions JEE amb aquesta arquitectura en detriment de JSF (JavaServer Faces) és una tendència global i que es pot visualitzar a Google Trends:\r\n\r\n<CENTER>![canigo-tendencia-tecnologies](/images/news/canigo-tendencia-tecnologies.png)</center>\r\n\r\n*Termes comparats*: Primefaces, Richfaces, JavaServer Faces (JSF), Representational state transfer (REST) i AngularJS (JavaScript MVW Framework)\r\n\r\nQualsevol proveïdor d'aplicacions de la Generalitat que vulgui desenvolupar aplicacions Canigó amb aquesta arquitectura pot utilitzar el plugin d'Eclipse (versió >= 1.2.0) que proporciona el CS Canigó per crear la base de l'aplicació. Més informació del plugin a la següent [plana](http://canigo.ctti.gencat.cat/canigo-download-related/plugin-canigo/)).","objectID":"L25vdGljaWVzLzIwMTUtMDctMjQtQ2FuaWdvLUFycXVpdGVjdHVyYS1hcGxpY2FjaW8tcmVjb21hbmFkYQ=="},"L25vdGljaWVzLzIwMTUtMDctMzEtQ2FuaWdvLVBsdWdpbi1FY2xpcHNlLU1hcnM=":{"date":1438300800000,"title":"Canigó. Certificació plugin Canigó a Eclipse Mars","description":"Donada la recent publicació d'Eclipse Mars (4.5) des del CS Canigó s'ha certificat el funcionament del plugin per la creació de projectes Canigó 3.1 en aquesta versió d'Eclipse.","sections":["Notícies","home"],"key":"AGOST2015","categories":["desenvolupament","canigó"],"path":"/noticies/2015-07-31-Canigo-Plugin-Eclipse-Mars","content":"Donada la recent publicació d'[Eclipse Mars (4.5)](https://projects.eclipse.org/releases/mars) des del CS Canigó s'ha certificat el funcionament del plugin per la creació de projectes Canigó 3.1 en aquesta versió d'Eclipse.\r\n\r\nAquesta és la taula actualitzada amb les diferents versions existents del plugin:\r\n\r\n*Nota: en la taula es mostra l'última \"fix\" version de cada \"minor\" version*\r\n\r\n|Versió Plugin|Versió Canigó|Versió JSF|Spring MVC|Versió Eclipse|Compatibilitat S.O.|\r\n|-----|---|---|---|--------------|-------|\r\n|**1.0.1**|3.0.1|1.2|N/A|Helios (3.6.1)|Windows|\r\n|**1.1.0**|3.0.2|2.0|N/A|Helios (3.6.1)|Windows|\r\n|**1.2.1**|3.1.x|2.2|4.1.0.RELEASE|Helios (3.6.1)|Windows|\r\n|**1.3.1**|3.1.x|2.2|4.1.0.RELEASE|Luna (4.4)*|Windows + Linux|\r\n|**1.4.0**|3.1.x|2.2|4.1.0.RELEASE|Mars (4.5)*|Windows + Linux|\r\n\r\n*Per a fer servir les versions 1.3.1 i 1.4.0 del Plugin amb la distribució JEE d'Eclipse cal aplicar un patch que consisteix en substituir una llibreria de la instal·lació base:\r\n\r\n_Eclipse Luna_\r\n\r\n+ La llibreria que cal sobreescriure es troba a: \\<eclipse_home\\>/plugins/org.eclipse.m2e.maven.runtime_1.5.1.20150109-1819/jars/maven-embedder-3.2.1.jar\r\n+ La llibrería amb la que s'ha de sobreescriure es pot descarregar des d'[aquest enllaç](http://canigo.ctti.gencat.cat/devenv/patch_plugin_canigo/maven-embedder-3.2.1.jar)\r\n\r\n_Eclipse Mars_\r\n\r\n+ La llibreria que cal sobreescriure es troba a: \\<eclipse_home\\>/plugins/org.eclipse.m2e.maven.runtime_1.6.0.20150526-2031/jars/maven-embedder-3.3.3.jar\r\n+ La llibrería amb la que s'ha de sobreescriure es pot descarregar des d'[aquest enllaç](http://canigo.ctti.gencat.cat/devenv/patch_plugin_canigo/maven-embedder-3.3.3.jar)\r\n\r\nUn cop finalitzat aquest procediment ja es pot crear un projecte Canigó des de l'Eclipse: New -> Other -> Assistent projectes Canigó -> Crear un projecte Canigó. Trobareu més informació relativa al Plugin de Canigó a la [documentació](http://canigo.ctti.gencat.cat/canigo-download-related/plugin-canigo/).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDctMzEtQ2FuaWdvLVBsdWdpbi1FY2xpcHNlLU1hcnM="},"L25vdGljaWVzLzIwMTUtMTAtMDUtU0lDLUJvbmVzLXByYWN0aXF1ZXMtZGVzcGxlZ2FtZW50cy1JTlQ=":{"date":1444176000000,"title":"SIC. Bones pràctiques per a no interferir en els mecanismes de SIC quan s’accedeix manualment a la consola d’administració del servidor d’aplicacions","description":"Una de les funcionalitats més destacades del SIC és el desplegament automàtic d'aplicacions en entorns d'INT. Amb l'experiència adquirida fins ara en els nous CPDs, des de l'equip del SIC recomanem una sèrie de bones pràctiques per tal d'evitar que actuacions alienes al SIC puguin interferir en el correcte funcionament d'aquests desplegaments automatitzats.","sections":["Notícies","home"],"categories":["sic"],"key":"OCTUBRE2015","path":"/noticies/2015-10-05-SIC-Bones-practiques-desplegaments-INT","content":"Una de les funcionalitats més destacades del SIC és el desplegament automàtic d'aplicacions en entorns d'INT. Amb l'experiència adquirida fins ara en els nous CPDs, des de l'equip del SIC recomanem una sèrie de bones pràctiques per tal d'evitar que actuacions alienes al SIC puguin interferir en el correcte funcionament d'aquests desplegaments automatitzats.\r\n\r\nEls jobs de desplegament a entorns d'INT de SIC (en endavant jobs d'INT) s'aprovisionen d'acord a la configuració de desplegament de l'aplicació al servidor d'aplicacions. Una vegada l'equip de SIC finalitza l'aprovisionament del job d'INT aquest queda lligat a aquesta configuració. Un canvi de configuració al servidor d'aplicacions pot provocar que el job deixi de funcionar correctament pel fet que no es podrà realitzar el desplegament.\r\n\r\nPer tant, la recomanació és que un cop aprovisionat el job d'INT no es faci servir cap altre via de desplegament que no sigui el propi SIC. En cas contrari, és responsabilitat del proveïdor d'aplicacions conèixer si el desplegament pot implicar que el job d'INT del SIC deixi de funcionar.\r\n\r\nAquestes són les accions detectades que poden produir un problema al funcionament del job d'INT:\r\n\r\n* _Canvi del nom de l'aplicació a la consola d'administració del servidor_: el job referenciarà a un nom d'aplicació inexistent\r\n* _Canvi del path i/o nom de l'artefacte a desplegar_: el job no desplegarà la versió de l'artefacte que s'està promovent des del SIC\r\n* _Canvi dels permisos de l'artefacte a desplegar_: el job podria tenir problemes de permisos per enviar l'artefacte o el servidor d'aplicacions per llegir-lo\r\n\r\nEn el següent diagrama s'il·lustra l'efecte que pot produir alguna d'aquestes accions:\r\n\r\n<center>![deploy_INT.jpg](/images/news/deploy_INT.jpg)</center>\r\n\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu obrir una consulta a Remedy al servei \"FRAMEWORK SIC\".","objectID":"L25vdGljaWVzLzIwMTUtMTAtMDUtU0lDLUJvbmVzLXByYWN0aXF1ZXMtZGVzcGxlZ2FtZW50cy1JTlQ="},"L25vdGljaWVzLzIwMTUtMDktMDEtQ2FuaWdvLVBsYW50aWxsYS1hcGxpY2FjaW8tcmVzdA==":{"date":1441065600000,"title":"Canigó. Plantilla aplicació REST+HTML5/Js","description":"Des de CS Canigó es proporciona una plantilla d'aplicació amb arquitectura REST+HTML5/Js. Aquesta és pot generar amb el plugin de Canigó per Eclipse versió 1.2.1 o superior","sections":["Notícies","home"],"categories":["canigo"],"key":"SEPTEMBRE2015","path":"/noticies/2015-09-01-Canigo-Plantilla-aplicacio-rest","content":"Des del CS Canigó es recomana utilitzar arquitectures client/servidor desacoblades basades en serveis REST i HTML5/JS [(comunicat Agost 2015)] (/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada). Per el frontend es dóna llibertat a utilitzar la tecnologia desitjada sempre que compleixi el PIV de Gencat. \r\n\r\nA partir de la versió 1.2.1** del Plugin de Canigó per Eclipse es pot generar l'esquelet d'una aplicació Canigó 3.1 amb arquitectura REST+HTML5/Javascript.A la plantilla que es crea amb el plugin, la part frontend corrersponent a un CRUD (Create-Read-Update-Delete) molt bàsic es troba realitzada amb HTML5/Javascript. No s'ha utilitzat cap llibreria de frontend (AngularJS, Bootstrap, EmberJS...), ja que és decisió de l'usuari triar la tecnologia més adient per la seva aplicació.\r\n\r\nAl HowTo publicat [aquest mes] (/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf) es descriu com fer la instal·lació de l'última versió del plugin (1.4.0) i la creació de l'esquelet d'una aplicació Canigó.\r\n\r\nRespecte a les tecnologies emprades a Canigó 3.1 per al backend les més rellevants són les següents:\r\n\r\n* *Spring MVC 4.1.0.RELEASE* : Framework Web basat en el patró Model-View-Controller.\r\n* *Spring Security 4.0.0.M2*: Framework que té la funció de proporcionar tant funcions d'autenticació com d'autorització a aplicacions Java.\r\n* *JPA (Java Persistence API) 2.1*: Busca la manera d'unificar les utilitats que proporcionen un mapeig objecte-relacional. La implementació de JPA per defecte a Canigó 3.1 és Hibernate versió 4.3.6.\r\n\r\nRecordar la Taula de compatibilitat de versions del plugin segons la versió d'Eclipse:\r\n\r\n|Versió Plugin|Versió Eclipse|\r\n|-----|--------------|\r\n|**1.2.1**|Helios (3.6.1)|\r\n|**1.3.1**|Luna (4.4)|\r\n|**1.4.0**|Mars (4.5)|","objectID":"L25vdGljaWVzLzIwMTUtMDktMDEtQ2FuaWdvLVBsYW50aWxsYS1hcGxpY2FjaW8tcmVzdA=="},"L25vdGljaWVzLzIwMTUtMDktMjMtQ2FuaWdvLVVzLWFwcGxldC1zaWduYXR1cmEtQ0FPQw==":{"date":1443484800000,"title":"Canigó. Ús applet d'e-signatura del CAOC","description":"La versió 45 del navegador web Google Chrome deixa de donar suport a la tecnologia NPAPI requerida per els applets Java. En conseqüència, l'applet d'e-signatura del CAOC s'ha d'executar en un altre navegador.","sections":["Notícies","home"],"key":"OCTUBRE2015","categories":["canigo"],"path":"/noticies/2015-09-23-Canigo-Us-applet-signatura-CAOC","content":"La versió 45 del navegador web Google Chrome deixa de donar suport a la tecnologia NPAPI requerida pels applets Java. En conseqüència, applets com el d'e-signatura del CAOC s'han d'executar en un altre navegador com per exemple Firefox o Internet Explorer.\r\n\r\nReferències:\r\n\r\n- [Chrome Support](https://support.google.com/chrome/answer/6213033)\r\n- [Java and Google Chrome Browser](https://java.com/en/download/faq/chrome.xml)\r\n\r\nDes d'altres navegadors, si la seguretat de Java bloqueja l'execució de l'applet cal afegir una excepció de seguretat per al lloc web del qual es descarrega.\r\n\r\nEn el cas concret de l'applet d'e-signatura, a més de tenir en compte aquests pre-requisits, des del consorci es fan una sèrie de recomanacions per la seva correcta execució:\r\n\r\n- Validar la versió de Safesign del client, en cas que no sigui l'última (3.0.76) s'hauria de desinstal·lar i descarregar des de la web del AOC ([Instal·lació T-CAT](https://web.aoc.cat/suport/knowledge-base/installacio-t-cat/))\r\n- Si es disposa d'un altre lector, es pot fer la prova si està dins la [llista de lectors homologats](https://web.aoc.cat/suport/knowledge-base/llista-de-lectors-homologats)\r\n- En cas de dubtes us podeu posar en contacte amb el CAOC a través del [Formulari de Suport](https://web.aoc.cat/suport/formulari-t-cat/)\r\n\r\n","objectID":"L25vdGljaWVzLzIwMTUtMDktMjMtQ2FuaWdvLVVzLWFwcGxldC1zaWduYXR1cmEtQ0FPQw=="},"L25vdGljaWVzLzIwMTUtMTAtMjctQ2FuaWdvLUFkYXB0YWNpby1hbC1QSVY=":{"date":1445904000000,"title":"Canigó. Adaptació al PIV de Gencat","description":"L'adaptació al PIV de Gencat és un requeriment per moltes aplicacions. L'estratègia a seguir per les aplicacions Canigó depèn de la versió en què estigui implementada.","sections":["Notícies","home"],"key":"NOVEMBRE2015","categories":["canigo"],"path":"/noticies/2015-10-27-Canigo-Adaptacio-al-PIV","content":"L'adaptació al [PIV (Programa d'Identificació Visual) de la Generalitat de Catalunya](http://www.gencat.cat/web/guies/estil/) és un requeriment per a moltes aplicacions web construïdes amb Canigó. L'estratègia a seguir per a aquestes aplicacions depèn de la versió en què estigui implementada. \r\n\r\n### Aplicacions ja desenvolupades amb Canigó 2 i Canigó 3\r\n\r\n* **Millor opció**:\r\n\r\n\t- Adaptar l'estil de l'aplicació al PIV mitjançant la modificació i creació de nous estils (css) sense modificar l'estructura (plantilles html) de l'aplicació. \r\n\r\n\t- Requereix un expert en maquetació, però l'esforç és molt menor que modificar l'estructura de les plantilles i incorporar els nous css\r\n\r\n* **No es recomana**:\r\n\r\n\t- Incorporar les plantilles de Bootstrap del nou Gencat ja que pot produir incompatibilitats amb la llibreria prototype.js utilitzada al servei de presentació de Canigó 2, a més de l'esforç que suposa modificar la capa de presentació (struts).\r\n\r\n* **Solució alternativa**:\r\n\r\n\t- Refer l'arquitectura de l'aplicació per desacoblar presentació i negoci. S'ha de tenir en compte que pot tenir un cost molt elevat.\r\n\r\n### Noves aplicacions Canigó 3\r\n\r\n* **Recomanació**:\r\n\r\n\t- Incorporació de Bootstrap 3 per al templating de l'aplicació i que l'arquitectura d'aquesta estigui basada en desacoblament client/servidor (veure [Arquitectura aplicació recomanada](/noticies/2015-07-24-Canigo-Arquitectura-aplicacio-recomanada/)). Qualsevol canvi en la presentació només suposarà canvis en el client i no haver de redesplegar el backend.\r\n\r\n\t- Es poden tenir equips separats per al manteniment i evolució de la presentació i el negoci, que poden portar ritmes diferents.\r\n\r\n* **No es recomana**:\r\n\r\n\t- Utilitzar una arquitectura a l'aplicació amb acoblament entre client i servidor (struts, jsf, ...) donat que pot dificultar modificacions en el templating i els estils.","objectID":"L25vdGljaWVzLzIwMTUtMTAtMjctQ2FuaWdvLUFkYXB0YWNpby1hbC1QSVY="},"L25vdGljaWVzLzIwMTUtMTEtMDUtRkFRcyBTSUM=":{"date":1446681600000,"title":"SIC. FAQ","description":"Com a novetat, a la secció SIC del Portal de Frameworks i Solucions d'Arquitectura, pròximament es publicaran les FAQ del SIC. L'objectiu d'aquestes FAQ és donar resposta a les qüestions que sovint ens plantegen els proveïdors d'aplicacions respecte a la integració amb el SIC.","sections":["Notícies","home"],"key":"NOVEMBRE2015","categories":["sic"],"path":"/noticies/2015-11-05-FAQs SIC","content":"Com a novetat, a la secció SIC del Portal de Frameworks i Solucions d'Arquitectura, pròximament es publicaran les FAQ del SIC. L'objectiu d'aquestes FAQ és donar resposta a les qüestions que sovint ens plantegen els proveïdors d'aplicacions respecte a la integració amb el SIC.\r\n\r\nA continuació s'enumeren algunes de les entrades que apareixeran en aquestes FAQ:\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Es poden pujar binaris al SVN del SIC?**\r\n\r\nPer defecte no donat que el SVN del SIC és un repositori de codi font, no de binaris. Ara bé, es poden contemplar excepcions en cas que el codi font inclogui Applets/Servlets, l'aplicació no es trobi mavenitzada o es vulgui fer ús del SVN de SIC per l'entrega de binaris a CPD. En aquests casos cal demanar l'excepció via SAU-Remedy.\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Puc demanar l'alta d'un usuari per accedir a un repositori del SVN?**\r\n\r\nNo tothom pot demanar d'alta usuaris al SIC, només ho poden demanar els responsables d'àmbit (OGOS, OGDP, @gencat.cat) o de CPD.\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**El meu àmbit encara no està migrat a Remedy i no disposo d'usuari a Remedy per poder obrir peticions SIC en aquest canal. Com puc fer peticions de SIC?**\r\n\r\nEn aquest cas concret, es pot fer enviant un correu a la [bústia de SAU-REMEDY] (mailto:sau.tic@gencat.cat) incloent tota la informació necessària per tractar la petició. Per a més informació consultar la secció sobre [Peticions SIC a SAU-Remedy](http://localhost:1313/sic/peticions/)\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Puc variar l'estructura de carpetes dels repositoris SVN de les meves aplicacions?**\r\n\r\nEls usuaris són lliures de poder modificar l'estructura de carpetes dins l'arrel dels repositoris SVN de SIC. SIC recomana una manera de treballar i en crear el repositori genera una estructura per defecte d'acord a aquesta manera. \r\n\r\nEn cas de voler utilitzar els repositoris SVN de SIC per a fer arribar els binaris a desplegar a CPD o voler fer servir jobs de Jenkins, sí que cal respectar certes normes. Aquestes es troben publicades al [Manual d'Integració de SIC](http://canigo.ctti.gencat.cat/related/sic/manual-integracio.pdf), apartats 3.1.4 i 3.1.5 .\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\n\r\n**Perquè en desplegar la meva aplicació a INT mitjançant un job de Jenkins del SIC s'ha desplegat una versió d'aplicació anterior a la que he escollit?**\r\n\r\nMolt probablement es deu al fet que abans l'execució del job s'ha desplegat l'aplicació manualment mitjançant la consola d'administració i la configuració de desplegament ha quedat lligada a aquella versió i no pas a la versió que compila i puja el job.\r\n\r\nPer a més informació sobre aquest problema i com evitar-ho, consultar el següent [article](http://canigo.ctti.gencat.cat/noticies/2015-10-05-SIC-Bones-practiques-desplegaments-INT/)\r\n<br/>\r\n<br/>\r\n<br/>\r\n<br/>\r\n\r\nA més d'aquestes FAQ, al [Portal de Frameworks i Solucions d'Arquitectura](http://canigo.ctti.gencat.cat/sic-documentacio/manuals/) hi ha publicats els Manuals d'Usuari i Integració amb més informació. En cas de dubtes es poden fer consultes via SAU-Remedy al servei \"FRAMEWORK SIC\".","objectID":"L25vdGljaWVzLzIwMTUtMTEtMDUtRkFRcyBTSUM="},"L25vdGljaWVzLzIwMTUtMTItMTgtU0lDLVNpc3RlbWEtYXV0b3JpdHphY2lvbnMtcGV0aWNpb25z":{"date":1450396800000,"title":"SIC. Sistema d'autoritzacions de peticions FRAMEWORK SIC a SAU-Remedy","description":"L'admissió de peticions al servei FRAMEWORK SIC de SAU-Remedy es troba restringit per un sistema de rols d'usuari que determina quines operacions pot demanar cada rol. Aquest article pretén explicar com es realitza aquesta discriminació.","sections":["Notícies","home"],"categories":["sic"],"key":"GENER2016","path":"/noticies/2015-12-18-SIC-Sistema-autoritzacions-peticions","content":"L'admissió de peticions al servei FRAMEWORK SIC de SAU-Remedy es troba restringit per un sistema de rols d'usuari que determina quines operacions pot demanar cada rol. Aquest article pretén explicar com es realitza aquesta discriminació.\r\n\r\nEs controla que les peticions que representen més impacte sobre els serveis SIC provinguin d'aquells usuaris amb més pes sobre el projecte. Es consideren peticions amb impacte:\r\n\r\n* Alta/Baixes d'usuaris SIC.\r\n* Restitució de passwords d'altres usuaris SIC.\r\n* Altes de repositoris [SVN](http://svn.intranet.gencat.cat/).\r\n* Petició d'aplicació d'excepció sobre el control d'extensions d'arxius a pujar als repositoris SVN (.war, .ear, .jar).\r\n\r\n<center>![autoritzacions_peticions_responsables.png](/images/news/autoritzacions_peticions_responsables.png)</center>\r\n\r\nN'hi ha altres tipus de peticions que no representen gaire impacte sobre els serveis SIC:\r\n\r\n* Restitució de password d'usuari SIC propi (a excepció del rol gestor de peticions SIC a SAU-Remedy, donat que no requereix un usuari al SIC).\r\n* Afegir llibreries al [Nexus](http://hudson.intranet.gencat.cat/nexus/) de SIC.\r\n* Altes/modificacions de Jobs de [Jenkins](http://hudson.intranet.gencat.cat/hudson/) de les aplicacions\r\n* Inscripció d'usuaris gestors de peticions SIC a SAU-Remedy (nou rol d'usuari que resta explicat al següent [article](http://canigo.ctti.gencat.cat/noticies/2015-12-23-SIC-Nou-rol-de-peticionari-a-SAU-Remedy/))\r\n\r\n<center>![autoritzacions_peticions_tecnics.png](/images/news/autoritzacions_peticions_tecnics.png)</center>\r\n\r\n\r\n\r\nPel que fa a les consultes o incidències amb serveis SIC, qualsevol usuari pot obrir-les a SAU-Remedy. No s'aplica aquest sistema de control d'autorització.\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTItMTgtU0lDLVNpc3RlbWEtYXV0b3JpdHphY2lvbnMtcGV0aWNpb25z"},"L25vdGljaWVzLzIwMTUtMTEtMDYtQ1MgQ2FuaWdvLVJvYWRtYXA=":{"date":1446768000000,"title":"CS Canigó. Roadmap","description":"Aquest mes d'Octubre ha estat publicat el Roadmap del CS Canigó. D'aquesta manera es dona visibilitat a les tasques que es fan des del Centre de Suport a curt i llarg termini amb una previsió de lliurament.","sections":["Notícies","home"],"key":"NOVEMBRE2015","categories":["cscanigo"],"path":"/noticies/2015-11-06-CS Canigo-Roadmap","content":"Aquest mes d'Octubre ha estat publicat el Roadmap del CS Canigó. D'aquesta manera es dona visibilitat a les tasques que es fan des del Centre de Suport a curt i llarg termini amb una previsió de lliurament.\r\n\r\n<iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1ycTBuP_02_fFQYHePMhAxAnNt70R4GyTP4phJn3EHi8&font=Default&lang=ca&initial_zoom=1&height=600' width='100%' height='600' frameborder='0'></iframe>\r\n\r\n*Aquest Roadmap està subjecte a canvis*\r\n\r\n<br>\r\n\r\nEl Roadmap és accessible des de la plana principal del [Portal de Frameworks i Solucions d'Arquitectura](http://canigo.ctti.gencat.cat). En aquesta mateixa plana, pròximament s'habilitarà un enllaç a un formulari amb la finalitat de fer arribar al CS Canigó propostes d'evolutius a incloure en el Roadmap.","objectID":"L25vdGljaWVzLzIwMTUtMTEtMDYtQ1MgQ2FuaWdvLVJvYWRtYXA="},"L25vdGljaWVzLzIwMTUtMTItMjMtU0lDLU5vdS1yb2wtZGUtcGV0aWNpb25hcmktYS1TQVUtUmVtZWR5":{"date":1450828800000,"title":"SIC. Nou rol de peticionari SIC a SAU-Remedy","description":"Neix a SIC un nou tipus d'usuari: Gestor de peticions a SAU-Remedy. Aquest tipus d'usuari pretén flexibilitzar el sistema d'autorització de peticions de SIC afegint un nou conjunt d'usuaris autoritzats per a poder demanar certs tipus de peticions de suport de FRAMEWORK SIC a SAU- Remedy.","sections":["Notícies","home"],"categories":["sic"],"key":"GENER2016","path":"/noticies/2015-12-23-SIC-Nou-rol-de-peticionari-a-SAU-Remedy","content":"Neix a SIC un nou tipus d'usuari: Gestor de peticions a SAU-Remedy. Aquest tipus d'usuari pretén flexibilitzar el sistema [d'autorització de peticions de SIC] (http://canigo.ctti.gencat.cat/noticies/2015-12-18-SIC-Sistema-autoritzacions-peticions/) afegint un nou conjunt d'usuaris autoritzats a poder demanar certs tipus de peticions de suport de FRAMEWORK SIC a SAU- Remedy.\r\n\r\nAquests usuaris **no tindran accés als serveis de SIC** (no podrà treballar amb repositoris SVN ni amb jobs de Jenkins). El seu abast **es limitarà a poder demanar**  mitjançant SAU-Remedy:\r\n\r\n* Altes / modificacions de Jobs\r\n* Altes de llibreries a Nexus\r\n* Fer consultes sobre SIC\r\n* Reportar incidències relacionades amb serveis de SIC.\r\n\r\nLa petició d'inscripció en aquest grup d'usuaris cal que sigui efectuada pels responsables d'arquitectura i qualitat del Lot. L'haurà de demanar mitjançant petició de suport funcional a [SAU-Remedy](http://canigo.ctti.gencat.cat/sic/peticions/),adjuntant el [formulari d'alta] (http://canigo.ctti.gencat.cat/sic-documentacio/formularis/) corresponent.\r\nLes peticions que demani aquest grup d'usuaris hauran de ser referents a aplicacions del seu mateix lot.\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .","objectID":"L25vdGljaWVzLzIwMTUtMTItMjMtU0lDLU5vdS1yb2wtZGUtcGV0aWNpb25hcmktYS1TQVUtUmVtZWR5"},"L25vdGljaWVzLzIwMTUtMTEtMTgtQ2FuaWdvLUVudG9ybi1EZXY=":{"date":1447804800000,"title":"Canigó. Nou entorn de desenvolupament","description":"A mitjans d'aquest mes de Novembre ha estat publicat el nou entorn de desenvolupament de Canigó. Amb aquest nou entorn es canvia l'antic instal·lable (.exe) exclusiu per a sistemes operatius Windows per un entorn multiplaforma amb moltes més possibilitats.","sections":["Notícies","home"],"key":"DESEMBRE2015","categories":["canigo"],"path":"/noticies/2015-11-18-Canigo-Entorn-Dev","content":"A mitjans d'aquest mes de Novembre ha estat publicat el nou entorn de desenvolupament de Canigó. Amb aquest nou entorn es canvia l'antic instal·lable (.exe) exclusiu per a sistemes operatius Windows per un entorn multiplaforma amb moltes més possibilitats.\r\n\r\n\r\nA continuació s'especifiquen les característiques més rellevants d'aquest nou entorn de desenvolupament:\r\n\r\n**Màquina virtual**\r\n\r\n* VM [Oracle VirtualBox](https://www.virtualbox.org/): aprovisionament de màquina virtual a partir d'un script [Vagrant](https://www.vagrantup.com/)\r\n* Linux: màquina virtual basada en sistema operatiu [Ubuntu](http://www.ubuntu.com/)\r\n* Personalitzacions: màquina virtual personalitzada proporcionant un espai d'eines CTTI\r\n\r\n**IDE**\r\n\r\nL'IDE és [Spring Tool Suite] (https://spring.io/tools) (basat en Eclipse Mars) amb JDK 7 (Oracle) i els següents plugins:\r\n\r\n* M2Eclipse per integració amb [Apache Maven](https://maven.apache.org/)\r\n* CTTI Canigó per creació aplicacions Canigó 3.1 basades en arquitectura REST+HTML5/JS o JSF\r\n* Spring Tool Suite per facilitar el desenvolupament d'aplicacions basades en [Spring](http://spring.io/projects)\r\n* Docker Tooling per manegar els contenidors [Docker](https://www.docker.com/)\r\n* Subclipse per integració amb [Subversion] (https://subversion.apache.org/)\r\n* SonarQube per integració amb [SonarQube] (http://www.sonarqube.org/) (antic Sonar)\r\n\r\n**Altres**\r\n\r\n* Engine Docker i Docker Compose Tool per l'execució de contenidors Docker\r\n* Navegador Google Chrome\r\n* Client VPNC per accés a XCAT\r\n* Fons de pantalla corporatiu CTTI\r\n* Accessos directes a eines CTTI: SIC ([SVN](http://svn.intranet.gencat.cat) i [Jenkins](http://hudson.intranet.gencat.cat)), [JIRA CSTD](https://cstd.ctti.gencat.cat/), [Portal Frameworks i Solucions d'Arquitectura](http://canigo.ctti.gencat.cat/).\r\n\r\n\r\nA més d'aquest nou entorn de desenvolupament des del CS Canigó també s'ha publicat una aplicació demo [Equipaments](https://github.com/cs-canigo/equipaments) amb la finalitat de proporcionar als proveïdors d'aplicacions un exemple d'aplicació Canigó 3.1 per a ser desplegada en contenidors Docker. L'ús d'aquests contenidors Docker pretén simular el desplegament en els PaaS del [Full de ruta de CTTI] (https://portic.ctti.gencat.cat/les_tic/Normativa/arquitectura/Documents/Full%20de%20Ruta%20del%20Programari.pdf#search=full%20de%20ruta). El stack on es desplega aquesta aplicació demo Equipaments és Apache 2.4/Tomcat 7/MySQL 5.6.\r\n\r\nA la secció [\"Framework Canigó\"](http://canigo.ctti.gencat.cat/canigo/) -> [\"Entorn de desenvolupament\"](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/) dins d'aquest portal podeu trobar més informació amb el detall del procés d'instal·lació, execució de l'aplicació demo Equipaments així com d'altra informació d'interès per a treballar amb aquest nou entorn de desenvolupament.\r\n\r\nPer a qualsevol dubte, problema o suggerència relatiu a aquest nou entorn de desenvolupament ens podeu fer arribar una petició al servei [CAN](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN) del JIRA CSTD o bé enviar-nos un correu a la nostra [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTEtMTgtQ2FuaWdvLUVudG9ybi1EZXY="},"L25vdGljaWVzLzIwMTYtMDEtMjgtQ2FuaWdvLUNvbm5lY3RvcnMtUElDQQ==":{"date":1453939200000,"title":"Noves versions dels connectors de Canigó amb la PICA","description":"S'han publicat noves versions dels connectors amb la PICA per a complir les noves restriccions d'esquema","sections":["Notícies","home"],"categories":["canigo"],"key":"FEBRER2016","path":"/noticies/2016-01-28-Canigo-Connectors-PICA","content":"S'han publicat noves versions dels connectors amb la PICA per a complir les noves restriccions d'esquema. És necessari informar les dades Nom i Nif d'emissor, així com informar les dades d'un funcionari en la majoria dels productes de la PICA. Els valors dels camps \"nifEmisor\" i \"nomEmisor\" a informar s’han de consultar a la [OT PICA](mailto:requeridors.otpica.ctti@gencat.cat). Per a més detall dels productes podeu visitar la Intranet d'Administració Electrònica ([IPAE](http://ipae.intranet.gencat.cat)).\r\n\r\nA continuació es mostren les noves versions publicades dels connectors amb la PICA per Canigó 2 i Canigó 3:\r\n\r\n__Canigó 2__:\r\n\r\n|Nom connector|Versió|\r\n|-----|--------------|\r\n|**canigo-connectors-pica-avisosalertes**|1.0.1|\r\n|**canigo-connectors-pica-dni**|1.1.0|\r\n|**canigo-connectors-pica-padro**|1.0.1|\r\n|**canigo-connectors-pica-tributs**|1.0.2|\r\n|**canigo-connectors-sarcat**|1.1.1|\r\n|**canigo-connectors-psis**|1.0.2|\r\n|**canigo-connectors-nt**|1.0.2|\r\n\r\n* _Per a més informació consultar la documentació de [Canigó 2](/canigo-documentacio-versions-anteriors/versio-2/)_\r\n\r\n__Canigó 3__:\r\n\r\n|Nom connector|Versió|\r\n|-----|--------------|\r\n|**canigo.integration.avisosalertes_pica**|1.1.2|\r\n|**canigo.integration.dni.pica**|1.2.0|\r\n|**canigo.integration.padro.pica**|1.1.1|\r\n|**canigo.integration.tributs.pica**|1.1.2|\r\n|**canigo.integration.sarcat.pica**|1.1.2|\r\n|**canigo.integration.psis**|1.1.2|\r\n|**canigo.integration.notificacions.electroniques**|1.3.1|\r\n\r\n* _Per a més informació consultar la documentació de [Canigó 3](/canigo-documentacio-versions-3x-integracio/)_\r\n\r\nEls canvis a l'esquema estan operatius des del 21 de desembre a PRE i durant els pròxims mesos s'aniran incorporant a PRO. Recomanem que es realitzin proves contra preproducció i en cas de no tenir nif/nom emissor que es demani a la PICA com més aviat millor.\r\n\r\nEn cas de tenir qualsevol dubte en l'ús per part de les aplicacions dels connectors amb la PICA us podeu posar en contacte amb el CS Caniǵo a través del [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/CAN) amb una petició de consulta o suport, o bé enviant-nos un correu a la nostra [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDEtMjgtQ2FuaWdvLUNvbm5lY3RvcnMtUElDQQ=="},"L25vdGljaWVzLzIwMTUtMTItMDctU0lDLUJhbGFuYy0yMDE1":{"date":1449446400000,"title":"SIC. Balanç 2015","description":"Evolució del SIC des de la implantació del nou model TIC fins al desembre del 2015","sections":["Notícies","home"],"categories":["sic"],"key":"DESEMBRE2015","path":"/noticies/2015-12-07-SIC-Balanc-2015","content":"El canvi al nou model TIC ha marcat un punt i apart a la història del SIC. Des d'aquell instant, i durant aquest any i mig, el SIC ha anat assolint un conjunt de fites que queden resumides en el següent fris cronològic:\r\n\r\n<center><iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1KwmAmGiVqaPRzp3cgcZ0iCGAfb56eyJv1rgkoizBtGQ&font=Default&lang=ca&hash_bookmark=true&initial_zoom=2&height=500' width='100%' height='500' frameborder='0'></iframe></center>\r\n\r\nAquesta evolució que ha experimentat el SIC s'ha aplicat en les següents vessants:\r\n\r\n* A nivell tecnològic:\r\n\t* ampliant el ventall de tecnologies suportades:\r\n\t\t* segons el llenguatge:\r\n\t\t\t* .NET i NuGet\r\n\t\t\t* PHP\r\n        * servidors:\r\n        \t* Websphere 8.5\r\n\t\t* bases de dades:\r\n\t\t\t* Oracle 12c\r\n* A nivell d'infraestructura:\r\n\t* Implantació d'un model amb SLAVES que permet la construcció i el desplegament dins del propi CPD que alberga l'aplicació\r\n* A nivell funcional:\r\n\t* s'ha incrementat el nombre d'aplicacions que utilitzen el SVN, que construeixen i que despleguen mitjançant els nostres servidors d'integració contínua Jenkins.\r\n* A nivell de seguretat:\r\n\t* a més de l'autenticació al SVN, s'ha afegit un model autoritzatiu que permet determinar la visibilitat i les accions en funció de rols\r\n\r\nLa nostra intenció és seguir evolucionant el SIC per donar servei a qualsevol aplicació que s'utilitzi a la Generalitat. Per a més informació sobre els futurs evolutius que s'aplicaran al SIC, podeu consultar el [Roadmap d'arquitectura del CTTI](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTItMDctU0lDLUJhbGFuYy0yMDE1"},"L25vdGljaWVzLzIwMTUtMTItMjQtQ2FuaWdvLUJhbGFuYy0yMDE1":{"date":1450915200000,"title":"Canigó. Balanç 2015","description":"Resum de les tasques realitzades per l'equip de Canigó durant l'any 2015","sections":["Notícies","home"],"categories":["canigo"],"key":"GENER2016","path":"/noticies/2015-12-24-Canigo-Balanc-2015","content":"Durant l'any 2015 des de l'equip de Canigó hem assolit diferents fites que resumim en el següent timeline:\r\n\r\n<center><iframe src='//cdn.knightlab.com/libs/timeline3/latest/embed/index.html?source=1culZh-JCr-W43Vt1qNGyhTT7wMuAOHA_BLQOwodSjaY&font=Default&lang=en&initial_zoom=1&height=650&lang=ca' width='100%' height='650' frameborder='0'></iframe></center>\r\n\r\nEns agradaria destacar per sobre de tota la resta les següents:\r\n\r\n* *[Nou Portal de Canigó ](http://canigo.ctti.gencat.cat)* (1-2-2015)\r\n\r\nAl mes de Febrer es va efectuar la migració de l'antic Confluence a un nou portal amb els nous estils Gencat. Aquest nou portal és un site estàtic que facilita molt la publicació de nous continguts així com la interacció amb els usuaris. Aprofitant aquesta migració s'han revisat continguts obsolets actualitzant-los o bé donant-los de baixa.\r\n\r\n* *[Nou entorn de treball](http://canigo.ctti.gencat.cat/canigo/entorn-desenvolupament/)* (15-11-2015)\r\n\r\nDurant els primers mesos de l'any s'ha analitzat la millor opció per un nou entorn de desenvolupament d'aplicacions Canigó. Finalment s'ha optat per l'aprovisionament d'una màquina virtual proporcionant un espai d'eines per facilitar el desenvolupament. Conjuntament amb aquest entorn de desenvolupament es proporciona una demo d'aplicació per a ser desplegada en un stack Apache+Tomcat+MySQL mitjançant contenidors Docker.\r\n\r\n* *Racionalització d'infraestructura* (23/12/2015 - Finalitzada primera fase)\r\n\r\nDes del mes de Octubre s'està duent a terme un projecte conjuntament amb CPD1 per tal de racionalitzar la infraestructura utilitzada al CS Canigó. En una primera fase han estat migrats al SIC el SVN, Hudson, i repositoris Maven 1 i Maven 2 propis de Canigó. Gràcies a aquesta migració de serveis destinats al manteniment del framework Canigó deixarà de ser necessària una infraestructura dedicada.\r\n\r\nPer l'any 2016 es preveu seguir evolucionant el nou portal i entorn de treball, i com a principal objectiu és pretén actualitzar l'actual versió 3.1 de Canigó. Aquesta actualització es farà aprofitant el coneixement adquirit en eines RAD analitzades durant l'any i l'estudi tecnològic realitzat sobretot pel que fa a l'evolució del framework JEE Spring. A mida que es vagin planificant les tasques previstes pel 2016 les podreu consultar en el [Roadmap d'arquitectura del CTTI](http://canigo.ctti.gencat.cat/centre-de-suport/roadmap/).\r\n","objectID":"L25vdGljaWVzLzIwMTUtMTItMjQtQ2FuaWdvLUJhbGFuYy0yMDE1"},"L25vdGljaWVzLzIwMTYtMDItMDQtU0lDLUludGVncmFjaW8tQ29udGludWEtZG90TmV0":{"date":1454544000000,"title":"Suport complet del SIC a la integració contínua amb .NET","description":"El SIC s'ha certificat en la construcció, en la gestió de dependències i en els desplegaments d'aplicatius programats amb .NET","sections":["Notícies","home"],"categories":["sic"],"key":"FEBRER2016","path":"/noticies/2016-02-04-SIC-Integracio-Continua-dotNet","content":"__Els inicis amb MSBuild__\r\n\r\nDes de l'estiu de 2015, el SIC ha estat treballant per poder oferir el mateix suport a les aplicacions desenvolupades amb .NET que el que ja ofereix a les aplicacions desenvolupades amb Java.\r\n\r\nCom a primer pas en la integració de .NET al SIC, es va habilitar la compilació i el muntatge d'aquest tipus d'aplicacions mitjançant [MSBuild](https://msdn.microsoft.com/es-es/library/dd393574.aspx).\r\n\r\nLa utilització de MSBuild permet controlar amb un fitxer xml el procés de compilació i muntatge del programari d'una forma equivalent a les eines del món Java tals com ANT i Maven. Amb MSBuild, a través de la definició de tasques i d'objectius en aquest fitxer xml, es pot orquestrar la gestió de mòduls i la generació dels artefactes .NET.\r\n\r\n__Gestió de dependències amb NuGet__\r\n\r\nUn element fonamental en la integració contínua és la gestió de dependències. L'ús de llibreries provinents de repositoris oficials o de pròpies validades i emmagatzemades en un repositori de confiança garanteix l'absència d'errors de compatibilitat entre les llibreries utilitzades en l'entorn de desenvolupament i l'entorn d'execució.\r\n\r\nDurant la tardor de 2015, es va habilitar un nou repositori en el servidor Nexus del SIC que permet emmagatzemar llibreries .NET. Es tracta d'un repositori Nexus compatible amb [NuGet](https://www.nuget.org/). A més, es va habilitar en els servidors d'integració contínua l'ús d'aquest repositori per fer el muntatge de l'aplicació. D'aquesta manera, es garanteix que les llibreries utilitzades són fiables tant en termes de compatibilitat i fiabilitat com de seguretat.\r\n\r\n__Desplegaments amb Web Deploy__\r\n\r\nUn cop s'ha aconseguit controlar el procés de muntatge i la gestió de dependències, era el torn estandarditzar el procés de desplegament als servidors.\r\n\r\nDurant el mes de gener de 2016, s'han certificat al SIC els desplegaments a IIS mitjançant [Web Deploy](https://www.microsoft.com/es-es/download/details.aspx?id=43717&751be11f-ede8-5a0c-058c-2ee190a24fa6=True). Amb aquesta eina, s'aprofita la generació de l'empaquetament zip --que es desa en el procés de muntatge en les carpetes de binaris-- per desplegar l'aplicació de forma automàtica als servidors IIS.\r\n\r\nAquest sistema de desplegament és el que internament utilitza Visual Studio en els entorns de desenvolupament.\r\n\r\nAmb aquestes tres eines, el SIC està preparat per oferir un suport complet a les aplicacions desenvolupades amb .NET. La tecnologia .NET ja és considerada \"first class\" dins del SIC, amb totes les prestacions que fins avui només gaudia la tecnologia JEE.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDItMDQtU0lDLUludGVncmFjaW8tQ29udGludWEtZG90TmV0"},"L25vdGljaWVzLzIwMTYtMDItMTAtU0lDLUNhbnZpcy1wZXRpY2lvbnMtZGVzcGxlZ2FtZW50cy1qb2JzLVBSRS1QUk8=":{"date":1455062400000,"title":"Canvi al sistema d'obertura de peticions als jobs de desplegament a PRE/PRO de SIC","description":"Fins el moment, les peticions de desplegament a entorns PRE/PRO que es demanaven mitjançant jobs de Jenkins SIC seguien l'antic model d'obertura de peticions: correu a la bústia de SAU. Amb l'entrada de Remedy, el mecanisme per a demanar desplegaments ha canviat.","sections":["Notícies","home"],"categories":["sic"],"key":"MARC2016","path":"/noticies/2016-02-10-SIC-Canvis-peticions-desplegaments-jobs-PRE-PRO","content":"Fins el moment, les peticions de desplegament a entorns PRE/PRO que es demanaven mitjançant jobs de Jenkins SIC seguien l'antic model d'obertura de peticions: correu a la bústia de SAU.\r\nAmb l'entrada de Remedy, el mecanisme per a demanar desplegaments ha canviat. Les aplicacions donades d'alta a Remedy han de demanar els desplegaments mitjançant l'obertura d'un tiquet de tipus canvi a l'eina.\r\nL'equip de SIC ha treballat en l'adaptació dels jobs de desplegament a PRE/PRO per tal d'acollir-se al model de peticions de desplegament mitjançant Remedy.\r\n\r\nEls jobs de desplegament a PRE/PRO de SIC adaptats a aquest sistema:\r\n\r\n* Pujaran els artefactes a desplegar als servidors de CPD (aquest punt no canvia respecte al model anterior).\r\n* Obriran un **canvi de tipologia “Desplegament” i en estat=”Draft”** a Remedy (no es requerirà passar prèviament per l'Atrium Impact Simulator) i com a Sol·licitant l'usuari que ha executat el job de desplegament. **L'usuari que executarà el job ha d'estar donat d'alta a GICAR i amb usuari autoritzat a treballar a ITSM Remedy. Si no és així, ITSM Remedy denegarà l'obertura del canvi** i el job finalitzarà amb error.\r\n* Els valors dels camps 'Summary' i 'Notes' que figuraran al Draft del canvi, es correspondran amb els camps 'TITOL' i 'OBSERVACIONS' del job de Jenkins. Aquests s'indicaran amb un valor per defecte que l'usuari podrà editar. La informació sobre la ubicació on s'han pujat prèviament els artefactes a desplegar s'afegirà automàticament al camp ''Notes'.\r\n* Una vegada creat el Draft, el job retornarà l'identificador de petició creada a Remedy. En paral·lel, ITSM Remedy enviarà una notificació d'obertura de tasca a la bústia de l'usuari que ha executat el job des del SIC.\r\n* El Draft es generarà amb uns camps mínims. Posteriorment, qualsevol usuari del grup de gestió d’ITSM REMEDY associat al desplegament haurà d'accedir al Draft per completar la resta de dades (incloent el document amb les instruccions de desplegament) i aplicar la instrucció operativa vigent de Gestió de Canvis.\r\n\r\n\r\n<center>![autoritzacions_peticions_responsables.png](/images/news/SIC-Jobs-peticions-Remedy.png)</center>\r\n\r\nEl canvi es va activar el dia **22 de Febrer** per als jobs d'aquelles aplicacions que ja es trobin dins Remedy. Els jobs de la resta d'aplicacions que encara no s'hagin integrat a Remedy mantindran l'antic sistema d'obertura de petició via correu a SAU.\r\nEn el moment que aquestes aplicacions s'afegeixin a Remedy, l'equip de SIC actualitzarà els seus jobs per tal que facin servir el model d'obertura de canvis via ITSM Remedy (els proveïdors no s'hauran de preocupar de demanar l'actualització dels jobs).\r\n\r\nPer a qualsevol dubte relatiu a aquest canvi, podeu contactar amb SAU (sau.tic@gencat.cat / Consulta al servei 'FRAMEWORK SIC' de Remedy).\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDItMTAtU0lDLUNhbnZpcy1wZXRpY2lvbnMtZGVzcGxlZ2FtZW50cy1qb2JzLVBSRS1QUk8="},"L25vdGljaWVzLzIwMTYtMDItMTAtU0lDLUNhbnZpcy1wZXRpY2lvbnMtZGVzcGxlZ2FtZW50cy1qb2JzLVBSRS1QUk9+":{"date":1455062400000,"title":"Canvi al sistema d'obertura de peticions als jobs de desplegament a PRE/PRO de SIC","description":"Fins el moment, les peticions de desplegament a entorns PRE/PRO que es demanaven mitjançant jobs de Jenkins SIC seguien l'antic model d'obertura de peticions: correu a la bústia de SAU. Amb l'entrada de Remedy, el mecanisme per a demanar desplegaments ha canviat.","sections":["Notícies"],"categories":["sic"],"key":"MARC2016","path":"/noticies/2016-02-10-SIC-Canvis-peticions-desplegaments-jobs-PRE-PRO~","content":"Fins el moment, les peticions de desplegament a entorns PRE/PRO que es demanaven mitjançant jobs de Jenkins SIC seguien l'antic model d'obertura de peticions: correu a la bústia de SAU.\r\nAmb l'entrada de Remedy, el mecanisme per a demanar desplegaments ha canviat. Les aplicacions donades d'alta a Remedy han de demanar els desplegaments mitjançant l'obertura d'un tiquet de tipus canvi a l'eina.\r\nL'equip de SIC ha treballat en l'adaptació dels jobs de desplegament a PRE/PRO per tal d'acollir-se al model de peticions de desplegament mitjançant Remedy.\r\n\r\nEls jobs de desplegament a PRE/PRO de SIC adaptats a aquest sistema:\r\n\r\n* Pujaran els artefactes a desplegar als servidors de CPD (aquest punt no canvia respecte al model anterior).\r\n* Obriran un **canvi de tipologia “Desplegament” i en estat=”Draft”** a Remedy (no es requerirà passar prèviament per l'Atrium Impact Simulador) i com a Sol·licitant l'usuari que ha executat el job de desplegament. **L'usuari que executarà el job ha d'estar donat d'alta GICAR i, posteriorment, replicat a ITSM Remedy perquè si no és així, ITSM Remedy denegarà l'obertura del canvi** i el job finalitzarà amb error.\r\n* Els valors dels camps 'Summary' i 'Notes' que figuraran al Draft es correspondran amb els camps 'TITOL' i 'OBSERVACIONS' del job. Aquests s'indicaran amb un valor per defecte que l'usuari podrà editar. La informació sobre la ubicació on s'han pujat prèviament els artefactes a desplegar s'afegirà automàticament al camp ''Notes'.\r\n* Una vegada creat el Draft, el job retornarà l'identificador de petició creada. En paral·lel, ITSM Remedy enviarà una notificació d'obertura de tasca a la bústia de l'usuari que ha executat el job des del SIC.\r\n* El Draft es generarà amb uns camps mínims. Posteriorment, qualsevol usuari del grup de gestió d’ITSM REMEDY associat al desplegament haurà d'accedir al Draft per completar la resta de dades (incloent el document amb les instruccions de desplegament) i aplicar la instrucció operativa vigent de Gestió de Canvis.\r\n\r\n\r\n<center>![autoritzacions_peticions_responsables.png](/images/news/SIC-Jobs-peticions-Remedy.png)</center>\r\n\r\nEl canvi està previst activar-se el dia **22 de Febrer** per als jobs d'aquelles aplicacions que ja es trobin dins Remedy. Els jobs de la resta d'aplicacions que encara no s'hagin integrat a Remedy mantindran l'antic sistema d'obertura de petició via correu a SAU.\r\nEn el moment que aquestes aplicacions s'afegeixin a Remedy, l'equip de SIC actualitzarà els seus jobs per tal que facin servir el model d'obertura de canvis via ITSM Remedy (els proveïdors no s'hauran de preocupar de demanar l'actualització dels jobs).\r\n\r\nPer a qualsevol dubte relatiu a aquest canvi, podeu contactar amb SAU (sau.tic@gencat.cat / Consulta al servei 'FRAMEWORK SIC' de Remedy).\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDItMTAtU0lDLUNhbnZpcy1wZXRpY2lvbnMtZGVzcGxlZ2FtZW50cy1qb2JzLVBSRS1QUk9+"},"L25vdGljaWVzLzIwMTYtMDMtMDEtQ2FuaWdvLUNvbm5lY3Rvci1QU0dE":{"date":1456790400000,"title":"Nou connector de Canigó 3 amb la Plataforma de Serveis de Gestió documental (PSGD)","description":"S'ha publicat un nou connector de Canigó 3 amb la Plataforma de Serveis de Gestió documental (en endavant PSGD). El propòsit del connector és proporcionar una interfície Java per accedir als serveis exposats per la PSGD.","sections":["Notícies","home"],"categories":["canigo"],"key":"MARC2016","path":"/noticies/2016-03-01-Canigo-Connector-PSGD","content":"S'ha publicat un nou connector de Canigó 3 amb la Plataforma de Serveis de Gestió documental (en endavant PSGD). El propòsit del connector és proporcionar una interfície Java per accedir als serveis exposats per la PSGD.\r\n\r\nEl connector permet el consum de totes les funcionalitats oferides per aquest servei:\r\n\r\n* _Gestió del token d'autenticació_: controla el cicle de vida del token d'autenticació renovant-ho automàticament quan aquest hagi caducat\r\n* _Gestió de documents_: permet el consum de les funcionalitats relacionades amb documents\r\n\t- Alta d’un nou document (en streaming)\r\n\t- Baixa lògica d’un document\r\n\t- Marcar un document com a no modificable (“Check-out”)\r\n\t- Carregar una nova versió d’un document i marcar-lo com a modificable (“Check-in”)\r\n\t- Editar les metadades d’un document\r\n\t- Descarregar un document (en streaming)\r\n\t- Cercar documents en funció de les seves metadades\r\n* _Gestió de relació d’expedients_: permet el consum dels serveis relacionats amb la gestió de carpetes contenidores de documents\r\n\t- Alta d’un expedient\r\n\t- Baixa d’un expedient\r\n\t- Assignació d’un document a un expedient\r\n\t- Eliminar l’assignació d’un document a un expedient\r\n* _Gestió del repositori_: permet el consum dels serveis relacionats amb la gestió del quadre de classificació i del tipus de documents\r\nsuportats.\r\n\t- Manteniment del quadre de classificació\r\n\t- Manteniment de la tipologia de documents\r\n\r\nAquest connector és el primer dins el framework que consumeix serveis REST i no Webservices (SOAP). Donat que Canigó està basat en [Spring](https://projects.spring.io/spring-framework/) s'ha emprat la classe [RestTemplate](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html) per a la seva implementació. Destacar també la modalitat en streaming utilitzada per l'enviament de fitxers de gran mida evitant possibles problemes de memòria en les aplicacions.\r\n\r\nEn cas de tenir qualsevol dubte en l'ús del connector de Canigó 3 amb la PSGD podeu consultar la [documentació del connector](http://canigo.ctti.gencat.cat/canigo-documentacio-versions-3x-integracio/modul-psgd/) publicada al portal, posar-vos posar en contacte amb el CS Caniǵo a través del [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/CAN) amb una petició de consulta o suport, o bé enviant-nos un correu a la nostra [bústia](mailto:oficina-tecnica.canigo.ctti@gencat.cat).\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDMtMDEtQ2FuaWdvLUNvbm5lY3Rvci1QU0dE"},"L25vdGljaWVzLzIwMTYtMDQtMDEtU0lDLUV0aXF1ZXRhZ2UtYWwtU1ZO":{"date":1459468800000,"title":"SIC. Etiquetatge de versions al SVN del SIC","description":"Hi ha diverses maneres de crear versions de codi al repositori SVN del SIC (sota directori /tags). Aquest article pretén recollir-ne algunes i aconsellar l'ús d'una en particular.","sections":["Notícies","home"],"categories":["sic"],"key":"ABRIL2016","path":"/noticies/2016-04-01-SIC-Etiquetage-al-SVN","content":"Hi ha diverses maneres de crear versions de codi al repositori SVN del SIC (sota directori /tags). Aquest article pretén recollir-ne algunes i aconsellar l'ús d'una en particular.\r\n\r\nEs parteix del fet que, tal com s'esmenta al [Manual d'Integració amb SIC] (http://canigo.ctti.gencat.cat/related/sic/manual-integracio.pdf), ja s'ha realitzat una primera pujada del codi font al directori /trunk del repositori de l'aplicació al SVN del SIC.\r\n<center>![etiquetatge_svn_trunk.PNG](/images/news/etiquetatge_svn_trunk.PNG)</center>\r\n\r\nLes posteriors versions (estables) del codi haurien de constar al directori /tags del repositori SVN de l'aplicació. Aquestes versions es poden generar de les següents maneres:\r\n\r\n<br/>\r\n<br/>\r\n\r\n**A partir del codi font de l'entorn de desenvolupament local**\r\n\r\nEs sincronitzaria el codi font de l'entorn local amb una nova carpeta dins el directori /tags del repositori SVN i es faria un checkin d'aquest. Això implicaria la creació d'una nova còpia etiquetada del codi al repositori, deslligada de la versió que figura al directori /trunk.\r\n<center>![etiquetatge_svn_opcio1.PNG](/images/news/etiquetatge_svn_opcio1.PNG)</center>\r\n\r\n<br/>\r\n<br/>\r\n\r\n**A partir del codi font al /trunk del repositori SVN del SIC**\r\n\r\nEn primer lloc caldria sincronitzar el codi font de l'entorn local amb el de la carpeta /trunk del repositori SVN de l'aplicació al SIC. Posteriorment caldria generar un tag d'aquest contingut i deixar-ho a la carpeta de /tags. La versió etiquetada del codi no seria una nova còpia del codi sinó una referència a al contingut del /trunk en el moment de generar-la (alterar posteriorment el contingut del /trunk no alterarà el contingut del tag generat).\r\n<center>![etiquetatge_svn_opcio2.PNG](/images/news/etiquetatge_svn_opcio2.PNG)</center>\r\n\r\n<br/>\r\n\r\n\r\nDes de SIC recomanem fer servir aquesta segona manera d'etiquetar per 2 motius:\r\n\r\n* Es redueix considerablement el temps d'espera en fer el checkin donat que només s'actualitzen els canvis al /trunk i l'operació de crear el tag del contingut del /trunk al repositori SVN és immediata.\r\n* Es genera un històric de canvis entre les versions, doncs les versions generades al /tag es troben lligades al /trunk, no són còpies noves de codi font.\r\n\r\n**NOTA**: Es recorda que els repositoris SIC són considerats com a repositoris d'entregables, no com a repositoris de treball. Per tant, només s'hauria de pujar el codi font en el /trunk quan es desitgi publicar una nova versió del codi.\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDQtMDEtU0lDLUV0aXF1ZXRhZ2UtYWwtU1ZO"},"L25vdGljaWVzLzIwMTYtMDMtMzEtU0lDLURlc3BsZWdhbWVudC1kZS1zaXRlcy1zdGF0aWNzLWFsLWNsb3Vk":{"date":1459382400000,"title":"SIC. S'habiliten els desplegaments de sites estàtics al núvol","description":"A partir d'aquest mes de març, el SIC comença a fer les seves primeres passes amb les tecnologies cloud integrant el desplegament de sites estàtics a Bluemix, el servei al núvol d'IBM.","sections":["Notícies","home"],"categories":["sic"],"key":"ABRIL2016","path":"/noticies/2016-03-31-SIC-Desplegament-de-sites-statics-al-cloud","content":"Un dels objectius que el SIC s'ha fixat enguany és ampliar el ventall de tecnologies i paradigmes que suporta per donar servei al màxim d'aplicacions possible. Amb la integració dels desplegaments de sites estàtics al núvol, s'inicia un nou camí en què es pretèn que el paraigua de la Integració Contínua acabi cobrint el 100% de les aplicacions de la Generalitat de Catalunya que requereixin desplegar-se en aquest nou tipus d'entorn.\r\n\r\nEl SIC ha publicat una nova versió del *Formulari d’alta d’aplicació per al Portal d’Integració Contínua (Tasques al Jenkins)* que podeu trobar a [la plana de Formularis del SIC del Portal](http://canigo.ctti.gencat.cat/sic-documentacio/formularis/). És mitjançant aquest formulari que es pot sol·licitar aquest nou tipus de desplegaments. Veureu que s’ha creat un nou apartat \"Web estàtiques\" per aplicacions d'aquest tipus.\r\n\r\n### Sites estàtics a Bluemix\r\n\r\nVal a dir que, com a primera aproximació a aquest nou escenari, el SIC ha decidit limitar-se al desplegament de sites estàtics a Bluemix, la solució Cloud d'IBM.\r\n\r\nBluemix permet per desplegar múltiples aplicacions i/o serveis ja siguin en forma de buildpacks --com és en aquest cas-- o d'altres --com per exemple contenidors Docker--. Aquests elements desplegats s'emmagatzemen dins d'un espai determinat que, alhora, pertany a una organització concreta. És a dir, una organització pot contenir múltiples espais que alhora poden contenir diverses aplicacions. Aquesta és la jerarquia utilitzada a Bluemix per estructurar les aplicacions i els serveis albergats.\r\n\r\n<center>![sites_estatics_Bluemix.png](/images/news/sites_estatics_Bluemix.png)</center>\r\n\r\n### Jobs de Jenkins\r\n\r\nEn principi, cada aplicació web estàtica al Bluemix requerirà la creació de tres jobs de jenkins:\r\n\r\n* **Job de tipus BLD**: s'encarregarà de realitzar les mètriques de codi necessàries, la construcció de l'artefacte i la generació dels arxius de manifest per a cada entorn.\r\n* **Job de tipus PRE**: s'encarregarà de realitzar la construcció de l'artefacte i el desplegament a Bluemix utilitzant l'arxiu de manifest per a aquest entorn.\r\n* **Job de tipus PRO**: s'encarregarà de desplegar l'artefacte construït de forma satisfactòria en l'anterior entorn utilitzant l'arxiu de manifest per a aquest entorn.\r\n\r\n### Properes passes\r\n\r\nEn futures ampliacions del servei, es pretén donar suport a múltiples tipologies d'aplicació així com a múltiples proveïdors d'infrastructura al núvol.\r\n\r\nCom sempre, per a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDMtMzEtU0lDLURlc3BsZWdhbWVudC1kZS1zaXRlcy1zdGF0aWNzLWFsLWNsb3Vk"},"L25vdGljaWVzLzIwMTYtMDQtMTgtU0lDLVBvbGl0aXF1ZXMtcmVzcGVjdGUtbm92ZXMtYXBsaWNhY2lvbnM=":{"date":1460937600000,"title":"SIC. Polítiques d'integració respecte a noves aplicacions","description":"Des de SIC es pretén recuperar la funcionalitat original dels repositoris SVN (custòdia del codi font) i promocionar l'us de la Plataforma d'Integració Contínua per a construïr i desplegar els binaris de les aplicacions.","sections":["Notícies","home"],"Draft":true,"categories":["sic"],"key":"MAIG2016","path":"/noticies/2016-04-18-SIC-Politiques-respecte-noves-aplicacions","content":"Als seus inicis, els repositoris SVN de CTTI es van concebir per a la custòdia i versionat de codi font de les aplicacions i la Plataforma d'Integració Contínua (jobs Jenkins) per construir els binaris a partir d'aquest codi font i desplegar-los als servidors d'aplicacions.\r\n\r\nAmb el pas del temps i de manera involuntària, s'ha permés l'ús dels repositoris SVN com a font d'intercanvi de binaris de les aplicacions amb CPD per tal que aquests darrers els puguin recollir i desplegar als seus entorns. Com a conseqüència d'aquest mode de treball, l'ús de la Plataforma d'Integració Contínua per construir i desplegar aplicacions ha quedat força desplaçat.\r\n\r\n\r\nDes de SIC es pretén recuperar la funcionalitat original dels repositoris SVN (custòdia del codi font) i promocionar l'ús de la Plataforma d'Integració Contínua per a construïr i desplegar els binaris de les aplicacions.\r\n\r\nPer a tal efecte i amb l'acord de CTTI, com a part de la preparació del servei totes les noves aplicacions hauràn de fer servir els repositoris SVN per a la custòdia de codi i la Plataforma d'Integració Contínua per a construïr els binaris i desplegar l'aplicació (les que es trobin suportades).\r\n\r\nPer a les aplicacions ja existents que facin servir els repositoris SVN per a compartir els binaris amb CPD, per el moment no s'obligarà però sí s'aconsella que s'addereixin al sistema de construcció i desplegament d'aplicacions de la Plataforma d'Integració Contínua (jobs Jenkins).\r\n\r\nS'ha elaborat el següent díptic que ha de servir com a carta de presentació de SIC i sumaritza els pasos necessaris per integrar-se.\r\n\r\n<center>![descarregaLogs.PNG](/images/news/descarregaLogs.png)</center>\r\n\r\nPer a qualsevol dubte relatiu a aquest tema, ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy .\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDQtMTgtU0lDLVBvbGl0aXF1ZXMtcmVzcGVjdGUtbm92ZXMtYXBsaWNhY2lvbnM="},"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU5vZGVKUw==":{"date":1464566400000,"title":"SIC. Suport a NodeJS","description":"Suport a construcció i desplegament d'aplicacions NodeJS. Inclou resolució de dependències amb npm (Node Package Manager) per JavaScript.","sections":["Notícies","home"],"categories":["SIC"],"key":"JUNY2016","path":"/noticies/2016-05-30-SIC-NodeJS","content":"Durant el mes de Maig s'ha dotat al SIC de les eines i procediments necessaris per poder empaquetar i desplegar aplicacions [NodeJS](https://nodejs.org/) en entorns corporatius. A la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels següents documents:\r\n\r\n- <i>[Formulari d'alta d'aplicació per al Portal d'Integració Contínua (Tasques al Jenkins)](/related/sic/SIC-Formulari-Construccio-Desplegament-Aplicacio.xlsx):</i>  en aquest formulari s'ha afegit una nova pestanya \"NodeJS-Construcció,Desplegament\" amb els camps necessaris per al desplegament d'aplicacions NodeJS en entorns d'INT, PRE i PRO.\r\n- <i>[Manual d'Integració:](/related/sic/manual-integracio.pdf)</i> afegit detall dels requeriments per la integració d'aplicacions NodeJS al SIC.\r\n- <i>[Manual d'Usuari:](/related/sic/manual-usuari.pdf)</i> afegida informació per l'ús de Jenkins per tal de fer desplegaments d'aplicacions NodeJS amb el SIC.\r\n\r\nLa custòdia de codi d'aplicacions NodeJS al SVN del SIC ja era permesa, i amb l'afegit de la construcció i els desplegaments es proveeix al SIC de la possibilitat de gestionar el cicle de vida d'aplicacions desenvolupades amb aquesta tecnologia. Al SIC es resolen les dependències de l'aplicació via [npm (Node Package Manager)](https://www.npmjs.com/) a través del Nexus, motiu pel qual no és permès pujar carpetes \"node_modules\" amb el codi d'aquestes dependències. En cas de ser necessari els proveïdors d'aplicacions poden demanar la instal·lació de paquets npm propis al Nexus.\r\n\r\nDestacar que de la mateixa manera que amb aplicacions JEE i PHP, també es permet l'execució de scripts de bases de dades Oracle/MongoDB en els desplegaments automàtics a INT. Per a PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD i enviament de correu de sol·licitud de desplegament a SAU CTTI o sol·licitud de canvi a Remedy.\r\n\r\nPer a qualsevol dubte referent a la integració d'aplicacions NodeJS al SIC ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU5vZGVKUw=="},"L25vdGljaWVzLzIwMTYtMDQtMTQtQ2FuaWdvLUFkbWluaXN0cmFjaW8tTG9ncw==":{"date":1460592000000,"title":"Canigó. Nou Mòdul d'Administració de Logs","description":"Nou mòdul per al monitoratge i administració de logs d'aplicacions Canigó 3.1.","sections":["Notícies","home"],"categories":["canigo"],"key":"MAIG2016","path":"/noticies/2016-04-14-Canigo-Administracio-Logs","content":"S'ha publicat un nou mòdul de Canigó 3.1 amb la finalitat de proporcionar als proveïdors d'aplicacions eines per a l'administració i monitoratge de logs.\r\n\r\nAquest mòdul \"canigo.operation.logging\" ofereix les següents funcionalitats:\r\n\r\n### Funcionalitats\r\n\r\n#### Canviar en calent el nivell de log dels diferents paquets de l'aplicació\r\n\r\n<center>![configuracioNivellLog.PNG](/images/news/configuracioNivellLogs.PNG)</center>\r\n\r\n#### Visualització de fitxers de logs en temps real mitjançant streaming amb WebSockets\r\n\r\n<center>![visualitzacioLogs.PNG](/images/news/VisualitzacioLogs.PNG)</center>\r\n\r\n#### Descarregar els fitxers de logs\r\n\r\n<center>![descarregaLogs.PNG](/images/news/descarregaLogs.png)</center>\r\n\r\n### Plugin Canigó per Eclipse\r\n\r\nTambé s'ha publicat la versió 1.5.1 del [Plugin de Canigó per Eclipse] (/related/canigo/howto/Canigo - HowTo - Generacio aplicacio Canigo 3.1 amb plugin Eclipse.pdf) el qual inclou la possibilitat d'afegir/eliminar aquest mòdul a una aplicació Canigó 3.1.\r\n\r\nAmb el Plugin de Canigó per Eclipse, en cas de crear una aplicació amb arquitectura REST+HTML5/JS el mòdul d'administració de logs ja ve inclòs per defecte.\r\n\r\n### Aplicació Demo\r\n\r\nDes del CS Canigó es proporciona una [demo online](http://canigo-admin-logs.eu-gb.mybluemix.net/loggingAdministration.html) d'aquest nou mòdul. El codi font de la demo es troba disponible a [Github](https://github.com/cs-canigo/demoAdminLogs).\r\n\r\nPer a més informació sobre el mòdul podeu consultar la [documentació](/canigo-documentacio-versions-3x-core/modul-logging-admin/) publicada en el portal.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDQtMTQtQ2FuaWdvLUFkbWluaXN0cmFjaW8tTG9ncw=="},"L25vdGljaWVzLzIwMTYtMDUtMjgtQ2FuaWdvLVByb2NlcyBhY3R1YWxpdHphY2lvIGEgQ2FuaWdvIDMuMQ==":{"date":1464393600000,"title":"Canigó. Actualització d'aplicacions Canigó 3.0 a Canigó 3.1","description":"Recordatori del procediment per a realitzar l'actualització d'aplicacions Canigo 3.0 a Canigó 3.1","sections":["Notícies","home"],"categories":["canigo"],"key":"JUNY2016","path":"/noticies/2016-05-28-Canigo-Proces actualitzacio a Canigo 3.1","content":"Amb motiu de la recent publicació del mòdul d'[Administració de Logs de Canigó](/noticies/2016-04-14-Canigo-Administracio-Logs/), el qual té com a requisit l'ús de Canigó 3.1, us recordem com procedir per a realitzar l'actualització d'una aplicació Canigó 3.0 a Canigó 3.1. Els passos a efectuar per a realitzar l'actualització els podeu trobar en aquest [howto](/related/canigo/howto/Canig%C3%B3+-+Howto+-+Actualitzacio+Canig%C3%B3+3.0+a+Canigo+3.1.pdf).\r\n\r\nEn cas de realitzar l'actualització en una aplicació basada en arquitectura REST+HTML5/JS, i no JSF (JavaServer Faces), el frontend no es veu afectat per l'actualització. Si l'aplicació Canigó 3.0 que s'actualitza utilitza JSF cal analitzar en detall la compatibilitat de les vistes (.jsf, .xhtml) i els seus components de presentació (Primefaces, Richfaces, ...) respecte a JSF 2.2. En aquest cas l'impacte pot ser major.\r\n\r\nCanigó 3.1 es va alliberar a finals del 2014 amb els següents canvis com a més destacables:\r\n\r\n* *Actualització de llibreries*:\r\n\r\n|   | Canigó 3.0   | Canigó 3.1 |\r\n|---|--------------|------------|\r\n| __Spring Framework__ | 3.0.3.RELEASE | 4.1.0.RELEASE |\r\n| __JPA__ | 1.0 | 2.1 |\r\n| __Hibernate__ | 3.3.2.GA | 4.3.6.Final |\r\n| __Servlet API__ | 2.5 | 3.0.1 |\r\n| __JSF__ | 2.0 | 2.2 |\r\n| __PICA__ | 1.6.3  | 1.9.2 |\r\n\r\n* *Revisió de llibreries*: eliminació de llibreries innecessàries i unificació de llibreries entre els diferents mòduls\r\n\r\nPer a qualsevol dubte referent al procés d'actualització de Canigó 3.0 a 3.1 podeu obrir una consulta o petició de suport al [servei CAN del JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/CAN).\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDUtMjgtQ2FuaWdvLVByb2NlcyBhY3R1YWxpdHphY2lvIGEgQ2FuaWdvIDMuMQ=="},"L25vdGljaWVzLzIwMTYtMDYtMDgtR0lDQVItZG9jdW1lbnRhY2lv":{"date":1465344000000,"title":"GICAR. Publicació de la documentació al web d'Arquitectura","description":"Publicació de la documentació de GICAR al web d'arquitectura i les novetats en quant a l'entorn de desenvolupament","sections":["Notícies","home"],"categories":["GICAR"],"key":"JULIOL2016","path":"/noticies/2016-06-08-GICAR-documentacio","content":"Al mes de Juny es publica la documentació de GICAR a la web d'Arquitectura CTTI. \r\n\r\nAquesta documentació pretén ajudar als integradors a conèixer el funcionament de GICAR, l'arquitectura i els fluxos d'autenticació. \r\n\r\nUna fita molt important que volem destacar, és el fet que posem a disposició dels desenvolupadors, un entorn de Sandbox, públic i basat en Docker amb el qual podran fer proves de funcionament real de les aplicacions integrades amb GICAR: http://canigo.ctti.gencat.cat/gicar-integracio/sandbox/\r\n\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n\r\n![GICAR](/related/gicar/logo.png)\r\n<img src=\"/images/bloc/docker/large_h-dark-trans.png\" style=\"width:75%\" />","objectID":"L25vdGljaWVzLzIwMTYtMDYtMDgtR0lDQVItZG9jdW1lbnRhY2lv"},"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5ULWRvdE5FVA==":{"date":1438473600000,"title":"SIC. Gestió de dependències per aplicacions .NET i JAVA al SIC","description":"El SIC ha incorporat les tecnologies ANT i .NET. Us expliquem com implementar la gestió de dependències amb aquestes tecnologies.","sections":["Notícies","home"],"categories":["sic"],"path":"/noticies/2016-08-02-SIC-Gestio-Dependencies-ANT-dotNET","content":"## Gestió de dependències al SIC\r\n\r\nL'única forma fins a l'actualitat de gestionar dependències al SIC era mitjançant [Apache Maven](http://maven.apache.org/). Aquesta gestió de dependències només era possible en aplicacions JAVA i utilizava [Nexus](http://www.sonatype.com/download-oss-sonatype) com a repositori d'artefactes.\r\n\r\nUs recordem que, per defecte, no es permet la inclusió de llibreries i/o artefactes (.jar, .war, .ear, .dll...) al repositori de codi SVN del SIC. Aquests elements es poden obtenir de 3 formes diferents:\r\n\r\n* Si es tracta d'una llibreria del proveïdor, aquesta es generarà en el propi procés de construcció de l'aplicació.\r\n* Si no és una llibreria del proveïdor:\r\n\t* Si és una llibreria que es pot obtenir d'un repositori Maven / NuGet oficial, el servidor Nexus l'obtindrà en el procés  de construcció de l'aplicació.\r\n\t* Si és una llibreria que no es troba en cap repositori oficial, s'haurà de facilitar en el procés d'integracióde l'aplicació al SIC per a que sigui inclosa al repositori Nexus de forma manual.\r\n\r\nA continuació, amb l'experiència adquirida gràcies a la integració de les primeres aplicacions ANT i .NET al SIC, hem desenvolupat uns procediments per a que les aplicacions JAVA-ANT i .NET puguin gestionar dependències al SIC.\r\n\r\nSi hi esteu interessats, premeu els següents enllaços:\r\n\r\n* [Gestió de dependències amb .NET: NuGet](/noticies/2016-08-02-SIC-Gestio-Dependencies-dotNET)\r\n* [Gestió de dependències amb JAVA utilitzant ANT](/noticies/2016-08-02-SIC-Gestio-Dependencies-ANT)\r\n\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5ULWRvdE5FVA=="},"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU1vbmdvREI=":{"date":1464566400000,"title":"SIC. Suport a MongoDB","description":"Suport a la primera base de dades NoSQL al SIC. Els jobs de desplegament a INT són capaços d'executar codi Javascript per manipular documents i crear o eliminar col·leccions de documents, indexos, etc.","sections":["Notícies","home"],"categories":["SIC"],"key":"JUNY2016","path":"/noticies/2016-05-30-SIC-MongoDB","content":"Durant el mes de Maig s'ha dotat al SIC de les eines i procediments necessaris per poder donar suport a MongoDB. A  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura podeu trobar noves versions dels següents documents:\r\n\r\n- <i>[Formulari d'alta d'aplicació per al Portal d'Integració Contínua (Tasques al Jenkins)](/related/sic/SIC-Formulari-Construccio-Desplegament-Aplicacio.xlsx):</i> en aquest formulari s'ha afegit una nova pestanya \"Scripts BBDD\" amb els camps necessaris per demanar l'execució de scripts MongoDB.\r\n\r\n![Formulari scripts BBDD](/images/news/formulari_mongodb.PNG \"Formulari scripts BBDD\")\r\n\r\n- <i>[Manual d'Usuari:](/related/sic/manual-usuari.pdf)</i> afegida informació per la configuració del fitxer de plans de BBDD per a MongoDB.\r\n\r\nUn exemple de com podria quedar el fitxer de plans per a MongoDB seria el següent:\r\n\r\n![Script plans MongoDB](/images/news/plans_mongodb.PNG \"Script plans MongoDB\")\r\n\r\nL'**idBBDD** fa referència a la base de dades on s'ha d'executar el script, no al tipus (podria haver scripts per dues bases de dades MongoDB, per exemple).\r\n\r\nDestacar que l'execució de scripts només es troba disponible per als entorns d'INT. Per PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD, i enviament de correu de sol·licitud de desplegament a SAU CTTI o sol·licitud de canvi a Remedy.\r\n\r\nPer a qualsevol dubte referent a l'execució de scripts de MongoDB ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDUtMzAtU0lDLU1vbmdvREI="},"L25vdGljaWVzLzIwMTYtMDctMDQtU0lDLU15U1FMLWktU1FMU0VSVkVS":{"date":1467590400000,"title":"SIC. Suport a MySQL i Microsoft SQL SERVER","description":"Suport a les bases de dades de tipus MySQL i Microsoft SQL SERVER. Els jobs de desplegament a INT són capaços d'executar scripts DDL i DML d'aquestes bases de dades.","sections":["Notícies","home"],"categories":["SIC"],"key":"JULIOL2016","path":"/noticies/2016-07-04-SIC-MySQL-i-SQLSERVER","content":"Durant el mes de Juny s'ha dotat al SIC de les eines i procediments necessaris per poder donar suport a les bases de dades *MySQL* i *Microsoft SQL SERVER*. Aquesta nova addició de tecnologies de Bases de Dades té afectació als següents documents de  la secció de Documentació del SIC del Portal de Frameworks i Solucions d'Arquitectura:\r\n\r\n- <i>[Formulari d'alta d'aplicació per al Portal d'Integració Contínua (Tasques al Jenkins)](/related/sic/SIC-Formulari-Construccio-Desplegament-Aplicacio.xlsx):</i> a la llengüeta \"Scripts BBDD\" podreu incloure les dades de connexió a aquests tipus de bases de dades. Recordar-vos que per a cada connexió, caldrà copiar i pegar la taula amb la informació pertinent.\r\n\r\n![Formulari scripts BBDD MySQL i SQLSERVER](/images/news/SIC-formulari_ Jenkins_SQL.png \"Formulari scripts BBDD MySQL i SQLSERVER\")\r\n\r\n- <i>[Manual d'Usuari:](/related/sic/manual-usuari.pdf)</i> afegida informació per la configuració del fitxer de plans de BBDD per a aquestes bases de dades.\r\n\r\nA continuació es mostra un exemple de com podria quedar el fitxer de plans per a una aplicació amb que utilitzés aquestes bases de dades:\r\n\r\n![Script plans MySQL i SQLSERVER](/images/news/SIC-fitxer_plans.png \"MySQL i SQLSERVER\")\r\n\r\nAl fitxer de plans s'indica l'**idBBDD**. Aquest atribut fa referència al nom de la connexió que s'ha definit al formulari anterior i indica que l'script indicat s'ha d'executar a través de la connexió de base de dades amb aquest nom.\r\n\r\nDestacar que l'execució de scripts només es troba disponible per als entorns d'INT. Per PRE i PRO, els procediments de desplegament són semi-automàtics amb lliurament per sFTP d'artefactes a CPD, i enviament de correu de sol·licitud de desplegament a SAU CTTI o sol·licitud de canvi a Remedy.\r\n\r\nPer a qualsevol dubte referent a l'execució de scripts de base de dades ens podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei \"FRAMEWORK SIC\" de SAU-Remedy.\r\n","objectID":"L25vdGljaWVzLzIwMTYtMDctMDQtU0lDLU15U1FMLWktU1FMU0VSVkVS"},"L25vdGljaWVzLzIwMTYtMDctMDYtQ2xvdWQtZG9jdW1lbnRhY2lv":{"date":1467763200000,"title":"Container Cloud. Publicació de la documentació al web d'Arquitectura","description":"Ha estat publicada la documentació del Container Cloud al web d'arquitectura. En ella podreu trobar els diferents elements del catàleg, les plataformes cloud de referència, arquitectures tipus i la definició del cicle de vida de les aplicacions.","sections":["Notícies","home"],"categories":["cloud"],"key":"AGOST2016","path":"/noticies/2016-07-06-Cloud-documentacio","content":"Recentment ha estat publicada la documentació de [Container Cloud](http://canigo.ctti.gencat.cat/cloud/) a la web d'Arquitectura CTTI. Com a Container Cloud entenem totes aquelles solucions basades en containers (CaaS, Containers as a Service) a cloud públic i privat.\r\n\r\nLa documentació de Container Cloud es divideix en les següents seccions:\r\n\r\n* [**Elements del catàleg**](http://canigo.ctti.gencat.cat/cloud/cataleg/)\r\n\r\nFa referència a tots aquells elements que ens permetran desplegar les nostres aplicacions en el Container Cloud.\r\n\r\n* [**Plataformes cloud de referència**](http://canigo.ctti.gencat.cat/cloud/caas/)\r\n\r\nEnumeració de les diferents plataformes que componguen l'entorn Container Cloud.\r\n\r\n* [**Arquitectures tipus**](http://canigo.ctti.gencat.cat/cloud/aq/)\r\n\r\nEn aquesta secció podreu trobar diferents pilots d'arquitectures de referència desenvolupats per l'equip d'Administració del Cloud per tal de proveir d'exemples a tots aquells que vulguin desplegar les seves aplicacions en el Container Cloud.\r\n\r\n* [**Cicle de vida**](http://canigo.ctti.gencat.cat/cloud/lifecycle/)\r\n\r\nDetall de les diferents passes que ha de seguir una aplicació des de la seva fase inicial en què es fa el disseny d'arquitectura fins que es desplega al Container Cloud.\r\n\r\nPer qualsevol dubte relatiu al Container Cloud us podeu posar en contacte amb l'equip d'Administració del Cloud al [servei CLD del JIRA CSTD](http://cstd.ctti.gencat.cat/jiracstd/browse/CLD) o bé enviant un correu a la bústia [suport.cloud@gencat.cat](mailto:suport.cloud@gencat.cat)","objectID":"L25vdGljaWVzLzIwMTYtMDctMDYtQ2xvdWQtZG9jdW1lbnRhY2lv"},"L3NnZGUvYWJvdXQ=":{"date":1422115902000,"title":"Què és el Servei de Gestió del Document Electrònic (SGDE)","description":"Plataforma, funcionalitats i ús del servei","sections":"SGDE","toc":false,"taxonomies":[],"weight":1,"path":"/sgde/about","content":"El **Servei de Gestió del Document Electrònic** proporciona als sistemes d'informació les principals funcions necessàries per al tractament i transformació del document electrònic per tal de donar suport a l'intercanvi fiable i segur de documents i informació entre els ciutadans i la Generalitat de Catalunya.\r\n\r\nPer implementar-ho s'ha desplegat un entorn corporatiu de valor afegit, basat en el format PDF, que proporciona uns serveis d'invocació (WebServices) que poden ser utilitzats des de qualsevol llenguatge o plataforma.\r\nL'arquitectura aplicada aporta la disponibilitat i flexibilitat necessària per a absorbir la demanda estacionals dels diferents departaments (campanyes, convocatòries, etc.).\r\n\r\n## Plataformes\r\n\r\nActualment l'SGDE té integrades dues plataformes:\r\n\r\n- Plataforma de **Formularis Adobe**\r\n- **Sistema de Transformació de Documents** o STD\r\n\r\n\r\n## Funcionalitats\r\n\r\nEl servei SGDE dóna resposta a la gestió del document en les transaccions per via telemàtica entre la Generalitat i els ciutadans, empreses i/o empleats públics.\r\n\r\nLes funcionalitats que ofereix s'agrupen pel tipus de plataforma on es troben implementades;\r\n\r\n### Plataforma de Formularis Adobe \r\n\r\n- Extracció de dades d'un formulari\r\n- Creació de formularis a partir de dades\r\n- Conversió de formularis intel.ligents en documents PDF plans (aplanat de formularis)\r\n- Signatura bàsica de documents amb un certificat genèric Generalitat \r\n\r\n### Sistema de Transformació de Documents o STD \r\n\r\n- Conversió a format pdf/a per a permetre la compatibilitat amb el temps\r\n- Normalització de format: Conversió de diferents formats ofimàtics al format PDF.\r\n- Transformació de documents: El sistema permet afegir informació en qualsevol dels quatre marges de cada pàgina dels documents d'entrada (imatges, texts, números de pàgina, codis QR etc.). També permetrà afegir una marca d'aigua en qualsevol posició del document.\r\n- Codi verificació de documents: Creació d'un codi segur de verificació (CSV) per a la identificació i registre del document i posicionament d'aquest codi sobre el document.\r\n\r\n## Ús del Servei\r\n\r\nPer poder utilitzar algun dels serveis de l'SGDE és necessari donar-se d'alta en alguna de les plataformes que l'integren. Per poder fer-ho s'ha de consultar la secció \"Documentació SGDE\" d'aquesta secció i seguir els passos documentats per cada plataforma.\r\n\r\nMes informació en [oficina-tecnica.canigo.ctti@gencat.cat](mailto://oficina-tecnica.canigo.ctti@gencat.cat)\r\n\r\n","objectID":"L3NnZGUvYWJvdXQ="},"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5U":{"date":1470873600000,"title":"SIC. Gestió de dependències per aplicacions ANT","description":"Procediment de gestió de dependències amb aplicacions ANT al SIC","sections":["Notícies","home"],"categories":["sic"],"key":"SETEMBRE2016","path":"/noticies/2016-08-02-SIC-Gestio-Dependencies-ANT","content":"## Gestió de dependències amb Java utilitzant ANT\n\nPer aplicacions Java no mavenitzades, tot i que existeixen solucions com [Apache Ivy](http://ant.apache.org/ivy/), és freqüent la utilització directament d'[Apache ANT](http://ant.apache.org/) per a gestionar dependències.\n\nPer a què la gestió de dependències ANT configurada a l'aplicació sigui compatible amb el SIC, cal que compleixi els següents punts:\n\n1. Utilització d'una versió d'**ANT 1.9.2 o superior**.\n\n2. S'han d'incloure a l'inici del fitxer _build.xml_ del projecte les següents directives:\n\n\t\t(...)\n\t\t<property name=\"nexus-url\" value=\"http://hudson.intranet.gencat.cat/nexus/service/local/artifact/maven/redirect\" />\n    \n\t    <macrodef name=\"descarrega-nexus\">\n    \t    <attribute name=\"repositori\"/>\n\t        <attribute name=\"grup\"/>\n    \t    <attribute name=\"artefacte\"/>\n        \t<attribute name=\"versio\"/>\n        \t<attribute name=\"extensio\"/>\n\t        <attribute name=\"desti\"/>\n    \t    <sequential>\n            \t<echo>[NEXUS] Descarregant llibreria @{grup}.@{artefacte}-@{versio}.@{extensio}</echo>\n            \t<get src=\"${nexus-url}?r=@{repositori}&amp;g=@{grup}&amp;a=@{artefacte}&amp;v=@{versio}&amp;e=@{extensio}\" dest=\"@{desti}/@{artefacte}-@{versio}.@{extensio}\" />\n        \t</sequential>\n\t    </macrodef>\n\t\t(...)\n        \n3. Cercar al repositori Nexus del SIC la llibreria que desitgem incloure al projecte:\n\n  1. Accedim al [Nexus del SIC](http://hudson.intranet.gencat.cat/nexus)\n  2. Escrivim la llibreria que desitgem cercar:\n  <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-01.png\" style=\"margin: 10px auto;width: 80%;auto;display:block;\"/>\n  3. Ens apareixeran els resultats de la cerca:\n  <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-02.png\" style=\"margin: 10px auto;width: 80%;auto;display:block;\"/>\n  4. Seleccionem l'element desitjat. Ens apareixeran dades que necessitem informar:\n      * El grup\n      * L'artefacte\n      * La versió\n      * L'extensió\n      * Indicador del repositori (a l'esquerra)\n   <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-03.png\" style=\"margin: 10px auto;width: 80%;height: auto;display:block;\"/>\n  5. Ens falta saber el nom del repositori del qual s'ha resolt la dependència. Farem clic a *Repositoris*:\n   <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-04.png\" style=\"margin: 10px auto;display:block;\"/>\n  6. Busquem el repositori a partir de l'indicador obtingut al pas 3.4. En aquest cas, el repositori de **3rd party** és **thirdparty**:\n   <img alt=\"Cerca de la llibreria\" src=\"/images/news/SIC-ant-nexus-05.png\" style=\"margin: 10px auto;width: 80%;auto;display:block;\"/>\n4. Per a cada llibreria que tingui el projecte, invocar a la macro que hem definit en el pas 2. Com a destí, especificar la ruta (path relatiu) on guardeu les llibreries del projecte. Exemple:\n\n\t\t<descarrega-nexus repositori=\"thirdparty\" grup=\"com.liferay.portal\" artefacte=\"servlet-api\" versio=\"5.1.2\" extensio=\"jar\" desti=\"./lib/\"/>\n        \nPer a qualsevol dubte referent a la gestió de dependències amb ANT al SIC  podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei “FRAMEWORK SIC” de SAU-Remedy.\n\n","objectID":"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtQU5U"},"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtZG90TkVU":{"date":1470096000000,"title":"SIC. Gestió de dependències per a aplicacions .NET","description":"Procediment de gestió de dependències amb aplicacions .NET al SIC","sections":["Notícies","home"],"categories":["sic"],"key":"AGOST2016","path":"/noticies/2016-08-02-SIC-Gestio-Dependencies-dotNET","content":"## Gestió de dependències amb .NET: NuGet\n\nDurant la tardor del 2015, es va habilitar un nou repositori en el servidor Nexus del SIC que permet emmagatzemar llibreries .NET. Es tracta d'un repositori Nexus compatible amb [NuGet](https://www.nuget.org/). A més, es va habilitar en els servidors d'integració contínua l'ús d'aquest repositori per fer el muntatge de l'aplicació. D'aquesta manera, es garanteix que les llibreries utilitzades són fiables tant en termes de compatibilitat i fiabilitat com de seguretat.\n\n### Llibreries a tenir en compte\n\nAbans de començar, us recordem que s'han d'incloure al projecte totes les llibreries que no venen per defecte en un servidor Windows amb la instal·lació del Framework de .NET.\n\nPer exemple, un problema que hem trobat de forma recurrent és la no inclusió de les llibreries del client de base de dades Oracle.\n\nAquestes llibreries s'instal·len als servidors i als entorns de desenvolupament i queden registrades al GAC (Global Assembly Cache) del sistema. Per tant, són llibreries que no cal incloure-les al projecte, ja que tant en l'entorn de desenvolupament com en els entorns d'Integració, Preproducció i Producció ja estan registrades.\n\nUn cop l'aplicació s'integra al SIC, aquest tipus de llibreries s'han d'incloure de forma obligada en la gestió de dependències del projecte, ja que, els servidors del SIC no les tenen instal·lades.\n\n### Com funciona?\n\nTota dependència que s'hagi d'incloure a un projecte .NET es declara a l'arxiu de projecte (_XXXXX.csproj_ ó _XXXXX.vbproj_). Les llibreries que no són de sistema queden amb un format similar al següent:\n\n\t(...)\n    <Reference Include=\"Oracle.DataAccess, Version=4.121.1.0, Culture=neutral, PublicKeyToken=89b483f429c47342, processorArchitecture=x86\">\n\t\t<Private>False</Private>\n    </Reference>\n    (...)\n\nAquestes llibreries s'han de declarar al projecte com paquets NuGet. Per tant, a l'arxiu de gestió de dependències NuGet (generalment `packages.config`) s'ha de declarar aquesta dependència:\n\n    <?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <packages>\n            (...)\n        <package id=\"Oracle.DataAccess.x86\" version=\"4.121.1.0\" targetFramework=\"net40\" />\n\t\t\t(...)\n    </packages>\n\nD'aquesta manera es descarregarà la llibreria del repositori Nexus del SIC a la carpeta `/packages`.\n\nHaurem de tornar a l'arxiu de projecte i incloure el path on s'ha descarregat la dependència:\n\n\t(...)\n    <Reference Include=\"Oracle.DataAccess, Version=4.121.1.0, Culture=neutral, PublicKeyToken=89b483f429c47342, processorArchitecture=x86\">\n\t\t<HintPath>..\\packages\\Oracle.DataAccess.x86.4.121.1.0\\lib\\net40\\Oracle.DataAccess.dll</HintPath>\n\t\t<Private>False</Private>\n    </Reference>\n    (...)\n\nPer tal que l'empaquetatge de l'aplicació continuï funcionant a l'entorn de desenvolupament, caldrà afegir la referència al Repository NuGet del Nexus del SIC (http://hudson.intranet.gencat.cat/nexus/content/groups/nuget-group/) a la configuració local (arxiu `Nuget.config`).\n\nTot i així, en molts aspectes no és necessari haver d'arribar a tan baix nivell. La comunitat .NET ofereix les següents solucions (no excloents entre si):\n\n* **NuGet Package Explorer**: Per explorar paquets NuGet i construir-los visualment.\n* **NuSpec Reference Generator**: Generar dependències per a nuspec\n* **NuProj**: Creador avançat de paquets NuGet amb intergació amb Visual Studio.\n\nPer a les llibreries de codi obert publicades al NuGet Gallery i per a les llibreries pròpies del proveïdor que es construeixen amb jobs de Jenkins *LIB* no caldrà fer cap tasca addicional. Per a la resta de llibreries, com per exemple el client d'Oracle o llibreries de proveïdors que no tenen jobs de Jenkins *LIB*, caldrà facilitar-li al SIC el paquet NuGet o l'artefacte `.dll` corresponent identificant l'*arquitectura* (**x86** o **x64**), la *versió* i el *targetFramework*.\n\nPer a qualsevol dubte referent a la gestió de dependències amb NuGet al SIC  podeu [obrir una consulta](http://canigo.ctti.gencat.cat/sic/peticions/) al servei “FRAMEWORK SIC” de SAU-Remedy.","objectID":"L25vdGljaWVzLzIwMTYtMDgtMDItU0lDLUdlc3Rpby1EZXBlbmRlbmNpZXMtZG90TkVU"},"L3NnZGUtcmVsYXRlZC9pbnRyby1mb3JtdWxhcmlz":{"date":1422115902000,"title":"Formularis electrònics (eFormularis)","description":"Plataforma de formularis electrònics Adobe","sections":"SGDE","taxonomies":[],"weight":3,"path":"/sgde-related/intro-formularis","content":"El CTTI disposa d'una plataforma de formularis electrònics que permet la interacció amb formularis PDF dinàmics basats en Adobe Livecycle ES4 SP1 sota una arquitectura amb disponibilitat i tolerància a fallades.\r\n\r\nA més, i aquest és un dels principals avantatges respecte a la solució única amb Adobe, s'ofereix un servei d'accés a les funcionalitats requerides en el tractament de formularis electrònics sense cap necessitat de conèixer l'API que ofereix Adobe.","objectID":"L3NnZGUtcmVsYXRlZC9pbnRyby1mb3JtdWxhcmlz"},"L3NnZGUtcmVsYXRlZC9pbnRyby1zdGQ=":{"date":1427760000000,"title":"Sistema de Transformació de Documents (STD)","description":"STD","sections":"SGDE","taxonomies":[],"weight":3,"path":"/sgde-related/intro-std","content":"El CTTI ofereix una nova plataforma on es troba disponible el **Sistema de Transformació de Documents** o STD. Aquesta plataforma s'integra dintre del grup de Serveis del **SGDE** (Sistema de Gestió de Documents Electrònics) del CTTI juntament amb la plataforma de Formularis Electrònics.\r\n\r\nEls serveis inclosos per aquesta plataforma són:\r\n\r\n- **Transformació de documents Ofimàtics** (Word, Excel, PowerPoint, OpenOffice, etc.) a PDF.\r\n- **Conversió de documents PDF** mitjançant plantilles.\r\n- Operacions de **Translació, Rotació i Escalatge**.\r\n- Inserció de diferents tipus de **Tags de Text, Imatges, Codis QR, Codis de Barres, Codis CSV i Marques d'Aigua**.\r\n- Generació de **Codis Segurs de Validació** o CSV\r\n- **OCR** (Optical Character Recognition)\r\n\r\nQualsevol aplicació que ho sol.liciti pot treballar amb l'STD prèvia petició d'alta en la plataforma. Per fer-ho s'ha d'enviar la Plantilla d'Alta al Servei, degudament omplerta a [oficina-tecnica.canigo.ctti@gencat.cat] (mailto://oficina-tecnica.canigo.ctti@gencat.cat), sol.licitant formalment l'alta.","objectID":"L3NnZGUtcmVsYXRlZC9pbnRyby1zdGQ="},"L3NpYy9hYm91dA==":{"date":1422115902000,"title":"Què és el Servei d'Integració Continua (SIC)","description":"Conceptes, motivació i funcionalitat del servei","sections":"SIC","taxonomies":[],"weight":1,"path":"/sic/about","content":"## Conceptes i motivació\r\n\r\nLa integració de les diferents peces de programari que componen una aplicació és un repte present en tot projecte de desenvolupament. Sovint apareixen problemes com els següents:\r\n\r\n- Proves d'integració ajornades fins moments massa propers al desplegament\r\n- Alt cost de correcció dels errors\r\n- Visibilitat baixa de l'estat de construcció dels projectes\r\n- Manca d'homogeneïtat en les eines utilitzades\r\n\r\nL'existència d'un servei que gestioni el cicle de vida d'aquestes peces i permeti automatitzar certes tasques i donar visió global proporciona molts beneficis, entre els quals podem citar:\r\n\r\n- Reducció en els costos de manteniment de les aplicacions\r\n- Augment de la qualitat i fiabilitat de les aplicacions\r\n- Donar visibilitat de les activitats, lliurables i estat del desenvolupament dels projectes\r\n- Disposar d'un conjunt d'eines comunes en la construcció de les aplicacions\r\n- Establir un repositori comú on ubicar el codi font de les aplicacions\r\n- Simplificar i reduïr el temps de desplegament als diferents entorns\r\n\r\nA més, el concepte d'integració continua permet disposar permanentment d'una versió del codi provinent d'un repositori controlat i amb uns paràmetres de qualitat mesurables.\r\n\r\nEl Servei d'Integració Continua (SIC) neix amb l'objectiu de donar aquest suport al cicle de vida de manera centralitzada i amb un cost reduït, ja que està basat en tecnologies de programari lliure.\r\n\r\n<p>&nbsp;</p>\r\n\r\n## Funcionalitat del Servei\r\n\r\n### Lliurament del codi\r\n\r\nQuan l'equip de desenvolupament té una nova versió llesta per lliurar es connecta al repositori del SIC (veure detalls al Manual d'Usuari) i efectua el commit de la nova versió. Aquest commit estarà marcat amb un tag de versió que haurà de coincidir amb la versió de l'aplicació.\r\n\r\nLa persona del l'equip de desenvolupament que efectua aquesta acció és la que té el rol de Release Manager o Gestor de Lliuraments. No és la idea del Servei que tots els membres de l'equip de desenvolupament estiguin utilitzant contínuament el repositori del SIC. Se suposa que l'equip de desenvolupament ja té el seu propi repositori de codi a les seves instal·lacions i que allà és on es fan les proves pertinents fins que es considera el codi llest per lliurar.\r\n\r\n### Construcció de l'aplicació\r\n\r\nEl Gestor de Lliuraments es connecta al portal del SIC i inicia la construcció del projecte corresponent. Com a resultat de la construcció es generarà un conjunt d'artefactes, bàsicament components estàtics i dinàmics. S'executaran les proves unitàries i s'efectuaran les tasques d'anàlisi de codi. El resultat de tot això es podrà veure a la pantalla de resultats, des d'on podrà ser consultable permanentment.\r\n\r\nLa construcció del codi pot donar errors, i el procés de lliurar codi / construir serà iteratiu en el cas més general.\r\n\r\n### Versionat del codi\r\n\r\nEl el codi emmagatzemat en el repositori de codi ha d'estar marcat amb un tag de versió. La versió de les aplicacions ha de sempre incremental, és a dir, qualsevol nou actualització de códi en el subversion del SIC ha d'anar acompanyat amb un increment de la versió.\r\n\r\nNo es permetrà que una aplicació desplegui una versió d'una aplicació igual o inferior a una versió prèviament desplegada. Si no es fes així, es podria induir a confusió en els futurs desplegaments de pre-producció i producció. Per exemple, no se sabria quina versió d'integració està desplegada en l'entorn de pre-producció.\r\n\r\n### Execució de proves unitàries\r\n\r\nDins del procés de construcció dels executables s'executen les proves unitàries, que es troben definides tal com es pot veure al Normatiu J2EE.\r\n\r\nCom a resultat de l'execució de les proves unitàries s'obtenen 2 tipus d'informes:\r\n\r\n* Número total de proves i percentatge de proves passades i fallades\r\n* Percentatge de cobertura de les proves respecte del codi font\r\n\r\n### Anàlisi del codi\r\n\r\nL'anàlisi de codi és un altre dels processos que es passen dins de la tasca de construcció. A partir d'unes regles predefinides, s'analitza el codi per tal d'obtenir mètriques d'adherència a estàndards i bones pràctiques.\r\n\r\nEn el SIC utilitzem tres eines de codi obert que s'integren amb el motor Maven de construcció, anomenades Checkstyle, PMD i Findbugs. Tot i que aquestes eines ja donen un conjunt de regles predefinides a partir dels estàndards Java i els Blueprints de Sun, en el SIC utilitzem unes regles que extenen i adapten les anteriors per tal d'ajustar-se al Llibre Normatiu del Servei J2EE Central.\r\n\r\n### Visualització d'informes i gràfics\r\n\r\nEs poden visualitzar els informes i gràfics tant d'execució i cobertura de proves unitàries com d'anàlisi de codi, per cadascuna de les tasques de construcció que s'hagin iniciat històricament.\r\n\r\nAixí mateix, a la pantalla principal del portal es pot veure, per cada projecte, unes icones que indiquen el \"nivell de salut\" del projecte. Aquest nivell de salut es pot definir per cada projecte i es basa en el número de construccions que han anat bé /malament, així com del percentatge de proves i indicadors d'anàlisi.\r\n\r\n### Desplegament automatitzat a l'entorn d'Integració\r\n\r\nUn cop es té al SIC un codi versionat es pot passar a desplegar-lo a l'entorn d'Integració de Serveis Centrals.\r\n\r\nEl SIC utilitza les APIs del servidor d'aplicacions per tal d'efectuar el desplegament. L'usuari pot veure immediatament el resultat del desplegament a la consola de la tasca.\r\n\r\nEl procediment per desplegar passa per una pantalla on es tria la versió del codi a desplegar. Si el desplegament de la darrera versió va malament, es pot desplegar la versió anterior.\r\n\r\nEls desplegaments suportats són els que consten d'una part dinàmica (WAR, EAR) i opcionalment d'una part estàtica (ZIP). També es poden executar per cada desplegament scripts de bbdd (SQL, PL/SQL). En cas de que el desplegament requereixi altres accions en el entorn caldrà sol- licitar-les mitjançant una petició al SAU.\r\n\r\n### Desplegaments a PRE i PRO\r\n\r\nEl SIC no automatitza els desplegaments a PRE i PRO, però sí que automatitza la generació dels artefactes (part estàtica i dinàmica de l'aplicació), el seu enviament als entorns mitjançant SFTP, i l'enviament del correu al SAU per la petició de desplegament.\r\n\r\nEn aquests entorns tant sols es pot desplegar una aplicació que previament ja s'hagi deplegat a l'entorn d'integració satisfactoriament.\r\n\r\n### Accés per a CPD\r\n\r\nNo totes les aplicacions poden construïr els seus artefactes a desplegar mitjançant el SIC, ja sigui per que no són aplicacions Java o bé perquè no utilitzen Maven com a motor de construcció. Per a més detall dels requeriments per la integració amb el SIC per part de les aplicacions veure el [Manual Integració](/related/sic/manual-integracio.pdf). En aquests casos es permet que les aplicacions puguin lliurar els artefactes (.war, .ear, .jar, .zip, etc.) al repositori de codi del SIC, i que els administradors de CPD hi puguin accedir per a fer el desplegament de forma manual.\r\n\r\nEl procediment per sol- licitar l'accés per a CPD al SIC es troba descrit en la següent [pàgina](/sic-related/acces-cpd).","objectID":"L3NpYy9hYm91dA=="},"L3NnZGUvZG9jdW1lbnRhY2lv":{"date":1422115902000,"title":"Documentació","description":"Documentació comú, manuals i formularis específics per cada plataforma","sections":"SGDE","taxonomies":[],"weight":2,"path":"/sgde/documentacio","content":"### Presentació del servei\r\n\r\n- [Presentació](/related/sgde/Presentació-SGDE.pdf)\r\n\r\nPer poder utilitzar els serveis del SGDE és necessari donar-se d'alta en alguna de les plataformes següents:\r\n\r\n###  Plataforma de Formularis Adobe\r\n\r\n- [Sobre Formularis](/sgde-related/intro-formularis)\r\n\r\n- [Manual d'Usuari - Servei d'Invocació de Formularis](/related/sgde/Manual-Usuari-Serveis-Invocació.pdf)\r\n- [Manual d'Usuari - Autoservei](/related/sgde/Manual-Usuari-Servei-Corporatiu-de-Formularis-Electrònics-v9.pdf)\r\n\r\n- [Normatiu servei corporatiu de formularis electrònics](/related/sgde/SC-NOR15-01-Norma-servei-corporatiu-de-formularis-electrònics.pdf)\r\n- [Llibre blanc servei corporatiu de formularis - Adobe LiveCycle](/related/sgde/GE-Llibre blanc servei corporatiu de formularis.pdf)\r\n\r\n###  Sistema de Transformació de Documents o STD\r\n\r\n- [Sobre l'STD](/sgde-related/intro-std)\r\n\r\n- [Manual d'Usuari](/related/sgde/CSCanigo.MU.P00.E01_manual_usuari_STD.pdf)\r\n- [Manual de Creació de Plantilles](/related/sgde/CSCanigo.MU.P00.E01_manual_creacio_plantilles_STD.pdf)\r\n- [Manual d'Arquitectura](/related/sgde/CSCanigo.MA.P00.E01_manual_arquitectura_STD.pdf)\r\n\r\n- [Formulari d'Alta d'aplicació](/related/sgde/CSCanigo.PA.P00.STD_ALTA_ambit-aplicacio.xlsx)\r\n","objectID":"L3NnZGUvZG9jdW1lbnRhY2lv"},"L3NnZGUvZm9ybXVsYXJpcw==":{"date":1422115902000,"title":"Formularis electrònics","description":"","sections":"SGDE","taxonomies":[],"weight":3,"path":"/sgde/formularis","content":"El CTTI disposa d'una plataforma de formularis electrònics que permet la interacció amb formularis PDF dinàmics basats en Adobe Livecycle ES4 SP1 sota una arquitectura amb disponibilitat i tolerància a fallades.\r\n\r\nA més, i aquest és un dels principals avantatges respecte a la solució única amb Adobe, s'ofereix un servei d'accés a les funcionalitats requerides en el tractament de formularis electrònics sense cap necessitat de conèixer l'API que ofereix Adobe.\r\nPer a la construcció dels formularis Adobe se seguiran les recomanacions dels següents llibres normatius del CTTI:\r\n\r\n- Llibre blanc servei corporatiu de formularis\r\n- Llibre normatiu (NOR15-01 6-11-08)\r\n\r\nAquests documents i més informació com l'arquitectura de la plataforma i els procediments de treball es poden consultar dintre de l'apartat de documentació de Formularis electrònics al Portal del Centre de Suport Canigó http://canigo.ctti.gencat.cat/sgde/documentacio/\r\n","objectID":"L3NnZGUvZm9ybXVsYXJpcw=="},"L3NpYy9wZXRpY2lvbnM=":{"date":1435276800000,"title":"Peticions SIC a SAU-Remedy","description":"Guia per a obrir peticions SIC a SAU-Remedy","sections":"SIC","taxonomies":[],"weight":3,"path":"/sic/peticions","content":"Es posa a disposició dels usuaris la següent guia sobre com obrir peticions al servei de FRAMEWORK SIC a Remedy\r\n\r\n- [SIC - Howto - Obrir peticions SIC a Remedy ] (/related/sic/howto/SIC - Howto - Obrir peticions SIC a Remedy.pdf)\r\n\r\n<br/>\r\n<br/>\r\n\r\nEn cas de mancança de disponibilitat del servei Remedy, es pot obrir la petició de SIC via bústia SAU de Remedy: [sau.tic@gencat.cat](mailto:sau.tic@gencat.cat).\r\n\r\nPer tal que aquesta petició pugui ser atesa per el personal de SAU-Remedy, cal indicar la mateixa informació que s'indicaria a la petició oberta via l'eina Remedy.\r\nEl redactat ha de ser en text plà, sense incloure sintaxi HTML. Es proposa seguir les següents plantilles a l'hora del redactat del correu de petició:\r\n<br/>\r\n<br/>\r\n\r\n[**Per a consultes:**](mailto:sau.tic@gencat.cat?subject=Consulta%20sobre%20aplicaci%C3%B3%20FRAMEWORK%20SIC&body=-%20Nom%20de%20l%27aplicaci%C3%B3%3A%20FRAMEWORK%20SIC%0A-%20Codi%20de%20la%20etiqueta%20o%20el%20nom%20del%20seu%20ordinador%3A%20SIC-Consulta%0A-%20Tel%C3%A8fon%20de%20contacte%0A%0A-%20Descripci%C3%B3%20de%20la%20consulta)\r\n\r\nTítol correu: \"Consulta sobre aplicació FRAMEWORK SIC\"\r\n\r\nCos correu: Cal indicar la següent informació:\r\n\r\n\t- Nom de l'aplicació: FRAMEWORK SIC\r\n\t- Codi de la etiqueta o el nom del seu ordinador: SIC-Consulta\r\n\t- Telèfon de contacte\r\n\r\n\t- Descripció de la consulta\r\n\t\t  \r\n <br/>\r\n <br/>\r\n\r\n[**Per a reportar una incidència:**](mailto:sau.tic@gencat.cat?subject=Incid%C3%A8ncia%20sobre%20aplicaci%C3%B3%20FRAMEWORK%20SIC&body=-%20Codi%20de%20la%20etiqueta%20o%20el%20nom%20del%20seu%20ordinador%3A%20SIC-Incid%C3%A8ncia%0A-%20Tel%C3%A8fon%20de%20contacte%0A-%20Problema%0A-%20Nom%20de%20l%27aplicaci%C3%B3%3A%20FRAMEWORK%20SIC%0A%0A-%20Descripci%C3%B3%20de%20l%27error%20o%20problema%20que%20es%20mostra%20a%20la%20pantalla)\r\n\r\nTítol correu: \"Incidència sobre aplicació FRAMEWORK SIC\"\r\n\r\nCos correu: Cal indicar la següent informació:\r\n\r\n\t- Codi de la etiqueta o el nom del seu ordinador: SIC-Incidència\r\n\t- Telèfon de contacte\r\n\t- Problema\r\n\t- Nom de l'aplicació: FRAMEWORK SIC\r\n\r\n\t- Descripció de l'error o problema que es mostra a la pantalla\r\n\t\r\n<br/>\r\n<br/>\r\n\r\n[**Petició de suport:**](mailto:sau.tic@gencat.cat?subject=Petici%C3%B3%20de%20suport%20funcional%20per%20a%20l%27aplicaci%C3%B3%20FRAMEWORK%20SIC&body=-%20Urg%C3%A8ncia%3A%20Alta%2C%20Mitjana%20o%20Baixa%0A-%20Nom%20de%20l%27aplicaci%C3%B3%3A%20FRAMEWORK%20SIC%0A-%20Descripci%C3%B3%20breu%20del%20suport%0A%0A-%20Descripci%C3%B3%20detallada%20del%20suport%0A)\r\n\r\nTítol correu: \"Petició de suport funcional per a l'aplicació FRAMEWORK SIC\"\r\n\r\nAdjunts: El [formulari](http://canigo.ctti.gencat.cat/sic-documentacio/formularis/) que es correspongui amb el tipus de petició que s'està demanant\r\n\r\nCos correu: Cal indicar la següent informació:\r\n\r\n\t- Urgència: (Alta, Mitjana o Baixa)\r\n\t- Nom de l'aplicació: FRAMEWORK SIC\r\n\t- Descripció breu del suport\r\n\r\n\t- Descripció detallada del suport\r\n","objectID":"L3NpYy9wZXRpY2lvbnM="},"L3NpYy1kb2N1bWVudGFjaW8vZm9ybXVsYXJpcw==":{"date":1435276800000,"title":"Formularis","description":"Formularis de SIC","sections":"SIC","path":"/sic-documentacio/formularis","content":"### Formularis\r\n\r\n- [Formulari Gestió d'usuaris al SIC](/related/sic/SIC-Formulari-Gestio-usuaris.xlsx)<br />\r\n  Cal fer servir aquest formulari per a tramitar les altes i modificacions de dades dels usuaris que necessiten accedir al Repositori de codi font del SIC (SVN) i/o al Portal d'Integració Contínua (Jenkins). \r\n\r\n- [Formulari d'inscripció d'usuari com a Gestor de peticions SIC a SAU-Remedy](/related/sic/SIC-Formulari-Gestor-peticions-SIC-a-SAU-Remedy.xlsx)<br />\r\n  Cal fer servir aquest formulari per demanar l'autorització d'usuaris per obrir peticions de SIC a SAU-Remedy relacionades amb al Portal d'Integració Contínua (Jenkins). Per més informació sobre aquest rol, consultar el següent [article] (/noticies/2015-12-23-SIC-Nou-rol-de-peticionari-a-SAU-Remedy/). \r\n  \r\n- [Formulari d'alta d'aplicació per a la Custòdia de codi al SIC](/related/sic/SIC-Formulari-Custodia-Codi-Aplicacio.xlsx)<br />\r\n  Cal fer servir aquest formulari per a tramitar l'alta o modificació de dades d'una aplicació al Repositori de codi font del SIC (SVN). \r\n\r\n- [Formulari d'alta d'aplicació per al Portal d'Integració Contínua (Tasques al Jenkins)](/related/sic/SIC-Formulari-Construccio-Desplegament-Aplicacio.xlsx)<br />\r\n  Cal fer servir aquest formulari per a tramitar l'alta o modificació de dades dels Jobs d'una aplicació al Portal d'Integració Contínua del SIC (Jenkins). \r\n\r\n- [Formulari d'accés per a CPD al SIC](/related/sic/SIC-Formulari-CPD.xlsx)<br />\r\n  Aquest formulari està destinat a donar accés als administradors de CPD al SIC. En cas que es vulgui donar accés a un CPD a aplicacions informar els blocs \"Dades CPD\" (Fulla Dades CPD) i \"Llistat d'aplicacions\" (Fulla dades aplicacions). Si el que es vol és donar d'alta usuaris administradors de CPD també cal emplenar el bloc \"Usuaris administradors de CPD\" (Fulla Dades CPD). En cas que s'informi el camp \"Accés a artefactes al repositori de codi font\" amb valor 'Si' per algún usuari, cal que el proveïdor de l'aplicació hagi gestionat abans amb l'equip del SIC la realització d'una excepció a les restriccions que impedeixen per defecte custodiar artefactes (.war, .ear, .jar) al Subversion del SIC. \r\n\r\n  \r\n  <p>&nbsp;</p>\r\n\r\n**Notes**\r\n\r\nÉs obligatori que tant la petició de creació d'aplicació al repositori de codi font del SIC com la petició d'alta dels Jobs d'una aplicació al Portal d'Integració Contínua del SIC sigui realitzada pel responsable del projecte (persona dins el CTTI o d'un Departament).\r\n\r\nÉs obligatori que les peticions de modificació de dades sobre una aplicació donada d'alta al repositori de codi font del SIC o al Portal d'Integració Contínua del SIC sigui realitzada pel responsable tècnic de l'aplicació (persona responsable per part del proveïdor) o bé pel responsable del projecte.\r\n\r\nÉs obligatori que les peticions d'inscripció com a Gestor de peticions SIC a SAU-Remedy sigui realitzada pel responsables d'arquitectura i qualitat del Lot.\r\n\r\nPer aquelles aplicacions que no tenen codi de diàleg cal seguir el següent [procediment](/sic-related/procediment).\r\n\r\nPer a més informació relativa als grups de permisos dels usuaris, llistat d'àmbits disponibles i repositoris de codi font creats degut a l'adaptació al nou model SIC, es pot consultar la Informació sobre el [nou model TIC al SIC](/sic-related/nou-model-tic).\r\n\r\nPer a més informació relativa al sistema d'autorització de peticions SIC a SAU-Remedy, consultar el [Sistema d'autorització de peticions SIC a SAU-Remedy] (/noticies/2015-12-18-SIC-Sistema-autoritzacions-peticions/).","objectID":"L3NpYy1kb2N1bWVudGFjaW8vZm9ybXVsYXJpcw=="},"L3NnZGUvc3Rk":{"date":1422115902000,"title":"Sistema de Transformació de Documents (STD)","description":"","sections":"SGDE","taxonomies":[],"weight":4,"path":"/sgde/std","content":"El CTTI ofereix una nova plataforma on es troba disponible el Sistema de Transformació de Documents o STD. Aquesta plataforma s'integra dintre del grup de Serveis del SGDE (Sistema de Gestió de Documents Electrònics) del CTTI juntament amb la plataforma de Formularis Electrònics.\r\n\r\nEls serveis inclosos per aquesta plataforma són:\r\n\r\n- Transformació de documents Ofimàtics (Word, Excel, PowerPoint, OpenOffice, etc.) a PDF.\r\n- Conversió de documents PDF mitjançant plantilles.\r\n\t- Operacions de Translació, Rotació i Escalatge.\r\n\t- Inserció de diferents tipus de Tags de Text, Imatges, Codis QR, Codis de Barres, Codis CSV i Marques d'Aigua.\r\n- Generació de Codis Segurs de Validació o CSV\r\n\r\nQualsevol aplicació que ho sol.liciti pot treballar amb l'STD prèvia petició d'alta en la plataforma. Per fer-ho s'ha d'enviar la Plantilla d'Alta al Servei, degudament omplerta a [oficina-tecnica.canigo.ctti@gencat.cat](mailto://oficina-tecnica.canigo.ctti@gencat.cat), sol.licitant formalment l'alta.","objectID":"L3NnZGUvc3Rk"},"L3NpYy1yZWxhdGVkL2FjY2VzLWNwZA==":{"date":1427760000000,"title":"Accés per a CPD","description":"","sections":"SIC","weight":1,"path":"/sic-related/acces-cpd","content":"### Accés per a CPD\r\n\r\nPer a totes aquelles aplicacions per a les que que no és possible realitzar desplegaments automatitzats des del SIC s'ofereix la possibilitat que els administradors de CPD puguin accedir als artefactes (.war, .ear, .zip, ...) custodiats al SIC per tal de poder realitzar desplegaments en els servidors dels nous CPDs.\r\n\r\nEls administradors podran accedir indistintament tant als artefactes lliurats al Subversion com els que generi Jenkins per a una aplicació que està compilant al SIC. Amb aquesta finalitat s'ha creat el Formulari d'accés per a CPD al SIC que podeu trobar a la secció de [Documentació](/sic/documentacio). Per tal de sol- licitar aquests accessos és necessari fer arribar aquest formulari degudament emplenat al servei SIC via petició de suport al [JIRA CSTD](https://cstd.ctti.gencat.cat/jiracstd/browse/SICQ). En cas de no dispossar d'usuari o permissos en aquest servei SIC del JIRA CSTD enviar el formulari a la [bústia del SIC](mailto://sic.ctti@gencat.cat).\r\n\r\n## Procediment de desplegament\r\n\r\nÉs responsabilitat del proveïdor de l'aplicació proporcionar a l'administrador de CPD el Manual de Desplegament on indicar les instruccions per a realitzar el desplegament de l'aplicació. És en aquest manual on cal indicar quina és la ubicació dins el SIC d'on obtenir l'artefacte/s a desplegar en el CPD:\r\n\r\nExemples\r\n\r\nLliurament a Subversion:\r\nhttp://svn.intranet.gencat.cat/ctt/0192/demoApp/tags/<versio>/bin/<nom_artefacte>\r\nhttp://svn.intranet.gencat.cat/ctt/0192/demoApp/tags/<versio>/docs/<nom_doc_desplegament>\r\nLliurament a Jenkins: http://hudson.intranet.gencat.cat/hudson/job/CTTI_demoApp_BLD/<num_compilacio>/artifact/treball/target/demoApp.ear","objectID":"L3NpYy1yZWxhdGVkL2FjY2VzLWNwZA=="},"L3NpYy1yZWxhdGVkL3Byb2NlZGltZW50":{"date":1427760000000,"title":"Procediment d'alta d'aplicacions sense codi de diàleg al SIC","description":"","sections":"SIC","weight":1,"path":"/sic-related/procediment","content":"### Procediment d'alta d'aplicacions sense codi de diàleg al SIC\r\n\r\nPer aquelles aplicacions que no estan donades d'alta a l'Inventari d'Aplicacions de Gestió de Serveis cal tramitar aquesta alta prèviament a poder incorporar-la al SIC. D'aquesta manera se li assignarà un codi de diàleg, dada requerida al formulari d'alta d'aplicacions al SIC, tan si únicament es vol Custodia de Codi com si també es desitja la Construcció i Desplegament de l'aplicació a un CPD Corporatiu.\r\n\r\nL'alta a l'Inventari d'Aplicacions s'ha de realitzar emplenant la [Fitxa d'Alta d'Aplicació](/related/sic/Fitxa-Alta-App.xlsm), concretament les pestanyes \"Caracterització\" i \"NAQ Solució\", i fent-la arribar a la bústia [ogdp.suport@gencat.cat](mailto://ogdp.suport@gencat.cat). En cas de dubtes i per obtenir la darrera versió de la fitxa podeu contactar amb aquesta mateixa bústia.","objectID":"L3NpYy1yZWxhdGVkL3Byb2NlZGltZW50"},"L3NpYy1yZWxhdGVkL25vdS1tb2RlbC10aWM=":{"date":1427760000000,"title":"Nou model TIC al SIC","description":"","sections":"SIC","weight":1,"path":"/sic-related/nou-model-tic","content":"### Nou model TIC al SIC\r\n\r\nLa implantació del nou model TIC al SIC ha consistit en:\r\n\r\n- Creació d'una nova estructura del repositoris on les aplicacions s'agrupen segons el seu àmbit i codi de diàleg (abans s'agrupaven per àmbit i nom d'aplicació).\r\n- Les noves altes d'aplicació es realitzaran contra aquesta estructura.\r\n- Creació de nous grups de permissos per gestionar els accessos a aquests repositoris.\r\n- Homogeneïtzació de la llista dels d'àmbits al que poden pertanyen les aplicacions.\r\n\r\n## Nous grups de permisos\r\n\r\nA continuació s'enumeren els grups de permisos LDAP disponibles per accedir als repositoris de codi font/Portal d'Integració Contínua del SIC:\r\n\r\n- AMBIT: Es defineix un grup per cada àmbit, cadascun amb accés total al repositori de codi de les seves aplicacions SIC.\r\nEl grup està integrat pels responsables CTTI de l'àmbit. La llista d'àmbits es pot consultar al següent apartat.\r\n- RSPL_LOT: Es defineix un grup de responsables per cada lot amb accés total al repositori de codi de les aplicacions SIC del seu lot.\r\nEl grup està integrat amb els responsables d'arquitectura i qualitat dels lots.\r\n- CPD: Es defineix un grup per cada CPD dels codis de diàleg amb accés al repositori de codi de les aplicacions SIC del seu CPD.\r\n- RML_LOT_AMBIT: Es defineix un grup de release manager per a cada lot i àmbit amb accés total a les aplicacions SIC de l'àmbit que pertanyin al lot.\r\nEl grup s'integra amb les persones sol- licitades per CTTI, aquesta sol- licitud es realitzarà com una petició estàndard al SIC.\r\n- APP_CODI_DIALEG_SVN: Es defineix un grup per a cada codi de diàleg amb accés al repositori de codi.\r\nEl grup s'integra amb les persones sol- licitades per CTTI, aquesta sol- licitud es realitzarà com una petició estàndard al SIC.\r\n\r\n## Llistat d'àmbits disponibles\r\n\r\n| Codi àmbit  \t| Descripció d'àmbit  \t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| :---------- \t| :----------------- \t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| AAM\t\t\t| \tDepartament d'Agricultura, Ramaderia, Pesca, Alimentació i Medi Natural\t|\r\n| ACC\t\t\t| \tAgència Catalana del Consum\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| ACC10\t\t\t|\tACC1Ó\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| ACT\t\t\t|\tAgència Catalana de Turisme\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| ATC\t\t\t|\tAgència Tributària de Catalunya\t\t\t\t\t\t\t\t\t\t\t|\r\n| ATM\t\t\t|\tAutoritat del Transport Metropolità\t\t\t\t\t\t\t\t\t\t|\r\n| BSF\t\t\t|\tDepartament de Benestar Social i Família\t\t\t\t\t\t\t\t|\r\n| CCAC\t\t\t|\tDirecció General d'Atenció Ciutadana i Difusió\t\t\t\t\t\t\t|\r\n| CCAE\t\t\t|\tDGPAE\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| CCE\t\t\t|\tConsell Català de l'Esport\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| CLT\t\t\t|\tDEPARTAMENT DE CULTURA\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| CTT\t\t\t|\tCentre de Telecomunicacions i Tecnologies de la Informació\t\t\t\t|\r\n| DGP\t\t\t|\tDirecció General de la Policia\t\t\t\t\t\t\t\t\t\t\t|\r\n| EAD\t\t\t|\tEADOP\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| EAPC\t\t\t|\tEscola d'Administració Pública de Catalunya\t\t\t\t\t\t\t\t|\r\n| ECO\t\t\t|\tDepartament d'Economia i Coneixement\t\t\t\t\t\t\t\t\t|\r\n| EMO\t\t\t|\tDepartament d'Empresa i Ocupació\t\t\t\t\t\t\t\t\t\t|\r\n| ENS\t\t\t|\tDepartament d'Ensenyament\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| GRI\t\t\t|\tDepartament de Governació i Relacions Institucionals\t\t\t\t\t|\r\n| ICA\t\t\t|\tICAEN\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| ICS\t\t\t|\tICS\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| INT\t\t\t|\tDepartament d'Interior\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| JUS\t\t\t|\tDepartament de Justícia\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| PRE\t\t\t|\tDepartament de la Presidència\t\t\t\t\t\t\t\t\t\t\t|\r\n| SCT\t\t\t|\tServei Català de Trànsit\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| SEM\t\t\t|\tServei d'Emergències Mèdiques\t\t\t\t\t\t\t\t\t\t\t|\r\n| SLT\t\t\t|\tDepartament de Salut\t\t\t\t\t\t\t\t\t\t\t\t\t|\r\n| SOC\t\t\t|\tServei d'Ocupació de Catalunya (SOC)\t\t\t\t\t\t\t\t\t|\r\n| SUR\t\t\t|\tSecretaria d'Universitats i Recerca\t\t\t\t\t\t\t\t\t\t|\r\n| TES\t\t\t|\tDepartament de Territori i Sostenibilitat\t\t\t\t\t\t\t\t|\r\n\r\n## Repositoris de codi que ja es troben creats de forma massiva\r\n\r\nL'equip de SIC en data 10-9-2014 va realitzar la creació massiva de repositoris de codi per a les aplicacions que figuren en aquest [Inventari d'Aplicacions](/related/sic/Inventari_SIC_140910.xlsx).","objectID":"L3NpYy1yZWxhdGVkL25vdS1tb2RlbC10aWM="},"L3NpYy1kb2N1bWVudGFjaW8vbWFudWFscw==":{"date":1435276800000,"title":"Manuals de SIC","description":"Manuals de SIC","sections":"SIC","path":"/sic-documentacio/manuals","content":"### Manuals\r\n\r\n- [Manual d'Usuari](/related/sic/manual-usuari.pdf)\r\n- [Manual d'Integració](/related/sic/manual-integracio.pdf)\r\n- [Manual d'Arquitectura](/related/sic/manual-arquitectura.pdf)\r\n\r\n\r\n<p>&nbsp;</p>\r\n\r\n**Notes**\r\n\r\nÉs obligatori que tant la petició de creació d'aplicació al repositori de codi font del SIC com la petició d'alta dels Jobs d'una aplicació al Portal d'Integració Contínua del SIC sigui realitzada pel responsable del projecte (persona dins el CTTI o d'un Departament).\r\n\r\nÉs obligatori que les peticions de modificació de dades sobre una aplicació donada d'alta al repositori de codi font del SIC o al Portal d'Integració Contínua del SIC sigui realitzada pel responsable tècnic de l'aplicació (persona responsable per part del proveïdor) o bé pel responsable del projecte.\r\n\r\nPer aquelles aplicacions que no tenen codi de diàleg cal seguir el següent [procediment](/sic-related/procediment).\r\n\r\nPer a més informació relativa als grups de permisos dels usuaris, llistat d'àmbits disponibles i repositoris de codi font creats degut a l'adaptació al nou model SIC, es pot consultar la Informació sobre el [nou model TIC al SIC](/sic-related/nou-model-tic).\r\n\r\n\r\n","objectID":"L3NpYy1kb2N1bWVudGFjaW8vbWFudWFscw=="},"L3NpYy1kb2N1bWVudGFjaW8vaG93LXRvcw==":{"date":1435276800000,"title":"How to","description":"Altres documents d'interés per a l'ús del SVN o Jenkins","sections":"SIC","path":"/sic-documentacio/how-tos","content":"Un how-to és un document informal, generalment breu, que descriu com desenvolupar una certa tasca.\r\n\r\nEn aquest apartat s'aniran afegint un seguit de how-to, per tal de facilitar l'ús dels components de SIC. Aquests documents estan disponibles en format pdf o pptx.\r\n\r\n- [SIC - Howto - Obrir peticions SIC a Remedy] (/related/sic/howto/SIC - Howto - Obrir peticions SIC a Remedy.pdf)\r\n\r\n- [SIC - Accés Tasques de Gestio del Framework SIC (versió oficial Remedy)] (/related/sic/howto/Acces Tasques de Gestio del Framework SIC.pptx)","objectID":"L3NpYy1kb2N1bWVudGFjaW8vaG93LXRvcw=="}}