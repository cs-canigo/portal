<!DOCTYPE html>
<html xml:lang="ca-ES" lang="ca-ES" xmlns="http://www.w3.org/1999/xhtml">
<head>

	<title>SAP</title>
		<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
	<link href="/css/master.min.css" rel="stylesheet" type="text/css" />
	<link href="/css/canigo.css" rel="stylesheet" type="text/css" />
	<script src="/js/jquery.min.js" type="text/javascript"></script>

	<script>
		document.write("<meta name=\"titol\" content=\"SAP\" />");
		document.write("<meta name=\"description\" content=\"Interficie d\x27accés als Backends SAP de la Generalitat.\" />");
	</script>

	

</head>
<body class="single">
	<div class="contenidor unfixed">

				

		<header class="fons_header navbar navbar-default z-index-menu">
			<div class="container" role="menu">
				<div class="row clearfix menuNav">
					<div class="col-md-3 col-xs-3 column visible-xs coloca ">
						<button type="button" onclick="amunt();" title="Menu"
							class="navbar-toggle pull-left" data-toggle="collapse"
							data-target=".navbar-collapse">
							<span class="sr-only">Toggle navigation</span> <span
								class="icon-bar"></span> <span class="icon-bar"></span> <span
								class="icon-bar"></span>
						</button>
					</div>

					<div class="col-md-3 col-xs-6 col-offset-2 column visible-xs titol-mobil">
						
						<span class="white titol-mobil-destacat">canigo.ctti</span><span class="white">.gencat.cat</span>
					</div>

					<div class="col-md-3 col-xs-3 column visible-xs coloca1">
						<button onclick="amunt();" type="button" title="Cerca"
							class="ico_cerca " data-toggle="collapse" data-target=".dos">
						</button>
					</div>

				</div>

				<div class="collapse dos">
					<div class="shadowBox">
						<form class="navbar-form navbar-left primer" action="/cercador/" method="get"
 						onsubmit="location.href=this.action+'?q='+this.cerca_cap.value; return false;">
							<div class="form-group">
								<input type="search" class="form-control" name="q" id="cerca_cap"
									title="Cerca"
									placeholder="Cerca" />
								<button type="button" title="Neteja" class="btn btn-default"></button>
								<input type="submit" class="ocult" name="Cerca" value="Cerca" />
							</div>
						</form>
					</div>
				</div>	

				<nav class="collapse navbar-collapse navbar-ex1-collapse ">
				
					<div class="row">
						<div class="col-md-6 col-sm-4 column">
							<a class="img-responsive logo" title="Generalitat de Catalunya"
								href="http://ctti.gencat.cat/">gencat.cat</a>
							<button class="menu_tancar visible-xs collapsed"
								data-target=".navbar-collapse" data-toggle="collapse"
								title="Tancar"></button>
						</div>

						<div class="col-md-6 col-sm-8 column hidden-xs hidden-mg">
							<form class="navbar-form cercador_vermell hidden-xs pull-right" action="/cercador/"  method="get" onsubmit="location.href=this.action+'?q='+this.cerca2.value; return false;">
								<div class="form-group">
									<label class="hidden" for="cerca2">Cerca</label>
									<input id="cerca2" class="form-control" type="search" 
									placeholder="Cerca" name="q" title="Cerca">
									<input class="btn btn-default" type="submit" title="Cerca" value="">
								</div>
							</form>

							

						</div>

					</div>
					<div class="col-xs-12 hidden-xs" id="nomPortal">
                    	<span class="titol-cap-nou">Arquitectura CTTI</span>
                    </div>					
					<ul class="nav navbar-nav">

			        	

						<li>
							<a target='_self' class="dropdown-toggle" href='/' data-toggle='_dropdown'>Inici</a>
						</li>

						

						<li>
							<a target='_self' class="dropdown-toggle" href='/principis/' data-toggle='_dropdown'>Principis d&#39;arquitectura</a>
						</li>

						

						<li>
							<a target='_self' class="dropdown-toggle" href='/bloc/' data-toggle='_dropdown'>Bloc</a>
						</li>

						

						<li>
							<a target='_self' class="dropdown-toggle" href='/cloud/' data-toggle='_dropdown'>Cloud</a>
						</li>

						

						<li>
							<a target='_self' class="dropdown-toggle" href='/canigo/' data-toggle='_dropdown'>Canigó</a>
						</li>

						

						<li>
							<a target='_self' class="dropdown-toggle" href='/sic/' data-toggle='_dropdown'>SIC</a>
						</li>

						

						<li>
							<a target='_self' class="dropdown-toggle" href='/sgde/' data-toggle='_dropdown'>SGDE</a>
						</li>

						

						<li>
							<a target='_self' class="dropdown-toggle" href='/gicar/' data-toggle='_dropdown'>GICAR</a>
						</li>

						

						<li>
							<a target='_self' class="dropdown-toggle" href='/cs/' data-toggle='_dropdown'>Centres de Suport</a>
						</li>

						

					</ul>

				</nav>
			</div>
		</header>



	</div>

	<section class="border-start">

						
			

			<article class="bgGrey">
				<div class="container">	
					<div class="row">
						<div class="capcelera_basica col-sm-12">
							<div class="capcelera_basica_cont">
								<ol class="breadcrumb filariana hidden-xs">
									<li>
										<a href="/">Inici</a>
									</li>
									<li class="breadcrumbs2">
									
										<a href="/canigo-documentacio-versions-3x-integracio">
											






















										</a>
										


















	<a href="/canigo/">Framework Canigó</a> </li>
	<li>
		<a href="/canigo-documentacio/">Documentació</a>
	</li>

	<li>
		<a href="/canigo-documentacio-versions/">Versions</a>
	</li>
	
	<li>
		<a href="/canigo-documentacio-versions-3x">Versió 3.x</a>
	</li>

	<li>
		
			<a href="/canigo-documentacio-versions-3x-integracio">Mòduls d'Integració</a>
		





































									
									</li>
									
									<li>
										SAP
									</li>
									

								</ol>

								<h1 class="capcelera_flotant pull-left" data-txt=".title">
									
										SAP
									
								</h1>

								

								
								
									
								

																	

							</div>
						</div>

					</div>
				</div>
			</article>

			
			<article class="padding-xs padding-sm padding-md contingut">				
				<div class="container">
 		
					
				

	


					

						

<h2 id="propòsit:dc9f209b3875087ae2f06bd4632533ea">Propòsit</h2>

<p>El propòsit del connector és proporcionar una interfície simplificada per accedir a backends SAP de la Generalitat.</p>

<h2 id="instal-lació-i-configuració:dc9f209b3875087ae2f06bd4632533ea">Instal.lació i Configuració</h2>

<h3 id="instal-lació:dc9f209b3875087ae2f06bd4632533ea">Instal.lació</h3>

<p>Per poder utilitzar el connector haurem de configurar el projecte perquè inclogui dues llibreries dll i diferents jars:</p>

<p>Les llibreries són sapjcorfc.dll i librfc32.dll i s&rsquo;han de copiar al directori system32.</p>

<p>Per fer les operacions sobre el sistema SAP és necessària la utilització del jar sapjco-2.1.6, que és el connector propi del SAP per fer les crides a les seves funcions BAPI (RFC).</p>

<p>Les classes que utilitzarem per fer els objectes d&rsquo;operacions estan en el jar del connector Gecat09 canigo-connectors-gecat09-2.3.2.jar</p>

<p>Les classes que utilitzarem per fer les operacions han estat generades amb una eina Open Source anomenada JAXB (Java API for Xml Binding), que genera classes java a partir d&rsquo;un esquema de xml (XMLSchema). Aquesta eina ens permet no solament generar automàticament classes java sinó també fer validacions per comprovar que les dades que contenen els objectes són vàlides. Per això també haurem d&rsquo;incloure els jars que necessita JAXB:</p>

<ul>
<li>jaxb-api-1.0.1.jar</li>
<li>jaxb-libs-1.0.1.jar</li>
<li>jaxb-impl-1.0.1.jar</li>
<li>jax-qname-1.1.jar</li>
<li>namespace-1.0.1.jar</li>
<li>relaxngDatatype-1.0.1.jar</li>
<li>xsdlib-1.1.2.jar</li>
</ul>

<p>Per tal d&rsquo;instal-lar el mòdul de SAP es pot incloure automàticament a través de l&rsquo;eina de suport al desenvolupament o bé afegir manualment en el pom.xml de l&rsquo;aplicació la següent dependència:</p>

<pre><code>&lt;canigo.integration.sap.version&gt;[1.1.0,1.2.0)&lt;/canigo.integration.sap.version&gt;
-
&lt;dependency&gt;
          &lt;groupId&gt;cat.gencat.ctti&lt;/groupId&gt;
          &lt;artifactId&gt;canigo.integration.sap&lt;/artifactId&gt;
          &lt;version&gt;${canigo.integration.sap.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h3 id="configuració:dc9f209b3875087ae2f06bd4632533ea">Configuració</h3>

<p>La configuració es realitza automàticament a partir de l&rsquo;eina de suport al desenvolupament.</p>

<p>Ubicació: <PROJECT_ROOT>/src/main/resources/config/props/sap.properties</p>

<table>
<thead>
<tr>
<th>Propietat</th>
<th>Requerit</th>
<th>Descripció</th>
</tr>
</thead>

<tbody>
<tr>
<td>*.sap.client</td>
<td>Sí</td>
<td>Client</td>
</tr>

<tr>
<td>*.sap.username</td>
<td>Sí</td>
<td>Usuari de connexió</td>
</tr>

<tr>
<td>*.sap.password</td>
<td>Sí</td>
<td>Password de connexió</td>
</tr>

<tr>
<td>*.sap.language</td>
<td>Sí</td>
<td>Idioma</td>
</tr>

<tr>
<td>*.sap.hostname</td>
<td>Sí</td>
<td>Nom del servidor</td>
</tr>

<tr>
<td>*.sap.systemNumber</td>
<td>Sí</td>
<td>SAP system number</td>
</tr>

<tr>
<td>*.sap.connectionPool</td>
<td>No</td>
<td>Connexió amb pool. Per defecte: true</td>
</tr>

<tr>
<td>*.sap.connectionPoolName</td>
<td>No</td>
<td>Nom del pool. Per defecte: poolCanigoSAP</td>
</tr>

<tr>
<td>*.sap.maxNumConnections</td>
<td>No</td>
<td>Número de connexions màximes. Per defecte: 5</td>
</tr>

<tr>
<td>*.sap.repositoryName</td>
<td>No</td>
<td>Nom del repository. Per defecte: ARAsoft</td>
</tr>
</tbody>
</table>

<h2 id="utilització-del-mòdul:dc9f209b3875087ae2f06bd4632533ea">Utilització del Mòdul</h2>

<h3 id="jsf:dc9f209b3875087ae2f06bd4632533ea">JSF</h3>

<p>Per a configurar el mòdul és necessari:</p>

<pre><code>Crear un managed bean de JSF que contingui la lògica d'invocació al servei SAP.
Pàgina JSF per a realitzar la invocació al managed bean.
</code></pre>

<p><strong>SAPBean.java</strong></p>

<p>Managed Bean de JSF que gestiona la crida al servei de SAP.</p>

<p>En aquest bean es pot veure:</p>

<ul>
<li>Inyecció del conector de SAP via annotacions (@Autowired) de Spring.</li>
<li>Inyecció del servei d&rsquo;internacionaliztació via annotacions (@Autowired) de Spring.</li>
<li>Invocació de la funció BAPI_MATERIAL_GETLIST, taula MATNRSELECTION.</li>
<li>Inserció del missatge de resultat de l&rsquo;operació que posteriorment sera recuperat pel formulari JSF.</li>
<li>En la classe MaterialBean s&rsquo;introduirà el resultat de l&rsquo;invocació de la funció SAP de manera transparent.</li>
</ul>

<pre><code class="language-java">/**
 * Classe d'exemple d'invocació al servei de SAP
 *
 * @author cscanigo
 *
 */
@Component(&quot;sapBean&quot;)
@Lazy
public class SAPBean {

    @Autowired
    private SapConnector connector;
    @Autowired
    private I18nResourceBundleMessageSource resource;

        /**
         * Execució de la funció SAP BAPI_MATERIAL_GETLIST
         *
         */
    public void execute(){
        try{
            this.connector.connect();
            Collection&lt;Object&gt; col = this.connector.executeFunction(&quot;BAPI_MATERIAL_GETLIST&quot;,
                    &quot;MATNRSELECTION&quot;, null, MaterialBean.class);

            FacesContext.getCurrentInstance().addMessage(&quot;sapForm&quot;, new FacesMessage(
                    FacesMessage.SEVERITY_INFO, resource.getMessage(&quot;sapSuccess&quot;) + &quot;: &quot; + col.size(), null));
        }catch(Exception e){
            FacesContext.getCurrentInstance().addMessage(&quot;sapForm&quot;, new FacesMessage(
                    FacesMessage.SEVERITY_ERROR, resource.getMessage(&quot;sapError&quot;) + &quot; - &quot; + e.getMessage(), null));
        }finally{
            this.connector.disconnect();
        }
    }

}
</code></pre>

<p><strong>sap.jsf</strong></p>

<p>Invocació del métode &ldquo;execute&rdquo; del managed bean de JSF definit anteriorment com a &ldquo;sapBean&rdquo;. El Tag message mostrarà el resultat de la crida (veure FacesContext.getCurrentInstance().addMessage(&ldquo;sapForm&rdquo;&hellip;.).</p>

<pre><code>&lt;h:form id=&quot;sapForm&quot;&gt;
   &lt;h:panelGrid columns=&quot;1&quot;&gt;
      &lt;h:commandButton value=&quot;#{msg.canigoSubmit}&quot; action=&quot;#{sapBean.execute}&quot; /&gt;
      &lt;h:message for=&quot;sapForm&quot; infoStyle=&quot;color: green;&quot; errorStyle=&quot;color: red;&quot; /&gt;
   &lt;/h:panelGrid&gt;
&lt;/h:form&gt;
</code></pre>


					

					
				</div>	

			</article>	


	</section>	

		<div class="fons_footer ">
		<footer class="container center-block shadowBox2">
			<div class="shadow2"></div>
			<div class="row footer_tab_ord">

				<div class="footer_tab_bot col-sm-12">
					<div class="avis_legal">

						<div id="fAvisLegal">
							<div>
								<div class="hidden-xs">
									<a href="http://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" alt="www.gencat.cat"
										/></a>
									<p>
										<a title="Avis legal" href="http://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								<div class="visible-xs avis_legal">
									<p>
										<a title="Avis legal" href="http://web.gencat.cat/ca/menu-ajuda/ajuda/avis_legal/" target="_self">Avís legal</a>: La &copy; Generalitat de Catalunya permet la reutilització dels continguts i de les dades sempre que se citi la font i la data d'actualització, que no es desnaturalitzi la informació i que no es contradigui amb una llicència específica.
									</p>
								</div>
								
								<div class="fi_peu visible-xs">
									<a title="www.gencat.cat" href="http://www.gencat.cat"> <img
										src="/img/logo_generalitat_gris.png_679097835.png"
										width="101" height="27" 
										alt="www.gencat.cat" /></a> <a class="torna_amunt pull-right"
										href=" javascript:tornarAmunt();" title="Torna amunt">
										<p>Torna amunt</p>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
	</div>

<script src="/js/master.min.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
<script src="/js/custom.js" type="text/javascript"></script>



<script type="text/javascript">

if(location.hostname!=="localhost"){

	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', "UA-59408075-1", 'auto');
	ga('send', 'pageview', {
	  	'page': location.pathname + location.search  + location.hash
	  }
	);

}

</script>



</body>
</html>
